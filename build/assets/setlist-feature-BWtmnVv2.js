import{r as m,j as e,R as de}from"./react-vendor-BoGJM_Cg.js";import{D as G,a as V,b as W,c as X,d as le,f as o,S as xe,I as F,u as ne,B as z,L as ye,o as we,e as L,C as Se,s as be,v as Ce,r as De,p as me,q as he}from"./library-feature-DCPrmRLD.js";import{P as K,D as H,S as ke,x as Y,j as ue,y as Ae,z as Te,T as ae,M as Ie,v as oe,B as Ee,H as Oe,J as Pe}from"./icons-vendor-4kQF2o2m.js";import{T as ze}from"./player-feature-DuzHldha.js";function Ke({open:h,onOpenChange:y,song:C,setlists:U,songs:$,onAddToSetlist:M,onCreateSetlist:T,onImportSetlist:w}){const[D,v]=m.useState("select"),[n,I]=m.useState(""),[p,d]=m.useState(""),S=U.filter(c=>c.name.toLowerCase().includes(p.toLowerCase())),b=()=>{n.trim()&&(T(n,C.id),I(""),v("select"),y(!1))},g=c=>{M(c,C.id),y(!1)};return e.jsx(G,{open:h,onOpenChange:y,children:e.jsxs(V,{className:"sm:max-w-[500px]",children:[e.jsxs(W,{children:[e.jsxs(X,{children:['Add "',C.title,'" to Setlist']}),e.jsx(le,{children:"Choose a setlist or create a new one"})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[D==="select"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",className:"flex-1",onClick:()=>v("create"),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"New Setlist"]}),e.jsxs(o,{variant:"outline",className:"flex-1",onClick:()=>v("import"),children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Import Setlist"]})]}),e.jsx(xe,{}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(F,{placeholder:"Search setlists...",value:p,onChange:c=>d(c.target.value),className:"pl-9"})]}),e.jsx(ne,{className:"h-[300px]",children:e.jsx("div",{className:"space-y-2",children:S.length>0?S.map(c=>{const N=c.items.some(f=>f.type==="song"&&f.id===C.id),j=c.items.filter(f=>f.type==="song").length;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:c.name}),e.jsxs(z,{variant:"secondary",className:"text-xs",children:[j," ",j===1?"song":"songs"]})]})}),N?e.jsx(z,{variant:"outline",className:"text-green-600 border-green-600",children:"Added"}):e.jsx(o,{size:"sm",onClick:()=>g(c.id),children:"Add"})]},c.id)}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No setlists found"}),e.jsx(o,{variant:"link",onClick:()=>v("create"),className:"mt-2",children:"Create your first setlist"})]})})})]}),D==="create"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ye,{htmlFor:"setlist-name",children:"Setlist Name"}),e.jsx(F,{id:"setlist-name",placeholder:"e.g., Sunday Service, Concert 2024...",value:n,onChange:c=>I(c.target.value),onKeyDown:c=>{c.key==="Enter"&&b()},autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>v("select"),children:"Cancel"}),e.jsxs(o,{onClick:b,disabled:!n.trim(),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Create & Add Song"]})]})]}),D==="import"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("h4",{className:"mb-2",children:"Import Setlist"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Import setlists from Planning Center, ChurchTools, or JSON file"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{variant:"outline",className:"w-full",onClick:w,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Import from Planning Center"]}),e.jsxs(o,{variant:"outline",className:"w-full",onClick:w,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Import from ChurchTools"]}),e.jsxs(o,{variant:"outline",className:"w-full",onClick:w,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Import from JSON File"]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(o,{variant:"outline",onClick:()=>v("select"),children:"Back"})})]})]})]})})}function Le({setlist:h,songs:y,onClose:C,onUpdateItems:U,onAddNote:$,onUpdateNote:M,onDeleteNote:T,onDeleteSong:w,onAddSongClick:D,onSongClick:v}){const[n,I]=m.useState(!0),[p,d]=m.useState(null),[S,b]=m.useState(""),[g,c]=m.useState(null),[N,j]=m.useState(""),[f,k]=m.useState(null),E=t=>y.find(x=>x.id===t),O=(t,x)=>{n||(k(x),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",t.currentTarget.innerHTML))},R=(t,x)=>{n||f===null||(t.preventDefault(),t.dataTransfer.dropEffect="move")},Q=(t,x)=>{if(!(n||f===null)){if(t.preventDefault(),f!==x){const l=[...h.items],[A]=l.splice(f,1);l.splice(x,0,A),U(l)}k(null)}},Z=()=>{k(null)},_=t=>{n||(d(t.id),b(t.content))},J=()=>{p&&!n&&M(p,S),d(null),b("")},B=t=>{n||(c(t),j(""))},P=()=>{g!==null&&N.trim()&&!n&&$(N.trim(),g),c(null),j("")},ee=(t,x)=>{!n&&window.confirm(`Remove "${x}"?`)&&w(t)},se=t=>{!n&&window.confirm("Delete note?")&&T(t)};return e.jsxs(V,{className:"sm:max-w-[600px] h-[80vh] flex flex-col",children:[e.jsxs(W,{children:[e.jsxs(X,{className:"flex justify-between items-center pr-10",children:[e.jsx("span",{className:"truncate",children:h.name}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>I(!n),className:L("w-8 h-8",n?"text-gray-500 hover:text-gray-700":"text-blue-500 hover:text-blue-700"),children:n?e.jsx(oe,{className:"w-5 h-5"}):e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs(le,{children:["Reorder, add notes/songs. ",n?"Unlock":"Lock"," via ",e.jsx(oe,{className:"w-3 h-3 inline"})," icon to"," ",n?"edit":"prevent edits","."]})]}),e.jsx(ne,{className:"flex-1 -mx-6 px-6 border-y",children:e.jsxs("div",{className:"py-4 space-y-1",children:[h.items.map((t,x)=>e.jsxs(de.Fragment,{children:[!n&&e.jsx("div",{className:"flex justify-center my-1 h-6 items-center",children:g===x?e.jsxs("div",{className:"flex items-center gap-1 w-full p-1 bg-yellow-100 rounded border border-yellow-300",children:[e.jsx(F,{placeholder:"Enter note...",value:N,onChange:l=>j(l.target.value),className:"flex-1 text-sm italic h-7 px-2",autoFocus:!0,onKeyDown:l=>{l.key==="Enter"&&P(),l.key==="Escape"&&c(null)},onBlur:()=>setTimeout(()=>{g===x&&c(null)},100)}),e.jsx(o,{size:"sm",onClick:P,disabled:!N.trim(),className:"h-7 px-2 text-xs",children:"Add"}),e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>c(null),className:"h-7 px-2 text-xs",children:"Cancel"})]}):e.jsxs(o,{variant:"ghost",size:"sm",className:"text-xs text-blue-600 hover:bg-blue-50 h-6 px-2 opacity-50 hover:opacity-100",onClick:()=>B(x),children:[e.jsx(K,{className:"w-3 h-3 mr-1"})," Add Note Here"]})}),e.jsxs("div",{draggable:!n,onDragStart:l=>O(l,x),onDragOver:l=>R(l),onDrop:l=>Q(l,x),onDragEnd:Z,className:L("flex items-center gap-2 p-2 rounded transition-all",n?"opacity-90":"hover:bg-gray-50 shadow-sm cursor-move",t.type==="note"?"bg-yellow-50/50":"bg-white",f===x&&"opacity-50"),children:[!n&&e.jsx("div",{className:"text-gray-400 hover:text-gray-600 p-1 cursor-grab active:cursor-grabbing","aria-label":"Drag to reorder",children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-gray-400 w-6 text-right font-medium",children:[x+1,"."]}),t.type==="song"?(()=>{const l=E(t.id),A=l?.title||"Unknown Song",te=l?.artist||"Unknown Artist";return e.jsxs("div",{className:"flex-1 flex justify-between items-center min-w-0 gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>v(t.id),title:`Go to song: ${A}`,children:[e.jsx("p",{className:"truncate font-medium cursor-pointer hover:text-blue-700 hover:underline",children:A}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:te})]}),!n&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-500 hover:bg-red-100 hover:text-red-600 shrink-0",onClick:()=>ee(t.id,A),"aria-label":`Remove ${A}`,children:e.jsx(ae,{className:"w-4 h-4"})})]})})():e.jsxs("div",{className:"flex-1 flex items-center gap-2 text-sm italic text-gray-700 min-w-0",children:[p===t.id?e.jsx(e.Fragment,{children:e.jsx(ze,{value:S,onChange:l=>b(l.target.value),rows:1,className:"flex-1 text-sm italic bg-white",autoFocus:!0,onBlur:J,onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),J()),l.key==="Escape"&&(d(null),b(""))}})}):e.jsx("span",{className:"flex-1 whitespace-pre-wrap py-1 cursor-text",onClick:()=>_(t),children:t.content}),!n&&p!==t.id&&e.jsxs("div",{className:"ml-auto flex items-center shrink-0",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-500 hover:bg-yellow-100 hover:text-gray-700",onClick:()=>_(t),"aria-label":"Edit note",children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-500 hover:bg-red-100 hover:text-red-600",onClick:()=>se(t.id),"aria-label":"Delete note",children:e.jsx(ae,{className:"w-4 h-4"})})]})]})]})]},t.id)),!n&&e.jsx("div",{className:"flex justify-center mt-3 h-6 items-center",children:g===h.items.length?e.jsxs("div",{className:"flex items-center gap-1 w-full p-1 bg-yellow-100 rounded border border-yellow-300",children:[e.jsx(F,{placeholder:"Enter note...",value:N,onChange:t=>j(t.target.value),className:"flex-1 text-sm italic h-7 px-2",autoFocus:!0,onKeyDown:t=>{t.key==="Enter"&&P(),t.key==="Escape"&&c(null)},onBlur:()=>setTimeout(()=>{g===h.items.length&&c(null)},100)}),e.jsx(o,{size:"sm",onClick:P,disabled:!N.trim(),className:"h-7 px-2 text-xs",children:"Add"}),e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>c(null),className:"h-7 px-2 text-xs",children:"Cancel"})]}):e.jsxs(o,{variant:"ghost",size:"sm",className:"text-xs text-blue-600 hover:bg-blue-50 h-6 px-2 opacity-50 hover:opacity-100",onClick:()=>B(h.items.length),children:[e.jsx(K,{className:"w-3 h-3 mr-1"})," Add Note Here"]})})]})}),e.jsxs(me,{className:"pt-4 border-t gap-2 sm:justify-end",children:[!n&&e.jsxs(o,{variant:"outline",onClick:D,className:"mr-auto sm:mr-0",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"})," Add Song"]}),e.jsx(he,{asChild:!0,children:e.jsx(o,{variant:"outline",children:"Close"})})]})]})}function Fe({setlists:h,songs:y,onSongClick:C,onCreateSetlist:U,onUpdateSetlist:$,onDeleteSetlist:M,onReorderSetlists:T}){const[w,D]=m.useState(""),[v,n]=m.useState(!1),[I,p]=m.useState(!1),[d,S]=m.useState(null),[b,g]=m.useState(!1),[c,N]=m.useState(""),[j,f]=m.useState(new Set),[k,E]=m.useState(null),[O,R]=m.useState([]),Q=()=>{w.trim()&&(U(w),D(""),n(!1))},Z=s=>y.find(a=>a.id===s)?.title||"Unknown Song",_=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):null,J=(s,a)=>{s.stopPropagation(),f(r=>{const i=new Set(r);return i.has(a)?i.delete(a):i.add(a),i})};m.useEffect(()=>{(O.length===0||h.length!==O.length)&&R(h.map(s=>s.id))},[h]);const B=de.useMemo(()=>{const s=new Map(h.map(u=>[u.id,u])),a=O.filter(u=>s.has(u)),r=a.map(u=>s.get(u)),i=h.filter(u=>!a.includes(u.id));return[...r,...i].sort((u,ve)=>{const ie=j.has(u.id),ce=j.has(ve.id);return ie&&!ce?-1:!ie&&ce?1:0})},[h,O,j]),P=(s,a)=>{E(a),s.dataTransfer.effectAllowed="move"},ee=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},se=(s,a)=>{if(s.preventDefault(),k===null||k===a){E(null);return}const r=[...B],[i]=r.splice(k,1);r.splice(a,0,i);const q=r.map(u=>u.id);R(q),T&&T(r),E(null)},t=()=>{E(null)},x=s=>{S(s),p(!0)},l=s=>{if(d){const a={...d,items:s};$(a),S(a)}},A=(s,a)=>{if(d){const r={type:"note",id:crypto.randomUUID(),content:s},i=[...d.items];i.splice(a,0,r),l(i)}},te=(s,a)=>{if(d){const r=d.items.map(i=>i.type==="note"&&i.id===s?{...i,content:a}:i);l(r)}},pe=s=>{if(d){const a=d.items.filter(r=>!(r.type==="note"&&r.id===s));l(a)}},ge=s=>{if(d){const a=d.items.filter(r=>!(r.type==="song"&&r.id===s));l(a)}},je=s=>{if(d){if(d.items.some(r=>r.type==="song"&&r.id===s))return;const a={type:"song",id:s};l([...d.items,a])}},fe=()=>{N(""),g(!0)},Ne=s=>{je(s),g(!1)},re=()=>{if(!d)return[];const s=d.items.filter(a=>a.type==="song").map(a=>a.id);return y.filter(a=>!s.includes(a.id)).filter(a=>{if(!c)return!0;const r=c.toLowerCase();return a.title.toLowerCase().includes(r)||a.artist.toLowerCase().includes(r)})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Setlists"}),e.jsxs(G,{open:v,onOpenChange:n,children:[e.jsx(we,{asChild:!0,children:e.jsxs(o,{size:"sm",children:[e.jsx(K,{className:"w-4 h-4 mr-1"})," New Setlist"]})}),e.jsxs(V,{className:"sm:max-w-[400px]",children:[e.jsx(W,{children:e.jsx(X,{children:"Create New Setlist"})}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsx(F,{placeholder:"Setlist name",value:w,onChange:s=>D(s.target.value),onKeyDown:s=>s.key==="Enter"&&Q(),autoFocus:!0}),e.jsx(o,{onClick:Q,className:"w-full",children:"Create"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:B.map((s,a)=>{const r=j.has(s.id);return e.jsxs("div",{className:L("relative transition-all",k===a&&"opacity-50 scale-95"),draggable:!0,onDragStart:i=>P(i,a),onDragOver:ee,onDrop:i=>se(i,a),onDragEnd:t,children:[e.jsx("div",{className:"absolute top-2 left-2 text-gray-300 hover:text-gray-500 cursor-grab active:cursor-grabbing p-1 z-10 opacity-50 hover:opacity-100 transition-opacity",children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsx(o,{variant:"ghost",size:"icon",className:L("absolute top-2 left-10 h-8 w-8 z-10 transition-all",r?"text-blue-600 opacity-100":"text-gray-300 opacity-0 group-hover:opacity-100 hover:text-blue-600"),onClick:i=>J(i,s.id),"aria-label":r?"Unpin setlist":"Pin setlist",children:e.jsx(Ae,{className:L("w-4 h-4",r&&"fill-current")})}),e.jsxs(Se,{className:L("cursor-pointer hover:shadow-lg transition-shadow h-full flex flex-col group",r&&"ring-2 ring-blue-500"),onClick:()=>x(s),children:[e.jsxs(be,{className:"pb-3 pt-4 pl-10 pr-4 relative",children:[e.jsxs(Ce,{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 flex-shrink-0 text-gray-500"}),e.jsx("span",{className:"truncate font-semibold",children:s.name}),r&&e.jsx(z,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:"Pinned"})]}),s.eventDate&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-gray-500",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:_(s.eventDate)})]})]}),e.jsxs(z,{variant:"secondary",className:"flex-shrink-0 text-xs",children:[s.items.length," items"]})]}),e.jsx(o,{variant:"ghost",size:"sm",className:"absolute top-2 right-2 text-red-500 hover:bg-red-100 h-7 px-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:i=>{i.stopPropagation(),window.confirm(`Delete setlist "${s.name}"?`)&&M(s.id)},"aria-label":`Delete setlist ${s.name}`,children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs(De,{className:"pt-0 pb-4 px-4 flex-1",children:[e.jsx(xe,{className:"mb-3"}),e.jsxs("div",{className:"space-y-1",children:[s.items.length===0&&e.jsx("div",{className:"text-xs text-gray-400 text-center py-4 italic",children:"Empty setlist"}),s.items.slice(0,5).map((i,q)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-1 rounded group",children:[e.jsxs("span",{className:"text-gray-400 w-5 text-right text-xs",children:[q+1,"."]}),i.type==="song"?e.jsx("span",{className:"flex-1 truncate text-gray-800 cursor-pointer hover:text-blue-700",onClick:u=>{u.stopPropagation(),C(i.id)},children:Z(i.id)}):e.jsxs("span",{className:"flex-1 truncate italic text-gray-500 text-xs",children:['"',i.content,'"']})]},i.id)),s.items.length>5&&e.jsxs("div",{className:"text-xs text-gray-400 text-center pt-1",children:["+",s.items.length-5," more items..."]})]}),s.notes&&e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsx("p",{className:"text-xs text-gray-500 italic line-clamp-2",children:s.notes})})]})]})]},s.id)})}),h.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No setlists created yet"}),e.jsx("p",{className:"text-sm mt-2",children:"Create your first setlist"})]}),d&&e.jsx(G,{open:I,onOpenChange:s=>{s||S(null),p(s)},children:e.jsx(Le,{setlist:d,songs:y,onClose:()=>p(!1),onUpdateItems:l,onAddNote:A,onUpdateNote:te,onDeleteNote:pe,onDeleteSong:ge,onAddSongClick:fe,onSongClick:s=>{p(!1),C(s)}})}),e.jsx(G,{open:b,onOpenChange:g,children:e.jsxs(V,{className:"sm:max-w-[500px] h-[70vh] flex flex-col",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Add Song to Setlist"}),e.jsxs(le,{children:['Select a song to add to "',d?.name,'"']})]}),e.jsxs("div",{className:"space-y-3 flex-1 flex flex-col min-h-0",children:[e.jsx(F,{placeholder:"Search songs...",value:c,onChange:s=>N(s.target.value),autoFocus:!0}),e.jsx(ne,{className:"flex-1 -mx-6 px-6 border rounded",children:e.jsx("div",{className:"py-2 space-y-1",children:re().length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ie,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:c?"No songs found":"All songs already added"})]}):re().map(s=>e.jsx("div",{className:"p-3 rounded hover:bg-gray-50 cursor-pointer transition-colors border",onClick:()=>Ne(s.id),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:s.artist})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsx(z,{variant:"secondary",className:"text-xs",children:s.key}),e.jsxs(z,{variant:"outline",className:"text-xs",children:[s.tempo," BPM"]})]})]})},s.id))})})]}),e.jsx(me,{children:e.jsx(he,{asChild:!0,children:e.jsx(o,{variant:"outline",children:"Cancel"})})})]})})]})}const $e=Object.freeze(Object.defineProperty({__proto__:null,SetlistManager:Fe},Symbol.toStringTag,{value:"Module"}));export{Ke as A,$e as S};
