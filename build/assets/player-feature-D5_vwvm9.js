import{r as f,j as e,R as H,a as nr}from"./react-vendor-BoGJM_Cg.js";import{D as dt,a as ut,b as mt,c as ht,d as xt,B as vt,S as Ot,e as Te,f as P,P as Ke,g as it,L as W,I as Me,h as Ee,i as Ae,j as Fe,k as De,l as ye,E as ar,T as ds,m as us,n as Ye,o as Qe,p as Bt,q as ms,M as or,G as ir,r as hs,s as lr,t as cr,A as $t,u as dr,v as ur,C as Ht,w as mr,Z as hr,x as xr,y as xs,z as fr,F as pr,H as gr,J as vr,U as br,K as jr,N as yr,O as wr,Q as kr,R as qt,V as Kt,W as Ut,X as Cr,Y as Nr,_ as fs,$ as Pt}from"./library-feature-B-e_QCCY.js";import{z as Tr,A as Sr,B as Mr,E as Er,F as Ar,G as Fr,H as Dr,J as Pr,K as Rr,M as Ir,N as Lr,Q as Or,U as Br,W as $r,X as zr,Y as _r,Z as Vr,_ as Wr,$ as Gr,a0 as Hr,a1 as qr}from"./ui-vendor-1btjq6i-.js";import{t as Ne}from"./toast-vendor-CHPPPCQ6.js";import{f as ct,g as Je,s as zt,a as Kr,b as bt}from"./audio-processing-DdlKDC9D.js";const Ur={library:"Library",setlists:"Setlists",settings:"Settings",songLibrary:"Song Library",searchSongs:"Search songs...",importProject:"Import Project",createNew:"Create New",songs:"songs",duration:"Duration",tempo:"Tempo",tracks:"tracks",play:"Play",edit:"Edit",delete:"Delete",addToSetlist:"Add to Setlist",setlistManager:"Setlist Manager",searchSetlists:"Search setlists...",createSetlist:"Create Setlist",setlistName:"Setlist Name",noSetlists:"No setlists yet",createFirstSetlist:"Create your first setlist to organize your songs",editSetlist:"Edit Setlist",deleteSetlist:"Delete Setlist",addSongs:"Add Songs",removeSong:"Remove from setlist",backToLibrary:"Back to Library",performanceMode:"Performance Mode",editMode:"Edit Mode",master:"Master",volume:"Volume",pan:"Pan",solo:"Solo",mute:"Mute",metronome:"Metronome",metronomeVolume:"Metronome Volume",time:"Time (mm:ss)",chords:"Chords",sections:"Sections",measures:"Measures",insertChord:"Insert Chord",insertSection:"Insert Section",insertTempo:"Insert Tempo/Time Sig",exitPerformance:"Exit Performance Mode",previous:"Previous",next:"Next",upNext:"Up Next",appSettings:"App Settings",appearance:"Appearance",theme:"Theme",light:"Light",dark:"Dark",system:"System",language:"Language",english:"English",portuguese:"Portuguese",audio:"Audio",audioOutput:"Audio Output Device",bufferSize:"Buffer Size",sampleRate:"Sample Rate",midi:"MIDI",midiInput:"MIDI Input Device",enableMidi:"Enable MIDI Control",midiChannel:"MIDI Channel",playPause:"Play/Pause",stop:"Stop",skipForward:"Skip Forward",skipBackward:"Skip Backward",about:"About",version:"Version",cancel:"Cancel",save:"Save",create:"Create",close:"Close",confirm:"Confirm",createProject:"Create New Project",projectName:"Project Name",artist:"Artist",defaultTempo:"Default Tempo",timeSignature:"Time Signature",selectSetlist:"Select a setlist",addToExisting:"Add to existing setlist",editTimeline:"Edit Timeline",chordInsertion:"Chord Insertion",sectionInsertion:"Section Insertion",tempoInsertion:"Tempo/Time Signature Insertion",position:"Position",chord:"Chord",section:"Section",tempoValue:"Tempo",root:"Root",accidental:"Accidental",quality:"Quality",major:"Major",minor:"Minor",augmented:"Augmented",diminished:"Diminished",dominant7:"Dominant 7th",major7:"Major 7th",minor7:"Minor 7th",extension:"Extension",none:"None",ninth:"9th",eleventh:"11th",thirteenth:"13th",bassNote:"Bass Note",customizeDiagram:"Customize Diagram",guitar:"Guitar",ukulele:"Ukulele",piano:"Piano",intro:"Intro",verse:"Verse",chorus:"Chorus",bridge:"Bridge",outro:"Outro",interlude:"Interlude",preChorus:"Pre-Chorus",notes:"Notes",songNotes:"Song notes and reminders...",confirmDelete:"Are you sure you want to delete this?",confirmDeleteSong:"Are you sure you want to delete this song?",confirmDeleteSetlist:"Are you sure you want to delete this setlist?",noSongsInLibrary:"No songs in your library",importFirstSong:"Import your first song to get started",clickFretsToPlace:"Click on frets to place fingers, click string labels to mute/unmute",clickToMute:"Click string labels to mute/unmute",greenCircles:"Green circles = open/active strings",redCircles:"Red circles with âœ• = muted strings",blueDots:"Blue dots = finger positions",clickPianoKeys:"Click on piano keys to build your chord",selectedNotes:"Selected notes:",clickToToggle:"Click keys to toggle selection",blueDotsFingers:"Blue dots show finger positions on the fretboard"},ps=f.createContext(void 0);function za({children:t}){const r={t:Ur};return e.jsx(ps.Provider,{value:r,children:t})}function st(){const t=f.useContext(ps);if(t===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return t}const je={TRACK_HEIGHT:"goodmultitracks_track_height",ZOOM_LEVEL:"goodmultitracks_zoom_level",RULER_ORDER:"goodmultitracks_ruler_order",METRONOME_FREQUENCIES:"metronome_frequencies",THEME:"goodmultitracks_theme",LANGUAGE:"goodmultitracks_language",MAIN_INSTRUMENT:"goodmultitracks_main_instrument",FIRST_TIME_SETUP_COMPLETE:"goodmultitracks_first_time_setup"};function Ie(t,r){try{const s=localStorage.getItem(t);return s===null?r:typeof r!="string"?JSON.parse(s):s}catch(s){return console.warn(`Failed to read from localStorage: ${t}`,s),r}}function Le(t,r){try{const s=typeof r=="string"?r:JSON.stringify(r);return localStorage.setItem(t,s),!0}catch(s){return console.warn(`Failed to write to localStorage: ${t}`,s),!1}}function Xr(t){try{return localStorage.removeItem(t),!0}catch(r){return console.warn(`Failed to remove from localStorage: ${t}`,r),!1}}const Pe={getTrackHeight:()=>Ie(je.TRACK_HEIGHT,"medium"),setTrackHeight:t=>Le(je.TRACK_HEIGHT,t),getZoomLevel:()=>Ie(je.ZOOM_LEVEL,1),setZoomLevel:t=>Le(je.ZOOM_LEVEL,t),getRulerVisibility:t=>{const r=`goodmultitracks_show_${t}_ruler`;return Ie(r,!0)},setRulerVisibility:(t,r)=>{const s=`goodmultitracks_show_${t}_ruler`;return Le(s,r)},getRulerOrder:()=>Ie(je.RULER_ORDER,["time","measures","sections","chords","tempo"]),setRulerOrder:t=>Le(je.RULER_ORDER,t),getMetronomeFrequencies:()=>Ie(je.METRONOME_FREQUENCIES,{strongBeat:1e3,normalBeat:800,subdivision:600}),setMetronomeFrequencies:t=>Le(je.METRONOME_FREQUENCIES,t),getTheme:()=>Ie(je.THEME,"dark"),setTheme:t=>Le(je.THEME,t),getLanguage:()=>Ie(je.LANGUAGE,"pt"),setLanguage:t=>Le(je.LANGUAGE,t),getMainInstrument:()=>Ie(je.MAIN_INSTRUMENT,null),setMainInstrument:t=>t?Le(je.MAIN_INSTRUMENT,t):Xr(je.MAIN_INSTRUMENT),isFirstTimeSetupComplete:()=>Ie(je.FIRST_TIME_SETUP_COMPLETE,!1),setFirstTimeSetupComplete:()=>Le(je.FIRST_TIME_SETUP_COMPLETE,!0)},gs=f.createContext(void 0),_a=({children:t})=>{const r=f.useRef(null),s=()=>(r.current||(r.current=new(window.AudioContext||window.webkitAudioContext)),r.current),n=async()=>{const a=s();a.state==="suspended"&&await a.resume()},o=async()=>{r.current&&r.current.state==="running"&&await r.current.suspend()};f.useEffect(()=>()=>{r.current&&r.current.state!=="closed"&&(r.current.close(),r.current=null)},[]);const l={audioContext:r.current,getAudioContext:s,resumeAudioContext:n,suspendAudioContext:o};return e.jsx(gs.Provider,{value:l,children:t})},Zr=()=>{const t=f.useContext(gs);if(!t)throw new Error("useAudioContext must be used within an AudioContextProvider");return t};class Ze{static instance;waveforms=new Map;mediums=new Map;overviews=new Map;listeners=new Set;notifyTimeout=null;constructor(){}static getInstance(){return Ze.instance||(Ze.instance=new Ze),Ze.instance}subscribe(r){return this.listeners.add(r),()=>this.listeners.delete(r)}notify(){this.notifyTimeout&&clearTimeout(this.notifyTimeout),this.notifyTimeout=setTimeout(()=>{this.listeners.forEach(r=>{try{r()}catch(s){console.error("Error in waveform store listener:",s)}}),this.notifyTimeout=null},0)}setWaveform(r,s){this.waveforms.set(r,s),this.notify()}getWaveform(r){return this.waveforms.get(r)}setOverview(r,s){this.overviews.set(r,s),this.notify()}getOverview(r){return this.overviews.get(r)}setMedium(r,s){this.mediums.set(r,s),this.notify()}getMedium(r){return this.mediums.get(r)}clear(){this.waveforms.clear(),this.mediums.clear(),this.overviews.clear(),this.notify()}has(r){return this.waveforms.has(r)}delete(r){this.waveforms.delete(r),this.mediums.delete(r),this.overviews.delete(r),this.notify()}}const gt=Ze.getInstance(),Mt=[{category:"Playback",items:[{keys:["Space"],description:"Play / Pause"},{keys:["Home"],description:"Go to start"},{keys:["End"],description:"Go to end"},{keys:["R"],description:"Reset to start"},{keys:["â†"],description:"Jump backward 5 seconds"},{keys:["â†’"],description:"Jump forward 5 seconds"},{keys:["Shift","â†"],description:"Previous section"},{keys:["Shift","â†’"],description:"Next section"}]},{category:"View",items:[{keys:["+"],description:"Zoom in"},{keys:["-"],description:"Zoom out"},{keys:["0"],description:"Reset zoom"}]},{category:"Tools",items:[{keys:["L"],description:"Toggle loop"},{keys:["M"],description:"Toggle metronome"}]}];function Yr({isOpen:t,onClose:r}){return e.jsx(dt,{open:t,onOpenChange:r,children:e.jsxs(ut,{className:"max-w-2xl",children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Keyboard Shortcuts"}),e.jsx(xt,{children:"Use these keyboard shortcuts to navigate and control the player efficiently"})]}),e.jsx("div",{className:"space-y-6 py-4",children:Mt.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700",children:s.category}),e.jsx("div",{className:"space-y-2",children:s.items.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm text-gray-600",children:n.description}),e.jsx("div",{className:"flex gap-1",children:n.keys.map((l,a)=>e.jsxs(H.Fragment,{children:[a>0&&e.jsx("span",{className:"text-gray-400 mx-1",children:"+"}),e.jsx(vt,{variant:"secondary",className:"font-mono px-2 py-1 bg-gray-100 text-gray-700 border",children:l})]},a))})]},o))}),s.category!==Mt[Mt.length-1].category&&e.jsx(Ot,{className:"mt-4"})]},s.category))}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"Tip:"})," Most shortcuts won't work when typing in text fields"]})]})})}function lt({className:t,...r}){return e.jsx(Tr,{"data-slot":"switch",className:Te("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(Sr,{"data-slot":"switch-thumb",className:Te("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const _t={C:261.63,"C#":277.18,Db:277.18,D:293.66,"D#":311.13,Eb:311.13,E:329.63,F:349.23,"F#":369.99,Gb:369.99,G:392,"G#":415.3,Ab:415.3,A:440,"A#":466.16,Bb:466.16,B:493.88};let Et=null;function kt(){return Et||(Et=new(window.AudioContext||window.webkitAudioContext)),Et}function Vt(t,r,s,n=.3){const o=kt(),l=o.createOscillator(),a=o.createGain();l.type="sine",l.frequency.setValueAtTime(t,s),a.gain.setValueAtTime(0,s),a.gain.linearRampToValueAtTime(n,s+.01),a.gain.exponentialRampToValueAtTime(n*.7,s+.1),a.gain.setValueAtTime(n*.7,s+r-.1),a.gain.exponentialRampToValueAtTime(.01,s+r),l.connect(a),a.connect(o.destination),l.start(s),l.stop(s+r)}function vs(t,r=1.5,s=.25){const o=kt().currentTime;t.forEach(l=>{const a=_t[l];a&&Vt(a,r,o,s)})}function bs(t,r=1.5){const s=["E","A","D","G","B","E"];t.forEach((l,a)=>{});const o=kt().currentTime;t.forEach((l,a)=>{if(l>=0){const i=s[a],d=_t[i];if(d){const m=d*Math.pow(2,l/12);Vt(m,r,o+a*.03,.15)}}})}function js(t,r=1.5){const s=["G","C","E","A"],o=kt().currentTime;t.forEach((l,a)=>{if(l>=0){const i=s[a],d=_t[i];if(d){const m=d*Math.pow(2,l/12);Vt(m,r,o+a*.03,.2)}}})}function Qr({frets:t,fingers:r,startFret:s=1,onChange:n}){const{t:o}=st(),l=["E","A","D","G","B","e"],a=5,i=(c,u)=>{const h=[...t],p=[...r],x=u===0?0:u+s-1;h[c]===x?(h[c]=0,p[c]=0):(h[c]=x,x>0?p[c]=Math.min(4,u):p[c]=0),n(h,p)},d=c=>{const u=[...t],h=[...r];u[c]===-1?(u[c]=0,h[c]=0):(u[c]=-1,h[c]=0),n(u,h)},m=()=>{bs(t)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:o.clickFretsToPlace}),e.jsxs(P,{variant:"outline",size:"sm",onClick:m,className:"gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Play"]})]}),e.jsxs("svg",{width:"240",height:"320",viewBox:"0 0 240 320",className:"border rounded-lg bg-white",children:[[...Array(a)].map((c,u)=>e.jsx("line",{x1:"50",y1:70+u*40,x2:"210",y2:70+u*40,stroke:"#666",strokeWidth:u===0?"4":"2"},`fret-${u}`)),[...Array(6)].map((c,u)=>e.jsx("line",{x1:50+u*32,y1:"70",x2:50+u*32,y2:"230",stroke:"#666",strokeWidth:"2"},`string-${u}`)),s>1&&e.jsxs("text",{x:"25",y:"90",fontSize:"14",fill:"#333",textAnchor:"middle",fontWeight:"600",children:[s,"fr"]}),l.map((c,u)=>{const h=50+u*32,p=t[u]===-1;return e.jsxs("g",{children:[e.jsx("rect",{x:h-12,y:"260",width:"24",height:"24",fill:"transparent",cursor:"pointer",onClick:()=>d(u)}),e.jsx("text",{x:h,y:"275",fontSize:"14",fill:p?"#999":"#333",textAnchor:"middle",cursor:"pointer",onClick:()=>d(u),style:{userSelect:"none"},children:c})]},`label-${u}`)}),t.map((c,u)=>{const h=50+u*32;if(c===-1)return e.jsxs("g",{children:[e.jsx("circle",{cx:h,cy:"45",r:"8",fill:"#ef4444"}),e.jsx("line",{x1:h-4,y1:"41",x2:h+4,y2:"49",stroke:"white",strokeWidth:"2"}),e.jsx("line",{x1:h+4,y1:"41",x2:h-4,y2:"49",stroke:"white",strokeWidth:"2"})]},`marker-${u}`);if(c===0)return e.jsx("circle",{cx:h,cy:"45",r:"7",fill:"none",stroke:"#22c55e",strokeWidth:"2.5"},`marker-${u}`);{const p=c-s+1;if(p>=1&&p<=a){const x=70+(p-.5)*40,g=r[u];return e.jsxs("g",{children:[e.jsx("circle",{cx:h,cy:x,r:"11",fill:"#2563eb"}),g>0&&e.jsx("text",{x:h,y:x+5,fontSize:"13",fill:"white",textAnchor:"middle",fontWeight:"600",children:g})]},`marker-${u}`)}return null}}),[...Array(6)].map((c,u)=>[...Array(a)].map((h,p)=>{const x=50+u*32,g=70+p*40,y=p+1;return e.jsx("rect",{x:x-16,y:g-20,width:"32",height:"40",fill:"transparent",cursor:"pointer",onClick:()=>i(u,y)},`click-${u}-${p}`)})),[...Array(6)].map((c,u)=>{const h=50+u*32;return e.jsx("rect",{x:h-16,y:"30",width:"32",height:"30",fill:"transparent",cursor:"pointer",onClick:()=>i(u,0)},`open-${u}`)})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 text-center max-w-xs",children:[e.jsxs("p",{children:["â€¢ ",o.greenCircles]}),e.jsxs("p",{children:["â€¢ ",o.redCircles]}),e.jsxs("p",{children:["â€¢ ",o.blueDots]})]})]})}function Jr({frets:t,fingers:r,startFret:s=1,onChange:n}){const{t:o}=st(),l=["G","C","E","A"],a=5,i=(m,c)=>{const u=[...t],h=[...r],p=c===0?0:c+s-1;u[m]===p?(u[m]=0,h[m]=0):(u[m]=p,p>0?h[m]=Math.min(4,c):h[m]=0),n(u,h)},d=()=>{js(t)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:o.clickFretsToPlace}),e.jsxs(P,{variant:"outline",size:"sm",onClick:d,className:"gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Play"]})]}),e.jsxs("svg",{width:"200",height:"320",viewBox:"0 0 200 320",className:"border rounded-lg bg-white",children:[[...Array(a)].map((m,c)=>e.jsx("line",{x1:"50",y1:70+c*40,x2:"170",y2:70+c*40,stroke:"#666",strokeWidth:c===0?"4":"2"},`fret-${c}`)),[...Array(4)].map((m,c)=>e.jsx("line",{x1:50+c*40,y1:"70",x2:50+c*40,y2:"230",stroke:"#666",strokeWidth:"2"},`string-${c}`)),s>1&&e.jsxs("text",{x:"25",y:"90",fontSize:"14",fill:"#333",textAnchor:"middle",fontWeight:"600",children:[s,"fr"]}),l.map((m,c)=>{const u=50+c*40;return e.jsx("text",{x:u,y:"275",fontSize:"14",fill:"#333",textAnchor:"middle",style:{userSelect:"none"},children:m},`label-${c}`)}),t.map((m,c)=>{const u=50+c*40;if(m===0)return e.jsx("circle",{cx:u,cy:"45",r:"7",fill:"none",stroke:"#22c55e",strokeWidth:"2.5"},`marker-${c}`);{const h=m-s+1;if(h>=1&&h<=a){const p=70+(h-.5)*40,x=r[c];return e.jsxs("g",{children:[e.jsx("circle",{cx:u,cy:p,r:"11",fill:"#2563eb"}),x>0&&e.jsx("text",{x:u,y:p+5,fontSize:"13",fill:"white",textAnchor:"middle",fontWeight:"600",children:x})]},`marker-${c}`)}return null}}),[...Array(4)].map((m,c)=>[...Array(a)].map((u,h)=>{const p=50+c*40,x=70+h*40,g=h+1;return e.jsx("rect",{x:p-20,y:x-20,width:"40",height:"40",fill:"transparent",cursor:"pointer",onClick:()=>i(c,g)},`click-${c}-${h}`)})),[...Array(4)].map((m,c)=>{const u=50+c*40;return e.jsx("rect",{x:u-20,y:"30",width:"40",height:"30",fill:"transparent",cursor:"pointer",onClick:()=>i(c,0)},`open-${c}`)})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center max-w-xs",children:e.jsxs("p",{children:["â€¢ ",o.blueDotsFingers]})})]})}function en({keys:t,onChange:r}){const{t:s}=st(),n=f.useRef(null),o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],a=[...o.map(h=>`${h}4`),...l.map(h=>`${h}5`)];f.useEffect(()=>{n.current&&(n.current.scrollLeft=200)},[]);const i=h=>{const p=[...t],x=p.indexOf(h);x>-1?p.splice(x,1):p.push(h),r(p)},d=h=>h.replace(/[0-9]/g,""),m=h=>h.includes("#"),c=h=>h.startsWith("C"),u=()=>{const h=t.map(p=>d(p));vs(h)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.clickPianoKeys}),e.jsxs(P,{variant:"outline",size:"sm",onClick:u,className:"gap-2",disabled:t.length===0,children:[e.jsx(Ke,{className:"w-4 h-4"}),"Play"]})]}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto border rounded-lg bg-gray-100 p-4",ref:n,children:e.jsxs("svg",{width:"860",height:"200",viewBox:"0 0 860 200",className:"min-w-[860px]",children:[a.filter(h=>!m(d(h))).map((h,p)=>{const x=20+p*56,g=t.includes(h),y=c(h);return e.jsxs("g",{children:[e.jsx("rect",{x,y:"20",width:"54",height:"150",fill:g?"#2563eb":"white",stroke:y?"#dc2626":"#333",strokeWidth:y?"3":"2",rx:"4",cursor:"pointer",onClick:()=>i(h)}),y&&e.jsx("circle",{cx:x+27,cy:"155",r:"4",fill:g?"white":"#dc2626"}),e.jsx("text",{x:x+27,y:"140",fontSize:"12",fill:g?"white":"#666",textAnchor:"middle",cursor:"pointer",onClick:()=>i(h),style:{userSelect:"none"},children:d(h)})]},`white-${h}`)}),a.filter(h=>m(d(h))).map(h=>{const p=d(h),x=h.replace(/[^0-9]/g,""),g=parseInt(x)-4;let y=0;p==="C#"?y=0:p==="D#"?y=1:p==="F#"?y=3:p==="G#"?y=4:p==="A#"&&(y=5);const v=20+(g*7+y)*56+40,M=t.includes(h);return e.jsx("rect",{x:v,y:"20",width:"28",height:"95",fill:M?"#1e40af":"#333",stroke:"#000",strokeWidth:"2",rx:"3",cursor:"pointer",onClick:()=>i(h)},`black-${h}`)})]})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 text-center max-w-md",children:[e.jsxs("p",{children:[e.jsx("strong",{children:s.selectedNotes})," ",t.length>0?t.join(", "):s.none]}),e.jsx("p",{className:"text-gray-400",children:s.clickToToggle}),e.jsx("p",{className:"text-gray-400 italic",children:"Red markers indicate C notes â€¢ Scroll horizontally to view all keys"})]})]})}const tn=["C","D","E","F","G","A","B"],sn={C:0,D:1,E:2,F:3,G:4,A:5,B:6},Xt=[0,2,4,5,7,9,11],rn={P1:{id:"P1",semitones:0,degree:0,quality:"P"},A1:{id:"A1",semitones:1,degree:0,quality:"A"},AA1:{id:"AA1",semitones:2,degree:0,quality:"AA"},d2:{id:"d2",semitones:0,degree:1,quality:"d"},m2:{id:"m2",semitones:1,degree:1,quality:"m"},M2:{id:"M2",semitones:2,degree:1,quality:"M"},A2:{id:"A2",semitones:3,degree:1,quality:"A"},AA2:{id:"AA2",semitones:4,degree:1,quality:"AA"},dd3:{id:"dd3",semitones:1,degree:2,quality:"dd"},d3:{id:"d3",semitones:2,degree:2,quality:"d"},m3:{id:"m3",semitones:3,degree:2,quality:"m"},M3:{id:"M3",semitones:4,degree:2,quality:"M"},A3:{id:"A3",semitones:5,degree:2,quality:"A"},d4:{id:"d4",semitones:4,degree:3,quality:"d"},P4:{id:"P4",semitones:5,degree:3,quality:"P"},A4:{id:"A4",semitones:6,degree:3,quality:"A"},AA4:{id:"AA4",semitones:7,degree:3,quality:"AA"},dd5:{id:"dd5",semitones:5,degree:4,quality:"dd"},d5:{id:"d5",semitones:6,degree:4,quality:"d"},P5:{id:"P5",semitones:7,degree:4,quality:"P"},A5:{id:"A5",semitones:8,degree:4,quality:"A"},AA5:{id:"AA5",semitones:9,degree:4,quality:"AA"},dd6:{id:"dd6",semitones:6,degree:5,quality:"dd"},d6:{id:"d6",semitones:7,degree:5,quality:"d"},m6:{id:"m6",semitones:8,degree:5,quality:"m"},M6:{id:"M6",semitones:9,degree:5,quality:"M"},A6:{id:"A6",semitones:10,degree:5,quality:"A"},dd7:{id:"dd7",semitones:8,degree:6,quality:"dd"},dim7:{id:"dim7",semitones:9,degree:6,quality:"d"},m7:{id:"m7",semitones:10,degree:6,quality:"m"},M7:{id:"M7",semitones:11,degree:6,quality:"M"},A7:{id:"A7",semitones:12,degree:6,quality:"A"},d8:{id:"d8",semitones:11,degree:7,quality:"d"},P8:{id:"P8",semitones:12,degree:7,quality:"P"},b9:{id:"b9",semitones:13,degree:8,quality:"m"},9:{id:"9",semitones:14,degree:8,quality:"M"},"#9":{id:"#9",semitones:15,degree:8,quality:"A"},11:{id:"11",semitones:17,degree:10,quality:"P"},"#11":{id:"#11",semitones:18,degree:10,quality:"A"},b13:{id:"b13",semitones:20,degree:12,quality:"m"},13:{id:"13",semitones:21,degree:12,quality:"M"}};function nn(t){const r=t.match(/^([A-G])(x|#+|b+)?(\d*)$/);if(!r)throw new Error(`Invalid note format: ${t}`);const s=r[1],n=r[2]||"",o=r[3]?parseInt(r[3]):void 0;let l=0;return n==="x"?l=2:n.startsWith("#")?l=n.length:n.startsWith("b")&&(l=-n.length),{letter:s,accidentalStr:n,accidentalValue:l,octave:o}}function an(t){return t===0?"":t===1?"#":t===2?"x":t===-1?"b":t===-2?"bb":t===3?"#x":t===-3?"bbb":t>0?"#".repeat(t):"b".repeat(Math.abs(t))}const on={0:"P1",1:"A1",2:"M2",3:"A2",4:"M3",5:"P4",6:"A4",7:"P5",8:"A5",9:"M6",10:"A6",11:"M7"},ln={0:"P1",1:"m2",2:"M2",3:"m3",4:"M3",5:"P4",6:"d5",7:"P5",8:"m6",9:"M6",10:"m7",11:"M7"};function cn(t,r){const s=typeof r=="string"?rn[r]:r;if(!s)return console.error(`Invalid interval: ${r}`),t;const{letter:n,accidentalValue:o,octave:l}=nn(t),a=sn[n],i=(a+s.degree)%7,d=tn[i];let m=Xt[i]-Xt[a];m<0&&(m+=12);const u=o+s.semitones-m;let h=l;if(l!==void 0){const p=s.degree,x=a+p>=7,g=Math.floor(s.degree/7);h=l+(x?1:0)+g}return`${d}${an(u)}${h!==void 0?h:""}`}function Rt(t,r,s){if(r===0)return t;const n=t.match(/^([A-G][#b]?)(.*)/);if(!n)return t;const[,o,l]=n,a=(r%12+12)%12;let i;{const c=["C","G","D","A","E","B","F#","C#","G#","D#","A#"],u=o.replace(/\d+$/,"");i=c.includes(u)||o.includes("#")}const d=i?on[a]:ln[a];return d?cn(o,d)+l:(console.error(`Invalid semitone value: ${a}`),t)}const ys=[{value:"natural",label:it.accidentalNatural,symbol:""},{value:"sharp",label:it.accidentalSharp,symbol:"#"},{value:"flat",label:it.accidentalFlat,symbol:"b"}],ws=[{value:"major",label:"Major",suffix:""},{value:"minor",label:"Minor",suffix:"m"},{value:"diminished",label:"Diminished",suffix:"dim"},{value:"augmented",label:"Augmented",suffix:"aug"},{value:"sus2",label:"Suspended 2nd",suffix:"sus2"},{value:"sus4",label:"Suspended 4th",suffix:"sus4"}],ks=[{value:"none",label:"None",suffix:""},{value:"7",label:"Dominant 7th",suffix:"7"},{value:"maj7",label:"Major 7th",suffix:"maj7"},{value:"9",label:"9th",suffix:"9"},{value:"maj9",label:"Major 9th",suffix:"maj9"},{value:"11",label:"11th",suffix:"11"},{value:"13",label:"13th",suffix:"13"},{value:"6",label:"6th",suffix:"6"},{value:"add9",label:"Add 9",suffix:"add9"}],Cs=(t="")=>{if(!t)return{root:"C",accidental:"natural",quality:"major",extension:"none",bassNote:"",isPolychord:!1};const[r,s]=t.split("/");let n=s||"",o=!1,l;if(s){const d=/^([A-G])([#b]?)(maj|m|min|dim|aug|sus2|sus4)?(13|11|9|7|6|add9|maj9|maj7)?(.*)$/,m=s.match(d);m&&(m[3]||m[4])?(o=!0,l=Cs(s)):n=s}const a=/^([A-G])([#b]?)(2|maj|m|min|dim|aug|sus2|sus4)?(13|11|9|7|6|add9|maj9|maj7)?(.*)$/,i=r.match(a);if(i){const[,d,m,c,u]=i,h=m==="#"?"sharp":m==="b"?"flat":"natural";let p="major";c==="m"||c==="min"?p="minor":c==="dim"?p="diminished":c==="aug"?p="augmented":c==="sus2"||c==="2"?p="sus2":c==="sus4"?p="sus4":c==="maj"&&!u?.startsWith("maj")&&(p="major");let x="none";return c==="maj"&&u==="7"?x="maj7":c==="maj"&&u==="9"?x="maj9":u==="7"?x="7":u==="9"?x="9":u==="11"?x="11":u==="13"?x="13":u==="6"?x="6":u==="add9"&&(x="add9"),{root:d,accidental:h,quality:p,extension:x,bassNote:n,isPolychord:o,upperChord:l}}else return console.warn("Could not parse chord name accurately:",t),{root:t[0]||"C",accidental:"natural",quality:"major",extension:"none",bassNote:"",isPolychord:!1}},dn=(t,r,s,n,o)=>{const l=ys.find(m=>m.value===r)?.symbol||"",a=ws.find(m=>m.value===s)?.suffix||"",i=ks.find(m=>m.value===n)?.suffix||"";let d=i;return n==="maj7"&&s!=="major"?d="maj7":n==="maj9"&&s!=="major"?d="maj9":(s==="major"&&(n==="maj7"||n==="maj9")||s==="major"&&n!=="none"||s!=="major"&&n!=="none")&&(d=i),`${t}${l}${a}${d}${o?"/"+o:""}`},et={C:{guitar:{frets:[-1,3,2,0,1,0],fingers:[0,3,2,0,1,0]},piano:{keys:["C","E","G"]},ukulele:{frets:[0,0,0,3],fingers:[0,0,0,3]}},D:{guitar:{frets:[-1,-1,0,2,3,2],fingers:[0,0,0,1,3,2]},piano:{keys:["D","F#","A"]},ukulele:{frets:[2,2,2,0],fingers:[1,1,1,0]}},E:{guitar:{frets:[0,2,2,1,0,0],fingers:[0,2,3,1,0,0]},piano:{keys:["E","G#","B"]},ukulele:{frets:[4,4,4,2],fingers:[3,3,3,1]}},F:{guitar:{frets:[1,3,3,2,1,1],fingers:[1,3,4,2,1,1]},piano:{keys:["F","A","C"]},ukulele:{frets:[2,0,1,0],fingers:[2,0,1,0]}},G:{guitar:{frets:[3,2,0,0,0,3],fingers:[3,2,0,0,0,4]},piano:{keys:["G","B","D"]},ukulele:{frets:[0,2,3,2],fingers:[0,1,3,2]}},A:{guitar:{frets:[-1,0,2,2,2,0],fingers:[0,0,1,2,3,0]},piano:{keys:["A","C#","E"]},ukulele:{frets:[2,1,0,0],fingers:[2,1,0,0]}},B:{guitar:{frets:[-1,2,4,4,4,2],fingers:[0,1,2,3,4,1]},piano:{keys:["B","D#","F#"]},ukulele:{frets:[4,3,2,2],fingers:[4,3,1,2]}},"C#":{guitar:{frets:[-1,4,6,6,6,4],fingers:[0,1,3,4,4,1],startFret:1},piano:{keys:["C#","F","G#"]},ukulele:{frets:[1,1,1,4],fingers:[1,1,1,4]}},"D#":{guitar:{frets:[-1,-1,1,3,4,3],fingers:[0,0,1,2,4,3]},piano:{keys:["D#","G","A#"]},ukulele:{frets:[0,3,3,1],fingers:[0,3,4,1]}},"F#":{guitar:{frets:[2,4,4,3,2,2],fingers:[1,3,4,2,1,1]},piano:{keys:["F#","A#","C#"]},ukulele:{frets:[3,1,2,1],fingers:[3,1,2,1]}},"G#":{guitar:{frets:[4,6,6,5,4,4],fingers:[1,3,4,2,1,1]},piano:{keys:["G#","C","D#"]},ukulele:{frets:[5,3,4,3],fingers:[3,1,2,1]}},"A#":{guitar:{frets:[-1,1,3,3,3,1],fingers:[0,1,2,3,4,1]},piano:{keys:["A#","D","F"]},ukulele:{frets:[3,2,1,1],fingers:[3,2,1,1]}},Db:{guitar:{frets:[-1,4,6,6,6,4],fingers:[0,1,3,4,4,1],startFret:1},piano:{keys:["Db","F","Ab"]},ukulele:{frets:[1,1,1,4],fingers:[1,1,1,4]}},Eb:{guitar:{frets:[-1,-1,1,3,4,3],fingers:[0,0,1,2,4,3]},piano:{keys:["Eb","G","Bb"]},ukulele:{frets:[0,3,3,1],fingers:[0,3,4,1]}},Gb:{guitar:{frets:[2,4,4,3,2,2],fingers:[1,3,4,2,1,1]},piano:{keys:["Gb","Bb","Db"]},ukulele:{frets:[3,1,2,1],fingers:[3,1,2,1]}},Ab:{guitar:{frets:[4,6,6,5,4,4],fingers:[1,3,4,2,1,1]},piano:{keys:["Ab","C","Eb"]},ukulele:{frets:[5,3,4,3],fingers:[3,1,2,1]}},Bb:{guitar:{frets:[-1,1,3,3,3,1],fingers:[0,1,2,3,4,1]},piano:{keys:["Bb","D","F"]},ukulele:{frets:[3,2,1,1],fingers:[3,2,1,1]}},Am:{guitar:{frets:[-1,0,2,2,1,0],fingers:[0,0,2,3,1,0]},piano:{keys:["A","C","E"]},ukulele:{frets:[2,0,0,0],fingers:[1,0,0,0]}},Bm:{guitar:{frets:[-1,2,4,4,3,2],fingers:[0,1,3,4,2,1]},piano:{keys:["B","D","F#"]},ukulele:{frets:[4,2,2,2],fingers:[4,1,1,1]}},Cm:{guitar:{frets:[-1,3,5,5,4,3],fingers:[0,1,3,4,2,1]},piano:{keys:["C","Eb","G"]},ukulele:{frets:[0,3,3,3],fingers:[0,1,1,1]}},Dm:{guitar:{frets:[-1,-1,0,2,3,1],fingers:[0,0,0,2,3,1]},piano:{keys:["D","F","A"]},ukulele:{frets:[2,2,1,0],fingers:[2,3,1,0]}},Em:{guitar:{frets:[0,2,2,0,0,0],fingers:[0,2,3,0,0,0]},piano:{keys:["E","G","B"]},ukulele:{frets:[0,4,3,2],fingers:[0,4,3,2]}},Fm:{guitar:{frets:[1,3,3,1,1,1],fingers:[1,3,4,1,1,1]},piano:{keys:["F","Ab","C"]},ukulele:{frets:[1,0,1,3],fingers:[1,0,2,4]}},Gm:{guitar:{frets:[3,5,5,3,3,3],fingers:[1,3,4,1,1,1]},piano:{keys:["G","Bb","D"]},ukulele:{frets:[0,2,3,1],fingers:[0,2,3,1]}}},Zt=["C","D","E","F","G","A","B"],Yt=[{value:"1",label:"1 (Whole Note)"},{value:"2",label:"2 (Half Note)"},{value:"3",label:"3 (Triplet Half Note)"},{value:"4",label:"4 (Quarter Note)"},{value:"6",label:"6 (Triplet Quarter Note)"},{value:"8",label:"8 (Eighth Note)"},{value:"12",label:"12 (Triplet Eighth Note)"},{value:"16",label:"16 (Sixteenth Note)"},{value:"32",label:"32 (32nd Note)"}],un=[{numerator:"4",denominator:"4",label:"4/4 (Common Time)"},{numerator:"3",denominator:"4",label:"3/4 (Waltz)"},{numerator:"6",denominator:"8",label:"6/8"},{numerator:"2",denominator:"4",label:"2/4"},{numerator:"5",denominator:"4",label:"5/4"},{numerator:"7",denominator:"8",label:"7/8"},{numerator:"9",denominator:"8",label:"9/8"},{numerator:"12",denominator:"8",label:"12/8"}],Oe=t=>{switch(t){case 1:return"whole";case 2:return"half";case 4:return"quarter";case 8:return"eighth";case 16:return"sixteenth";case 32:return"32nd"}return t===3||t===6?"quarter":t===12?"eighth":t<2?"whole":t<4?"half":t<8?"quarter":t<16?"eighth":t<32?"sixteenth":"32nd"},mn=t=>{if(!t.includes("+"))return null;const r=t.split("+").map(n=>parseInt(n.trim(),10));return r.some(n=>isNaN(n)||n<=0)?null:{total:r.reduce((n,o)=>n+o,0),grouping:r}},Ns=(t,r,s,n="default",o="auto")=>{let l="simple",a,i,d,m,c=[];if(typeof t=="string"){const p=mn(t);if(p){d=p.total,m=p.total,l="irregular",c=p.grouping,i=p.grouping.length,a=Oe(r);const x=r===6?2/3:r===12?1/3:1,g=d/r*4*x;return{numerator:d,denominator:r,type:l,beatUnit:a,beatsPerMeasure:i,pulsesPerMeasure:m,grouping:c,beatRatio:x!==1?x:void 0,measureDurationInQuarters:g}}else d=parseInt(t,10),isNaN(d)&&(d=4)}else d=t;if(m=d,s)l="irregular",c=s.split("+").map(Number),i=c.length,a=Oe(r);else if(d%3===0&&d>=6&&d<=15&&d!==3)o==="simple"?(l="simple",i=d,a=Oe(r),c=Array(i).fill(1)):o==="compound"?(l="compound",i=d/3,r===8?a="dotted-quarter":r===4?a="dotted-half":r===16?a="dotted-eighth":a=Oe(r),c=Array(i).fill(3)):n==="very-slow"&&d===6?(l="simple",i=d,a=Oe(r),c=Array(i).fill(1)):(l="compound",i=d/3,r===8?a="dotted-quarter":r===4?a="dotted-half":r===16?a="dotted-eighth":a=Oe(r),c=Array(i).fill(3));else{const p=Ts(d);n==="fast"&&d===3?(l="simple",i=1,a=Oe(r),c=[3]):p.length>0?(l="irregular",c=p[0].split("+").map(Number),i=c.length,a=Oe(r)):(l="simple",i=d,a=Oe(r),c=Array(i).fill(1))}let u;(r===6||r===12||r===3)&&(u=2/3);const h=d/r*4*(u||1);return{numerator:d,denominator:r,type:l,beatUnit:a,beatsPerMeasure:i,pulsesPerMeasure:m,grouping:c,beatRatio:u,measureDurationInQuarters:h}},hn=t=>{const r=[],s=new Set;function n(o,l){if(o===t){const a=l.join(",");s.has(a)||(s.add(a),r.push([...l]));return}o>t||(n(o+3,[...l,3]),n(o+2,[...l,2]))}return n(0,[]),r},Ts=(t,r)=>{const s=t<=4,n=t%3===0&&t>=6&&t<=15&&t!==3;return s||n?[]:hn(t).map(l=>l.join("+"))},xn=[{value:"intro",label:"Intro"},{value:"verse",label:"Verse"},{value:"chorus",label:"Chorus"},{value:"bridge",label:"Bridge"},{value:"outro",label:"Outro"},{value:"pre-chorus",label:"Pre-Chorus"},{value:"instrumental",label:"Instrumental"},{value:"tag",label:"Tag"},{value:"custom",label:"Custom"}];function fn({open:t,onOpenChange:r,type:s,currentTime:n,initialData:o,onSubmit:l}){const{t:a}=st(),i=!!o,[d,m]=f.useState("0"),[c,u]=f.useState("120"),[h,p]=f.useState("4"),[x,g]=f.useState("4"),[y,S]=f.useState(!1),[v,M]=f.useState(""),[C,w]=f.useState("verse"),[j,k]=f.useState(""),[N,E]=f.useState("C"),[z,V]=f.useState("natural"),[R,ie]=f.useState("major"),[de,U]=f.useState("none"),[X,L]=f.useState(""),[ve,le]=f.useState(!1),[Q,J]=f.useState([-1,3,2,0,1,0]),[Y,te]=f.useState([0,3,2,0,1,0]),[me,ce]=f.useState(1),[Se,O]=f.useState([0,0,0,3]),[$,T]=f.useState([0,0,0,3]),[A,D]=f.useState(1),[B,G]=f.useState(["C","E","G"]),[_,K]=f.useState(0),[q,ee]=f.useState(""),[ue,re]=f.useState(!1),[he,xe]=f.useState("linear"),[we,Z]=f.useState("120"),[ne,Be]=f.useState("0"),[Re,rt]=f.useState("simple"),$e=()=>{m(n.toFixed(2)),u("120"),p("4"),g("4"),S(!1),M(""),w("verse"),k(""),E("C"),V("natural"),ie("major"),U("none"),L(""),le(!1);const b=et.C;J(b?.guitar.frets||[-1,3,2,0,1,0]),te(b?.guitar.fingers||[0,3,2,0,1,0]),ce(b?.guitar.startFret||1),O(b?.ukulele.frets||[0,0,0,3]),T(b?.ukulele.fingers||[0,0,0,3]),D(1),G(b?.piano.keys||["C","E","G"]),K(0),ee(""),re(!1),xe("linear"),Z("120"),Be("0")};f.useEffect(()=>{if(t)if(i&&o)if(m(o.time.toFixed(2)),s==="chord"){const b=o,F=Cs(b.chord);if(E(F.root),V(F.accidental),ie(F.quality),U(F.extension),L(F.bassNote),k(b.chord),b.customDiagram)le(!0),J(b.customDiagram.guitar.frets),te(b.customDiagram.guitar.fingers),ce(b.customDiagram.guitar.startFret||1),O(b.customDiagram.ukulele.frets),T(b.customDiagram.ukulele.fingers),D(b.customDiagram.ukulele.startFret||1),G(b.customDiagram.piano.keys),K(b.customDiagram.capo||0);else{le(!1);const ae=b.chord.split("/")[0],se=et[ae];J(se?.guitar?.frets||[-1,-1,-1,-1,-1,-1]),te(se?.guitar?.fingers||[0,0,0,0,0,0]),ce(se?.guitar?.startFret||1),O(se?.ukulele?.frets||[0,0,0,0]),T(se?.ukulele?.fingers||[0,0,0,0]),D(1),G(se?.piano?.keys||[]),K(0)}}else if(s==="tempo"&&"tempo"in o){const b=o;u(String(b.tempo)),S(b.hidden||!1),ee(b.subdivision||""),b.curve&&(re(!0),xe(b.curve.type),Z(String(b.curve.targetTempo)),Be(String(b.curve.targetTime)))}else if(s==="timesig"&&"timeSignature"in o){const b=o,[F,ae]=b.timeSignature.split("/");p(F),g(ae),S(b.hidden||!1),ee(b.subdivision||"")}else s==="section"&&"label"in o&&(M(o.label),w(o.type||"custom"));else $e()},[t,i,o,s,n]),f.useEffect(()=>{const b=parseInt(h),F=parseInt(x);if(!isNaN(b)&&!isNaN(F)){const ae=Ns(b,F,q);rt(ae.type)}},[h,x,q]),f.useEffect(()=>{if(s==="chord"){const b=dn(N,z,R,de,X);k(b)}},[N,z,R,de,X,s]),f.useEffect(()=>{if(s==="chord"&&j&&!ve){const b=j.split("/")[0],F=et[b];F&&(J(F.guitar?.frets||[-1,-1,-1,-1,-1,-1]),te(F.guitar?.fingers||[0,0,0,0,0,0]),ce(F.guitar?.startFret||1),O(F.ukulele?.frets||[0,0,0,0]),T(F.ukulele?.fingers||[0,0,0,0]),D(1),G(F.piano?.keys||[]))}},[j,s,ve]);const ze=()=>{const b=parseFloat(d);if(isNaN(b)||b<0){Ne.error("Please enter a valid time");return}let F={time:b};switch(s){case"tempo":const ae=parseInt(c);if(isNaN(ae)||ae<1){Ne.error("Please enter a valid tempo (BPM)");return}if(F.tempo=ae,F.timeSignature=`${h}/${x}`,F.hidden=y,F.subdivision=q.trim()||void 0,ue){const We=parseInt(we),Ge=parseFloat(ne);if(isNaN(We)||We<1){Ne.error("Please enter a valid target tempo (BPM)");return}if(isNaN(Ge)||Ge<=b){Ne.error("Target time must be greater than start time");return}F.curve={type:he,targetTempo:We,targetTime:Ge}}break;case"timesig":const se=parseInt(h),ke=parseInt(x);if(isNaN(se)||isNaN(ke)||se<1||ke<1||!Number.isInteger(Math.log2(ke))){Ne.error("Please enter a valid time signature (e.g., 4/4, 3/4, 6/8)");return}F.timeSignature=`${se}/${ke}`,F.tempo=i&&o&&"tempo"in o?o.tempo:parseInt(c),F.hidden=y,F.subdivision=q.trim()||void 0;break;case"section":if(!v.trim()){Ne.error("Please enter a section label");return}F.label=v.trim(),F.type=C;break;case"chord":if(!j.trim()){Ne.error("Chord name is empty or invalid");return}F.chord=j.trim(),ve?F.customDiagram={guitar:{frets:Q,fingers:Y,startFret:me},ukulele:{frets:Se,fingers:$,startFret:A},piano:{keys:B},capo:_>0?_:void 0}:F.customDiagram=void 0;break}l(i?"update":"add",F)},_e=()=>{i&&l("delete",{})},Ve=()=>{switch(s){case"tempo":return"Add Tempo";case"timesig":return"Add Time Sig";case"section":return"Add Section";case"chord":return"Add Chord";default:return"Add Item"}},nt=()=>{switch(s){case"tempo":return"Add tempo marker";case"timesig":return"Add time signature marker";case"section":return"Add section marker";case"chord":return"Add chord marker";default:return""}};return e.jsx(dt,{open:t,onOpenChange:r,children:e.jsxs(ut,{className:s==="chord"?"sm:max-w-[600px] max-h-[90vh] overflow-y-auto":"sm:max-w-[450px]",children:[e.jsxs(mt,{children:[e.jsx(ht,{children:i?`Edit ${s}`:Ve()}),e.jsx(xt,{children:nt()})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"time",children:"Time (seconds)"}),e.jsx(Me,{id:"time",type:"number",step:"0.01",value:d,onChange:b=>m(b.target.value)})]}),s==="tempo"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"tempo",children:"Tempo (BPM)"}),e.jsx(Me,{id:"tempo",type:"number",placeholder:"120",value:c,onChange:b=>u(b.target.value)})]}),e.jsxs("div",{className:"space-y-3 border border-[#2B2B2B] rounded-md p-3",children:[e.jsx(W,{className:"text-sm font-semibold",children:"Time Signature"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-num",className:"text-xs text-muted-foreground",children:"Numerator"}),e.jsx(Me,{id:"ts-num",type:"number",min:"1",max:"32",value:h,onChange:b=>p(b.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-den",className:"text-xs text-muted-foreground",children:"Denominator"}),e.jsxs(Ee,{value:x,onValueChange:g,children:[e.jsx(Ae,{id:"ts-den",children:e.jsx(Fe,{})}),e.jsx(De,{children:Yt.map(b=>e.jsx(ye,{value:b.value,children:b.value},b.value))})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Type: ",e.jsx("span",{className:"font-semibold text-primary capitalize",children:Re})]}),Re==="irregular"&&e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:e.jsx("div",{className:"text-xs font-mono bg-black/20 px-2 py-1 rounded border border-white/10",children:q||"Default"})})]}),e.jsx("div",{className:"pt-2",children:e.jsx(Qt,{numerator:parseInt(h)||4,denominator:parseInt(x)||4,subdivision:q,onSubdivisionChange:ee})})]}),e.jsxs("div",{className:"space-y-3 border border-[#2B2B2B] rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(lt,{id:"enable-curve",checked:ue,onCheckedChange:re}),e.jsx(W,{htmlFor:"enable-curve",className:"text-sm cursor-pointer",children:"Enable Tempo Curve (Rallentando/Accelerando)"})]}),ue&&e.jsxs("div",{className:"space-y-3 pl-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"curve-type",className:"text-xs text-muted-foreground",children:"Curve Type"}),e.jsxs(Ee,{value:he,onValueChange:b=>xe(b),children:[e.jsx(Ae,{id:"curve-type",children:e.jsx(Fe,{})}),e.jsxs(De,{children:[e.jsx(ye,{value:"linear",children:"Linear (constant rate)"}),e.jsx(ye,{value:"exponential",children:"Exponential (natural feel)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"target-tempo",className:"text-xs text-muted-foreground",children:"Target Tempo"}),e.jsx(Me,{id:"target-tempo",type:"number",placeholder:"90",value:we,onChange:b=>Z(b.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"target-time",className:"text-xs text-muted-foreground",children:"Target Time (sec)"}),e.jsx(Me,{id:"target-time",type:"number",step:"0.1",placeholder:"8.0",value:ne,onChange:b=>Be(b.target.value)})]})]}),e.jsxs("div",{className:"bg-[#1E1E1E] border border-[#2B2B2B] rounded-md p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Curve Preview:"}),parseInt(c)>parseInt(we)?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-yellow-500/20 text-yellow-400 border border-yellow-500/30",children:"Rallentando (slowing down)"}):parseInt(c)<parseInt(we)?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-orange-500/20 text-orange-400 border border-orange-500/30",children:"Accelerando (speeding up)"}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-500/20 text-gray-400 border border-gray-500/30",children:"No change"})]}),e.jsxs("div",{className:"relative w-full h-16 bg-[#171717] rounded border border-[#2B2B2B] overflow-hidden",children:[e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 200 60",preserveAspectRatio:"none",children:[e.jsx("line",{x1:"0",y1:"15",x2:"200",y2:"15",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("line",{x1:"0",y1:"30",x2:"200",y2:"30",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("line",{x1:"0",y1:"45",x2:"200",y2:"45",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),(()=>{const b=parseInt(c)||120,F=parseInt(we)||120,ae=Math.max(b,F,180),se=Math.min(b,F,60),ke=ae-se||1,We=55-(b-se)/ke*50,Ge=55-(F-se)/ke*50;if(he==="linear")return e.jsx("line",{x1:"10",y1:We,x2:"190",y2:Ge,stroke:b>F?"#60a5fa":"#fb923c",strokeWidth:"2"});{const at=[];for(let ot=0;ot<=20;ot++){const Ue=ot/20,Ct=b>F?1-Math.pow(1-Ue,2):Math.pow(Ue,2),Nt=b+(F-b)*Ct,Tt=10+Ue*180,St=55-(Nt-se)/ke*50;at.push(`${Tt},${St}`)}return e.jsx("polyline",{points:at.join(" "),fill:"none",stroke:b>F?"#60a5fa":"#fb923c",strokeWidth:"2"})}})(),e.jsx("circle",{cx:"10",cy:(()=>{const b=parseInt(c)||120,F=parseInt(we)||120,ae=Math.max(b,F,180),se=Math.min(b,F,60),ke=ae-se||1;return 55-(b-se)/ke*50})(),r:"3",fill:"#10b981"}),e.jsx("circle",{cx:"190",cy:(()=>{const b=parseInt(c)||120,F=parseInt(we)||120,ae=Math.max(b,F,180),se=Math.min(b,F,60),ke=ae-se||1;return 55-(F-se)/ke*50})(),r:"3",fill:"#ef4444"})]}),e.jsxs("div",{className:"absolute top-1 left-2 text-[10px] text-yellow-400",children:[c," BPM"]}),e.jsxs("div",{className:"absolute top-1 right-2 text-[10px] text-red-400",children:[we," BPM"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs pt-1",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",(parseFloat(ne)-parseFloat(d)).toFixed(2),"s"]}),e.jsxs("span",{className:"text-muted-foreground",children:["Change: ",Math.abs(parseInt(we)-parseInt(c))," BPM"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(lt,{id:"hide-tempo",checked:y,onCheckedChange:S}),e.jsx(W,{htmlFor:"hide-tempo",className:"text-sm cursor-pointer",children:"Hide in player mode (show only in edit mode)"})]})]}),s==="timesig"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(W,{children:"Time Signature"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-preset",className:"text-xs text-muted-foreground",children:"Common Presets"}),e.jsxs(Ee,{value:`${h}/${x}`,onValueChange:b=>{const[F,ae]=b.split("/");p(F),g(ae)},children:[e.jsx(Ae,{id:"ts-preset",children:e.jsx(Fe,{})}),e.jsx(De,{children:un.map(b=>e.jsx(ye,{value:`${b.numerator}/${b.denominator}`,children:b.label},b.label))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Custom Time Signature"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-num",className:"text-xs text-muted-foreground",children:"Numerator (Beats)"}),e.jsx(Me,{id:"ts-num",type:"number",min:"1",max:"32",value:h,onChange:b=>p(b.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-den",className:"text-xs text-muted-foreground",children:"Denominator (Note Value)"}),e.jsxs(Ee,{value:x,onValueChange:g,children:[e.jsx(Ae,{id:"ts-den",children:e.jsx(Fe,{})}),e.jsx(De,{children:Yt.map(b=>e.jsx(ye,{value:b.value,children:b.label},b.value))})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Note Groups (Visual Feedback)"}),e.jsx(Qt,{numerator:parseInt(h)||4,denominator:parseInt(x)||4,subdivision:q,onSubdivisionChange:ee})]}),Re==="irregular"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",children:"Beat Grouping (Drag to Rearrange)"}),(()=>{const b=parseInt(h),F=Ts(b);return F.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:F.map(ae=>e.jsx(P,{type:"button",variant:q===ae?"default":"outline",size:"sm",onClick:()=>ee(ae),className:"text-xs h-7",children:ae},ae))}):null})(),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"ðŸ’¡ Drag the note groups in the visualization above to rearrange beat grouping for this irregular time signature."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(lt,{id:"hide-timesig",checked:y,onCheckedChange:S}),e.jsx(W,{htmlFor:"hide-timesig",className:"text-sm cursor-pointer",children:"Hide in player mode (show only in edit mode)"})]})]}),s==="section"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"section-type",children:"Section Type"}),e.jsxs(Ee,{value:C,onValueChange:w,children:[" ",e.jsx(Ae,{id:"section-type",children:e.jsx(Fe,{})})," ",e.jsx(De,{children:xn.map(b=>e.jsx(ye,{value:b.value,children:b.label},b.value))})," "]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"section-label",children:"Section Label"}),e.jsx(Me,{id:"section-label",value:v,onChange:b=>M(b.target.value)})]})]}),s==="chord"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 border p-4 rounded-md",children:[e.jsx(W,{className:"text-base font-medium",children:"Chord Builder"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"root-note",className:"text-xs text-muted-foreground",children:"Root"}),e.jsxs(Ee,{value:N,onValueChange:E,children:[e.jsx(Ae,{id:"root-note",children:e.jsx(Fe,{})}),e.jsx(De,{children:Zt.map(b=>e.jsx(ye,{value:b,children:b},b))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"accidental",className:"text-xs text-muted-foreground",children:"Accidental"}),e.jsxs(Ee,{value:z,onValueChange:V,children:[e.jsx(Ae,{id:"accidental",className:"music-notation",children:e.jsx(Fe,{})}),e.jsx(De,{children:ys.map(b=>e.jsx(ye,{value:b.value,className:"music-notation",children:b.label},b.value))})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"quality",className:"text-xs text-muted-foreground",children:"Quality"}),e.jsxs(Ee,{value:R,onValueChange:ie,children:[e.jsx(Ae,{id:"quality",children:e.jsx(Fe,{})}),e.jsx(De,{children:ws.map(b=>e.jsx(ye,{value:b.value,children:b.label},b.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"extension",className:"text-xs text-muted-foreground",children:"Extension"}),e.jsxs(Ee,{value:de,onValueChange:U,children:[e.jsx(Ae,{id:"extension",children:e.jsx(Fe,{})}),e.jsx(De,{children:ks.map(b=>e.jsx(ye,{value:b.value,children:b.label},b.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"bass-note",className:"text-xs text-muted-foreground",children:"Bass Note"}),e.jsxs(Ee,{value:X||"none",onValueChange:b=>L(b==="none"?"":b),children:[e.jsx(Ae,{id:"bass-note",children:e.jsx(Fe,{placeholder:"None"})}),e.jsxs(De,{children:[e.jsx(ye,{value:"none",children:"None"}),Zt.map(b=>e.jsxs(H.Fragment,{children:[e.jsx(ye,{value:b,children:b}),e.jsx(ye,{value:`${b}#`,className:"music-notation",children:`${b}${it.accidentalSharp}`}),e.jsx(ye,{value:`${b}b`,className:"music-notation",children:`${b}${it.accidentalFlat}`})]},b))]})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Generated Chord"}),e.jsx("p",{className:"text-lg font-semibold",children:j||"-"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{type:"button",variant:"outline",onClick:()=>le(!ve),className:"w-full",children:[" ",e.jsx(ar,{className:"w-4 h-4 mr-2"})," ",ve?"Hide":"Customize"," Diagrams "]}),ve&&e.jsxs("div",{className:"border rounded-md p-4 space-y-4",children:[" ",e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"capo",children:"Capo Fret"}),e.jsx(Me,{id:"capo",type:"number",min:"0",max:"12",value:_,onChange:b=>K(parseInt(b.target.value)||0)})]})," ",e.jsxs(ds,{defaultValue:"guitar",children:[e.jsxs(us,{className:"grid w-full grid-cols-3",children:[" ",e.jsx(Ye,{value:"guitar",children:"Guitar"})," ",e.jsx(Ye,{value:"ukulele",children:"Ukulele"})," ",e.jsx(Ye,{value:"piano",children:"Piano"})," "]}),e.jsxs(Qe,{value:"guitar",className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"guitar-start-fret",children:"Start Fret"}),e.jsx(Me,{id:"guitar-start-fret",type:"number",min:"1",max:"15",value:me,onChange:b=>ce(parseInt(b.target.value)||1)})]}),e.jsx(Qr,{frets:Q,fingers:Y,startFret:me,onChange:(b,F)=>{J(b),te(F)}})]}),e.jsxs(Qe,{value:"ukulele",className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ukulele-start-fret",children:"Start Fret"}),e.jsx(Me,{id:"ukulele-start-fret",type:"number",min:"1",max:"15",value:A,onChange:b=>D(parseInt(b.target.value)||1)})]}),e.jsx(Jr,{frets:Se,fingers:$,startFret:A,onChange:(b,F)=>{O(b),T(F)}})]}),e.jsxs(Qe,{value:"piano",className:"mt-4 space-y-3",children:[" ",e.jsx(en,{keys:B,onChange:G})," "]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[i&&e.jsxs(P,{variant:"destructive",onClick:_e,className:"mr-auto",children:[e.jsx(Bt,{className:"w-4 h-4 mr-2"})," Delete"]}),e.jsx(P,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsx(P,{onClick:ze,children:i?"Update":e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Add"]})})]})]})})}const Qt=({numerator:t,denominator:r,subdivision:s,onSubdivisionChange:n})=>{const o=Ns(t,r,s),{grouping:l,type:a}=o,[i,d]=H.useState(l),[m,c]=H.useState(null),[u,h]=H.useState(null);H.useEffect(()=>{d(l)},[JSON.stringify(l)]);const p=60,x=50,g=40,y=35,S=(w,j)=>{a!=="irregular"||!n||(c(j),w.dataTransfer.effectAllowed="move")},v=(w,j)=>{if(w.preventDefault(),a!=="irregular"||!n||m===null||m===j)return;const k=[...i],[N]=k.splice(m,1);k.splice(j,0,N),d(k),c(j)},M=w=>{if(w.preventDefault(),a!=="irregular"||!n||m===null)return;c(null);const j=i.join("+");j!==s&&n(j)};return a==="irregular"&&n?e.jsxs("div",{className:"w-full p-4 bg-[#171717] rounded-md border border-[#2B2B2B] space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-lg",children:"âœ‹"}),e.jsx("span",{children:"Drag beat groups to rearrange the meter pattern"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-[#1F1F1F] border border-[#333] rounded px-3 py-2",children:[e.jsx("span",{className:"text-2xl font-bold leading-none",children:t}),e.jsx("div",{className:"w-full h-[1px] bg-[#444] my-0.5"}),e.jsx("span",{className:"text-2xl font-bold leading-none",children:r})]}),e.jsx("div",{className:"text-2xl text-muted-foreground",children:"="}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:i.map((w,j)=>e.jsxs("div",{draggable:!0,onDragStart:k=>S(k,j),onDragEnter:k=>v(k,j),onDragEnd:M,onDragOver:k=>k.preventDefault(),className:`
                  flex items-center justify-center gap-1 px-4 py-3 rounded-lg border-2
                  transition-all duration-200 select-none
                  ${m===j?"opacity-40 scale-95 border-yellow-500/50 bg-yellow-500/10":"opacity-100 scale-100 border-[#333] bg-[#1F1F1F] hover:border-yellow-500/30 hover:bg-[#252525]"}
                  cursor-move
                `,children:[e.jsx("span",{className:"text-xl font-bold",children:w}),e.jsx("span",{className:"text-xs text-muted-foreground",children:w===3?"â™©.":w===2?"â™©":"â™ª"})]},j))})]}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground",children:["Pattern: ",i.join(" + ")," = ",t]})]}):e.jsx("div",{className:"w-full overflow-x-auto p-4 bg-[#171717] rounded-md border border-[#2B2B2B]",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("svg",{height:"80",width:Math.max(300,x+i.length*p+40),children:[e.jsx("line",{x1:"0",y1:g,x2:"100%",y2:g,stroke:"#444",strokeWidth:"1"}),e.jsx("text",{x:"10",y:g-5,fontFamily:"serif",fontSize:"24",fontWeight:"bold",fill:"#e5e5e5",children:t}),e.jsx("text",{x:"10",y:g+20,fontFamily:"serif",fontSize:"24",fontWeight:"bold",fill:"#e5e5e5",children:r}),i.map((w,j)=>{const k=x+40+j*p,N=[];let E=!0,z=!0,V=!1,R=!1;return r===8?w===3?(E=!0,z=!0,R=!0,V=!1):w===2?(E=!0,z=!0,R=!1,V=!1):(E=!0,z=!0,R=!1,V=!0):r===4?w===3?(E=!1,z=!0,R=!0,V=!1):w===2?(E=!1,z=!0,R=!1,V=!1):(E=!0,z=!0,R=!1,V=!1):r===2?w===1&&(E=!1,z=!0,R=!1,V=!1):r===1&&w===1&&(E=!1,z=!1,R=!1,V=!1),E?N.push(e.jsx("ellipse",{cx:k,cy:g,rx:"6",ry:"5",fill:"#e5e5e5",transform:`rotate(-15 ${k} ${g})`},`head-${j}`)):N.push(e.jsx("ellipse",{cx:k,cy:g,rx:"6",ry:"5",fill:"none",stroke:"#e5e5e5",strokeWidth:"2",transform:`rotate(-15 ${k} ${g})`},`head-${j}`)),z&&N.push(e.jsx("line",{x1:k+5,y1:g,x2:k+5,y2:g-y,stroke:"#e5e5e5",strokeWidth:"1.5"},`stem-${j}`)),R&&N.push(e.jsx("circle",{cx:k+12,cy:g,r:"2",fill:"#e5e5e5"},`dot-${j}`)),V&&N.push(e.jsx("path",{d:`M${k+5},${g-y} Q${k+15},${g-y+10} ${k+10},${g-y+25}`,fill:"none",stroke:"#e5e5e5",strokeWidth:"2"},`flag-${j}`)),e.jsx("g",{children:N},j)})]})})})},pn=({chord:t,customData:r})=>{const s=et[t],{frets:n,fingers:o,startFret:l=1}=r||s?.guitar||{frets:[0,0,0,0,0,0],fingers:[0,0,0,0,0,0]},a=l;if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const i=["E","A","D","G","B","e"],d=()=>{bs(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:d,className:"mb-3 gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"200",height:"280",viewBox:"0 0 200 280",className:"mb-2",children:[[...Array(5)].map((m,c)=>e.jsx("line",{x1:"40",y1:60+c*40,x2:"160",y2:60+c*40,stroke:"#666",strokeWidth:c===0&&a===1?"4":"2"},`fret-${c}`)),[...Array(6)].map((m,c)=>e.jsx("line",{x1:40+c*24,y1:"60",x2:40+c*24,y2:"220",stroke:"#666",strokeWidth:"2"},`string-${c}`)),a>1&&e.jsxs("text",{x:"20",y:"65",fontSize:"14",fill:"#666",children:[a,"fr"]}),i.map((m,c)=>e.jsx("text",{x:40+c*24,y:"250",fontSize:"12",fill:"#666",textAnchor:"middle",children:m},`label-${c}`)),n.map((m,c)=>{const u=40+c*24;if(m===-1)return e.jsxs("g",{children:[e.jsx("line",{x1:u-4,y1:"36",x2:u+4,y2:"44",stroke:"#999",strokeWidth:"2"}),e.jsx("line",{x1:u+4,y1:"36",x2:u-4,y2:"44",stroke:"#999",strokeWidth:"2"})]},`marker-${c}`);if(m===0)return e.jsx("circle",{cx:u,cy:"40",r:"6",fill:"none",stroke:"#666",strokeWidth:"2"},`marker-${c}`);{const h=m-a+1;if(h>=1&&h<=5){const p=60+(h-.5)*40,x=o?.[c];return e.jsxs("g",{children:[e.jsx("circle",{cx:u,cy:p,r:"10",fill:"#2563eb"}),x&&x>0&&e.jsx("text",{x:u,y:p+4,fontSize:"12",fill:"white",textAnchor:"middle",children:x})]},`marker-${c}`)}return null}})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Finger positions: ",o?.filter(m=>m>0).join(", ")||"N/A"]})]})},gn=({chord:t,customData:r})=>{const s=et[t],{keys:n}=r||s?.piano||{keys:["C","E","G"]};if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=["C#","D#","F#","G#","A#"],a=()=>{vs(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:a,className:"mb-3 gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"400",height:"180",viewBox:"0 0 400 180",className:"mb-2",children:[o.filter(i=>!l.includes(i)).map((i,d)=>{const m=20+d*50,c=n.includes(i);return e.jsx("rect",{x:m,y:"20",width:"48",height:"140",fill:c?"#2563eb":"white",stroke:"#333",strokeWidth:"2",rx:"4"},`white-${i}`)}),o.filter(i=>l.includes(i)).map(i=>{const m=20+(o.indexOf(i)-Math.floor((o.indexOf(i)+1)/2))*50+35,c=n.includes(i);return e.jsx("rect",{x:m,y:"20",width:"26",height:"90",fill:c?"#1e40af":"#333",stroke:"#000",strokeWidth:"2",rx:"3"},`black-${i}`)}),o.filter(i=>!l.includes(i)).map((i,d)=>{const m=20+d*50+24;return e.jsx("text",{x:m,y:"150",fontSize:"14",fill:n.includes(i)?"white":"#666",textAnchor:"middle",children:i},`label-${i}`)})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Notes: ",n.join(" - ")]})]})},vn=({chord:t,customData:r})=>{const s=et[t],{frets:n,fingers:o,startFret:l=1}=r||s?.ukulele||{frets:[0,0,0,0],fingers:[0,0,0,0]};if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const a=["G","C","E","A"],i=()=>{js(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:i,className:"mb-3 gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"160",height:"280",viewBox:"0 0 160 280",className:"mb-2",children:[[...Array(5)].map((d,m)=>e.jsx("line",{x1:"40",y1:60+m*40,x2:"136",y2:60+m*40,stroke:"#666",strokeWidth:m===0&&l===1?"4":"2"},`fret-${m}`)),[...Array(4)].map((d,m)=>e.jsx("line",{x1:40+m*32,y1:"60",x2:40+m*32,y2:"220",stroke:"#666",strokeWidth:"2"},`string-${m}`)),l>1&&e.jsxs("text",{x:"20",y:"65",fontSize:"14",fill:"#666",children:[l,"fr"]}),a.map((d,m)=>e.jsx("text",{x:40+m*32,y:"250",fontSize:"12",fill:"#666",textAnchor:"middle",children:d},`label-${m}`)),n.map((d,m)=>{const c=40+m*32;if(d===0)return e.jsx("circle",{cx:c,cy:"40",r:"6",fill:"none",stroke:"#666",strokeWidth:"2"},`marker-${m}`);{const u=d-l+1;if(u>=1&&u<=5){const h=60+(u-.5)*40,p=o?.[m];return e.jsxs("g",{children:[e.jsx("circle",{cx:c,cy:h,r:"10",fill:"#2563eb"}),p&&p>0&&e.jsx("text",{x:c,y:h+4,fontSize:"12",fill:"white",textAnchor:"middle",children:p})]},`marker-${m}`)}return null}})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Finger positions: ",o?.filter(d=>d>0).join(", ")||"N/A"]})]})};function bn({chord:t,isOpen:r,onClose:s,customDiagram:n}){return e.jsx(dt,{open:r,onOpenChange:s,children:e.jsxs(ut,{className:"max-w-2xl",children:[e.jsxs(mt,{children:[e.jsxs(ht,{className:"text-2xl",children:[t," Chord",n?.capo&&n.capo>0&&e.jsxs("span",{className:"ml-3 text-lg text-orange-600",children:["Capo ",n.capo]})]}),e.jsxs(xt,{children:["View chord diagrams for guitar, piano, and ukulele",n&&e.jsx("span",{className:"ml-2 text-yellow-600",children:"(Custom)"})]})]}),e.jsxs(ds,{defaultValue:"guitar",className:"w-full",children:[e.jsxs(us,{className:"grid w-full grid-cols-3",children:[e.jsx(Ye,{value:"guitar",children:"Guitar"}),e.jsx(Ye,{value:"piano",children:"Piano"}),e.jsx(Ye,{value:"ukulele",children:"Ukulele"})]}),e.jsx(Qe,{value:"guitar",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(pn,{chord:t,customData:n?.guitar})}),e.jsx(Qe,{value:"piano",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(gn,{chord:t,customData:n?.piano})}),e.jsx(Qe,{value:"ukulele",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(vn,{chord:t,customData:n?.ukulele})})]})]})})}function Ss({className:t,...r}){return e.jsx("textarea",{"data-slot":"textarea",className:Te("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...r})}function jn({open:t,onOpenChange:r,trackName:s,notes:n,onSave:o}){const[l,a]=f.useState(n);H.useEffect(()=>{a(n)},[n,t]);const i=()=>{o(l),r(!1)};return e.jsx(dt,{open:t,onOpenChange:r,children:e.jsxs(ut,{style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},children:[e.jsxs(mt,{children:[e.jsx(ht,{style:{color:"#F1F1F1"},children:"Track Notes"}),e.jsxs(xt,{style:{color:"#9E9E9E"},children:["Add notes for ",s]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ss,{placeholder:"Enter your notes here...",value:l,onChange:d=>a(d.target.value),rows:6,style:{backgroundColor:"var(--daw-control)",borderColor:"var(--daw-border)",color:"#F1F1F1"}}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"ghost",onClick:()=>r(!1),style:{color:"#9E9E9E"},children:"Cancel"}),e.jsx(P,{onClick:i,style:{backgroundColor:"#3B82F6",color:"#FFFFFF"},children:"Save Notes"})]})]})]})})}const yn=({start:t,end:r,onChange:s,minWidth:n=.01,className:o})=>{const l=f.useRef(null),[a,i]=f.useState(null),d=f.useCallback(p=>{if(!l.current)return 0;const x=l.current.getBoundingClientRect(),g=p-x.left;return Math.max(0,Math.min(1,g/x.width))},[]),m=(p,x)=>{p.preventDefault(),p.stopPropagation(),i({type:x,startX:p.clientX,initialStart:t,initialEnd:r})};f.useEffect(()=>{if(!a)return;const p=g=>{if(!l.current)return;const S=l.current.getBoundingClientRect().width;let v=a.initialStart,M=a.initialEnd;if(a.type==="pan"){const w=(g.clientX-a.startX)/S;if(v=a.initialStart+w,M=a.initialEnd+w,v<0){const j=0-v;v+=j,M+=j}if(M>1){const j=1-M;v+=j,M+=j}v=Math.max(0,Math.min(1-(a.initialEnd-a.initialStart),v)),M=Math.min(1,Math.max(a.initialEnd-a.initialStart,M))}else if(a.type==="left"){const C=d(g.clientX);v=Math.min(C,a.initialEnd-n),v=Math.max(0,v),M=a.initialEnd}else if(a.type==="right"){const C=d(g.clientX);M=Math.max(C,a.initialStart+n),M=Math.min(1,M),v=a.initialStart}(Math.abs(v-t)>1e-4||Math.abs(M-r)>1e-4)&&s({start:v,end:M})},x=()=>{i(null)};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",x)}},[a,t,r,n,s,d]);const c=p=>{if(p.target!==l.current)return;p.preventDefault(),p.stopPropagation();const x=d(p.clientX),g=r-t;let y=x-g/2,S=x+g/2;y<0&&(y=0,S=g),S>1&&(S=1,y=1-g),s({start:y,end:S})},u=t*100,h=(r-t)*100;return e.jsxs("div",{ref:l,onClick:c,className:Te("relative w-full select-none touch-none flex items-center border border-white/10 rounded-full cursor-pointer",o),style:{backgroundColor:"#18181b",height:"14px"},children:[e.jsx("div",{className:"absolute top-0 bottom-0 rounded-full group transition-colors cursor-grab active:cursor-grabbing hover:brightness-110",style:{left:`${u}%`,width:`${h}%`,backgroundColor:"#52525b",border:"1px solid #71717a",boxSizing:"border-box"},onMouseDown:p=>m(p,"pan")}),e.jsx("div",{className:"absolute top-1/2 w-6 h-6 cursor-ew-resize z-20 group/handle",style:{left:`${u}%`,transform:"translate(-50%, -50%)"},onMouseDown:p=>m(p,"left"),children:e.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full shadow-sm transition-transform hover:scale-150",style:{transform:"translate(-50%, -50%)"}})}),e.jsx("div",{className:"absolute top-1/2 w-6 h-6 cursor-ew-resize z-20 group/handle",style:{left:`${r*100}%`,transform:"translate(-50%, -50%)"},onMouseDown:p=>m(p,"right"),children:e.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full shadow-sm transition-transform hover:scale-150",style:{transform:"translate(-50%, -50%)"}})})]})},wn=({start:t,end:r,onChange:s,minHeight:n=.01,className:o})=>{const l=f.useRef(null),[a,i]=f.useState(null),d=f.useCallback(p=>{if(!l.current)return 0;const x=l.current.getBoundingClientRect(),g=p-x.top;return Math.max(0,Math.min(1,g/x.height))},[]),m=p=>{p.preventDefault(),p.stopPropagation(),i({startY:p.clientY,initialStart:t,initialEnd:r})};f.useEffect(()=>{if(!a)return;const p=g=>{if(!l.current)return;const S=l.current.getBoundingClientRect().height,M=(g.clientY-a.startY)/S;let C=a.initialStart+M,w=a.initialEnd+M;if(C<0){const j=0-C;C+=j,w+=j}if(w>1){const j=1-w;C+=j,w+=j}C=Math.max(0,Math.min(1-(a.initialEnd-a.initialStart),C)),w=Math.min(1,Math.max(a.initialEnd-a.initialStart,w)),(Math.abs(C-t)>1e-4||Math.abs(w-r)>1e-4)&&s({start:C,end:w})},x=()=>{i(null)};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",x)}},[a,t,r,s]);const c=p=>{if(p.target!==l.current)return;p.preventDefault(),p.stopPropagation();const x=d(p.clientY),g=r-t;let y=x-g/2,S=x+g/2;y<0&&(y=0,S=g),S>1&&(S=1,y=1-g),s({start:y,end:S})},u=t*100,h=(r-t)*100;return e.jsx("div",{ref:l,onClick:c,className:Te("relative h-full select-none touch-none flex justify-center border border-white/10 rounded-full cursor-pointer",o),style:{backgroundColor:"#18181b",width:"14px"},children:e.jsx("div",{className:"absolute left-0 right-0 rounded-full transition-colors cursor-grab active:cursor-grabbing hover:brightness-110",style:{top:`${u}%`,height:`${h}%`,backgroundColor:"#52525b",border:"1px solid #71717a",boxSizing:"border-box"},onMouseDown:m})})},kn=f.createContext(void 0),Cn=({children:t,value:r})=>e.jsx(kn.Provider,{value:r,children:t}),At=new WeakMap;function Nn(t,r){if(At.has(t))return At.get(t);const s=[...t].sort((i,d)=>i.time-d.time),n=[];let o=0,l=0;for(let i=0;i<s.length;i++)s[i].time>l;const a=[...s];(a.length===0||a[0].time>0)&&a.unshift({time:0,tempo:r}),o=0;for(let i=0;i<a.length;i++){const d=a[i],m=i<a.length-1?a[i+1].time:Number.MAX_VALUE;if(n.push({startTime:d.time,endTime:m,audioStartTime:o,tempo:d.tempo}),m!==Number.MAX_VALUE){const c=m-d.time,u=r/d.tempo;o+=c*u}}return At.set(t,n),n}function Tn(t,r,s,n){if(!n||r.length===0)return t;const o=Nn(r,s);let l=0,a=o.length-1,i=null;for(;l<=a;){const d=Math.floor((l+a)/2),m=o[d];if(t>=m.startTime&&t<m.endTime){i=m;break}else t<m.startTime?a=d-1:l=d+1}if(!i&&o.length>0&&(i=o[o.length-1]),i){const d=t-i.startTime,m=s/i.tempo;return i.audioStartTime+d*m}return t}function Jt(t,r,s){let n=0,o=0;const a=[{time:0,tempo:s},...r].sort((u,h)=>u.time-h.time).filter((u,h,p)=>h===0||u.time>p[h-1].time);for(let u=1;u<a.length;u++){const h=a[u],p=h.time-o,x=a[u-1].tempo,g=s/x,y=p*g;if(t<n+y){const v=(t-n)/g;return o+v}n+=y,o=h.time}const i=a[a.length-1]?.tempo||s,d=s/i,c=(t-n)/d;return o+c}function Sn(){return Pe.getMetronomeFrequencies()}function Va(t){Pe.setMetronomeFrequencies(t)}function Wa(){try{Pe.setMetronomeFrequencies({strongBeat:1e3,normalBeat:800,subdivision:600})}catch{console.warn("Failed to reset metronome frequencies")}}function Mn(t,r,s=.5,n=!1,o,l){const a=t,i=l!==void 0?l:a.currentTime,d=a.createOscillator(),m=a.createGain(),c=Sn();let u;n?u=c.subdivision:r?u=c.strongBeat:u=c.normalBeat,d.frequency.setValueAtTime(u,i),m.gain.setValueAtTime(s,i),m.gain.exponentialRampToValueAtTime(.001,i+.05),d.connect(m),m.connect(a.destination),d.start(i),d.stop(i+.05)}function Wt(t){return!t||!t.trim()?[]:t.split("+").map(r=>parseInt(r.trim())).filter(r=>!isNaN(r)&&r>0)}function En(t,r){if(r)return Wt(r).length;const[s,n]=t.split("/").map(Number);return n===8&&[6,9,12].includes(s)?s/3:s}function An(t,r){const s=Wt(r);if(s.length===0)return{groupIndex:0,beatInGroup:1,isGroupStart:!0};let n=0,o=(t-1)%s.reduce((l,a)=>l+a,0)+1;for(let l=0;l<s.length;l++){if(o<=n+s[l])return{groupIndex:l,beatInGroup:o-n,isGroupStart:o===n+1};n+=s[l]}return{groupIndex:0,beatInGroup:1,isGroupStart:!0}}const Fn=({song:t,initialTempo:r=100,initialMetronomeVolume:s=.5,warpModeEnabled:n=!0})=>{const{resumeAudioContext:o,getAudioContext:l}=Zr(),[a,i]=f.useState(!1),[d,m]=f.useState(0),[c,u]=f.useState(0),[h,p]=f.useState(r),[x,g]=f.useState(!1),[y,S]=f.useState(null),[v,M]=f.useState(null),[C,w]=f.useState(!1),[j,k]=f.useState(s),N=f.useRef(0),E=f.useRef(0),z=f.useRef(new Set),V=t?.tempoChanges||[{time:0,tempo:t?.tempo||120,timeSignature:"4/4"}],R=f.useRef(new Map),ie=f.useRef(new Map),de=f.useRef(null),U=f.useRef(h),X=f.useRef(C),L=f.useRef(j),ve=f.useRef(x),le=f.useRef(y),Q=f.useRef(v),J=f.useRef(0),Y=f.useRef(0);f.useEffect(()=>{U.current=h},[h]),f.useEffect(()=>{X.current=C},[C]),f.useEffect(()=>{L.current=j},[j]),f.useEffect(()=>{ve.current=x},[x]),f.useEffect(()=>{le.current=y},[y]),f.useEffect(()=>{Q.current=v},[v]);const te=f.useCallback(O=>t?Tn(O,V,t.tempo,n):O,[t,V,n]),me=f.useCallback(O=>{if(!t)return;const $=Math.max(0,Math.min(O,t.duration)),T=te($),A=l();J.current=A.currentTime,Y.current=T,u($),m(T),N.current=0,R.current.forEach(D=>{D.currentTime=T})},[t,te,l]),ce=f.useCallback(()=>{i(O=>!O)},[]),Se=f.useCallback(()=>{i(!1),me(0)},[me]);return f.useEffect(()=>{if(!t)return;const O=l(),$=new Map,T=new Map;for(const A of t.tracks){if(!A.url)continue;const D=new Audio(A.url);D.preload="auto",D.crossOrigin="anonymous";const B=O.createGain(),G=O.createMediaElementSource(D);G.connect(B),B.connect(O.destination),B.gain.value=A.muted?0:A.volume,$.set(A.id,D),T.set(A.id,{gainNode:B,source:G})}return R.current=$,ie.current=T,()=>{$.forEach(A=>{A.pause(),A.src=""}),T.forEach(({gainNode:A,source:D})=>{D.disconnect(),A.disconnect()}),R.current.clear(),ie.current.clear()}},[t?.id,l]),f.useEffect(()=>{if(!t)return;const O=t.tracks.some($=>$.solo);t.tracks.forEach($=>{const T=ie.current.get($.id);if(!T)return;const{gainNode:A}=T;let D=0;O?D=$.solo&&!$.muted?$.volume:0:D=$.muted?0:$.volume,A.gain.value=D})},[t?.tracks]),f.useEffect(()=>{a&&o()},[a,o]),f.useEffect(()=>()=>{de.current&&de.current.terminate()},[]),f.useEffect(()=>{if(!a||!t)return;const O=l(),$=.2;let T=null;J.current=O.currentTime,Y.current=d;const A=G=>{let _=V[0];for(const K of V)if(K.time<=G)_=K;else break;if(_.curve&&G>=_.time&&G<=_.curve.targetTime){const K=_.tempo,q=_.curve.targetTempo,ee=_.curve.targetTime-_.time,ue=(G-_.time)/ee;let re=K;if(_.curve.type==="linear")re=K+(q-K)*ue;else if(_.curve.type==="exponential"){const he=1-Math.pow(1-ue,2);re=K+(q-K)*he}return{..._,tempo:re}}return _};R.current.forEach(G=>{G.currentTime=d,G.playbackRate=h/100,G.play().catch(_=>console.warn("Audio play failed:",_))});const D=()=>{const G=O.currentTime,_=U.current,K=ve.current,q=le.current,ee=Q.current;X.current,L.current;const ue=(G-J.current)*(_/100),re=Y.current+ue,he=Jt(re,V,t.tempo);R.current.forEach(Z=>{Math.abs(Z.currentTime-re)>.02&&(Z.currentTime=re),Math.abs(Z.playbackRate-_/100)>.01&&(Z.playbackRate=_/100)});const xe=K&&q!==null?te(q):0,we=K&&ee!==null?te(ee):t.duration;re>=we?K?(J.current=O.currentTime,Y.current=xe,N.current=0,E.current=0,z.current.clear(),u(q!==null?q:0),m(xe),R.current.forEach(Z=>{Z.currentTime=xe})):(i(!1),N.current=0,E.current=0,z.current.clear(),u(0),m(0),R.current.forEach(Z=>{Z.pause(),Z.currentTime=0})):(m(re),u(he)),T=requestAnimationFrame(D)},B=de.current;return B&&(B.onmessage=()=>{if(X.current){const G=l(),_=G.currentTime,K=_+$,q=U.current;(E.current===0||E.current<_)&&(E.current=_+.05,z.current.clear());const ee=(_-J.current)*(q/100),ue=Y.current+ee,re=Jt(ue,V,t.tempo);for(;E.current<K;){const he=E.current,xe=A(re),Z=60/(xe.tempo*(q/100)),ne=Math.floor(re/Z);if(!z.current.has(ne)){const Be=xe.timeSignature||"4/4",Re=xe.subdivision,rt=En(Be,Re);let $e=!1;if(Re){const _e=Wt(Re).reduce((nt,b)=>nt+b,0),Ve=ne%_e+1;$e=An(Ve,Re).isGroupStart}else $e=ne%rt+1===1;if(Mn(G,$e,L.current,!1,void 0,he),z.current.add(ne),z.current.size>100){const ze=Array.from(z.current).sort((_e,Ve)=>_e-Ve);z.current=new Set(ze.slice(-50))}}E.current+=Z}}},B.postMessage({action:"start",interval:25})),T=requestAnimationFrame(D),()=>{T!==null&&cancelAnimationFrame(T),B&&B.postMessage({action:"stop"}),R.current.forEach(G=>{G.pause()})}},[a,t,V,te,l]),{isPlaying:a,currentTime:d,gridTime:c,tempo:h,loopEnabled:x,loopStart:y,loopEnd:v,metronomeEnabled:C,metronomeVolume:j,actions:{togglePlayPause:ce,stop:Se,seek:me,setTempo:p,setLoopEnabled:g,setLoopStart:S,setLoopEnd:M,setMetronomeEnabled:w,setMetronomeVolume:k}}},Dn=({isPlaying:t,onPlayPause:r,onStop:s,onZoomIn:n,onZoomOut:o,onToggleLoop:l,onToggleMetronome:a,onGoToStart:i,onGoToEnd:d,onFitToView:m,onToggleEditMode:c,onToggleHelp:u,disabled:h=!1})=>{const p=f.useCallback(x=>{if(h)return;const g=x.target;if(!(g.tagName==="INPUT"||g.tagName==="TEXTAREA"||g.isContentEditable))switch(x.code){case"Space":x.preventDefault(),r();break;case"KeyS":(x.ctrlKey||x.metaKey)&&(x.preventDefault(),s());break;case"Home":x.preventDefault(),i();break;case"End":x.preventDefault(),d();break;case"Equal":case"NumpadAdd":(x.ctrlKey||x.metaKey)&&(x.preventDefault(),n());break;case"Minus":case"NumpadSubtract":(x.ctrlKey||x.metaKey)&&(x.preventDefault(),o());break;case"KeyL":(x.ctrlKey||x.metaKey)&&(x.preventDefault(),l());break;case"KeyM":(x.ctrlKey||x.metaKey)&&(x.preventDefault(),a());break;case"Slash":x.shiftKey&&(x.preventDefault(),u?.());break;case"KeyF":!x.ctrlKey&&!x.metaKey&&!x.altKey&&!x.shiftKey&&(x.preventDefault(),m?.());break;case"KeyE":!x.ctrlKey&&!x.metaKey&&!x.altKey&&!x.shiftKey&&(x.preventDefault(),c?.());break}},[h,t,r,s,n,o,l,a,i,d,m,c,u]);return f.useEffect(()=>(window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p)}),[p]),null},Pn=["time","measures","sections","chords","tempo"],Rn=()=>{const[t,r]=f.useState(()=>Pe.getTrackHeight()),[s,n]=f.useState(1),[o,l]=f.useState(()=>Pe.getRulerOrder()),[a,i]=f.useState(()=>{const w={};return Pn.forEach(j=>{w[j]=Pe.getRulerVisibility(j)}),w}),[d,m]=f.useState(!0),[c,u]=f.useState(!0),[h,p]=f.useState(!1),[x,g]=f.useState(!1);f.useEffect(()=>{Pe.setTrackHeight(t)},[t]),f.useEffect(()=>{Pe.setRulerOrder(o)},[o]);const y=f.useCallback((w,j)=>{i(k=>{const N={...k,[w]:j};return Pe.setRulerVisibility(w,j),N})},[]),S=f.useCallback(()=>{n(w=>Math.min(w+.5,8))},[]),v=f.useCallback(()=>{n(w=>Math.max(w-.5,.5))},[]),M=f.useCallback(w=>{n(Math.max(.5,Math.min(8,w)))},[]),C=f.useCallback(()=>{switch(t){case"small":return 80;case"large":return 180;default:return 120}},[t]);return{trackHeight:t,zoom:s,rulerVisibility:a,rulerOrder:o,sidebarVisible:d,mixerVisible:c,mixerDockVisible:h,notesPanelVisible:x,setTrackHeight:r,setZoom:n,setRulerVisibility:i,setRulerOrder:l,setSidebarVisible:m,setMixerVisible:u,setMixerDockVisible:p,setNotesPanelVisible:g,handleRulerVisibilityChange:y,handleZoomIn:S,handleZoomOut:v,handleZoomChange:M,getTrackHeightPx:C}};function In(t,r){let s=null;return(...n)=>{s&&clearTimeout(s),s=setTimeout(()=>t(...n),r)}}const Ln=(t,r)=>{const[s,n]=f.useState(t?.tracks||[]),[o,l]=f.useState(new Set),a=f.useRef(null),i=f.useRef(null);f.useEffect(()=>{const C=t?.id||null;C!==a.current&&t?.tracks&&(n(t.tracks),a.current=C)},[t?.id]);const d=f.useCallback(C=>{t&&r&&r({...t,...C})},[t,r]);f.useEffect(()=>{i.current=In(C=>{t&&r&&r({...t,...C})},100)},[t,r]);const m=f.useCallback((C,w)=>{const j=isNaN(w)||!isFinite(w)?1:Math.max(0,Math.min(10,w));if(n(k=>k.map(N=>N.id===C?{...N,volume:j}:N)),i.current){const k=s.map(N=>N.id===C?{...N,volume:j}:N);i.current({tracks:k})}},[s]),c=f.useCallback(C=>{n(w=>{const j=w.map(k=>k.id===C?{...k,muted:!k.muted}:k);return d({tracks:j}),j})},[d]),u=f.useCallback(C=>{n(w=>{const j=w.map(k=>k.id===C?{...k,solo:!k.solo}:k);return d({tracks:j}),j})},[d]),h=f.useCallback((C,w)=>{n(j=>{const k=j.map(N=>N.id===C?{...N,name:w}:N);return d({tracks:k}),k})},[d]),p=f.useCallback((C,w)=>{n(j=>{const k=j.map(N=>N.id===C?{...N,color:w}:N);return d({tracks:k}),k})},[d]),x=f.useCallback((C,w)=>{n(j=>{const k=j.map(N=>N.id===C?{...N,tag:w}:N);return d({tracks:k}),k})},[d]),g=f.useCallback((C,w)=>{n(j=>{const k=j.map(N=>N.id===C?{...N,notes:w}:N);return d({tracks:k}),k})},[d]),y=f.useCallback(C=>{l(w=>{const j=new Set(w);return j.has(C)?j.delete(C):j.add(C),j})},[]),S=f.useCallback(C=>{if(!t)return;const w={id:`preset-${Date.now()}`,name:C,tracks:s.filter(j=>!o.has(j.id)).map(j=>({trackId:j.id,volume:j.volume,muted:j.muted}))};if(r){const j=[...t.mixPresets||[],w];r({...t,mixPresets:j})}},[t,s,o,r]),v=f.useCallback(C=>{if(!t||!t.mixPresets)return;const w=t.mixPresets.find(N=>N.id===C);if(!w)return;const j=s.map(N=>{if(o.has(N.id))return N;const E=w.tracks.find(z=>z.trackId===N.id);return E?{...N,volume:E.volume,muted:E.muted}:N}),k=Pe.getMainInstrument();if(k){const N=j.findIndex(E=>E.tag===k);if(N>0){const[E]=j.splice(N,1);j.unshift(E)}}n(j),d({tracks:j})},[t,o,s,d]),M=f.useCallback(C=>{if(!t||!r)return;const w=(t.mixPresets||[]).filter(j=>j.id!==C);r({...t,mixPresets:w})},[t,r]);return{tracks:s,setTracks:n,pinnedTracks:o,isAnySolo:s.some(C=>C.solo),handlers:{handleTrackVolumeChange:m,handleTrackMuteToggle:c,handleTrackSoloToggle:u,handleTrackNameChange:h,handleTrackColorChange:p,handleTrackTagChange:x,handleSaveTrackNotes:g,handleToggleTrackPin:y},presetHandlers:{handleSavePreset:S,handleLoadPreset:v,handleDeletePreset:M}}};function On({song:t,onSongUpdate:r}){const s=Ln(t,r),n=s.handlers.handleTrackVolumeChange,o=s.handlers.handleTrackMuteToggle,l=s.handlers.handleTrackSoloToggle,a=s.handlers.handleTrackNameChange,i=s.handlers.handleTrackColorChange,d=s.handlers.handleTrackTagChange;return{handleTrackVolumeChange:n,handleTrackMuteToggle:o,handleTrackSoloToggle:l,handleTrackNameChange:a,handleTrackColorChange:i,handleTrackTagChange:d}}function Bn({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",scrollContainerRef:a,scrollPosRef:i,zoom:d=1}){const m=f.useRef(null),c=f.useRef(null),u=f.useRef({scrollLeft:-1,width:0,totalWidth:0,dataLen:-1,zoom:0}),h=f.useRef(0);f.useEffect(()=>{if(!a.current)return;const x=new ResizeObserver(g=>{for(const y of g)h.current=y.contentRect.width});return x.observe(a.current),h.current=a.current.clientWidth,()=>x.disconnect()},[a]);const p=f.useCallback(()=>{const x=performance.now(),g=m.current,y=a.current;if(!g||!y){c.current=requestAnimationFrame(p);return}const S=i?i.current:y.scrollLeft,v=h.current,M=window.devicePixelRatio||1,C=t?t.length:0;if(S===u.current.scrollLeft&&v===u.current.width&&r===u.current.totalWidth&&C===u.current.dataLen){c.current=requestAnimationFrame(p);return}u.current={scrollLeft:S,width:v,totalWidth:r,dataLen:C,zoom:0};const w=v*M,j=s*M;(g.width!==w||g.height!==j)&&(g.width=w,g.height=j,g.style.width=`${v}px`,g.style.height=`${s}px`),g.style.transform=`translateX(${S}px)`;const k=g.getContext("2d",{alpha:!0});if(!k)return;if(k.setTransform(1,0,0,1,0,0),k.scale(M,M),k.clearRect(0,0,v,s),!t||t.length===0){k.strokeStyle=n,k.globalAlpha=.5,k.lineWidth=2,k.beginPath(),k.moveTo(0,s/2),k.lineTo(v,s/2),k.stroke(),c.current=requestAnimationFrame(p);return}const N=t.length,E=r/N;if(r===0)return;const z=Math.floor(S/E),V=Math.ceil((S+v)/E),R=Math.max(0,z),ie=Math.min(N,V);if(R>=ie){c.current=requestAnimationFrame(p);return}const de=1/E,U=de>1?Math.floor(de):1,X=s/2;k.fillStyle=n,k.globalAlpha=o,k.beginPath();const L=R*E-S;k.moveTo(L,X);const ve=(Q,J)=>{let Y=0;for(let te=Q;te<Math.min(J,N);te++)t[te]>Y&&(Y=t[te]);return Y};for(let Q=R;Q<ie;Q+=U){const J=U>1?ve(Q,Q+U):t[Q],Y=Q*E-S,te=Math.max(.5,J*X*.95);k.lineTo(Y,X-te)}for(let Q=ie-1;Q>=R;Q-=U){const J=U>1?ve(Q,Q+U):t[Q],Y=Q*E-S,te=Math.max(.5,J*X*.95);k.lineTo(Y,X+te)}k.closePath(),k.fill();const le=performance.now()-x;le>16&&console.warn(`[LOD Performance Main] Slow render: ${le.toFixed(2)}ms | Step: ${U} | Points: ${ie-R} | Zoom: ${d.toFixed(2)}`),c.current=requestAnimationFrame(p)},[t,r,s,n,o,d,a]);return f.useEffect(()=>(c.current=requestAnimationFrame(p),()=>{c.current&&cancelAnimationFrame(c.current)}),[p]),e.jsx("div",{className:"h-full w-full relative",children:e.jsx("canvas",{ref:m,className:l,style:{display:"block",position:"absolute",left:0,top:0,pointerEvents:"none",willChange:"transform"}})})}function $n({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",scrollLeft:a=0,viewportWidth:i=1e3,zoom:d=1}){const m=f.useRef(null),c=f.useRef(null);f.useRef(null);const u=f.useRef(!1),h=!t||t.length===0;return f.useEffect(()=>{h||m.current},[h]),f.useEffect(()=>{!u.current||!c.current||h||c.current.postMessage({type:"updateData",data:t})},[t,h]),f.useEffect(()=>{!u.current||!c.current||h||c.current.postMessage({type:"updateMetrics",width:r,height:s})},[r,s,h]),f.useEffect(()=>{!u.current||!c.current||h||c.current.postMessage({type:"render",viewportWidth:i,scrollLeft:a,zoom:d})},[a,i,d,h]),e.jsxs("div",{className:"relative w-full h-full",children:[h&&e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{backgroundColor:`${n}15`,pointerEvents:"none"}}),e.jsx("canvas",{ref:m,className:l,style:{display:"block",width:"100%",height:"100%",backgroundColor:"transparent",pointerEvents:"none",opacity:h?0:1}})]})}const zn=H.memo($n,(t,r)=>t.data===r.data&&t.width===r.width&&t.height===r.height&&t.fill===r.fill&&t.opacity===r.opacity&&t.scrollLeft===r.scrollLeft&&t.viewportWidth===r.viewportWidth&&t.zoom===r.zoom);zn.displayName="WaveformCanvasOffscreenMemoized";function _n({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",useCanvas:a=!0,scrollContainerRef:i,scrollPosRef:d,zoom:m=1}){return e.jsx(Bn,{data:t,width:r,height:s,fill:n,opacity:o,className:l,scrollContainerRef:i||{current:null},scrollPosRef:d,zoom:m})}const oe={BASE_PPS:50,MIN:.001,MAX:20,FACTOR:1.2},He={RULER_HEIGHT:32},es={LOW_ZOOM_THRESHOLD:.3,MEDIUM_ZOOM_THRESHOLD:1.5},Ft={SIDEBAR_WIDTH:280};function Vn(t,r=1){const s=f.useCallback(()=>{if(r<es.LOW_ZOOM_THRESHOLD){const l=gt.getOverview(t);if(l&&l.length>0)return l}if(r<es.MEDIUM_ZOOM_THRESHOLD){const l=gt.getMedium(t);if(l&&l.length>0)return l}return gt.getWaveform(t)||[]},[t,r]),[n,o]=f.useState(()=>s());return f.useEffect(()=>{const l=gt.subscribe(()=>{o(s())}),a=s();return a.length>0&&o(a),l},[s]),n}const Ms=H.memo(({trackId:t,color:r,duration:s,pps:n,height:o,zoom:l,scrollContainerRef:a,scrollPosRef:i})=>{const d=Vn(t,l);return e.jsx("div",{className:"waveform-container",style:{height:"calc(100% - 20px)"},children:e.jsx(_n,{data:d,width:s*n,height:o,fill:r||"#3b82f6",opacity:.8,useCanvas:!0,scrollContainerRef:a,scrollPosRef:i,zoom:l})})});Ms.displayName="TrackWaveformRenderer";const Es=H.memo(H.forwardRef(({song:t,currentTime:r,zoom:s,pixelsPerSecond:n,filteredTracks:o,loopStart:l,loopEnd:a,trackHeightPx:i,onTimelineMouseDown:d,onTimelineMouseMove:m,onTimelineMouseUp:c,onScroll:u},h)=>{const p=f.useRef(null),x=f.useRef(0),g=f.useCallback(v=>{x.current=v.currentTarget.scrollLeft,u(v.currentTarget.scrollLeft)},[u]),y=n||s*100,S=l!==null&&a!==null?{left:`${l*y}px`,width:`${(a-l)*y}px`}:void 0;return e.jsx("div",{className:"timeline-tracks-container flex-1 overflow-auto relative scrollbar-hide",style:{backgroundColor:"var(--daw-bg-main)",overflowY:"auto",scrollbarWidth:"none",msOverflowStyle:"none"},ref:v=>{typeof h=="function"?h(v):h&&(h.current=v),p.current=v},onScroll:g,children:e.jsxs("div",{className:"relative",style:{width:`${t.duration*y}px`,height:`${Math.max(o.length*i,0)}px`,minHeight:"100%",paddingTop:0,paddingBottom:0},onClick:d,onMouseDown:d,onMouseMove:m,onMouseUp:c,onMouseLeave:c,children:[e.jsx("div",{className:"absolute top-0 z-50 pointer-events-none",style:{left:`${r*y}px`,height:"100%"},children:e.jsx("div",{className:"h-full",style:{width:"2px",backgroundColor:"#ef4444",boxShadow:"0 0 4px rgba(239, 68, 68, 0.4)"}})}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"linear-gradient(to right, var(--daw-grid) 1px, transparent 1px)",backgroundSize:"100px 100%",opacity:.3}}),S&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-yellow-500/10 border-l-2 border-r-2 border-yellow-500/50 z-10 pointer-events-none",style:S}),o.map((v,M)=>e.jsx("div",{className:"track-lane absolute left-0 right-0 border-b box-border",style:{top:0,height:`${i}px`,minHeight:`${i}px`,maxHeight:`${i}px`,transform:`translateY(${M*i}px)`,borderColor:"var(--daw-border)",borderBottomWidth:"1px"},children:e.jsxs("div",{className:"clip-box absolute rounded-md overflow-hidden border",style:{left:0,top:"2px",width:`${t.duration*y}px`,height:"calc(100% - 4px)",backgroundColor:`${v.color}20`,borderColor:`${v.color}40`,borderWidth:"1px"},children:[e.jsx("div",{className:"h-5 w-full flex items-center px-2",style:{backgroundColor:`${v.color}60`},children:e.jsx("span",{className:"text-[10px] text-white truncate font-medium drop-shadow",children:v.name})}),e.jsx(Ms,{trackId:v.id,color:v.color||"#3b82f6",duration:t.duration,pps:y,height:i-28,zoom:s,scrollContainerRef:p,scrollPosRef:x})]})},v.id))]})})}));Es.displayName="TimelineContainer";const Wn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M6 20h12l-2-12H8l-2 12z"}),e.jsx("line",{x1:"12",y1:"8",x2:"14",y2:"13"}),e.jsx("circle",{cx:"14.5",cy:"14",r:"1.5"}),e.jsx("path",{d:"M5 20h14"})]}),ts=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10"}),e.jsx("path",{d:"M12 2a10 10 0 0 0-10 10"}),e.jsx("path",{d:"M2 12a10 10 0 0 0 10 10"}),e.jsx("path",{d:"M22 12a10 10 0 0 1-10 10"}),e.jsx("path",{d:"M12 12l4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"5"}),e.jsx("line",{x1:"19",y1:"12",x2:"18",y2:"12"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"6",y2:"12"})]}),Gn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"6",y1:"4",x2:"6",y2:"20",strokeWidth:"1.5"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20",strokeWidth:"2"}),e.jsx("line",{x1:"18",y1:"4",x2:"18",y2:"20",strokeWidth:"1.5"}),e.jsx("circle",{cx:"9",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("path",{d:"M10.5 12h4.5"}),e.jsx("path",{d:"M13 10l2 2-2 2"})]}),Hn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M17 2l4 4-4 4"}),e.jsx("path",{d:"M3 11v-1a9 9 0 0 1 9-9h9"}),e.jsx("path",{d:"M7 22l-4-4 4-4"}),e.jsx("path",{d:"M21 13v1a9 9 0 0 1-9 9H3"})]}),ss=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M10 8l6 4-6 4V8z",fill:"currentColor"})]}),rs=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M4 4v16",strokeWidth:"2.5"}),e.jsx("path",{d:"M4 4h12l-2 4 2 4H4"}),e.jsx("path",{d:"M17 15l2-2 2 2-3 3-2-2z"}),e.jsx("path",{d:"M16 18l-2 2"})]}),ns=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"4",y1:"7",x2:"20",y2:"7",strokeWidth:"1.5"}),e.jsx("path",{d:"M4 12 Q 12 9, 20 12",strokeWidth:"2"}),e.jsx("line",{x1:"4",y1:"17",x2:"20",y2:"17",strokeWidth:"1.5"}),e.jsx("line",{x1:"8",y1:"5",x2:"8",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("line",{x1:"16",y1:"5",x2:"16",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("circle",{cx:"12",cy:"9",r:"2",fill:"currentColor"})]}),qn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"3",rx:"1"}),e.jsx("rect",{x:"3",y:"10",width:"18",height:"3",rx:"1"}),e.jsx("rect",{x:"3",y:"16",width:"18",height:"3",rx:"1"}),e.jsx("circle",{cx:"8",cy:"5.5",r:"0.8",fill:"currentColor"}),e.jsx("circle",{cx:"8",cy:"11.5",r:"0.8",fill:"currentColor"}),e.jsx("circle",{cx:"8",cy:"17.5",r:"0.8",fill:"currentColor"})]});function tt({className:t,defaultValue:r,value:s,min:n=0,max:o=100,...l}){const a=f.useMemo(()=>Array.isArray(s)?s:Array.isArray(r)?r:[n,o],[s,r,n,o]);return e.jsxs(Mr,{"data-slot":"slider",defaultValue:r,value:s,min:n,max:o,className:Te("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...l,children:[e.jsx(Er,{"data-slot":"slider-track",className:Te("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(Ar,{"data-slot":"slider-range",className:Te("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:a.length},(i,d)=>e.jsx(Fr,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},d))]})}function Gt({delayDuration:t=0,...r}){return e.jsx(Dr,{"data-slot":"tooltip-provider",delayDuration:t,...r})}function fe({...t}){return e.jsx(Gt,{children:e.jsx(Pr,{"data-slot":"tooltip",...t})})}function pe({...t}){return e.jsx(Rr,{"data-slot":"tooltip-trigger",...t})}function ge({className:t,sideOffset:r=0,children:s,...n}){return e.jsx(Ir,{children:e.jsxs(Lr,{"data-slot":"tooltip-content",sideOffset:r,className:Te("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...n,children:[s,e.jsx(Or,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function jt({...t}){return e.jsx(Br,{"data-slot":"dropdown-menu",...t})}function yt({...t}){return e.jsx($r,{"data-slot":"dropdown-menu-trigger",...t})}function wt({className:t,sideOffset:r=4,...s}){return e.jsx(zr,{children:e.jsx(_r,{"data-slot":"dropdown-menu-content",sideOffset:r,className:Te("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...s})})}function Dt({className:t,inset:r,variant:s="default",...n}){return e.jsx(Vr,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":s,className:Te("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function Kn({tempo:t,onTempoChange:r,keyShift:s,onKeyShiftChange:n,disabled:o,originalKey:l="C"}){const[a,i]=f.useState(0),d=s+a,m=Rt(l,s),c=Rt(l,d);return e.jsxs(jt,{children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(yt,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:u=>{u.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="var(--daw-control)"},disabled:o,children:e.jsx(ts,{className:"w-5 h-5"})})})}),e.jsx(ge,{children:"Playback Settings"})]}),e.jsx(wt,{className:"w-96 p-4",style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},align:"end",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(ts,{className:"w-4 h-4"}),"Speed"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:[t,"%"]}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>r(100),className:"h-6 px-2 text-xs",style:{backgroundColor:t===100?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(tt,{value:[t],onValueChange:([u])=>r(u),min:50,max:150,step:1,className:"w-full",onDoubleClick:()=>r(100)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"}),e.jsx("span",{children:"150%"})]})]}),e.jsx(Ot,{style:{backgroundColor:"#3A3A3A"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",style:{color:"#F1F1F1"},children:"Key Information"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center p-3 rounded-md",style:{backgroundColor:"#1E1E1E",border:"1px solid #3A3A3A"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Original"}),e.jsx("div",{className:"text-lg",style:{color:"#F1F1F1"},children:l})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Playing"}),e.jsx("div",{className:"text-lg",style:{color:"#3B82F6"},children:m})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Display"}),e.jsx("div",{className:"text-lg",style:{color:a>0?"#22c55e":"#F1F1F1"},children:c})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(or,{className:"w-4 h-4"}),"Transpose"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:[s>0?"+":"",s," ",Math.abs(s)===1?"semitone":"semitones"]}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>n(0),className:"h-6 px-2 text-xs",style:{backgroundColor:s===0?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(tt,{value:[s],onValueChange:([u])=>n(u),min:-12,max:12,step:1,className:"w-full",onDoubleClick:()=>n(0)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"-12"}),e.jsx("span",{children:"0"}),e.jsx("span",{children:"+12"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(ir,{className:"w-4 h-4"}),"Capo Position"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:["Fret ",a]}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>i(0),className:"h-6 px-2 text-xs",style:{backgroundColor:a===0?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(tt,{value:[a],onValueChange:([u])=>i(u),min:0,max:12,step:1,className:"w-full",onDoubleClick:()=>i(0)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"6"}),e.jsx("span",{children:"12"})]}),e.jsx("div",{className:"text-xs",style:{color:"#9E9E9E"},children:a>0?`Chords shown are ${a} semitone${a>1?"s":""} higher (play as if no capo)`:"No capo - play chords as shown"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",style:{color:"#F1F1F1"},children:"Quick Presets"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>{r(75),n(0)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"Practice (75%)"}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>{r(100),n(0),i(0)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"Reset All"}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>{r(100),n(-2)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"-2 semitones"}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>{r(100),n(2)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"+2 semitones"})]})]})]})})]})}function Un({trackHeight:t,onTrackHeightChange:r,rulerVisibility:s,onRulerVisibilityChange:n,rulerOrder:o=["time","measures","sections","chords","tempo"],onRulerOrderChange:l}){const{t:a}=st(),[i,d]=f.useState(null),[m,c]=f.useState(null),u={time:{id:"time",label:a.time,visible:s.time},measures:{id:"measures",label:a.measures,visible:s.measures},sections:{id:"sections",label:a.sections,visible:s.sections},chords:{id:"chords",label:a.chords,visible:s.chords},tempo:{id:"tempo",label:a.tempo,visible:s.tempo}},h=o.map(v=>u[v]).filter(Boolean),p=(v,M)=>{const C={...s,[v]:M};n(C)},x=(v,M)=>{d(M),v.dataTransfer.setData("text/plain",M),v.dataTransfer.effectAllowed="move"},g=(v,M)=>{v.preventDefault(),v.dataTransfer.dropEffect="move",M!==m&&c(M)},y=(v,M)=>{v.preventDefault();const C=v.dataTransfer.getData("text/plain");if(!C||C===M)return;const w=[...o],j=w.indexOf(C),k=w.indexOf(M);if(j===-1||k===-1)return;const[N]=w.splice(j,1);w.splice(k,0,N),l&&l(w)},S=()=>{d(null),c(null)};return e.jsxs(jt,{children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(yt,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:v=>{v.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="var(--daw-control)"},children:e.jsx(qn,{className:"w-5 h-5"})})})}),e.jsx(ge,{children:"View Settings"})]}),e.jsx(wt,{className:"w-72 p-4",style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",style:{color:"#F1F1F1"},children:"Track Height"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{size:"sm",variant:t==="small"?"default":"outline",onClick:()=>r("small"),className:"flex-1",style:t==="small"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Small"}),e.jsx(P,{size:"sm",variant:t==="medium"?"default":"outline",onClick:()=>r("medium"),className:"flex-1",style:t==="medium"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Medium"}),e.jsx(P,{size:"sm",variant:t==="large"?"default":"outline",onClick:()=>r("large"),className:"flex-1",style:t==="large"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Large"})]})]}),e.jsx(Ot,{style:{backgroundColor:"#3A3A3A"}}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{className:"text-sm",style:{color:"#F1F1F1"},children:"Rulers"}),e.jsx("span",{className:"text-xs",style:{color:"#9E9E9E"},children:"Drag to reorder"})]}),e.jsx("div",{className:"space-y-1",children:h.map((v,M)=>e.jsxs("div",{draggable:!!l,onDragStart:C=>l&&x(C,v.id),onDragOver:C=>l&&g(C,v.id),onDrop:C=>l&&y(C,v.id),onDragEnd:S,onDragLeave:()=>c(null),className:Te("flex items-center justify-between p-2 rounded transition-all",l&&"cursor-move",i===v.id?"opacity-50 scale-95":"opacity-100",m===v.id&&i!==v.id&&"bg-yellow-500/30"),style:{backgroundColor:"var(--daw-control)"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(hs,{className:"w-4 h-4 cursor-grab active:cursor-grabbing",style:{color:"#6B6B6B"}}),v.visible?e.jsx(lr,{className:"w-4 h-4",style:{color:"#9E9E9E"}}):e.jsx(cr,{className:"w-4 h-4",style:{color:"#9E9E9E"}}),e.jsx("span",{className:"text-sm",style:{color:"#F1F1F1"},children:v.label})]}),e.jsx(lt,{checked:v.visible,onCheckedChange:C=>p(v.id,C),onClick:C=>C.stopPropagation()})]},v.id))})]})]})})]})}const As=t=>Number.isInteger(t)?t.toString():parseFloat(t.toFixed(2)).toString(),It=t=>{if(t==null)return"--:--";const r=Math.floor(t/60),s=Math.floor(t%60);return`${r}:${s.toString().padStart(2,"0")}`},Xn=({songTitle:t,songKey:r,isPlaying:s,currentTime:n,tempo:o,loopEnabled:l,metronomeEnabled:a,metronomeVolume:i,keyShift:d,trackHeight:m,rulerVisibility:c,rulerOrder:u,currentMeasure:h,currentTimeSignature:p,displayTempo:x,snapEnabled:g=!1,snapMode:y="measures",onBack:S,onPlayPause:v,onStop:M,onLoopToggle:C,onMetronomeToggle:w,onMetronomeVolumeChange:j,onTempoChange:k,onKeyShiftChange:N,onTrackHeightChange:E,onRulerVisibilityChange:z,onRulerOrderChange:V,onSnapToggle:R,onSnapModeChange:ie,onExportProject:de,activeTool:U=null,onToolChange:X})=>e.jsxs("div",{className:"border-b p-3 flex items-center justify-between gap-4",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:S,children:e.jsx($t,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Back to Library"})]}),e.jsx("span",{className:"text-lg font-medium",style:{color:"var(--daw-text-primary)"},children:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:M,children:e.jsx(dr,{className:"w-5 h-5"})})}),e.jsx(ge,{children:"Stop"})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-12 w-12",style:{backgroundColor:s?"#10B981":"#065F46",color:"#FFFFFF",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=s?"#059669":"#047857"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=s?"#10B981":"#065F46"},onClick:v,children:s?e.jsx(ur,{className:"w-6 h-6"}):e.jsx(Ke,{className:"w-6 h-6"})})}),e.jsx(ge,{children:s?"Pause":"Play"})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:l?"#1E3A8A":"var(--daw-control)",color:l?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=l?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=l?"#1E3A8A":"var(--daw-control)"},onClick:C,children:e.jsx(Hn,{className:"w-5 h-5"})})}),e.jsx(ge,{children:"Loop"})]})]}),e.jsxs("div",{className:"rounded-lg px-4 py-2 flex items-center gap-4",style:{backgroundColor:"var(--daw-bg-main)",border:"1px solid var(--daw-border)",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{className:"flex flex-col items-center",style:{minWidth:"80px"},children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Time"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:It(n)})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Measure"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:h})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Tempo"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:As(x)})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Time Sig"}),e.jsx("span",{className:"text-lg font-mono font-bold",style:{color:"#10B981"},children:p})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Key"}),e.jsx("span",{className:"text-lg font-mono font-bold",style:{color:"#10B981"},children:r})]})]}),e.jsxs(jt,{children:[e.jsxs("div",{className:"flex items-center gap-0",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-r-none",style:{backgroundColor:a?"#1E3A8A":"var(--daw-control)",color:a?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px 0 0 8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=a?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=a?"#1E3A8A":"var(--daw-control)"},onClick:w,children:e.jsx(Wn,{className:"w-5 h-5"})})}),e.jsx(ge,{children:"Metronome"})]}),e.jsx(yt,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-6 rounded-l-none px-1",style:{backgroundColor:a?"#1E3A8A":"var(--daw-control)",color:a?"#60A5FA":"var(--daw-text-primary)",borderRadius:"0 8px 8px 0",borderLeft:"1px solid rgba(0,0,0,0.2)"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=a?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=a?"#1E3A8A":"var(--daw-control)"},children:e.jsx(Ht,{className:"w-3 h-3"})})})]}),e.jsx(wt,{className:"w-64 p-4",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{className:"text-sm",style:{color:"var(--daw-text-primary)"},children:"Metronome Volume"}),e.jsxs("span",{className:"text-sm",style:{color:"var(--daw-text-secondary)"},children:[ct(Kr(i))," dB"]})]}),e.jsx(tt,{value:[Je(i)],onValueChange:L=>j(zt(L[0])),max:100,step:.1,className:"w-full",onDoubleClick:()=>{j(.5)}})]})})]}),e.jsxs(jt,{children:[e.jsx(yt,{asChild:!0,children:e.jsxs(P,{variant:"ghost",className:"h-10 px-3 gap-2",style:{backgroundColor:U?"#1E3A8A":"var(--daw-control)",color:U?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px"},children:[U==="marker"?e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Marker Editor"})]}):U==="warp"?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Warp Grid"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Player Mode"})]}),e.jsx(Ht,{className:"w-3 h-3 opacity-50"})]})}),e.jsxs(wt,{align:"end",className:"w-48",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs(Dt,{onClick:()=>X&&X(null),className:"gap-2 cursor-pointer",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{children:"Player Mode"})]}),e.jsxs(Dt,{onClick:()=>X&&X("marker"),className:"gap-2 cursor-pointer",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{children:"Marker Editor"})]}),e.jsxs(Dt,{onClick:()=>X&&X("warp"),className:"gap-2 cursor-pointer",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{children:"Warp Grid Editor"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",className:"h-10 px-3",style:{backgroundColor:g?"#2563EB":"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=g?"#1D4ED8":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=g?"#2563EB":"var(--daw-control)"},onClick:R,children:e.jsx(Gn,{className:"w-4 h-4"})})}),e.jsx(ge,{children:g?"Snap enabled (measures)":"Snap disabled"})]}),e.jsx(Kn,{tempo:o,onTempoChange:k,keyShift:d,onKeyShiftChange:N,originalKey:r}),e.jsx(Un,{trackHeight:m,onTrackHeightChange:E,rulerVisibility:c,onRulerVisibilityChange:z,rulerOrder:u,onRulerOrderChange:V}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:de,children:e.jsx(mr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Export Project"})]})]})]});function Xe(t,r,s){let n=s.initialDeps??[],o,l=!0;function a(){var i,d,m;let c;s.key&&((i=s.debug)!=null&&i.call(s))&&(c=Date.now());const u=t();if(!(u.length!==n.length||u.some((x,g)=>n[g]!==x)))return o;n=u;let p;if(s.key&&((d=s.debug)!=null&&d.call(s))&&(p=Date.now()),o=r(...u),s.key&&((m=s.debug)!=null&&m.call(s))){const x=Math.round((Date.now()-c)*100)/100,g=Math.round((Date.now()-p)*100)/100,y=g/16,S=(v,M)=>{for(v=String(v);v.length<M;)v=" "+v;return v};console.info(`%câ± ${S(g,5)} /${S(x,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,s?.key)}return s?.onChange&&!(l&&s.skipInitialOnChange)&&s.onChange(o),l=!1,o}return a.updateDeps=i=>{n=i},a}function as(t,r){if(t===void 0)throw new Error("Unexpected undefined");return t}const Zn=(t,r)=>Math.abs(t-r)<1.01,Yn=(t,r,s)=>{let n;return function(...o){t.clearTimeout(n),n=t.setTimeout(()=>r.apply(this,o),s)}},os=t=>{const{offsetWidth:r,offsetHeight:s}=t;return{width:r,height:s}},Qn=t=>t,Jn=t=>{const r=Math.max(t.startIndex-t.overscan,0),s=Math.min(t.endIndex+t.overscan,t.count-1),n=[];for(let o=r;o<=s;o++)n.push(o);return n},ea=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;const o=a=>{const{width:i,height:d}=a;r({width:Math.round(i),height:Math.round(d)})};if(o(os(s)),!n.ResizeObserver)return()=>{};const l=new n.ResizeObserver(a=>{const i=()=>{const d=a[0];if(d?.borderBoxSize){const m=d.borderBoxSize[0];if(m){o({width:m.inlineSize,height:m.blockSize});return}}o(os(s))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return l.observe(s,{box:"border-box"}),()=>{l.unobserve(s)}},is={passive:!0},ls=typeof window>"u"?!0:"onscrollend"in window,ta=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;let o=0;const l=t.options.useScrollendEvent&&ls?()=>{}:Yn(n,()=>{r(o,!1)},t.options.isScrollingResetDelay),a=c=>()=>{const{horizontal:u,isRtl:h}=t.options;o=u?s.scrollLeft*(h&&-1||1):s.scrollTop,l(),r(o,c)},i=a(!0),d=a(!1);d(),s.addEventListener("scroll",i,is);const m=t.options.useScrollendEvent&&ls;return m&&s.addEventListener("scrollend",d,is),()=>{s.removeEventListener("scroll",i),m&&s.removeEventListener("scrollend",d)}},sa=(t,r,s)=>{if(r?.borderBoxSize){const n=r.borderBoxSize[0];if(n)return Math.round(n[s.options.horizontal?"inlineSize":"blockSize"])}return t[s.options.horizontal?"offsetWidth":"offsetHeight"]},ra=(t,{adjustments:r=0,behavior:s},n)=>{var o,l;const a=t+r;(l=(o=n.scrollElement)==null?void 0:o.scrollTo)==null||l.call(o,{[n.options.horizontal?"left":"top"]:a,behavior:s})};class na{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const n=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(o=>{o.forEach(l=>{const a=()=>{this._measureElement(l.target,l)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()})}));return{disconnect:()=>{var o;(o=n())==null||o.disconnect(),s=null},observe:o=>{var l;return(l=n())==null?void 0:l.observe(o,{box:"border-box"})},unobserve:o=>{var l;return(l=n())==null?void 0:l.unobserve(o)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([n,o])=>{typeof o>"u"&&delete s[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Qn,rangeExtractor:Jn,onChange:()=>{},measureElement:sa,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var n,o;(o=(n=this.options).onChange)==null||o.call(n,this,s)},this.maybeNotify=Xe(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(o=>{this.observer.observe(o)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,o=>{this.scrollRect=o,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(o,l)=>{this.scrollAdjustments=0,this.scrollDirection=l?this.getScrollOffset()<o?"forward":"backward":null,this.scrollOffset=o,this.isScrolling=l,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,n)=>{const o=new Map,l=new Map;for(let a=n-1;a>=0;a--){const i=s[a];if(o.has(i.lane))continue;const d=l.get(i.lane);if(d==null||i.end>d.end?l.set(i.lane,i):i.end<d.end&&o.set(i.lane,!0),o.size===this.options.lanes)break}return l.size===this.options.lanes?Array.from(l.values()).sort((a,i)=>a.end===i.end?a.index-i.index:a.end-i.end)[0]:void 0},this.getMeasurementOptions=Xe(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(s,n,o,l,a,i)=>(this.prevLanes!==void 0&&this.prevLanes!==i&&(this.lanesChangedFlag=!0),this.prevLanes=i,this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:n,scrollMargin:o,getItemKey:l,enabled:a,lanes:i}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=Xe(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:n,scrollMargin:o,getItemKey:l,enabled:a,lanes:i},d)=>{if(!a)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>s)for(const h of this.laneAssignments.keys())h>=s&&this.laneAssignments.delete(h);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(h=>{this.itemSizeCache.set(h.key,h.size)}));const m=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===s&&(this.lanesSettling=!1);const c=this.measurementsCache.slice(0,m),u=new Array(i).fill(void 0);for(let h=0;h<m;h++){const p=c[h];p&&(u[p.lane]=h)}for(let h=m;h<s;h++){const p=l(h),x=this.laneAssignments.get(h);let g,y;if(x!==void 0&&this.options.lanes>1){g=x;const C=u[g],w=C!==void 0?c[C]:void 0;y=w?w.end+this.options.gap:n+o}else{const C=this.options.lanes===1?c[h-1]:this.getFurthestMeasurement(c,h);y=C?C.end+this.options.gap:n+o,g=C?C.lane:h%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(h,g)}const S=d.get(p),v=typeof S=="number"?S:this.options.estimateSize(h),M=y+v;c[h]={index:h,start:y,size:v,end:M,key:p,lane:g},u[g]=h}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Xe(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,n,o,l)=>this.range=s.length>0&&n>0?aa({measurements:s,outerSize:n,scrollOffset:o,lanes:l}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Xe(()=>{let s=null,n=null;const o=this.calculateRange();return o&&(s=o.startIndex,n=o.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,n]},(s,n,o,l,a)=>l===null||a===null?[]:s({startIndex:l,endIndex:a,overscan:n,count:o}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const n=this.options.indexAttribute,o=s.getAttribute(n);return o?parseInt(o,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(s,n)=>{const o=this.indexFromElement(s),l=this.measurementsCache[o];if(!l)return;const a=l.key,i=this.elementsCache.get(a);i!==s&&(i&&this.observer.unobserve(i),this.observer.observe(s),this.elementsCache.set(a,s)),s.isConnected&&this.resizeItem(o,this.options.measureElement(s,n,this))},this.resizeItem=(s,n)=>{const o=this.measurementsCache[s];if(!o)return;const l=this.itemSizeCache.get(o.key)??o.size,a=n-l;a!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(o,a,this):o.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=a,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(o.index),this.itemSizeCache=new Map(this.itemSizeCache.set(o.key,n)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((n,o)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(o))});return}this._measureElement(s,void 0)},this.getVirtualItems=Xe(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,n)=>{const o=[];for(let l=0,a=s.length;l<a;l++){const i=s[l],d=n[i];o.push(d)}return o},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const n=this.getMeasurements();if(n.length!==0)return as(n[Fs(0,n.length-1,o=>as(n[o]).start,s)])},this.getOffsetForAlignment=(s,n,o=0)=>{const l=this.getSize(),a=this.getScrollOffset();n==="auto"&&(n=s>=a+l?"end":"start"),n==="center"?s+=(o-l)/2:n==="end"&&(s-=l);const i=this.getTotalSize()+this.options.scrollMargin-l;return Math.max(Math.min(i,s),0)},this.getOffsetForIndex=(s,n="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const o=this.measurementsCache[s];if(!o)return;const l=this.getSize(),a=this.getScrollOffset();if(n==="auto")if(o.end>=a+l-this.options.scrollPaddingEnd)n="end";else if(o.start<=a+this.options.scrollPaddingStart)n="start";else return[a,n];const i=n==="end"?o.end+this.options.scrollPaddingEnd:o.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,n,o.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:n="start",behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,n),{adjustments:void 0,behavior:o})},this.scrollToIndex=(s,{align:n="auto",behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1));let l=0;const a=10,i=m=>{if(!this.targetWindow)return;const c=this.getOffsetForIndex(s,m);if(!c){console.warn("Failed to get offset for index:",s);return}const[u,h]=c;this._scrollToOffset(u,{adjustments:void 0,behavior:o}),this.targetWindow.requestAnimationFrame(()=>{const p=this.getScrollOffset(),x=this.getOffsetForIndex(s,h);if(!x){console.warn("Failed to get offset for index:",s);return}Zn(x[0],p)||d(h)})},d=m=>{this.targetWindow&&(l++,l<a?this.targetWindow.requestAnimationFrame(()=>i(m)):console.warn(`Failed to scroll to index ${s} after ${a} attempts.`))};i(n)},this.scrollBy=(s,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var s;const n=this.getMeasurements();let o;if(n.length===0)o=this.options.paddingStart;else if(this.options.lanes===1)o=((s=n[n.length-1])==null?void 0:s.end)??0;else{const l=Array(this.options.lanes).fill(null);let a=n.length-1;for(;a>=0&&l.some(i=>i===null);){const i=n[a];l[i.lane]===null&&(l[i.lane]=i.end),a--}o=Math.max(...l.filter(i=>i!==null))}return Math.max(o-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:n,behavior:o})=>{this.options.scrollToFn(s,{behavior:o,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(r)}}const Fs=(t,r,s,n)=>{for(;t<=r;){const o=(t+r)/2|0,l=s(o);if(l<n)t=o+1;else if(l>n)r=o-1;else return o}return t>0?t-1:0};function aa({measurements:t,outerSize:r,scrollOffset:s,lanes:n}){const o=t.length-1,l=d=>t[d].start;if(t.length<=n)return{startIndex:0,endIndex:o};let a=Fs(0,o,l,s),i=a;if(n===1)for(;i<o&&t[i].end<s+r;)i++;else if(n>1){const d=Array(n).fill(0);for(;i<o&&d.some(c=>c<s+r);){const c=t[i];d[c.lane]=c.end,i++}const m=Array(n).fill(s+r);for(;a>=0&&m.some(c=>c>=s);){const c=t[a];m[c.lane]=c.start,a--}a=Math.max(0,a-a%n),i=Math.min(o,i+(n-1-i%n))}return{startIndex:a,endIndex:i}}const cs=typeof document<"u"?f.useLayoutEffect:f.useEffect;function oa(t){const r=f.useReducer(()=>({}),{})[1],s={...t,onChange:(o,l)=>{var a;l?nr.flushSync(r):r(),(a=t.onChange)==null||a.call(t,o,l)}},[n]=f.useState(()=>new na(s));return n.setOptions(s),cs(()=>n._didMount(),[]),cs(()=>n._willUpdate()),n}function ia(t){return oa({observeElementRect:ea,observeElementOffset:ta,scrollToFn:ra,...t})}const Ds=H.memo(({trackId:t,trackName:r,trackColor:s,trackVolume:n,trackMuted:o,trackSolo:l,trackHeightPx:a,isAnySolo:i,onVolumeChange:d,onMuteToggle:m,onSoloToggle:c})=>{const[u,h]=H.useState(Je(n)),[p,x]=H.useState(!1);H.useEffect(()=>{p||h(Je(n))},[n,p]);const g=v=>{h(v[0])},y=()=>{x(!0)},S=()=>{x(!1),d(t,zt(u))};return e.jsxs("div",{className:"border-b relative group box-border",style:{height:`${a}px`,minHeight:`${a}px`,maxHeight:`${a}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",borderBottomWidth:"1px"},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1",style:{backgroundColor:s||"#3b82f6"}}),e.jsxs("div",{className:"p-2 pl-6 h-full flex flex-col justify-center gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:e.jsx("span",{className:"font-semibold text-sm truncate text-gray-200",title:r,children:r})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{variant:"ghost",size:"icon",className:`h-6 w-8 rounded-sm border-2 focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${o?"bg-red-600 text-white border-red-500 focus:ring-red-500":"bg-gray-800 text-gray-400 border-gray-600 hover:border-gray-500 focus:ring-gray-500"}`,onClick:()=>m(t),"aria-label":o?`Unmute ${r}`:`Mute ${r}`,"aria-pressed":o,title:o?"Unmute track":"Mute track",children:e.jsx("span",{className:"text-[10px] font-bold",children:"M"})}),e.jsx(P,{variant:"ghost",size:"icon",className:`h-6 w-8 rounded-sm border-2 focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${l?"bg-yellow-500 text-black border-yellow-400 focus:ring-yellow-500":"bg-gray-800 text-gray-400 border-gray-600 hover:border-gray-500 focus:ring-gray-500"}`,onClick:()=>c(t),"aria-label":l?`Unsolo ${r}`:`Solo ${r}`,"aria-pressed":l,title:l?"Unsolo track":"Solo track",children:e.jsx("span",{className:"text-[10px] font-bold",children:"S"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{value:[u],min:0,max:100,step:1,onValueChange:g,onPointerDown:y,onPointerUp:S,className:"flex-1","aria-label":`Volume for ${r}`,"aria-valuenow":u,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":`${ct(bt(u))} decibels`}),e.jsx("span",{className:"text-[10px] tabular-nums text-gray-400 w-8 text-right font-mono","aria-hidden":"true",children:ct(bt(u))})]})]})]})},(t,r)=>t.trackId===r.trackId&&t.trackName===r.trackName&&t.trackColor===r.trackColor&&t.trackVolume===r.trackVolume&&t.trackMuted===r.trackMuted&&t.trackSolo===r.trackSolo&&t.trackHeightPx===r.trackHeightPx&&t.isAnySolo===r.isAnySolo);Ds.displayName="TrackListItem";const Ps=H.memo(H.forwardRef(({tracks:t,trackHeight:r,editingTrackId:s,trackNameInput:n,pinnedTracks:o,onTrackNameChange:l,onTrackColorChange:a,onTrackVolumeChange:i,onTrackMuteToggle:d,onTrackSoloToggle:m,onTrackTagsChange:c,onTrackNotesOpen:u,onEditingTrackIdChange:h,onTrackNameInputChange:p,onPinnedTracksChange:x,onScroll:g},y)=>{const S=()=>{switch(r){case"small":return 64;case"large":return 128;default:return 96}},v=f.useCallback((N,E)=>{i(N,E)},[i]),M=t.some(N=>N.solo),C=S(),w=f.useRef(null),j=ia({count:t.length,getScrollElement:()=>w.current,estimateSize:()=>C,overscan:3}),k=N=>{g(N.currentTarget.scrollTop)};return e.jsxs("div",{ref:N=>{w.current=N,typeof y=="function"?y(N):y&&(y.current=N)},className:"track-list-sidebar-container flex-shrink-0 border-r flex flex-col overflow-y-auto",style:{width:`${Ft.SIDEBAR_WIDTH}px`,minWidth:`${Ft.SIDEBAR_WIDTH}px`,maxWidth:`${Ft.SIDEBAR_WIDTH}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",scrollbarWidth:"none",msOverflowStyle:"none",paddingTop:0,paddingBottom:0},onScroll:k,children:[e.jsx("div",{className:"flex-1 relative",style:{height:`${j.getTotalSize()}px`,margin:0,padding:0},children:j.getVirtualItems().map(N=>{const E=t[N.index];return e.jsx("div",{"data-index":N.index,ref:j.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${N.start}px)`},children:e.jsx(Ds,{trackId:E.id,trackName:E.name,trackColor:E.color||"#3b82f6",trackVolume:E.volume,trackMuted:E.muted,trackSolo:E.solo,trackHeightPx:C,isAnySolo:M,onVolumeChange:v,onMuteToggle:d,onSoloToggle:m})},E.id)})}),e.jsx("style",{children:`
        .track-list-sidebar-container::-webkit-scrollbar {
          display: none;
        }
      `})]})}));Ps.displayName="TrackListSidebar";const la={time:"Time",measures:"Measures",sections:"Sections",chords:"Chords",tempo:"Tempo"},ca=({visibleRulers:t,rulerOrder:r,onRulerOrderChange:s})=>{const[n,o]=f.useState(null),l=r.filter(c=>t.includes(c)),a=(c,u)=>{o(u),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("text/plain",u)},i=c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},d=(c,u)=>{if(c.preventDefault(),!n||n===u){o(null);return}const h=[...r],p=h.indexOf(n),x=h.indexOf(u);h.splice(p,1),h.splice(x,0,n),s(h),o(null)},m=()=>{o(null)};return e.jsx("div",{className:"flex flex-col",children:l.map(c=>e.jsxs("div",{draggable:!0,onDragStart:u=>a(u,c),onDragOver:i,onDrop:u=>d(u,c),onDragEnd:m,className:`flex items-center justify-start px-3 border-b text-xs font-medium uppercase tracking-wider cursor-grab active:cursor-grabbing transition-opacity ${n===c?"opacity-50":"opacity-100"}`,style:{height:`${He.RULER_HEIGHT}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",color:"var(--daw-text-secondary)"},children:[e.jsx(hs,{className:"w-3 h-3 mr-2 text-gray-500"}),la[c]||c]},c))})},da=({zoom:t,onZoomIn:r,onZoomOut:s,onFitToView:n})=>e.jsxs("div",{className:"flex items-center justify-center gap-2 px-2",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",opacity:t<=1?.5:1},onClick:s,disabled:t<=1,children:e.jsx(hr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Zoom Out"})]}),e.jsxs("span",{className:"text-xs tabular-nums w-14 text-center",style:{color:"#9E9E9E"},children:[Math.round(t*100),"%"]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",opacity:t>=8?.5:1},onClick:r,disabled:t>=8,children:e.jsx(xr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Zoom In"})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:n,children:e.jsx(xs,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Fit to View"})]})]});function ua({...t}){return e.jsx(Wr,{"data-slot":"popover",...t})}function ma({...t}){return e.jsx(Gr,{"data-slot":"popover-trigger",...t})}function ha({className:t,align:r="center",sideOffset:s=4,...n}){return e.jsx(Hr,{children:e.jsx(qr,{"data-slot":"popover-content",align:r,sideOffset:s,className:Te("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...n})})}function xa({tracks:t,presets:r,onSavePreset:s,onLoadPreset:n,onDeletePreset:o}){const[l,a]=f.useState(!1),[i,d]=f.useState(""),[m,c]=f.useState(""),u=()=>{if(!i.trim()){Ne.error("Please enter a preset name");return}s(i),d(""),a(!1),Ne.success(`Mix preset "${i}" saved successfully`)},h=()=>{if(!m){Ne.error("Please select a preset to load");return}const x=r.find(g=>g.id===m);if(!x){Ne.error("Preset not found");return}n(x),Ne.success(`Mix preset "${x.name}" loaded successfully`)},p=x=>{const g=r.find(y=>y.id===x);window.confirm(`Are you sure you want to delete preset "${g?.name}"?`)&&(o(x),m===x&&c(""),Ne.success("Mix preset deleted"))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(dt,{open:l,onOpenChange:a,children:[e.jsx(fr,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",className:"w-full",title:"Save current mix as preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(pr,{className:"w-4 h-4 mr-2"}),"Save Current Mix"]})}),e.jsxs(ut,{children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Save Mix Preset"}),e.jsx(xt,{children:"Save the current volume and mute settings as a mix preset."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"preset-name",children:"Preset Name"}),e.jsx(Me,{id:"preset-name",placeholder:"e.g., Rehearsal Mix, Live Mix, etc.",value:i,onChange:x=>d(x.target.value),onKeyDown:x=>{x.key==="Enter"&&u()}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Current Settings:"}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded p-2 space-y-1",children:t.map(x=>e.jsxs("div",{className:"text-sm flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:x.name}),e.jsx("span",{className:"text-gray-500",children:x.muted?"Muted":`${Math.round(x.volume*100)}%`})]},x.id))})]})]}),e.jsxs(gr,{children:[e.jsx(vr,{asChild:!0,children:e.jsx(P,{variant:"outline",children:"Cancel"})}),e.jsx(P,{onClick:u,children:"Save Preset"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Ee,{value:m,onValueChange:c,children:[e.jsx(Ae,{className:"w-full",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:e.jsx(Fe,{placeholder:"Select preset..."})}),e.jsx(De,{children:r.length===0?e.jsx("div",{className:"px-2 py-1.5 text-sm text-gray-500",children:"No presets saved"}):r.map(x=>e.jsx(ye,{value:x.id,children:x.name},x.id))})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1",onClick:h,disabled:!m,title:"Load selected preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(br,{className:"w-4 h-4 mr-1"}),"Load"]}),e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>m&&p(m),disabled:!m,title:"Delete selected preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(Bt,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]})}const fa=({sidebarVisible:t,mixerDockVisible:r,notesPanelVisible:s,mixPresetsPopoverOpen:n,tracks:o,mixPresets:l,onToggleSidebar:a,onToggleMixer:i,onToggleNotes:d,onPerformanceMode:m,onMixPresetsOpenChange:c,onSaveMixPreset:u,onLoadMixPreset:h,onDeleteMixPreset:p})=>e.jsxs("div",{className:"border-t flex items-center justify-between h-10 px-3",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:a,children:t?e.jsx(jr,{className:"w-4 h-4"}):e.jsx(yr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:t?"Hide Sidebar":"Show Sidebar"})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(ua,{open:n,onOpenChange:c,children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(ma,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"6",y1:"4",x2:"6",y2:"20"}),e.jsx("rect",{x:"4",y:"7",width:"4",height:"3",rx:"1",fill:"currentColor"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20"}),e.jsx("rect",{x:"10",y:"11",width:"4",height:"3",rx:"1",fill:"currentColor"}),e.jsx("line",{x1:"18",y1:"4",x2:"18",y2:"20"}),e.jsx("rect",{x:"16",y:"9",width:"4",height:"3",rx:"1",fill:"currentColor"})]})})})}),e.jsx(ge,{children:"Mix Presets"})]}),e.jsx(ha,{align:"center",className:"w-72",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:e.jsx(xa,{tracks:o,presets:l,onSavePreset:u,onLoadPreset:h,onDeletePreset:p})})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:r?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},onClick:i,children:e.jsx(wr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:r?"Hide Mixer":"Show Mixer"})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:s?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},onClick:d,children:e.jsx(kr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:s?"Hide Notes":"Show Notes"})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:m,children:e.jsx(xs,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Performance Mode"})]})})]}),pa=({zoom:t,setZoom:r,timelineRef:s,rulerRef:n,currentTime:o})=>{const l=f.useRef(0),a=f.useRef(null),i=f.useCallback(c=>{n.current&&(n.current.scrollLeft=c)},[n]),d=f.useCallback(c=>{l.current=c,i(c)},[i]),m=f.useCallback((c,u)=>{r(c),s.current&&(s.current.scrollLeft=u),n.current&&(n.current.scrollLeft=u),l.current=u},[r,s,n]);return f.useEffect(()=>{const c=s.current,u=n.current,h=p=>{if(!p.ctrlKey&&!p.metaKey)return;p.preventDefault(),p.stopPropagation();const x=p.deltaY>0?1/oe.FACTOR:oe.FACTOR,g=Math.max(oe.MIN,Math.min(oe.MAX,t*x));if(g===t)return;const y=s.current?.getBoundingClientRect(),S=y?p.clientX-y.left:0,M=(s.current?.scrollLeft||0)+S,C=oe.BASE_PPS*t,w=M/C;r(g);const j=oe.BASE_PPS*g,k=w*j,N=Math.max(0,k-S);a.current=N};return c&&c.addEventListener("wheel",h,{passive:!1}),u&&u.addEventListener("wheel",h,{passive:!1}),()=>{c&&c.removeEventListener("wheel",h),u&&u.removeEventListener("wheel",h)}},[t,r,s,n]),f.useEffect(()=>{if(a.current!==null){const c=a.current;s.current&&(s.current.scrollLeft=c),n.current&&(n.current.scrollLeft=c),l.current=c,a.current=null}},[t,s,n]),{scrollLeftRef:l,handleTimelineScroll:d,handleNavigatorChange:m}},ga=({song:t,onSongUpdate:r})=>{const[s,n]=f.useState([]),o=f.useCallback(i=>{const d={id:`preset-${Date.now()}`,name:i,tracks:t.tracks.map(m=>({trackId:m.id,volume:m.volume??1,muted:m.muted??!1}))};n(m=>[...m,d])},[t.tracks]),l=f.useCallback(i=>{if(!r)return;const d=t.tracks.map(m=>{const c=i.tracks.find(u=>u.trackId===m.id);return c?{...m,volume:c.volume,muted:c.muted}:m});r({...t,tracks:d})},[t,r]),a=f.useCallback(i=>{n(d=>d.filter(m=>m.id!==i))},[]);return{mixPresets:s,handleSaveMixPreset:o,handleLoadMixPreset:l,handleDeleteMixPreset:a}},va=({song:t,onSongUpdate:r,editMode:s})=>{const[n,o]=f.useState(!1),[l,a]=f.useState("section"),[i,d]=f.useState(null),[m,c]=f.useState(0),u=f.useCallback(x=>{if(!s)return;const g=x.currentTarget.getBoundingClientRect(),S=(x.clientX-g.left)/50;c(S)},[s]),h=f.useCallback((x,g)=>{if(!r)return;let y={...t};switch(l){case"section":x==="delete"&&i?y.markers=t.markers?.filter(v=>v.time!==i.time)||[]:x==="update"&&i?y.markers=t.markers?.map(v=>v.time===i.time?{...v,...g}:v)||[]:y.markers=[...t.markers||[],g];break;case"chord":x==="delete"&&i?y.chordMarkers=t.chordMarkers?.filter(v=>v.time!==i.time)||[]:x==="update"&&i?y.chordMarkers=t.chordMarkers?.map(v=>v.time===i.time?{...v,...g}:v)||[]:y.chordMarkers=[...t.chordMarkers||[],g];break;case"tempo":x==="delete"&&i?y.tempoChanges=t.tempoChanges?.filter(v=>v.time!==i.time)||[]:x==="update"&&i?y.tempoChanges=t.tempoChanges?.map(v=>v.time===i.time?{...v,...g}:v)||[]:y.tempoChanges=[...t.tempoChanges||[],g];break}r(y),o(!1),d(null)},[t,r,i,l]),p=f.useCallback((x,g,y)=>{a(x),d(g||null),y!==void 0&&c(y),o(!0)},[]);return{editorOpen:n,setEditorOpen:o,editorType:l,editingMarker:i,clickedTime:m,handleTimelineClick:u,handleTimelineItemSubmit:h,openEditor:p}},ba=({zoom:t,setZoom:r,song:s,containerWidth:n})=>{const o=f.useCallback(()=>!s||n===0?1:n/(s.duration*oe.BASE_PPS),[s,n]),l=f.useCallback(()=>{r(d=>Math.max(oe.MIN,d-.25))},[r]),a=f.useCallback(()=>{r(d=>Math.min(oe.MAX,d+.25))},[r]),i=f.useCallback(()=>{const d=o(),m=Math.max(oe.MIN,Math.min(oe.MAX,d));r(m)},[o,r]);return{handleZoomOutOnPlayhead:l,handleZoomInOnPlayhead:a,handleFitToView:i}},ja=({song:t})=>{const[r,s]=f.useState(0),[n,o]=f.useState(t?.source==="project"),[l,a]=f.useState(!1),[i,d]=f.useState(1e3),[m,c]=f.useState(!1),[u,h]=f.useState(!0),[p,x]=f.useState(!0),[g,y]=f.useState(!1),[S,v]=f.useState(!1),[M,C]=f.useState(null),[w,j]=f.useState(!1),[k,N]=f.useState([]),[E,z]=f.useState(!1),[V,R]=f.useState(null),[ie,de]=f.useState(0),[U,X]=f.useState(new Set),[L,ve]=f.useState(null),[le,Q]=f.useState(!1),[J,Y]=f.useState(!1),te=f.useRef(null),me=f.useRef(null),ce=f.useRef(null),Se=f.useRef(null);return f.useEffect(()=>{t&&N(t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}])},[t?.tempoChanges,t?.tempo]),{keyShift:r,setKeyShift:s,editMode:n,setEditMode:o,createProjectOpen:l,setCreateProjectOpen:a,containerWidth:i,setContainerWidth:d,snapEnabled:m,setSnapEnabled:c,sidebarVisible:u,setSidebarVisible:h,mixerVisible:p,setMixerVisible:x,mixerDockVisible:g,setMixerDockVisible:y,mixPresetsPopoverOpen:S,setMixPresetsPopoverOpen:v,selectedChord:M,setSelectedChord:C,showShortcutsHelp:w,setShowShortcutsHelp:j,dynamicTempos:k,setDynamicTempos:N,isDragging:E,setIsDragging:z,dragStartTime:V,setDragStartTime:R,scrollTop:ie,setScrollTop:de,pinnedTracks:U,setPinnedTracks:X,selectedTrackForNotes:L,setSelectedTrackForNotes:ve,notesPanelVisible:le,setNotesPanelVisible:Q,warpMode:J,setWarpMode:Y,rulerRef:te,sidebarRef:me,timelineRef:ce,hoveredContainerRef:Se}};function qe(t,r,s,n="4/4"){const[o]=n.split("/").map(Number),l=[...r].sort((c,u)=>c.time-u.time);let a=0,i=1,d=s;for(const c of l){if(c.time<=a){d=c.tempo;continue}const u=o*60/d,h=(c.time-a)/u,p=i+h;if(p>=t){const x=t-i;return a+x*u}a=c.time,i=p,d=c.tempo}const m=t-i;if(m>0){const c=o*60/d;a+=m*c}return a}function Lt(t,r,s,n="4/4"){const[o]=n.split("/").map(Number),l=[...r].sort((h,p)=>h.time-p.time);let a=0,i=1,d=s;for(const h of l){if(h.time<=a){d=h.tempo;continue}if(h.time>t){const y=t-a,S=o*60/d,v=y/S;return i+v}const p=h.time-a,x=o*60/d,g=p/x;a=h.time,i+=g,d=h.tempo}const m=t-a,c=o*60/d,u=m/c;return i+u}function Rs(t,r,s){if(r<=0)return 120;const n=t*s*60/r;return Math.max(10,Math.min(999,n))}const ya=({song:t,zoom:r,currentTime:s,trackHeight:n})=>{const o=()=>oe.BASE_PPS*r,l=()=>{switch(n){case"small":return 64;case"large":return 128;default:return 96}},a=()=>{const m=t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}];return Math.floor(Lt(s,m,t.tempo))},i=m=>{const c=t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}],u=Lt(m,c,t.tempo);return[...c].sort((x,g)=>x.time-g.time).slice().reverse().find(x=>x.time<=u)||c[0]};return{getPixelsPerSecond:o,getTrackHeightPx:l,getCurrentMeasure:a,getCurrentTempoInfo:i,getCurrentTimeSignature:()=>i(s).timeSignature}},wa=({song:t,onSongUpdate:r})=>({handleWarpCommit:f.useCallback((n,o,l)=>{if(!t||!r)return;const a={...t},i=a.tempoChanges?[...a.tempoChanges]:[];i.sort((x,g)=>x.time-g.time);const d=i.find(x=>x.time>o);let m=0,c=0;d&&(c=d.time,m=qe(c,i,t.tempo));const u=i.findIndex(x=>x.time===n);u>=0?i[u]={...i[u],tempo:l}:n===1&&i.push({time:1,tempo:l,timeSignature:"4/4"});let h=i.findIndex(x=>x.time===o),p=i[h];if(!p){const x=i.find(g=>g.time===n);p={time:o,tempo:x?x.tempo:l,timeSignature:x?x.timeSignature:"4/4"},i.push(p)}if(i.sort((x,g)=>x.time-g.time),d){const x=qe(o,i,t.tempo),g=m-x,y=c-o;if(g>0&&y>0){const[S]=p.timeSignature.split("/").map(Number),v=Rs(y,g,S);p.tempo=v;const M=i.findIndex(C=>C.time===o);M>=0&&(i[M]=p)}}a.tempoChanges=i,r(a)},[t,r])}),ka=({song:t,onSongUpdate:r})=>{const s=f.useCallback((l,a,i)=>{if(!t||!r)return;const d={id:crypto.randomUUID(),userId:"current-user",content:l,time:i,isPrivate:a};r({...t,notes:[...t.notes||[],d]})},[t,r]),n=f.useCallback(l=>{!t||!r||r({...t,notes:(t.notes||[]).filter(a=>a.id!==l)})},[t,r]),o=f.useCallback((l,a)=>{if(!t||!r)return;const i=t.tracks.map(d=>d.id===a?{...d,notes:l}:d);r({...t,tracks:i})},[t,r]);return{handleAddSongNote:s,handleDeleteSongNote:n,handleSaveTrackNotes:o}},Ca=({timelineRef:t,setContainerWidth:r,song:s,containerWidth:n,setZoom:o})=>{f.useEffect(()=>{const l=()=>{t.current&&r(t.current.clientWidth)},a=setTimeout(l,0);return window.addEventListener("resize",l),()=>{clearTimeout(a),window.removeEventListener("resize",l)}},[t,r]),f.useEffect(()=>{if(!s||n===0)return;const l=n/(s.duration*oe.BASE_PPS),a=Math.max(oe.MIN,Math.min(oe.MAX,l));o(a),t.current&&(t.current.scrollLeft=0)},[s?.id,n,o,t])};function Na({notes:t,currentUser:r,onAddNote:s,onDeleteNote:n}){const[o,l]=f.useState(""),[a,i]=f.useState(!1),d=()=>{o.trim()&&(s(o,a),l(""),i(!1))},m=[...t].sort((u,h)=>u.time!==void 0&&h.time!==void 0?u.time-h.time:u.time!==void 0?-1:h.time!==void 0?1:0),c=u=>{if(u===void 0)return null;const h=Math.floor(u/60),p=Math.floor(u%60);return`${h}:${p.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add personal notes or share with your team"})]}),e.jsx(qt,{children:e.jsxs(Kt,{className:"pt-6 space-y-3",children:[e.jsx(Ss,{placeholder:"Add a note...",value:o,onChange:u=>l(u.target.value),rows:3}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{id:"private-note",checked:a,onCheckedChange:i}),e.jsxs(W,{htmlFor:"private-note",className:"text-sm flex items-center gap-1",children:[e.jsx(Ut,{className:"w-3 h-3"}),"Private Note"]})]}),e.jsxs(P,{onClick:d,disabled:!o.trim(),children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Add Note"]})]})]})}),e.jsx("div",{className:"space-y-3",children:m.map(u=>e.jsxs(qt,{children:[e.jsx(Cr,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm",children:u.userId===r.id?"You":"Team Member"}),u.isPrivate?e.jsxs(vt,{variant:"secondary",className:"text-xs",children:[e.jsx(Ut,{className:"w-3 h-3 mr-1"}),"Private"]}):e.jsxs(vt,{variant:"outline",className:"text-xs",children:[e.jsx(Nr,{className:"w-3 h-3 mr-1"}),"Shared"]}),u.time!==void 0&&e.jsx(vt,{variant:"outline",className:"text-xs",children:c(u.time)})]})}),u.userId===r.id&&e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n(u.id),children:e.jsx(Bt,{className:"w-4 h-4"})})]})}),e.jsx(Kt,{children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:u.content})})]},u.id))}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No notes yet"})})]})}const Is=H.memo(({track:t,isAnySolo:r,onVolumeChange:s,onMuteToggle:n,onSoloToggle:o})=>{const[l,a]=H.useState(Je(t.volume)),[i,d]=H.useState(!1);H.useEffect(()=>{i||a(Je(t.volume))},[t.volume,i]);const m=g=>{a(g[0])},c=()=>{d(!0)},u=()=>{d(!1),s(t.id,zt(l))},h=()=>{a(Je(1)),s(t.id,1)},p=r&&!t.solo,x=t.muted||p;return e.jsxs("div",{className:"flex flex-col items-center gap-3 min-w-[70px]",children:[e.jsx("div",{className:"text-xs text-center truncate w-full px-1 text-neutral-50",title:t.name,children:t.name}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center min-h-0",children:e.jsx(Gt,{children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx("div",{className:"h-full flex items-center",onDoubleClick:h,children:e.jsx(tt,{orientation:"vertical",value:[l],min:0,max:100,step:.1,onValueChange:m,onPointerDown:c,onPointerUp:u,className:"h-32",disabled:x})})}),e.jsxs(ge,{side:"top",children:[ct(bt(l))," â€¢ Double-click to reset"]})]})})}),e.jsx("div",{className:`text-xs tabular-nums text-center min-w-[45px] ${x?"text-neutral-600":"text-neutral-400"}`,children:ct(bt(l))}),e.jsx(P,{variant:"ghost",size:"sm",className:`h-7 w-8 text-xs p-0 ${t.muted?"bg-red-500 text-white hover:bg-red-600":"bg-neutral-700 text-neutral-50 hover:bg-neutral-600"}`,onClick:()=>n(t.id),children:"M"}),e.jsx(P,{variant:"ghost",size:"sm",className:`h-7 w-8 text-xs p-0 ${t.solo?"bg-amber-400 text-black hover:bg-amber-500":"bg-neutral-700 text-neutral-50 hover:bg-neutral-600"}`,onClick:()=>o(t.id),children:"S"}),e.jsx("div",{className:"w-full h-1 rounded",style:{backgroundColor:t.color}})]})});Is.displayName="MixerFader";function Ta({tracks:t,onTrackVolumeChange:r,onTrackMuteToggle:s,onTrackSoloToggle:n,onClose:o}){const l=t.some(a=>a.solo);return e.jsxs("div",{className:"w-full flex flex-col border-t h-[240px]",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:[e.jsxs("div",{className:"h-10 border-b flex items-center justify-between px-3 bg-neutral-800 border-neutral-700",children:[e.jsx("h3",{className:"text-sm text-neutral-50",children:"Mixer"}),e.jsx(P,{variant:"ghost",size:"icon",className:"h-7 w-7 text-neutral-400 hover:text-neutral-50",onClick:o,children:e.jsx(fs,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden p-4",children:e.jsx("div",{className:"flex gap-4 h-full",children:t.map(a=>e.jsx(Is,{track:a,isAnySolo:l,onVolumeChange:r,onMuteToggle:s,onSoloToggle:n},a.id))})})]})}const Sa=({mixerDockVisible:t,notesPanelVisible:r,song:s,orderedTracks:n,onCloseMixerDock:o,onCloseNotesPanel:l,onTrackVolumeChange:a,onTrackMuteToggle:i,onTrackSoloToggle:d,onAddNote:m,onDeleteNote:c})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(Ta,{tracks:n,onTrackVolumeChange:a,onTrackMuteToggle:i,onTrackSoloToggle:d,onClose:o}),r&&s&&e.jsxs("div",{className:"w-full flex flex-col border-t",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",height:"240px"},children:[e.jsxs("div",{className:"h-10 border-b flex items-center justify-between px-3",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:"var(--daw-text-primary)"},children:"Song Notes"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-gray-700 rounded",children:e.jsx(fs,{className:"w-4 h-4",style:{color:"var(--daw-text-primary)"}})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-3",style:{backgroundColor:"var(--daw-bg-contrast)"},children:e.jsx(Na,{notes:s.notes||[],currentUser:{id:"current-user",name:"You"},onAddNote:m,onDeleteNote:c})})]})]});function Ma(t,r,s="4/4",n=!0,o=50,l,a,i){const d=[],m=i?[...i].sort((v,M)=>v.time-M.time):[];let c=1,u=0,h=r,p=s,x,g=0;const y=Math.max(0,0),S=Math.min(t,t);for(;u<t;){for(;g<m.length&&m[g].time<=c;){const j=m[g];h=j.tempo,j.timeSignature&&(p=j.timeSignature),x=j.subdivision,g++}const[v]=p.split("/").map(Number),M=60/h,C=M*v;if(u+C>=y&&u<=S){u>=y&&d.push({position:u,opacity:1,type:"measure"});let j=new Set;if(x){const k=x.split("+").map(E=>parseInt(E.trim()));let N=0;for(const E of k)j.add(N),N+=E}else for(let k=0;k<v;k++)j.add(k);for(let k=1;k<v;k++){const N=u+k*M;if(N>=y&&N<S&&N<t&&(j.has(k)?d.push({position:N,opacity:.6,type:"beat"}):n&&o>50&&d.push({position:N,opacity:.4,type:"subdivision"})),n&&o>80)for(let E=1;E<4;E++){const z=N-M+M*E/4;z>u&&z>=y&&z<S&&z<t&&Math.abs(z-N)>.001&&d.push({position:z,opacity:.3,type:"subdivision"})}}if(n&&o>80){const k=u+(v-1)*M;for(let N=1;N<4;N++){const E=k+M*N/4;E>=y&&E<S&&E<t&&d.push({position:E,opacity:.3,type:"subdivision"})}}}u+=C,c++}return d}const Ea=({song:t,timelineWidth:r,onWarpCommit:s,warpMode:n})=>{const[o,l]=f.useState(!1),[a,i]=f.useState(null),[d,m]=f.useState(null),c=f.useCallback((u,h)=>{if(!n)return!1;u.preventDefault(),u.stopPropagation();const x=(u.clientX-h.left)/r*t.duration,g=t.tempoChanges||[],y=Lt(x,g,t.tempo),S=Math.round(y),M=[...g].sort((k,N)=>k.time-N.time).slice().reverse().find(k=>k.time<S),C=M?M.time:1;if(S<=C)return!0;const w=qe(C,g,t.tempo),j=qe(S,g,t.tempo);return i({dragMeasure:S,anchorMeasure:C,anchorTime:w,startPixel:u.clientX,originalTime:j}),l(!0),m(j),!0},[n,r,t]);return f.useEffect(()=>{if(!o||!a)return;const u=p=>{document.body.style.cursor="col-resize";const x=p.clientX-a.startPixel,g=r/t.duration,y=x/g,S=a.originalTime+y;S>a.anchorTime&&m(S)},h=p=>{document.body.style.cursor="default";const x=p.clientX-a.startPixel,g=r/t.duration,y=x/g,S=a.originalTime+y;if(S<=a.anchorTime){l(!1),i(null),m(null);return}const v=a.dragMeasure-a.anchorMeasure,M=S-a.anchorTime,C=(t.tempoChanges||[]).find(N=>N.time===a.anchorMeasure),w=C?C.timeSignature:"4/4",[j]=w.split("/").map(Number),k=Rs(v,M,j);s&&s(a.anchorMeasure,a.dragMeasure,k),l(!1),i(null),m(null)};return window.addEventListener("mousemove",u),window.addEventListener("mouseup",h),()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",h),document.body.style.cursor="default"}},[o,a,r,t,s]),{isWarpDragging:o,warpState:a,warpGhostTime:d,handleWarpMouseDown:c}},Aa=({rulerId:t,song:r,timelineWidth:s,zoom:n,editMode:o,keyShift:l,showBeats:a,onRulerDrop:i,onRulerDragOver:d,onSectionClick:m,onTempoMarkerClick:c,onChordClick:u,onTimeClick:h,onTempoMarkerAdd:p,onChordAdd:x,hoverLineRef:g,onLoopRegionChange:y,loopStart:S=null,loopEnd:v=null,scrollLeft:M=0,containerWidth:C=1e3,warpMode:w=!1,onWarpCommit:j})=>{const{warpGhostTime:k,handleWarpMouseDown:N}=Ea({song:r,timelineWidth:s,onWarpCommit:j,warpMode:w}),[E,z]=H.useState(!1),[V,R]=H.useState(null),[ie,de]=H.useState(null),[U,X]=H.useState(null),[L,ve]=H.useState(!0),[le,Q]=H.useState(!1),J=O=>{if(!L||ce.length===0)return O;let $=0,T=ce.length-1;for(;$<=T;){const B=Math.floor(($+T)/2);ce[B].position<O?$=B+1:T=B-1}const A=ce[$],D=ce[$-1];return A&&D?O-D.position<A.position-O?D.position:A.position:A?A.position:D?D.position:O},Y=O=>{const $=O.currentTarget.getBoundingClientRect();if(!(w&&t==="measures"&&N(O,$))){if(!w&&t==="measures"&&y&&O.shiftKey){O.stopPropagation();const A=(O.clientX-$.left)/s*r.duration,D=J(A);z(!0),R(D),de(D);return}if(o&&!w){if(t==="tempo"&&p){const A=(O.clientX-$.left)/s*r.duration,D=J(A);p(D);return}if(t==="chords"&&x){const A=(O.clientX-$.left)/s*r.duration,D=J(A);x(D);return}}if(!w){const A=(O.clientX-$.left)/s*r.duration,D=J(A);h&&O.clientY-$.top<He.RULER_HEIGHT/2&&h(Math.max(0,Math.min(D,r.duration)))}}},te=()=>{const $=n>=8?1:n>=4?2:n>=2?5:n>=.5?10:30,T=[];for(let A=0;A<=r.duration;A+=$)T.push(A);return T},me=f.useMemo(()=>Math.round(n*10)/10,[n]),ce=f.useMemo(()=>Ma(r.duration,r.tempo||120,"4/4",a,me*100,void 0,void 0,r.tempoChanges),[r.duration,r.tempo,r.tempoChanges,o,me,a]),Se=f.useMemo(()=>{const O=[];let $=0,T=-1,A=-100;const D=50,B=s/r.duration,G=60/(r.tempo||120)*B,_=a&&G>=25,K=a&&G>=80;return ce.forEach((q,ee)=>{if(q.type==="measure"){$++,T=q.position;const ue=q.position/r.duration*s,he=ue-A>=D;he&&(A=ue),O.push({time:q.position,measure:he?$:null,beat:1,isBeat:!1,opacity:q.opacity,height:"100%",width:2,color:"rgba(255,255,255,0.6)"})}else if(q.type==="beat"&&_){const re=ce.slice(0,ee).filter(xe=>xe.position>T&&xe.type==="beat").length+2,he=re===4||re===7||re===10;O.push({time:q.position,measure:null,beat:re,isBeat:!0,opacity:q.opacity,height:he?"70%":"55%",width:he?1.5:1,color:he?"rgba(255,255,255,0.35)":"rgba(255,255,255,0.25)"})}else q.type==="subdivision"&&K&&O.push({time:q.position,measure:null,beat:0,isBeat:!0,opacity:q.opacity*.5,height:"30%",width:1,color:"rgba(255,255,255,0.15)"})}),O},[ce,n,a,r.duration,s,r.tempo,M,C]);switch(t){case"time":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${He.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"time"),onDragOver:d,onMouseDown:Y,children:te().map(T=>e.jsx("div",{className:"absolute top-0 bottom-0 border-l",style:{left:T/r.duration*s,borderColor:"var(--daw-border)"},children:e.jsx("span",{className:"absolute top-0.5 left-1 text-[10px]",style:{color:"var(--daw-text-secondary)"},children:It(T)})},T))});case"measures":return e.jsxs("div",{className:"border-b relative cursor-pointer transition-colors duration-300",style:{height:`${He.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:w?"rgba(249, 115, 22, 0.15)":"var(--daw-bg-contrast)",borderColor:w?"#f97316":"var(--daw-border)"},onDrop:T=>i(T,"measures"),onDragOver:d,onMouseDown:Y,onMouseMove:T=>{const A=T.currentTarget.getBoundingClientRect(),B=(T.clientX-A.left)/s*r.duration,G=J(B);if(X(G),E&&V!==null&&y){const _=Math.min(V,G),K=Math.max(V,G);y(_,K)}},onMouseUp:()=>{E&&(z(!1),R(null),de(null))},onMouseLeave:()=>{X(null),E&&(z(!1),R(null),de(null))},children:[Se.map((T,A)=>{const D=T.time/r.duration*s;if(!T.measure&&!T.isBeat)return null;const B=T.height,G=T.width,_=T.color,K="var(--daw-text-secondary)",q=B==="100%"?"0":B==="70%"?"15%":B==="55%"?"22.5%":"35%",ee=r.tempoChanges?.find(ue=>Math.abs(ue.time-T.time)<.01);return ee&&ee.timeSignature&&ee.timeSignature.includes("8")&&["6/8","9/8","12/8"].includes(ee.timeSignature),ee&&ee.subdivision,e.jsxs("div",{className:`absolute transition-colors ${w?"hover:bg-orange-400/30":""}`,style:{left:D,top:q,height:B,width:`${G}px`,backgroundColor:_},title:T.isCompound?"Compound Time":T.isIrregular?"Irregular Time":void 0,children:[T.measure&&e.jsx("span",{className:"absolute -top-4 left-1 text-[10px] font-semibold whitespace-nowrap",style:{color:K},children:T.measure}),a&&T.isBeat&&T.beat>0&&e.jsx("span",{className:"absolute -top-4 left-1 text-[9px] whitespace-nowrap",style:{color:"var(--daw-text-muted)"},children:T.beat})]},A)}),w&&(r.tempoChanges||[]).map((T,A)=>{const B=qe(T.time,r.tempoChanges||[],r.tempo)/r.duration*s;return e.jsx("div",{className:"absolute -top-0.5 -left-1.5 w-3 h-3 z-20 pointer-events-none",style:{left:B,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #f97316",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}},`warp-anchor-${A}`)}),U!==null&&!w&&e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-cyan-400/50 pointer-events-none transition-all duration-75",style:{left:U/r.duration*s},children:e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 px-1.5 py-0.5 bg-cyan-500 text-white text-[9px] rounded whitespace-nowrap",children:It(U)})}),k!==null&&e.jsxs("div",{className:"absolute top-0 bottom-0 w-0.5 bg-orange-500 z-50 pointer-events-none",style:{left:k/r.duration*s},children:[e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 px-1.5 py-0.5 bg-orange-500 text-white text-[9px] rounded whitespace-nowrap font-bold",children:"WARP"}),e.jsx("div",{className:"absolute -top-0.5 -left-1.5 w-3 h-3 z-50",style:{borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #f97316",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}})]}),E&&V!==null&&U!==null&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-yellow-500/20 border-l-2 border-r-2 border-yellow-500/60 pointer-events-none",style:{left:Math.min(V,U)/r.duration*s,width:Math.abs(U-V)/r.duration*s}})]});case"tempo":const $=[...o?r.tempoChanges||[]:(r.tempoChanges||[]).filter(T=>!T.hidden)].sort((T,A)=>T.time-A.time);return e.jsxs("div",{className:"tempo-ruler-interactive border-b relative cursor-pointer transition-all duration-300",style:{height:le?"120px":`${He.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"tempo"),onDragOver:d,onMouseDown:Y,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-4 z-50 flex items-center justify-center hover:bg-white/10 cursor-pointer text-[10px] text-muted-foreground",onClick:T=>{T.stopPropagation(),Q(!le)},title:le?"Collapse Tempo View":"Expand Tempo View",children:e.jsx("div",{className:`transform transition-transform ${le?"rotate-90":"rotate-0"}`,children:"â–¶"})}),le&&e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none opacity-30",children:e.jsx("polyline",{points:$.map(T=>{const A=qe(T.time,r.tempoChanges||[],r.tempo)/r.duration*s,D=120-(Math.min(Math.max(T.tempo,60),200)-60)/140*120;return`${A},${D}`}).join(" "),fill:"none",stroke:"#f97316",strokeWidth:"2"})}),$.map((T,A)=>{const D=A>0?$[A-1]:null,B=!D||D.timeSignature!==T.timeSignature,G=qe(T.time,r.tempoChanges||[],r.tempo);return e.jsxs("div",{className:"absolute top-0.5 flex items-start cursor-pointer group z-10",style:{left:G/r.duration*s},onClick:_=>{_.stopPropagation(),_.preventDefault(),o&&c(T)},children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-px",style:{backgroundColor:"#f97316",opacity:.4,height:le?"120px":"100%"}}),e.jsxs("div",{className:"absolute top-0 -translate-x-1/2 flex gap-1 flex-col items-center",children:[e.jsx("div",{className:"hover:brightness-110 transition-all",style:{backgroundColor:"#f97316",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},children:As(T.tempo)}),B&&e.jsx("div",{className:"hover:brightness-110 transition-all mt-0.5",style:{backgroundColor:"#6b7280",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},children:T.timeSignature})]})]},`tempo-${A}`)})]});case"chords":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${He.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"chords"),onDragOver:d,onMouseDown:Y,children:(r.chordMarkers||[]).map((T,A)=>e.jsx("div",{className:"absolute top-0.5",style:{left:T.time/r.duration*s},children:e.jsx("div",{className:"cursor-pointer hover:brightness-110 transition-all",style:{backgroundColor:"#3b82f6",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},onClick:D=>{D.stopPropagation(),u(T)},children:Rt(T.chord,l)})},A))});case"sections":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${He.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"sections"),onDragOver:d,onMouseDown:Y,children:r.markers.map((T,A)=>{const D=T.time/r.duration*s,B=r.markers[A+1],G=B?(B.time-T.time)/r.duration*s:s-D,_={intro:{bg:"#22c55e",text:"#fff"},verse:{bg:"#3b82f6",text:"#fff"},chorus:{bg:"#ef4444",text:"#fff"},bridge:{bg:"#f59e0b",text:"#fff"},outro:{bg:"#8b5cf6",text:"#fff"},"pre-chorus":{bg:"#ec4899",text:"#fff"},instrumental:{bg:"#14b8a6",text:"#fff"},tag:{bg:"#64748b",text:"#fff"},custom:{bg:"#6b7280",text:"#fff"}},K=_[T.type]||_.custom;return e.jsx("div",{className:"absolute top-0.5 cursor-pointer hover:brightness-110 transition-all",style:{left:D,width:Math.max(40,G-4),height:"24px",backgroundColor:K.bg,borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)"},onClick:q=>{q.stopPropagation(),m(A)},children:e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-semibold pointer-events-none truncate px-2",style:{color:K.text},children:T.label})},T.id)})});default:return null}},Ls=H.memo(({song:t,currentTime:r,gridTime:s,tempo:n,zoom:o,pixelsPerSecond:l,containerWidth:a,visibleRulers:i,rulerOrder:d,onTimeClick:m,onMarkerEdit:c,onMarkerDelete:u,editMode:h,keyShift:p,onChordClick:x,onLoopRegionChange:g,loopStart:y,loopEnd:S,scrollLeft:v,warpMode:M=!1,onWarpCommit:C,onTempoMarkerAdd:w,onChordAdd:j})=>{const k=l||o*100,N=d.filter(R=>i.includes(R)),E=R=>{x&&x(R.chord,R.customDiagram)},z=R=>{h&&!M&&c&&t.markers[R]&&c(t.markers[R],"section")},V=R=>{h&&!M&&c&&c(R,"tempo")};return e.jsxs("div",{className:"relative flex-shrink-0 z-10",style:{width:`${t.duration*k}px`},children:[e.jsx("div",{className:"absolute top-0 bottom-0 z-50 pointer-events-none",style:{left:`${r*k}px`},children:e.jsx("div",{className:"absolute top-0 bottom-0",style:{width:"2px",backgroundColor:"#ef4444"},children:e.jsx("div",{className:"absolute -top-0 left-1/2 -translate-x-1/2",style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"8px solid #ef4444"}})})}),N.map(R=>e.jsx(Aa,{rulerId:R,song:t,timelineWidth:t.duration*k,zoom:o,editMode:h,keyShift:p,showBeats:!0,onRulerDrop:()=>{},onRulerDragOver:ie=>ie.preventDefault(),onSectionClick:z,onTempoMarkerClick:V,onChordClick:E,onTimeClick:m,onLoopRegionChange:R==="measures"?g:void 0,loopStart:y,loopEnd:S,scrollLeft:v,containerWidth:a,warpMode:M,onWarpCommit:C,onTempoMarkerAdd:w,onChordAdd:j},R))]})});Ls.displayName="RulersContainer";const Fa=({songDuration:t,zoom:r,containerWidth:s,timelineRef:n,onNavigate:o})=>{const[l,a]=f.useState({start:0,end:1}),i=f.useRef(!1);f.useEffect(()=>{const m=n.current;if(!m)return;const c=()=>{if(i.current)return;const u=m.scrollLeft,h=t*oe.BASE_PPS*r;if(h===0)return;const p=u/h,x=(u+s)/h;a({start:Math.max(0,p),end:Math.min(1,x)})};return c(),m.addEventListener("scroll",c),()=>m.removeEventListener("scroll",c)},[t,r,s,n]);const d=H.useCallback(({start:m,end:c})=>{i.current=!0,a({start:m,end:c});const u=c-m;if(u<=1e-4)return;const p=s/u/(t*oe.BASE_PPS),x=Math.max(oe.MIN,Math.min(oe.MAX,p)),g=t*oe.BASE_PPS*x,y=m*g;o(x,y),setTimeout(()=>{i.current=!1},100)},[s,t,o]);return e.jsx("div",{className:"flex-1 px-4 flex items-center h-full",children:e.jsx(yn,{start:l.start,end:l.end,onChange:d,className:"h-5 w-full"})})};function Da({song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n,onExportProject:o}){const{t:l}=st(),a=Rn(),{zoom:i,setZoom:d,trackHeight:m,setTrackHeight:c,rulerVisibility:u,rulerOrder:h,setRulerOrder:p}=a,x=ja({song:t}),{keyShift:g,setKeyShift:y,editMode:S,setEditMode:v,createProjectOpen:M,setCreateProjectOpen:C,containerWidth:w,setContainerWidth:j,snapEnabled:k,setSnapEnabled:N,sidebarVisible:E,setSidebarVisible:z,mixerVisible:V,mixerDockVisible:R,setMixerDockVisible:ie,mixPresetsPopoverOpen:de,setMixPresetsPopoverOpen:U,selectedChord:X,setSelectedChord:L,showShortcutsHelp:ve,setShowShortcutsHelp:le,setIsDragging:Q,scrollTop:J,pinnedTracks:Y,setPinnedTracks:te,selectedTrackForNotes:me,setSelectedTrackForNotes:ce,notesPanelVisible:Se,setNotesPanelVisible:O,warpMode:$,setWarpMode:T,rulerRef:A,sidebarRef:D,timelineRef:B,hoveredContainerRef:G}=x,{isPlaying:_,currentTime:K,gridTime:q,tempo:ee,loopEnabled:ue,loopStart:re,loopEnd:he,metronomeEnabled:xe,metronomeVolume:we,actions:Z}=Fn({song:t,warpModeEnabled:!1}),ne=On({song:t,onSongUpdate:r}),{mixPresets:Be,handleSaveMixPreset:Re,handleLoadMixPreset:rt,handleDeleteMixPreset:$e}=ga({song:t,onSongUpdate:r}),{editorOpen:ze,setEditorOpen:_e,editorType:Ve,editingMarker:nt,clickedTime:b,handleTimelineClick:F,handleTimelineItemSubmit:ae,openEditor:se}=va({song:t,onSongUpdate:r,editMode:S}),{handleZoomOutOnPlayhead:ke,handleZoomInOnPlayhead:We,handleFitToView:Ge}=ba({zoom:i,setZoom:d,song:t,containerWidth:w}),{handleTimelineScroll:at,handleNavigatorChange:ot}=pa({zoom:i,setZoom:d,timelineRef:B,rulerRef:A,currentTime:K}),{getPixelsPerSecond:Ue,getTrackHeightPx:Ct,getCurrentMeasure:Nt,getCurrentTimeSignature:Tt}=ya({song:t,zoom:i,currentTime:K,trackHeight:m}),{handleWarpCommit:St}=wa({song:t,onSongUpdate:r}),{handleAddSongNote:Os,handleDeleteSongNote:Bs,handleSaveTrackNotes:$s}=ka({song:t,onSongUpdate:r});Ca({timelineRef:B,setContainerWidth:j,song:t,containerWidth:w,setZoom:d});const zs=I=>{a.setRulerVisibility(I),Object.entries(I).forEach(([be,Ce])=>{Pe.setRulerVisibility(be,Ce)})},_s=H.useCallback(()=>{Q(!1)},[]),Vs=H.useCallback(I=>{G.current!=="timeline"&&B.current&&B.current.scrollTop!==I&&(B.current.scrollTop=I)},[]),Ws=H.useCallback(I=>{if(!B.current)return;const be=B.current.scrollHeight,Ce=I.start*be;B.current.scrollTop=Ce,D.current&&(D.current.scrollTop=Ce)},[]),Gs=H.useCallback(()=>{if(!B.current)return{start:0,end:1};const I=B.current.scrollHeight,be=B.current.clientHeight;if(I<=be)return{start:0,end:1};const Ce=B.current.scrollTop,sr=Ce/I,rr=(Ce+be)/I;return{start:sr,end:rr}},[J]),Hs=H.useCallback(I=>{},[]),qs=H.useCallback((I,be)=>{},[]),Ks=H.useCallback(()=>{},[]),Us=H.useCallback(()=>{},[]),Xs=H.useCallback(()=>{ie(!1)},[]);Dn({isPlaying:_,onPlayPause:Z.togglePlayPause,onStop:()=>Z.seek(0),onToggleLoop:()=>Z.setLoopEnabled(!ue),onToggleMetronome:()=>Z.setMetronomeEnabled(!xe),onZoomIn:()=>d(I=>Math.min(8,I+.25)),onZoomOut:()=>d(I=>Math.max(.5,I-.25)),onGoToStart:()=>Z.seek(0),onGoToEnd:()=>Z.seek(t?.duration||0),onFitToView:()=>{if(t&&w>0){const I=w/(t.duration*oe.BASE_PPS),be=Math.max(oe.MIN,Math.min(oe.MAX,I));d(be),at(0)}},onToggleEditMode:()=>v(I=>!I)});const[Zs,Ra]=H.useState(null),Ys=I=>{S&&!$?se("chord",I):L({chord:I.chord,customDiagram:I.customDiagram})};if(!t)return e.jsxs("div",{className:"flex flex-col h-full text-white",style:{backgroundColor:"var(--daw-bg-main)"},children:[e.jsxs("div",{className:"border-b p-3 flex items-center justify-between",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs(P,{variant:"ghost",size:"sm",onClick:n,className:"text-white hover:bg-gray-700",children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),"Back to Library"]}),e.jsx("h2",{children:"Player"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"No Project Loaded"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create a new project or load one from the library"})]})})}),e.jsx(Pt,{open:!1,onOpenChange:()=>{},onCreateProject:async()=>{}})]});const ft=f.useMemo(()=>{if(!t?.tracks)return[];const I=t.tracks.filter(Ce=>Y.has(Ce.id)),be=t.tracks.filter(Ce=>!Y.has(Ce.id));return[...I,...be]},[t?.tracks,Y]),Qs=I=>{se("tempo",void 0,I)},Js=I=>{se("chord",void 0,I)},er={song:t,updateSong:I=>{r&&r(I)},tracks:t?.tracks||[],trackActions:{updateVolume:ne.handleTrackVolumeChange,toggleMute:ne.handleTrackMuteToggle,toggleSolo:ne.handleTrackSoloToggle,updateName:ne.handleTrackNameChange,updateColor:ne.handleTrackColorChange,updateTag:ne.handleTrackTagChange},currentTime:K,gridTime:q,tempo:ee,isPlaying:_,zoom:i,setZoom:d,editMode:S,setEditMode:v,warpMode:$,setWarpMode:T,keyShift:g,setKeyShift:y},pt=$?"warp":S?"marker":null,tr=I=>{I==="warp"?(T(!0),v(!0)):I==="marker"?(T(!1),v(!0)):(T(!1),v(!1))};return e.jsx(Cn,{value:er,children:e.jsx(Gt,{children:e.jsxs("div",{className:"flex flex-col h-full text-white",style:{backgroundColor:"var(--daw-bg-main)"},children:[e.jsx(Xn,{songTitle:t.title,songKey:t.key,isPlaying:_,currentTime:K,tempo:ee,loopEnabled:ue,metronomeEnabled:xe,metronomeVolume:we,currentMeasure:String(Nt()),currentTimeSignature:Tt(),displayTempo:ee,keyShift:g,trackHeight:m,rulerVisibility:u,rulerOrder:h,snapEnabled:k,onBack:n,onPlayPause:Z.togglePlayPause,onStop:Z.stop,onLoopToggle:()=>Z.setLoopEnabled(!ue),onMetronomeToggle:()=>Z.setMetronomeEnabled(!xe),onMetronomeVolumeChange:Z.setMetronomeVolume,onTempoChange:Z.setTempo,onKeyShiftChange:y,onTrackHeightChange:c,onRulerVisibilityChange:zs,onRulerOrderChange:p,onSnapToggle:()=>N(!k),onSnapModeChange:I=>console.log("Snap mode:",I),activeTool:pt,onToolChange:tr}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-none h-auto border-b z-30",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:[E&&V&&e.jsx("div",{className:"flex-none border-r",style:{width:"280px",minWidth:"280px",maxWidth:"280px",backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:e.jsx(ca,{visibleRulers:Object.keys(u).filter(I=>u[I]),rulerOrder:h,onRulerOrderChange:p})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-hidden",ref:A,children:e.jsx(Ls,{song:t,currentTime:K,gridTime:q,tempo:ee,zoom:i,pixelsPerSecond:Ue(),containerWidth:w,visibleRulers:Object.keys(u).filter(I=>u[I]),rulerOrder:h,onTimeClick:I=>Z.seek(I),onMarkerEdit:(I,be)=>se(be,I),onMarkerDelete:(I,be)=>{},onTempoMarkerAdd:pt==="marker"?Qs:void 0,onChordAdd:pt==="marker"?Js:void 0,editMode:pt==="marker",keyShift:g,warpMode:$,onWarpCommit:St,onChordClick:I=>{const be=t?.chordMarkers?.find(Ce=>Ce.chord===I);be&&Ys(be)}})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[E&&V&&e.jsx(Ps,{ref:D,tracks:ft,trackHeight:m,editingTrackId:null,trackNameInput:"",pinnedTracks:Y,onTrackVolumeChange:ne.handleTrackVolumeChange,onTrackMuteToggle:ne.handleTrackMuteToggle,onTrackSoloToggle:ne.handleTrackSoloToggle,onTrackNameChange:ne.handleTrackNameChange,onTrackColorChange:ne.handleTrackColorChange,onTrackTagsChange:qs,onTrackNotesOpen:ce,onEditingTrackIdChange:Ks,onTrackNameInputChange:Us,onPinnedTracksChange:te,onScroll:Vs}),e.jsx(Es,{ref:B,song:t,currentTime:K,zoom:i,pixelsPerSecond:Ue(),filteredTracks:ft,loopStart:re,loopEnd:he,trackHeightPx:Ct(),onTimelineMouseDown:F,onTimelineMouseMove:Hs,onTimelineMouseUp:_s,onScroll:at}),e.jsx("div",{className:"w-4 flex-shrink-0",style:{backgroundColor:"var(--daw-bg-contrast)"},children:e.jsx(wn,{...Gs(),onChange:Ws,minHeight:.05})})]})]}),e.jsx(Sa,{mixerDockVisible:R,notesPanelVisible:Se,orderedTracks:ft,song:t,onTrackVolumeChange:ne.handleTrackVolumeChange,onTrackMuteToggle:ne.handleTrackMuteToggle,onTrackSoloToggle:ne.handleTrackSoloToggle,onCloseMixerDock:Xs,onCloseNotesPanel:()=>O(!1),onAddNote:Os,onDeleteNote:Bs}),e.jsxs("div",{className:"border-t flex items-center h-8",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("div",{className:"border-r flex items-center flex-shrink-0",style:{width:E&&V?"280px":"0",minWidth:E&&V?"280px":"0",borderColor:"var(--daw-border)"},children:e.jsx(da,{zoom:i,onZoomIn:We,onZoomOut:ke,onFitToView:Ge})}),e.jsx(Fa,{songDuration:t.duration,zoom:i,containerWidth:w,timelineRef:B,onNavigate:ot})]}),e.jsx(fa,{sidebarVisible:E,mixerDockVisible:R,notesPanelVisible:Se,mixPresetsPopoverOpen:de,tracks:ft,mixPresets:Be,onToggleSidebar:()=>z(!E),onToggleMixer:()=>ie(!R),onToggleNotes:()=>O(!Se),onPerformanceMode:s||(()=>{}),onMixPresetsOpenChange:U,onSaveMixPreset:Re,onLoadMixPreset:rt,onDeleteMixPreset:$e}),e.jsx(Pt,{open:M,onOpenChange:C,onCreateProject:async()=>{}}),e.jsx(fn,{open:ze,onOpenChange:_e,type:Ve,currentTime:Zs??b,initialData:nt,onSubmit:ae}),X&&e.jsx(bn,{chord:X.chord,isOpen:!!X,onClose:()=>L(null),customDiagram:X.customDiagram}),me&&e.jsx(jn,{open:!!me,onOpenChange:I=>{I||ce(null)},trackName:me.name,notes:me.notes||"",onSave:I=>$s(I,me.id)}),e.jsx(Yr,{isOpen:ve,onClose:()=>le(!1)})]})})})}function Pa({song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n,onCreateProject:o,onExportProject:l}){return t?e.jsx(Da,{song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n}):e.jsxs("div",{className:"flex flex-col h-full bg-gray-900 text-white",children:[e.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 p-3 flex items-center justify-between",children:[e.jsxs(P,{variant:"ghost",size:"sm",onClick:n,className:"text-white hover:bg-gray-700",children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),"Back to Library"]}),e.jsx("h2",{children:"Player"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"No Project Loaded"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create a new project or load one from the library"})]})})}),e.jsx(Pt,{open:!1,onOpenChange:()=>{},onCreateProject:o||(async()=>{})})]})}const Ga=Object.freeze(Object.defineProperty({__proto__:null,DAWPlayer:Pa},Symbol.toStringTag,{value:"Module"}));export{_a as A,Ga as D,za as L,ua as P,tt as S,Ss as T,Va as a,Fn as b,ma as c,ha as d,En as e,It as f,Sn as g,An as h,Wt as p,Wa as r,Pe as s,st as u,gt as w};
