import{r as x,j as e,R as H,a as tr}from"./react-vendor-BoGJM_Cg.js";import{D as lt,a as ct,b as dt,c as ut,d as mt,B as pt,S as It,e as Te,f as P,L as W,I as Me,g as Ee,h as Ae,i as Fe,j as De,k as ye,T as cs,l as ds,m as Ze,n as Ye,o as sr,p as rr,q as nr,C as Wt,r as Gt,s as ar,t as Ft}from"./library-feature-pEmANn5L.js";import{z as or,A as ir,B as lr,E as cr,F as dr,G as ur,H as mr,J as hr,K as xr,M as fr,N as pr,Q as gr,U as br,W as vr,X as jr,Y as yr,Z as wr,_ as kr,$ as Cr,a0 as Nr,a1 as Tr}from"./ui-vendor-1btjq6i-.js";import{g as qe,h as Sr,T as Lt,P as us,M as Mr,i as Er,j as ms,E as Ar,k as Fr,l as Ot,m as Dr,n as Pr,C as Ht,D as Rr,Z as Ir,o as Lr,p as hs,q as Or,U as Br,r as $r,s as zr,t as _r,u as Vr,v as qt,w as Wr,X as xs}from"./icons-vendor-4kQF2o2m.js";import{t as Ne}from"./toast-vendor-CHPPPCQ6.js";import{f as it,g as Qe,s as Bt,a as Gr,b as gt}from"./audio-processing-DdlKDC9D.js";const Hr={library:"Library",setlists:"Setlists",settings:"Settings",songLibrary:"Song Library",searchSongs:"Search songs...",importProject:"Import Project",createNew:"Create New",songs:"songs",duration:"Duration",tempo:"Tempo",tracks:"tracks",play:"Play",edit:"Edit",delete:"Delete",addToSetlist:"Add to Setlist",setlistManager:"Setlist Manager",searchSetlists:"Search setlists...",createSetlist:"Create Setlist",setlistName:"Setlist Name",noSetlists:"No setlists yet",createFirstSetlist:"Create your first setlist to organize your songs",editSetlist:"Edit Setlist",deleteSetlist:"Delete Setlist",addSongs:"Add Songs",removeSong:"Remove from setlist",backToLibrary:"Back to Library",performanceMode:"Performance Mode",editMode:"Edit Mode",master:"Master",volume:"Volume",pan:"Pan",solo:"Solo",mute:"Mute",metronome:"Metronome",metronomeVolume:"Metronome Volume",time:"Time (mm:ss)",chords:"Chords",sections:"Sections",measures:"Measures",insertChord:"Insert Chord",insertSection:"Insert Section",insertTempo:"Insert Tempo/Time Sig",exitPerformance:"Exit Performance Mode",previous:"Previous",next:"Next",upNext:"Up Next",appSettings:"App Settings",appearance:"Appearance",theme:"Theme",light:"Light",dark:"Dark",system:"System",language:"Language",english:"English",portuguese:"Portuguese",audio:"Audio",audioOutput:"Audio Output Device",bufferSize:"Buffer Size",sampleRate:"Sample Rate",midi:"MIDI",midiInput:"MIDI Input Device",enableMidi:"Enable MIDI Control",midiChannel:"MIDI Channel",playPause:"Play/Pause",stop:"Stop",skipForward:"Skip Forward",skipBackward:"Skip Backward",about:"About",version:"Version",cancel:"Cancel",save:"Save",create:"Create",close:"Close",confirm:"Confirm",createProject:"Create New Project",projectName:"Project Name",artist:"Artist",defaultTempo:"Default Tempo",timeSignature:"Time Signature",selectSetlist:"Select a setlist",addToExisting:"Add to existing setlist",editTimeline:"Edit Timeline",chordInsertion:"Chord Insertion",sectionInsertion:"Section Insertion",tempoInsertion:"Tempo/Time Signature Insertion",position:"Position",chord:"Chord",section:"Section",tempoValue:"Tempo",root:"Root",accidental:"Accidental",quality:"Quality",major:"Major",minor:"Minor",augmented:"Augmented",diminished:"Diminished",dominant7:"Dominant 7th",major7:"Major 7th",minor7:"Minor 7th",extension:"Extension",none:"None",ninth:"9th",eleventh:"11th",thirteenth:"13th",bassNote:"Bass Note",customizeDiagram:"Customize Diagram",guitar:"Guitar",ukulele:"Ukulele",piano:"Piano",intro:"Intro",verse:"Verse",chorus:"Chorus",bridge:"Bridge",outro:"Outro",interlude:"Interlude",preChorus:"Pre-Chorus",notes:"Notes",songNotes:"Song notes and reminders...",confirmDelete:"Are you sure you want to delete this?",confirmDeleteSong:"Are you sure you want to delete this song?",confirmDeleteSetlist:"Are you sure you want to delete this setlist?",noSongsInLibrary:"No songs in your library",importFirstSong:"Import your first song to get started",clickFretsToPlace:"Click on frets to place fingers, click string labels to mute/unmute",clickToMute:"Click string labels to mute/unmute",greenCircles:"Green circles = open/active strings",redCircles:"Red circles with âœ• = muted strings",blueDots:"Blue dots = finger positions",clickPianoKeys:"Click on piano keys to build your chord",selectedNotes:"Selected notes:",clickToToggle:"Click keys to toggle selection",blueDotsFingers:"Blue dots show finger positions on the fretboard"},fs=x.createContext(void 0);function La({children:t}){const r={t:Hr};return e.jsx(fs.Provider,{value:r,children:t})}function tt(){const t=x.useContext(fs);if(t===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return t}const je={TRACK_HEIGHT:"goodmultitracks_track_height",ZOOM_LEVEL:"goodmultitracks_zoom_level",RULER_ORDER:"goodmultitracks_ruler_order",METRONOME_FREQUENCIES:"metronome_frequencies",THEME:"goodmultitracks_theme",LANGUAGE:"goodmultitracks_language",MAIN_INSTRUMENT:"goodmultitracks_main_instrument",FIRST_TIME_SETUP_COMPLETE:"goodmultitracks_first_time_setup"};function Ie(t,r){try{const s=localStorage.getItem(t);return s===null?r:typeof r!="string"?JSON.parse(s):s}catch(s){return console.warn(`Failed to read from localStorage: ${t}`,s),r}}function Le(t,r){try{const s=typeof r=="string"?r:JSON.stringify(r);return localStorage.setItem(t,s),!0}catch(s){return console.warn(`Failed to write to localStorage: ${t}`,s),!1}}function qr(t){try{return localStorage.removeItem(t),!0}catch(r){return console.warn(`Failed to remove from localStorage: ${t}`,r),!1}}const Pe={getTrackHeight:()=>Ie(je.TRACK_HEIGHT,"medium"),setTrackHeight:t=>Le(je.TRACK_HEIGHT,t),getZoomLevel:()=>Ie(je.ZOOM_LEVEL,1),setZoomLevel:t=>Le(je.ZOOM_LEVEL,t),getRulerVisibility:t=>{const r=`goodmultitracks_show_${t}_ruler`;return Ie(r,!0)},setRulerVisibility:(t,r)=>{const s=`goodmultitracks_show_${t}_ruler`;return Le(s,r)},getRulerOrder:()=>Ie(je.RULER_ORDER,["time","measures","sections","chords","tempo"]),setRulerOrder:t=>Le(je.RULER_ORDER,t),getMetronomeFrequencies:()=>Ie(je.METRONOME_FREQUENCIES,{strongBeat:1e3,normalBeat:800,subdivision:600}),setMetronomeFrequencies:t=>Le(je.METRONOME_FREQUENCIES,t),getTheme:()=>Ie(je.THEME,"dark"),setTheme:t=>Le(je.THEME,t),getLanguage:()=>Ie(je.LANGUAGE,"pt"),setLanguage:t=>Le(je.LANGUAGE,t),getMainInstrument:()=>Ie(je.MAIN_INSTRUMENT,null),setMainInstrument:t=>t?Le(je.MAIN_INSTRUMENT,t):qr(je.MAIN_INSTRUMENT),isFirstTimeSetupComplete:()=>Ie(je.FIRST_TIME_SETUP_COMPLETE,!1),setFirstTimeSetupComplete:()=>Le(je.FIRST_TIME_SETUP_COMPLETE,!0)},ps=x.createContext(void 0),Oa=({children:t})=>{const r=x.useRef(null),s=()=>(r.current||(r.current=new(window.AudioContext||window.webkitAudioContext)),r.current),n=async()=>{const a=s();a.state==="suspended"&&await a.resume()},o=async()=>{r.current&&r.current.state==="running"&&await r.current.suspend()};x.useEffect(()=>()=>{r.current&&r.current.state!=="closed"&&(r.current.close(),r.current=null)},[]);const l={audioContext:r.current,getAudioContext:s,resumeAudioContext:n,suspendAudioContext:o};return e.jsx(ps.Provider,{value:l,children:t})},Kr=()=>{const t=x.useContext(ps);if(!t)throw new Error("useAudioContext must be used within an AudioContextProvider");return t};class Xe{static instance;waveforms=new Map;mediums=new Map;overviews=new Map;listeners=new Set;notifyTimeout=null;constructor(){}static getInstance(){return Xe.instance||(Xe.instance=new Xe),Xe.instance}subscribe(r){return this.listeners.add(r),()=>this.listeners.delete(r)}notify(){this.notifyTimeout&&clearTimeout(this.notifyTimeout),this.notifyTimeout=setTimeout(()=>{this.listeners.forEach(r=>{try{r()}catch(s){console.error("Error in waveform store listener:",s)}}),this.notifyTimeout=null},0)}setWaveform(r,s){this.waveforms.set(r,s),this.notify()}getWaveform(r){return this.waveforms.get(r)}setOverview(r,s){this.overviews.set(r,s),this.notify()}getOverview(r){return this.overviews.get(r)}setMedium(r,s){this.mediums.set(r,s),this.notify()}getMedium(r){return this.mediums.get(r)}clear(){this.waveforms.clear(),this.mediums.clear(),this.overviews.clear(),this.notify()}has(r){return this.waveforms.has(r)}delete(r){this.waveforms.delete(r),this.mediums.delete(r),this.overviews.delete(r),this.notify()}}const ft=Xe.getInstance(),Tt=[{category:"Playback",items:[{keys:["Space"],description:"Play / Pause"},{keys:["Home"],description:"Go to start"},{keys:["End"],description:"Go to end"},{keys:["R"],description:"Reset to start"},{keys:["â†"],description:"Jump backward 5 seconds"},{keys:["â†’"],description:"Jump forward 5 seconds"},{keys:["Shift","â†"],description:"Previous section"},{keys:["Shift","â†’"],description:"Next section"}]},{category:"View",items:[{keys:["+"],description:"Zoom in"},{keys:["-"],description:"Zoom out"},{keys:["0"],description:"Reset zoom"}]},{category:"Tools",items:[{keys:["L"],description:"Toggle loop"},{keys:["M"],description:"Toggle metronome"}]}];function Ur({isOpen:t,onClose:r}){return e.jsx(lt,{open:t,onOpenChange:r,children:e.jsxs(ct,{className:"max-w-2xl",children:[e.jsxs(dt,{children:[e.jsx(ut,{children:"Keyboard Shortcuts"}),e.jsx(mt,{children:"Use these keyboard shortcuts to navigate and control the player efficiently"})]}),e.jsx("div",{className:"space-y-6 py-4",children:Tt.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700",children:s.category}),e.jsx("div",{className:"space-y-2",children:s.items.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm text-gray-600",children:n.description}),e.jsx("div",{className:"flex gap-1",children:n.keys.map((l,a)=>e.jsxs(H.Fragment,{children:[a>0&&e.jsx("span",{className:"text-gray-400 mx-1",children:"+"}),e.jsx(pt,{variant:"secondary",className:"font-mono px-2 py-1 bg-gray-100 text-gray-700 border",children:l})]},a))})]},o))}),s.category!==Tt[Tt.length-1].category&&e.jsx(It,{className:"mt-4"})]},s.category))}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"Tip:"})," Most shortcuts won't work when typing in text fields"]})]})})}function ot({className:t,...r}){return e.jsx(or,{"data-slot":"switch",className:Te("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(ir,{"data-slot":"switch-thumb",className:Te("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const $t={C:261.63,"C#":277.18,Db:277.18,D:293.66,"D#":311.13,Eb:311.13,E:329.63,F:349.23,"F#":369.99,Gb:369.99,G:392,"G#":415.3,Ab:415.3,A:440,"A#":466.16,Bb:466.16,B:493.88};let St=null;function yt(){return St||(St=new(window.AudioContext||window.webkitAudioContext)),St}function zt(t,r,s,n=.3){const o=yt(),l=o.createOscillator(),a=o.createGain();l.type="sine",l.frequency.setValueAtTime(t,s),a.gain.setValueAtTime(0,s),a.gain.linearRampToValueAtTime(n,s+.01),a.gain.exponentialRampToValueAtTime(n*.7,s+.1),a.gain.setValueAtTime(n*.7,s+r-.1),a.gain.exponentialRampToValueAtTime(.01,s+r),l.connect(a),a.connect(o.destination),l.start(s),l.stop(s+r)}function gs(t,r=1.5,s=.25){const o=yt().currentTime;t.forEach(l=>{const a=$t[l];a&&zt(a,r,o,s)})}function bs(t,r=1.5){const s=["E","A","D","G","B","E"];t.forEach((l,a)=>{});const o=yt().currentTime;t.forEach((l,a)=>{if(l>=0){const i=s[a],u=$t[i];if(u){const h=u*Math.pow(2,l/12);zt(h,r,o+a*.03,.15)}}})}function vs(t,r=1.5){const s=["G","C","E","A"],o=yt().currentTime;t.forEach((l,a)=>{if(l>=0){const i=s[a],u=$t[i];if(u){const h=u*Math.pow(2,l/12);zt(h,r,o+a*.03,.2)}}})}function Xr({frets:t,fingers:r,startFret:s=1,onChange:n}){const{t:o}=tt(),l=["E","A","D","G","B","e"],a=5,i=(c,d)=>{const m=[...t],p=[...r],f=d===0?0:d+s-1;m[c]===f?(m[c]=0,p[c]=0):(m[c]=f,f>0?p[c]=Math.min(4,d):p[c]=0),n(m,p)},u=c=>{const d=[...t],m=[...r];d[c]===-1?(d[c]=0,m[c]=0):(d[c]=-1,m[c]=0),n(d,m)},h=()=>{bs(t)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:o.clickFretsToPlace}),e.jsxs(P,{variant:"outline",size:"sm",onClick:h,className:"gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Play"]})]}),e.jsxs("svg",{width:"240",height:"320",viewBox:"0 0 240 320",className:"border rounded-lg bg-white",children:[[...Array(a)].map((c,d)=>e.jsx("line",{x1:"50",y1:70+d*40,x2:"210",y2:70+d*40,stroke:"#666",strokeWidth:d===0?"4":"2"},`fret-${d}`)),[...Array(6)].map((c,d)=>e.jsx("line",{x1:50+d*32,y1:"70",x2:50+d*32,y2:"230",stroke:"#666",strokeWidth:"2"},`string-${d}`)),s>1&&e.jsxs("text",{x:"25",y:"90",fontSize:"14",fill:"#333",textAnchor:"middle",fontWeight:"600",children:[s,"fr"]}),l.map((c,d)=>{const m=50+d*32,p=t[d]===-1;return e.jsxs("g",{children:[e.jsx("rect",{x:m-12,y:"260",width:"24",height:"24",fill:"transparent",cursor:"pointer",onClick:()=>u(d)}),e.jsx("text",{x:m,y:"275",fontSize:"14",fill:p?"#999":"#333",textAnchor:"middle",cursor:"pointer",onClick:()=>u(d),style:{userSelect:"none"},children:c})]},`label-${d}`)}),t.map((c,d)=>{const m=50+d*32;if(c===-1)return e.jsxs("g",{children:[e.jsx("circle",{cx:m,cy:"45",r:"8",fill:"#ef4444"}),e.jsx("line",{x1:m-4,y1:"41",x2:m+4,y2:"49",stroke:"white",strokeWidth:"2"}),e.jsx("line",{x1:m+4,y1:"41",x2:m-4,y2:"49",stroke:"white",strokeWidth:"2"})]},`marker-${d}`);if(c===0)return e.jsx("circle",{cx:m,cy:"45",r:"7",fill:"none",stroke:"#22c55e",strokeWidth:"2.5"},`marker-${d}`);{const p=c-s+1;if(p>=1&&p<=a){const f=70+(p-.5)*40,g=r[d];return e.jsxs("g",{children:[e.jsx("circle",{cx:m,cy:f,r:"11",fill:"#2563eb"}),g>0&&e.jsx("text",{x:m,y:f+5,fontSize:"13",fill:"white",textAnchor:"middle",fontWeight:"600",children:g})]},`marker-${d}`)}return null}}),[...Array(6)].map((c,d)=>[...Array(a)].map((m,p)=>{const f=50+d*32,g=70+p*40,y=p+1;return e.jsx("rect",{x:f-16,y:g-20,width:"32",height:"40",fill:"transparent",cursor:"pointer",onClick:()=>i(d,y)},`click-${d}-${p}`)})),[...Array(6)].map((c,d)=>{const m=50+d*32;return e.jsx("rect",{x:m-16,y:"30",width:"32",height:"30",fill:"transparent",cursor:"pointer",onClick:()=>i(d,0)},`open-${d}`)})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 text-center max-w-xs",children:[e.jsxs("p",{children:["â€¢ ",o.greenCircles]}),e.jsxs("p",{children:["â€¢ ",o.redCircles]}),e.jsxs("p",{children:["â€¢ ",o.blueDots]})]})]})}function Zr({frets:t,fingers:r,startFret:s=1,onChange:n}){const{t:o}=tt(),l=["G","C","E","A"],a=5,i=(h,c)=>{const d=[...t],m=[...r],p=c===0?0:c+s-1;d[h]===p?(d[h]=0,m[h]=0):(d[h]=p,p>0?m[h]=Math.min(4,c):m[h]=0),n(d,m)},u=()=>{vs(t)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:o.clickFretsToPlace}),e.jsxs(P,{variant:"outline",size:"sm",onClick:u,className:"gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Play"]})]}),e.jsxs("svg",{width:"200",height:"320",viewBox:"0 0 200 320",className:"border rounded-lg bg-white",children:[[...Array(a)].map((h,c)=>e.jsx("line",{x1:"50",y1:70+c*40,x2:"170",y2:70+c*40,stroke:"#666",strokeWidth:c===0?"4":"2"},`fret-${c}`)),[...Array(4)].map((h,c)=>e.jsx("line",{x1:50+c*40,y1:"70",x2:50+c*40,y2:"230",stroke:"#666",strokeWidth:"2"},`string-${c}`)),s>1&&e.jsxs("text",{x:"25",y:"90",fontSize:"14",fill:"#333",textAnchor:"middle",fontWeight:"600",children:[s,"fr"]}),l.map((h,c)=>{const d=50+c*40;return e.jsx("text",{x:d,y:"275",fontSize:"14",fill:"#333",textAnchor:"middle",style:{userSelect:"none"},children:h},`label-${c}`)}),t.map((h,c)=>{const d=50+c*40;if(h===0)return e.jsx("circle",{cx:d,cy:"45",r:"7",fill:"none",stroke:"#22c55e",strokeWidth:"2.5"},`marker-${c}`);{const m=h-s+1;if(m>=1&&m<=a){const p=70+(m-.5)*40,f=r[c];return e.jsxs("g",{children:[e.jsx("circle",{cx:d,cy:p,r:"11",fill:"#2563eb"}),f>0&&e.jsx("text",{x:d,y:p+5,fontSize:"13",fill:"white",textAnchor:"middle",fontWeight:"600",children:f})]},`marker-${c}`)}return null}}),[...Array(4)].map((h,c)=>[...Array(a)].map((d,m)=>{const p=50+c*40,f=70+m*40,g=m+1;return e.jsx("rect",{x:p-20,y:f-20,width:"40",height:"40",fill:"transparent",cursor:"pointer",onClick:()=>i(c,g)},`click-${c}-${m}`)})),[...Array(4)].map((h,c)=>{const d=50+c*40;return e.jsx("rect",{x:d-20,y:"30",width:"40",height:"30",fill:"transparent",cursor:"pointer",onClick:()=>i(c,0)},`open-${c}`)})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center max-w-xs",children:e.jsxs("p",{children:["â€¢ ",o.blueDotsFingers]})})]})}function Yr({keys:t,onChange:r}){const{t:s}=tt(),n=x.useRef(null),o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],a=[...o.map(m=>`${m}4`),...l.map(m=>`${m}5`)];x.useEffect(()=>{n.current&&(n.current.scrollLeft=200)},[]);const i=m=>{const p=[...t],f=p.indexOf(m);f>-1?p.splice(f,1):p.push(m),r(p)},u=m=>m.replace(/[0-9]/g,""),h=m=>m.includes("#"),c=m=>m.startsWith("C"),d=()=>{const m=t.map(p=>u(p));gs(m)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.clickPianoKeys}),e.jsxs(P,{variant:"outline",size:"sm",onClick:d,className:"gap-2",disabled:t.length===0,children:[e.jsx(qe,{className:"w-4 h-4"}),"Play"]})]}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto border rounded-lg bg-gray-100 p-4",ref:n,children:e.jsxs("svg",{width:"860",height:"200",viewBox:"0 0 860 200",className:"min-w-[860px]",children:[a.filter(m=>!h(u(m))).map((m,p)=>{const f=20+p*56,g=t.includes(m),y=c(m);return e.jsxs("g",{children:[e.jsx("rect",{x:f,y:"20",width:"54",height:"150",fill:g?"#2563eb":"white",stroke:y?"#dc2626":"#333",strokeWidth:y?"3":"2",rx:"4",cursor:"pointer",onClick:()=>i(m)}),y&&e.jsx("circle",{cx:f+27,cy:"155",r:"4",fill:g?"white":"#dc2626"}),e.jsx("text",{x:f+27,y:"140",fontSize:"12",fill:g?"white":"#666",textAnchor:"middle",cursor:"pointer",onClick:()=>i(m),style:{userSelect:"none"},children:u(m)})]},`white-${m}`)}),a.filter(m=>h(u(m))).map(m=>{const p=u(m),f=m.replace(/[^0-9]/g,""),g=parseInt(f)-4;let y=0;p==="C#"?y=0:p==="D#"?y=1:p==="F#"?y=3:p==="G#"?y=4:p==="A#"&&(y=5);const b=20+(g*7+y)*56+40,M=t.includes(m);return e.jsx("rect",{x:b,y:"20",width:"28",height:"95",fill:M?"#1e40af":"#333",stroke:"#000",strokeWidth:"2",rx:"3",cursor:"pointer",onClick:()=>i(m)},`black-${m}`)})]})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 text-center max-w-md",children:[e.jsxs("p",{children:[e.jsx("strong",{children:s.selectedNotes})," ",t.length>0?t.join(", "):s.none]}),e.jsx("p",{className:"text-gray-400",children:s.clickToToggle}),e.jsx("p",{className:"text-gray-400 italic",children:"Red markers indicate C notes â€¢ Scroll horizontally to view all keys"})]})]})}const Qr=["C","D","E","F","G","A","B"],Jr={C:0,D:1,E:2,F:3,G:4,A:5,B:6},Kt=[0,2,4,5,7,9,11],en={P1:{id:"P1",semitones:0,degree:0,quality:"P"},m2:{id:"m2",semitones:1,degree:1,quality:"m"},M2:{id:"M2",semitones:2,degree:1,quality:"M"},A2:{id:"A2",semitones:3,degree:1,quality:"A"},m3:{id:"m3",semitones:3,degree:2,quality:"m"},M3:{id:"M3",semitones:4,degree:2,quality:"M"},P4:{id:"P4",semitones:5,degree:3,quality:"P"},A4:{id:"A4",semitones:6,degree:3,quality:"A"},d5:{id:"d5",semitones:6,degree:4,quality:"d"},P5:{id:"P5",semitones:7,degree:4,quality:"P"},A5:{id:"A5",semitones:8,degree:4,quality:"A"},m6:{id:"m6",semitones:8,degree:5,quality:"m"},M6:{id:"M6",semitones:9,degree:5,quality:"M"},dim7:{id:"dim7",semitones:9,degree:6,quality:"d"},m7:{id:"m7",semitones:10,degree:6,quality:"m"},M7:{id:"M7",semitones:11,degree:6,quality:"M"},P8:{id:"P8",semitones:12,degree:7,quality:"P"},b9:{id:"b9",semitones:13,degree:8,quality:"m"},9:{id:"9",semitones:14,degree:8,quality:"M"},"#9":{id:"#9",semitones:15,degree:8,quality:"A"},11:{id:"11",semitones:17,degree:10,quality:"P"},"#11":{id:"#11",semitones:18,degree:10,quality:"A"},b13:{id:"b13",semitones:20,degree:12,quality:"m"},13:{id:"13",semitones:21,degree:12,quality:"M"}};function tn(t){const r=t.match(/^([A-G])(bb|b|#|x|##)?(\d*)$/);if(!r)throw new Error(`Invalid note format: ${t}`);const s=r[1],n=r[2]||"",o=r[3]?parseInt(r[3]):void 0;let l=0;return n==="#"?l=1:n==="x"||n==="##"?l=2:n==="b"?l=-1:n==="bb"&&(l=-2),{letter:s,accidentalStr:n,accidentalValue:l,octave:o}}function sn(t){return t===0?"":t===1?"#":t===2?"x":t===-1?"b":t===-2?"bb":t>0?"#".repeat(t):"b".repeat(Math.abs(t))}function rn(t,r){const s=typeof r=="string"?en[r]:r;if(!s)return console.error(`Invalid interval: ${r}`),t;const{letter:n,accidentalValue:o,octave:l}=tn(t),a=Jr[n],i=(a+s.degree)%7,u=Qr[i];let h=Kt[i]-Kt[a];h<0&&(h+=12);const d=o+s.semitones-h;let m=l;if(l!==void 0){const p=s.degree,f=a+p>=7,g=Math.floor(s.degree/7);m=l+(f?1:0)+g}return`${u}${sn(d)}${m!==void 0?m:""}`}function Dt(t,r){if(r===0)return t;const s=t.match(/^([A-G][#b]?)(.*)/);if(!s)return t;const[,n,o]=s,l=(r%12+12)%12,i={0:"P1",1:(n.includes("b"),"m2"),2:"M2",3:n.includes("b")?"m3":"M2",4:"M3",5:"P4",6:n.includes("#")?"A4":"d5",7:"P5",8:n.includes("b")?"m6":"A5",9:"M6",10:"m7",11:"M7"}[l]||"P1";return rn(n,i)+o}const js=[{value:"natural",label:"Natural",symbol:""},{value:"sharp",label:"â™¯ (Sharp)",symbol:"#"},{value:"flat",label:"â™­ (Flat)",symbol:"b"}],ys=[{value:"major",label:"Major",suffix:""},{value:"minor",label:"Minor",suffix:"m"},{value:"diminished",label:"Diminished",suffix:"dim"},{value:"augmented",label:"Augmented",suffix:"aug"},{value:"sus2",label:"Suspended 2nd",suffix:"sus2"},{value:"sus4",label:"Suspended 4th",suffix:"sus4"}],ws=[{value:"none",label:"None",suffix:""},{value:"7",label:"Dominant 7th",suffix:"7"},{value:"maj7",label:"Major 7th",suffix:"maj7"},{value:"9",label:"9th",suffix:"9"},{value:"maj9",label:"Major 9th",suffix:"maj9"},{value:"11",label:"11th",suffix:"11"},{value:"13",label:"13th",suffix:"13"},{value:"6",label:"6th",suffix:"6"},{value:"add9",label:"Add 9",suffix:"add9"}],nn=(t="")=>{if(!t)return{root:"C",accidental:"natural",quality:"major",extension:"none",bassNote:""};const[r,s]=t.split("/"),n=s||"",o=/^([A-G])([#b]?)(maj|m|min|dim|aug|sus2|sus4)?(13|11|9|7|6|add9|maj9|maj7)?(.*)$/,l=r.match(o);if(l){const[,a,i,u,h]=l,c=i==="#"?"sharp":i==="b"?"flat":"natural";let d="major";u==="m"||u==="min"?d="minor":u==="dim"?d="diminished":u==="aug"?d="augmented":u==="sus2"?d="sus2":u==="sus4"?d="sus4":u==="maj"&&!h?.startsWith("maj")&&(d="major");let m="none";return u==="maj"&&h==="7"?m="maj7":u==="maj"&&h==="9"?m="maj9":h==="7"?m="7":h==="9"?m="9":h==="11"?m="11":h==="13"?m="13":h==="6"?m="6":h==="add9"&&(m="add9"),{root:a,accidental:c,quality:d,extension:m,bassNote:n}}else return console.warn("Could not parse chord name accurately:",t),{root:t[0]||"C",accidental:"natural",quality:"major",extension:"none",bassNote:""}},an=(t,r,s,n,o)=>{const l=js.find(h=>h.value===r)?.symbol||"",a=ys.find(h=>h.value===s)?.suffix||"",i=ws.find(h=>h.value===n)?.suffix||"";let u=i;return n==="maj7"&&s!=="major"?u="maj7":n==="maj9"&&s!=="major"?u="maj9":(s==="major"&&(n==="maj7"||n==="maj9")||s==="major"&&n!=="none"||s!=="major"&&n!=="none")&&(u=i),`${t}${l}${a}${u}${o?"/"+o:""}`},Je={C:{guitar:{frets:[-1,3,2,0,1,0],fingers:[0,3,2,0,1,0]},piano:{keys:["C","E","G"]},ukulele:{frets:[0,0,0,3],fingers:[0,0,0,3]}},D:{guitar:{frets:[-1,-1,0,2,3,2],fingers:[0,0,0,1,3,2]},piano:{keys:["D","F#","A"]},ukulele:{frets:[2,2,2,0],fingers:[1,1,1,0]}},E:{guitar:{frets:[0,2,2,1,0,0],fingers:[0,2,3,1,0,0]},piano:{keys:["E","G#","B"]},ukulele:{frets:[4,4,4,2],fingers:[3,3,3,1]}},F:{guitar:{frets:[1,3,3,2,1,1],fingers:[1,3,4,2,1,1]},piano:{keys:["F","A","C"]},ukulele:{frets:[2,0,1,0],fingers:[2,0,1,0]}},G:{guitar:{frets:[3,2,0,0,0,3],fingers:[3,2,0,0,0,4]},piano:{keys:["G","B","D"]},ukulele:{frets:[0,2,3,2],fingers:[0,1,3,2]}},A:{guitar:{frets:[-1,0,2,2,2,0],fingers:[0,0,1,2,3,0]},piano:{keys:["A","C#","E"]},ukulele:{frets:[2,1,0,0],fingers:[2,1,0,0]}},B:{guitar:{frets:[-1,2,4,4,4,2],fingers:[0,1,2,3,4,1]},piano:{keys:["B","D#","F#"]},ukulele:{frets:[4,3,2,2],fingers:[4,3,1,2]}},"C#":{guitar:{frets:[-1,4,6,6,6,4],fingers:[0,1,3,4,4,1],startFret:1},piano:{keys:["C#","F","G#"]},ukulele:{frets:[1,1,1,4],fingers:[1,1,1,4]}},"D#":{guitar:{frets:[-1,-1,1,3,4,3],fingers:[0,0,1,2,4,3]},piano:{keys:["D#","G","A#"]},ukulele:{frets:[0,3,3,1],fingers:[0,3,4,1]}},"F#":{guitar:{frets:[2,4,4,3,2,2],fingers:[1,3,4,2,1,1]},piano:{keys:["F#","A#","C#"]},ukulele:{frets:[3,1,2,1],fingers:[3,1,2,1]}},"G#":{guitar:{frets:[4,6,6,5,4,4],fingers:[1,3,4,2,1,1]},piano:{keys:["G#","C","D#"]},ukulele:{frets:[5,3,4,3],fingers:[3,1,2,1]}},"A#":{guitar:{frets:[-1,1,3,3,3,1],fingers:[0,1,2,3,4,1]},piano:{keys:["A#","D","F"]},ukulele:{frets:[3,2,1,1],fingers:[3,2,1,1]}},Db:{guitar:{frets:[-1,4,6,6,6,4],fingers:[0,1,3,4,4,1],startFret:1},piano:{keys:["Db","F","Ab"]},ukulele:{frets:[1,1,1,4],fingers:[1,1,1,4]}},Eb:{guitar:{frets:[-1,-1,1,3,4,3],fingers:[0,0,1,2,4,3]},piano:{keys:["Eb","G","Bb"]},ukulele:{frets:[0,3,3,1],fingers:[0,3,4,1]}},Gb:{guitar:{frets:[2,4,4,3,2,2],fingers:[1,3,4,2,1,1]},piano:{keys:["Gb","Bb","Db"]},ukulele:{frets:[3,1,2,1],fingers:[3,1,2,1]}},Ab:{guitar:{frets:[4,6,6,5,4,4],fingers:[1,3,4,2,1,1]},piano:{keys:["Ab","C","Eb"]},ukulele:{frets:[5,3,4,3],fingers:[3,1,2,1]}},Bb:{guitar:{frets:[-1,1,3,3,3,1],fingers:[0,1,2,3,4,1]},piano:{keys:["Bb","D","F"]},ukulele:{frets:[3,2,1,1],fingers:[3,2,1,1]}},Am:{guitar:{frets:[-1,0,2,2,1,0],fingers:[0,0,2,3,1,0]},piano:{keys:["A","C","E"]},ukulele:{frets:[2,0,0,0],fingers:[1,0,0,0]}},Bm:{guitar:{frets:[-1,2,4,4,3,2],fingers:[0,1,3,4,2,1]},piano:{keys:["B","D","F#"]},ukulele:{frets:[4,2,2,2],fingers:[4,1,1,1]}},Cm:{guitar:{frets:[-1,3,5,5,4,3],fingers:[0,1,3,4,2,1]},piano:{keys:["C","Eb","G"]},ukulele:{frets:[0,3,3,3],fingers:[0,1,1,1]}},Dm:{guitar:{frets:[-1,-1,0,2,3,1],fingers:[0,0,0,2,3,1]},piano:{keys:["D","F","A"]},ukulele:{frets:[2,2,1,0],fingers:[2,3,1,0]}},Em:{guitar:{frets:[0,2,2,0,0,0],fingers:[0,2,3,0,0,0]},piano:{keys:["E","G","B"]},ukulele:{frets:[0,4,3,2],fingers:[0,4,3,2]}},Fm:{guitar:{frets:[1,3,3,1,1,1],fingers:[1,3,4,1,1,1]},piano:{keys:["F","Ab","C"]},ukulele:{frets:[1,0,1,3],fingers:[1,0,2,4]}},Gm:{guitar:{frets:[3,5,5,3,3,3],fingers:[1,3,4,1,1,1]},piano:{keys:["G","Bb","D"]},ukulele:{frets:[0,2,3,1],fingers:[0,2,3,1]}}},Ut=["C","D","E","F","G","A","B"],Xt=[{value:"1",label:"1 (Whole Note)"},{value:"2",label:"2 (Half Note)"},{value:"4",label:"4 (Quarter Note)"},{value:"8",label:"8 (Eighth Note)"},{value:"16",label:"16 (Sixteenth Note)"},{value:"32",label:"32 (32nd Note)"}],on=[{numerator:"4",denominator:"4",label:"4/4 (Common Time)"},{numerator:"3",denominator:"4",label:"3/4 (Waltz)"},{numerator:"6",denominator:"8",label:"6/8"},{numerator:"2",denominator:"4",label:"2/4"},{numerator:"5",denominator:"4",label:"5/4"},{numerator:"7",denominator:"8",label:"7/8"},{numerator:"9",denominator:"8",label:"9/8"},{numerator:"12",denominator:"8",label:"12/8"}],Zt=t=>{switch(t){case 1:return"whole";case 2:return"half";case 4:return"quarter";case 8:return"eighth";case 16:return"sixteenth";case 32:return"32nd";default:return"quarter"}},ks=(t,r,s)=>{let n="simple",o,l,a=[];return s?(n="irregular",a=s.split("+").map(Number),l=a.length,o=Zt(r)):r===8&&t%3===0&&t>=6?(n="compound",l=t/3,o="dotted-quarter",a=Array(l).fill(3)):(n="simple",l=t,o=Zt(r),a=Array(l).fill(1)),{numerator:t,denominator:r,type:n,beatUnit:o,beatsPerMeasure:l,grouping:a}},ln=(t,r)=>{if(r===8){if(t===5)return["3+2","2+3"];if(t===7)return["2+2+3","3+2+2","2+3+2"];if(t===8)return["3+3+2","3+2+3"];if(t===9)return["2+2+2+3","3+2+2+2"];if(t===10)return["3+3+2+2","2+3+2+3"];if(t===11)return["3+3+3+2","2+3+3+3"]}return[]},cn=[{value:"intro",label:"Intro"},{value:"verse",label:"Verse"},{value:"chorus",label:"Chorus"},{value:"bridge",label:"Bridge"},{value:"outro",label:"Outro"},{value:"pre-chorus",label:"Pre-Chorus"},{value:"instrumental",label:"Instrumental"},{value:"tag",label:"Tag"},{value:"custom",label:"Custom"}];function dn({open:t,onOpenChange:r,type:s,currentTime:n,initialData:o,onSubmit:l}){const{t:a}=tt(),i=!!o,[u,h]=x.useState("0"),[c,d]=x.useState("120"),[m,p]=x.useState("4"),[f,g]=x.useState("4"),[y,S]=x.useState(!1),[b,M]=x.useState(""),[C,w]=x.useState("verse"),[j,k]=x.useState(""),[N,E]=x.useState("C"),[z,V]=x.useState("natural"),[R,ie]=x.useState("major"),[de,U]=x.useState("none"),[Z,L]=x.useState(""),[be,le]=x.useState(!1),[J,ee]=x.useState([-1,3,2,0,1,0]),[Q,se]=x.useState([0,3,2,0,1,0]),[me,ce]=x.useState(1),[Se,O]=x.useState([0,0,0,3]),[$,T]=x.useState([0,0,0,3]),[A,D]=x.useState(1),[B,G]=x.useState(["C","E","G"]),[_,K]=x.useState(0),[q,te]=x.useState(""),[ue,re]=x.useState(!1),[he,xe]=x.useState("linear"),[we,Y]=x.useState("120"),[ne,Oe]=x.useState("0"),[Re,st]=x.useState("simple"),Be=()=>{h(n.toFixed(2)),d("120"),p("4"),g("4"),S(!1),M(""),w("verse"),k(""),E("C"),V("natural"),ie("major"),U("none"),L(""),le(!1);const v=Je.C;ee(v?.guitar.frets||[-1,3,2,0,1,0]),se(v?.guitar.fingers||[0,3,2,0,1,0]),ce(v?.guitar.startFret||1),O(v?.ukulele.frets||[0,0,0,3]),T(v?.ukulele.fingers||[0,0,0,3]),D(1),G(v?.piano.keys||["C","E","G"]),K(0),te(""),re(!1),xe("linear"),Y("120"),Oe("0")};x.useEffect(()=>{if(t)if(i&&o)if(h(o.time.toFixed(2)),s==="chord"){const v=o,F=nn(v.chord);if(E(F.root),V(F.accidental),ie(F.quality),U(F.extension),L(F.bassNote),k(v.chord),v.customDiagram)le(!0),ee(v.customDiagram.guitar.frets),se(v.customDiagram.guitar.fingers),ce(v.customDiagram.guitar.startFret||1),O(v.customDiagram.ukulele.frets),T(v.customDiagram.ukulele.fingers),D(v.customDiagram.ukulele.startFret||1),G(v.customDiagram.piano.keys),K(v.customDiagram.capo||0);else{le(!1);const oe=v.chord.split("/")[0],X=Je[oe];ee(X?.guitar?.frets||[-1,-1,-1,-1,-1,-1]),se(X?.guitar?.fingers||[0,0,0,0,0,0]),ce(X?.guitar?.startFret||1),O(X?.ukulele?.frets||[0,0,0,0]),T(X?.ukulele?.fingers||[0,0,0,0]),D(1),G(X?.piano?.keys||[]),K(0)}}else if(s==="tempo"&&"tempo"in o){const v=o;d(String(v.tempo)),S(v.hidden||!1),te(v.subdivision||""),v.curve&&(re(!0),xe(v.curve.type),Y(String(v.curve.targetTempo)),Oe(String(v.curve.targetTime)))}else if(s==="timesig"&&"timeSignature"in o){const v=o,[F,oe]=v.timeSignature.split("/");p(F),g(oe),S(v.hidden||!1),te(v.subdivision||"")}else s==="section"&&"label"in o&&(M(o.label),w(o.type||"custom"));else Be()},[t,i,o,s,n]),x.useEffect(()=>{const v=parseInt(m),F=parseInt(f);if(!isNaN(v)&&!isNaN(F)){const oe=ks(v,F,q);st(oe.type)}},[m,f,q]),x.useEffect(()=>{if(s==="chord"){const v=an(N,z,R,de,Z);k(v)}},[N,z,R,de,Z,s]),x.useEffect(()=>{if(s==="chord"&&j&&!be){const v=j.split("/")[0],F=Je[v];F&&(ee(F.guitar?.frets||[-1,-1,-1,-1,-1,-1]),se(F.guitar?.fingers||[0,0,0,0,0,0]),ce(F.guitar?.startFret||1),O(F.ukulele?.frets||[0,0,0,0]),T(F.ukulele?.fingers||[0,0,0,0]),D(1),G(F.piano?.keys||[]))}},[j,s,be]);const $e=()=>{const v=parseFloat(u);if(isNaN(v)||v<0){Ne.error("Please enter a valid time");return}let F={time:v};switch(s){case"tempo":const oe=parseInt(c);if(isNaN(oe)||oe<1){Ne.error("Please enter a valid tempo (BPM)");return}if(F.tempo=oe,F.timeSignature=`${m}/${f}`,F.hidden=y,F.subdivision=q.trim()||void 0,ue){const Ve=parseInt(we),We=parseFloat(ne);if(isNaN(Ve)||Ve<1){Ne.error("Please enter a valid target tempo (BPM)");return}if(isNaN(We)||We<=v){Ne.error("Target time must be greater than start time");return}F.curve={type:he,targetTempo:Ve,targetTime:We}}break;case"timesig":const X=parseInt(m),ke=parseInt(f);if(isNaN(X)||isNaN(ke)||X<1||ke<1||!Number.isInteger(Math.log2(ke))){Ne.error("Please enter a valid time signature (e.g., 4/4, 3/4, 6/8)");return}F.timeSignature=`${X}/${ke}`,F.tempo=i&&o&&"tempo"in o?o.tempo:parseInt(c),F.hidden=y,F.subdivision=q.trim()||void 0;break;case"section":if(!b.trim()){Ne.error("Please enter a section label");return}F.label=b.trim(),F.type=C;break;case"chord":if(!j.trim()){Ne.error("Chord name is empty or invalid");return}F.chord=j.trim(),be?F.customDiagram={guitar:{frets:J,fingers:Q,startFret:me},ukulele:{frets:Se,fingers:$,startFret:A},piano:{keys:B},capo:_>0?_:void 0}:F.customDiagram=void 0;break}l(i?"update":"add",F)},ze=()=>{i&&l("delete",{})},_e=()=>{switch(s){case"tempo":return"Add Tempo";case"timesig":return"Add Time Sig";case"section":return"Add Section";case"chord":return"Add Chord";default:return"Add Item"}},rt=()=>{switch(s){case"tempo":return"Add tempo marker";case"timesig":return"Add time signature marker";case"section":return"Add section marker";case"chord":return"Add chord marker";default:return""}};return e.jsx(lt,{open:t,onOpenChange:r,children:e.jsxs(ct,{className:s==="chord"?"sm:max-w-[600px] max-h-[90vh] overflow-y-auto":"sm:max-w-[450px]",children:[e.jsxs(dt,{children:[e.jsx(ut,{children:i?`Edit ${s}`:_e()}),e.jsx(mt,{children:rt()})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"time",children:"Time (seconds)"}),e.jsx(Me,{id:"time",type:"number",step:"0.01",value:u,onChange:v=>h(v.target.value)})]}),s==="tempo"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"tempo",children:"Tempo (BPM)"}),e.jsx(Me,{id:"tempo",type:"number",placeholder:"120",value:c,onChange:v=>d(v.target.value)})]}),e.jsxs("div",{className:"space-y-3 border border-[#2B2B2B] rounded-md p-3",children:[e.jsx(W,{className:"text-sm font-semibold",children:"Time Signature"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-num",className:"text-xs text-muted-foreground",children:"Numerator"}),e.jsx(Me,{id:"ts-num",type:"number",min:"1",max:"32",value:m,onChange:v=>p(v.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-den",className:"text-xs text-muted-foreground",children:"Denominator"}),e.jsxs(Ee,{value:f,onValueChange:g,children:[e.jsx(Ae,{id:"ts-den",children:e.jsx(Fe,{})}),e.jsx(De,{children:Xt.map(v=>e.jsx(ye,{value:v.value,children:v.value},v.value))})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Type: ",e.jsx("span",{className:"font-semibold text-primary capitalize",children:Re})]}),Re==="irregular"&&e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:e.jsx("div",{className:"text-xs font-mono bg-black/20 px-2 py-1 rounded border border-white/10",children:q||"Default"})})]}),e.jsx("div",{className:"pt-2",children:e.jsx(Yt,{numerator:parseInt(m)||4,denominator:parseInt(f)||4,subdivision:q,onSubdivisionChange:te})})]}),e.jsxs("div",{className:"space-y-3 border border-[#2B2B2B] rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{id:"enable-curve",checked:ue,onCheckedChange:re}),e.jsx(W,{htmlFor:"enable-curve",className:"text-sm cursor-pointer",children:"Enable Tempo Curve (Rallentando/Accelerando)"})]}),ue&&e.jsxs("div",{className:"space-y-3 pl-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"curve-type",className:"text-xs text-muted-foreground",children:"Curve Type"}),e.jsxs(Ee,{value:he,onValueChange:v=>xe(v),children:[e.jsx(Ae,{id:"curve-type",children:e.jsx(Fe,{})}),e.jsxs(De,{children:[e.jsx(ye,{value:"linear",children:"Linear (constant rate)"}),e.jsx(ye,{value:"exponential",children:"Exponential (natural feel)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"target-tempo",className:"text-xs text-muted-foreground",children:"Target Tempo"}),e.jsx(Me,{id:"target-tempo",type:"number",placeholder:"90",value:we,onChange:v=>Y(v.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"target-time",className:"text-xs text-muted-foreground",children:"Target Time (sec)"}),e.jsx(Me,{id:"target-time",type:"number",step:"0.1",placeholder:"8.0",value:ne,onChange:v=>Oe(v.target.value)})]})]}),e.jsxs("div",{className:"bg-[#1E1E1E] border border-[#2B2B2B] rounded-md p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Curve Preview:"}),parseInt(c)>parseInt(we)?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-blue-500/20 text-blue-400 border border-blue-500/30",children:"Rallentando (slowing down)"}):parseInt(c)<parseInt(we)?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-orange-500/20 text-orange-400 border border-orange-500/30",children:"Accelerando (speeding up)"}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-500/20 text-gray-400 border border-gray-500/30",children:"No change"})]}),e.jsxs("div",{className:"relative w-full h-16 bg-[#171717] rounded border border-[#2B2B2B] overflow-hidden",children:[e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 200 60",preserveAspectRatio:"none",children:[e.jsx("line",{x1:"0",y1:"15",x2:"200",y2:"15",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("line",{x1:"0",y1:"30",x2:"200",y2:"30",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("line",{x1:"0",y1:"45",x2:"200",y2:"45",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),(()=>{const v=parseInt(c)||120,F=parseInt(we)||120,oe=Math.max(v,F,180),X=Math.min(v,F,60),ke=oe-X||1,Ve=55-(v-X)/ke*50,We=55-(F-X)/ke*50;if(he==="linear")return e.jsx("line",{x1:"10",y1:Ve,x2:"190",y2:We,stroke:v>F?"#60a5fa":"#fb923c",strokeWidth:"2"});{const nt=[];for(let at=0;at<=20;at++){const Ke=at/20,wt=v>F?1-Math.pow(1-Ke,2):Math.pow(Ke,2),kt=v+(F-v)*wt,Ct=10+Ke*180,Nt=55-(kt-X)/ke*50;nt.push(`${Ct},${Nt}`)}return e.jsx("polyline",{points:nt.join(" "),fill:"none",stroke:v>F?"#60a5fa":"#fb923c",strokeWidth:"2"})}})(),e.jsx("circle",{cx:"10",cy:(()=>{const v=parseInt(c)||120,F=parseInt(we)||120,oe=Math.max(v,F,180),X=Math.min(v,F,60),ke=oe-X||1;return 55-(v-X)/ke*50})(),r:"3",fill:"#10b981"}),e.jsx("circle",{cx:"190",cy:(()=>{const v=parseInt(c)||120,F=parseInt(we)||120,oe=Math.max(v,F,180),X=Math.min(v,F,60),ke=oe-X||1;return 55-(F-X)/ke*50})(),r:"3",fill:"#ef4444"})]}),e.jsxs("div",{className:"absolute top-1 left-2 text-[10px] text-green-400",children:[c," BPM"]}),e.jsxs("div",{className:"absolute top-1 right-2 text-[10px] text-red-400",children:[we," BPM"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs pt-1",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",(parseFloat(ne)-parseFloat(u)).toFixed(2),"s"]}),e.jsxs("span",{className:"text-muted-foreground",children:["Change: ",Math.abs(parseInt(we)-parseInt(c))," BPM"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{id:"hide-tempo",checked:y,onCheckedChange:S}),e.jsx(W,{htmlFor:"hide-tempo",className:"text-sm cursor-pointer",children:"Hide in player mode (show only in edit mode)"})]})]}),s==="timesig"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(W,{children:"Time Signature"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-preset",className:"text-xs text-muted-foreground",children:"Common Presets"}),e.jsxs(Ee,{value:`${m}/${f}`,onValueChange:v=>{const[F,oe]=v.split("/");p(F),g(oe)},children:[e.jsx(Ae,{id:"ts-preset",children:e.jsx(Fe,{})}),e.jsx(De,{children:on.map(v=>e.jsx(ye,{value:`${v.numerator}/${v.denominator}`,children:v.label},v.label))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Custom Time Signature"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-num",className:"text-xs text-muted-foreground",children:"Numerator (Beats)"}),e.jsx(Me,{id:"ts-num",type:"number",min:"1",max:"32",value:m,onChange:v=>p(v.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ts-den",className:"text-xs text-muted-foreground",children:"Denominator (Note Value)"}),e.jsxs(Ee,{value:f,onValueChange:g,children:[e.jsx(Ae,{id:"ts-den",children:e.jsx(Fe,{})}),e.jsx(De,{children:Xt.map(v=>e.jsx(ye,{value:v.value,children:v.label},v.value))})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Note Groups (Visual Feedback)"}),e.jsx(Yt,{numerator:parseInt(m)||4,denominator:parseInt(f)||4,subdivision:q,onSubdivisionChange:te})]}),Re==="irregular"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",children:"Beat Grouping (Drag to Rearrange)"}),(()=>{const v=parseInt(m),F=parseInt(f),oe=ln(v,F);return oe.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:oe.map(X=>e.jsx(P,{type:"button",variant:q===X?"default":"outline",size:"sm",onClick:()=>te(X),className:"text-xs h-7",children:X},X))}):null})(),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"ðŸ’¡ Drag the note groups in the visualization above to rearrange beat grouping for this irregular time signature."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{id:"hide-timesig",checked:y,onCheckedChange:S}),e.jsx(W,{htmlFor:"hide-timesig",className:"text-sm cursor-pointer",children:"Hide in player mode (show only in edit mode)"})]})]}),s==="section"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"section-type",children:"Section Type"}),e.jsxs(Ee,{value:C,onValueChange:w,children:[" ",e.jsx(Ae,{id:"section-type",children:e.jsx(Fe,{})})," ",e.jsx(De,{children:cn.map(v=>e.jsx(ye,{value:v.value,children:v.label},v.value))})," "]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"section-label",children:"Section Label"}),e.jsx(Me,{id:"section-label",value:b,onChange:v=>M(v.target.value)})]})]}),s==="chord"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 border p-4 rounded-md",children:[e.jsx(W,{className:"text-base font-medium",children:"Chord Builder"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"root-note",className:"text-xs text-muted-foreground",children:"Root"}),e.jsxs(Ee,{value:N,onValueChange:E,children:[e.jsx(Ae,{id:"root-note",children:e.jsx(Fe,{})}),e.jsx(De,{children:Ut.map(v=>e.jsx(ye,{value:v,children:v},v))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"accidental",className:"text-xs text-muted-foreground",children:"Accidental"}),e.jsxs(Ee,{value:z,onValueChange:V,children:[e.jsx(Ae,{id:"accidental",children:e.jsx(Fe,{})}),e.jsx(De,{children:js.map(v=>e.jsx(ye,{value:v.value,children:v.label},v.value))})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"quality",className:"text-xs text-muted-foreground",children:"Quality"}),e.jsxs(Ee,{value:R,onValueChange:ie,children:[e.jsx(Ae,{id:"quality",children:e.jsx(Fe,{})}),e.jsx(De,{children:ys.map(v=>e.jsx(ye,{value:v.value,children:v.label},v.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"extension",className:"text-xs text-muted-foreground",children:"Extension"}),e.jsxs(Ee,{value:de,onValueChange:U,children:[e.jsx(Ae,{id:"extension",children:e.jsx(Fe,{})}),e.jsx(De,{children:ws.map(v=>e.jsx(ye,{value:v.value,children:v.label},v.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"bass-note",className:"text-xs text-muted-foreground",children:"Bass Note"}),e.jsxs(Ee,{value:Z||"none",onValueChange:v=>L(v==="none"?"":v),children:[e.jsx(Ae,{id:"bass-note",children:e.jsx(Fe,{placeholder:"None"})}),e.jsxs(De,{children:[e.jsx(ye,{value:"none",children:"None"}),Ut.map(v=>e.jsxs(H.Fragment,{children:[e.jsx(ye,{value:v,children:v}),e.jsx(ye,{value:`${v}#`,children:`${v}â™¯`}),e.jsx(ye,{value:`${v}b`,children:`${v}â™­`})]},v))]})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx(W,{className:"text-xs text-muted-foreground",children:"Generated Chord"}),e.jsx("p",{className:"text-lg font-semibold",children:j||"-"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{type:"button",variant:"outline",onClick:()=>le(!be),className:"w-full",children:[" ",e.jsx(Sr,{className:"w-4 h-4 mr-2"})," ",be?"Hide":"Customize"," Diagrams "]}),be&&e.jsxs("div",{className:"border rounded-md p-4 space-y-4",children:[" ",e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"capo",children:"Capo Fret"}),e.jsx(Me,{id:"capo",type:"number",min:"0",max:"12",value:_,onChange:v=>K(parseInt(v.target.value)||0)})]})," ",e.jsxs(cs,{defaultValue:"guitar",children:[e.jsxs(ds,{className:"grid w-full grid-cols-3",children:[" ",e.jsx(Ze,{value:"guitar",children:"Guitar"})," ",e.jsx(Ze,{value:"ukulele",children:"Ukulele"})," ",e.jsx(Ze,{value:"piano",children:"Piano"})," "]}),e.jsxs(Ye,{value:"guitar",className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"guitar-start-fret",children:"Start Fret"}),e.jsx(Me,{id:"guitar-start-fret",type:"number",min:"1",max:"15",value:me,onChange:v=>ce(parseInt(v.target.value)||1)})]}),e.jsx(Xr,{frets:J,fingers:Q,startFret:me,onChange:(v,F)=>{ee(v),se(F)}})]}),e.jsxs(Ye,{value:"ukulele",className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{htmlFor:"ukulele-start-fret",children:"Start Fret"}),e.jsx(Me,{id:"ukulele-start-fret",type:"number",min:"1",max:"15",value:A,onChange:v=>D(parseInt(v.target.value)||1)})]}),e.jsx(Zr,{frets:Se,fingers:$,startFret:A,onChange:(v,F)=>{O(v),T(F)}})]}),e.jsxs(Ye,{value:"piano",className:"mt-4 space-y-3",children:[" ",e.jsx(Yr,{keys:B,onChange:G})," "]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[i&&e.jsxs(P,{variant:"destructive",onClick:ze,className:"mr-auto",children:[e.jsx(Lt,{className:"w-4 h-4 mr-2"})," Delete"]}),e.jsx(P,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsx(P,{onClick:$e,children:i?"Update":e.jsxs(e.Fragment,{children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Add"]})})]})]})})}const Yt=({numerator:t,denominator:r,subdivision:s,onSubdivisionChange:n})=>{const o=ks(t,r,s),{grouping:l,type:a}=o,[i,u]=H.useState(l),[h,c]=H.useState(null),[d,m]=H.useState(null);H.useEffect(()=>{u(l)},[JSON.stringify(l)]);const p=60,f=50,g=40,y=35,S=(w,j)=>{a!=="irregular"||!n||(c(j),w.dataTransfer.effectAllowed="move")},b=(w,j)=>{if(w.preventDefault(),a!=="irregular"||!n||h===null||h===j)return;const k=[...i],[N]=k.splice(h,1);k.splice(j,0,N),u(k),c(j)},M=w=>{if(w.preventDefault(),a!=="irregular"||!n||h===null)return;c(null);const j=i.join("+");j!==s&&n(j)};return a==="irregular"&&n?e.jsxs("div",{className:"w-full p-4 bg-[#171717] rounded-md border border-[#2B2B2B] space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-lg",children:"âœ‹"}),e.jsx("span",{children:"Drag beat groups to rearrange the meter pattern"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-[#1F1F1F] border border-[#333] rounded px-3 py-2",children:[e.jsx("span",{className:"text-2xl font-bold leading-none",children:t}),e.jsx("div",{className:"w-full h-[1px] bg-[#444] my-0.5"}),e.jsx("span",{className:"text-2xl font-bold leading-none",children:r})]}),e.jsx("div",{className:"text-2xl text-muted-foreground",children:"="}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:i.map((w,j)=>e.jsxs("div",{draggable:!0,onDragStart:k=>S(k,j),onDragEnter:k=>b(k,j),onDragEnd:M,onDragOver:k=>k.preventDefault(),className:`
                  flex items-center justify-center gap-1 px-4 py-3 rounded-lg border-2
                  transition-all duration-200 select-none
                  ${h===j?"opacity-40 scale-95 border-blue-500/50 bg-blue-500/10":"opacity-100 scale-100 border-[#333] bg-[#1F1F1F] hover:border-blue-500/30 hover:bg-[#252525]"}
                  cursor-move
                `,children:[e.jsx("span",{className:"text-xl font-bold",children:w}),e.jsx("span",{className:"text-xs text-muted-foreground",children:w===3?"â™©.":w===2?"â™©":"â™ª"})]},j))})]}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground",children:["Pattern: ",i.join(" + ")," = ",t]})]}):e.jsx("div",{className:"w-full overflow-x-auto p-4 bg-[#171717] rounded-md border border-[#2B2B2B]",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("svg",{height:"80",width:Math.max(300,f+i.length*p+40),children:[e.jsx("line",{x1:"0",y1:g,x2:"100%",y2:g,stroke:"#444",strokeWidth:"1"}),e.jsx("text",{x:"10",y:g-5,fontFamily:"serif",fontSize:"24",fontWeight:"bold",fill:"#e5e5e5",children:t}),e.jsx("text",{x:"10",y:g+20,fontFamily:"serif",fontSize:"24",fontWeight:"bold",fill:"#e5e5e5",children:r}),i.map((w,j)=>{const k=f+40+j*p,N=[];let E=!0,z=!0,V=!1,R=!1;return r===8?w===3?(E=!0,z=!0,R=!0,V=!1):w===2?(E=!0,z=!0,R=!1,V=!1):(E=!0,z=!0,R=!1,V=!0):r===4?w===3?(E=!1,z=!0,R=!0,V=!1):w===2?(E=!1,z=!0,R=!1,V=!1):(E=!0,z=!0,R=!1,V=!1):r===2?w===1&&(E=!1,z=!0,R=!1,V=!1):r===1&&w===1&&(E=!1,z=!1,R=!1,V=!1),E?N.push(e.jsx("ellipse",{cx:k,cy:g,rx:"6",ry:"5",fill:"#e5e5e5",transform:`rotate(-15 ${k} ${g})`},`head-${j}`)):N.push(e.jsx("ellipse",{cx:k,cy:g,rx:"6",ry:"5",fill:"none",stroke:"#e5e5e5",strokeWidth:"2",transform:`rotate(-15 ${k} ${g})`},`head-${j}`)),z&&N.push(e.jsx("line",{x1:k+5,y1:g,x2:k+5,y2:g-y,stroke:"#e5e5e5",strokeWidth:"1.5"},`stem-${j}`)),R&&N.push(e.jsx("circle",{cx:k+12,cy:g,r:"2",fill:"#e5e5e5"},`dot-${j}`)),V&&N.push(e.jsx("path",{d:`M${k+5},${g-y} Q${k+15},${g-y+10} ${k+10},${g-y+25}`,fill:"none",stroke:"#e5e5e5",strokeWidth:"2"},`flag-${j}`)),e.jsx("g",{children:N},j)})]})})})},un=({chord:t,customData:r})=>{const s=Je[t],{frets:n,fingers:o,startFret:l=1}=r||s?.guitar||{frets:[0,0,0,0,0,0],fingers:[0,0,0,0,0,0]},a=l;if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const i=["E","A","D","G","B","e"],u=()=>{bs(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:u,className:"mb-3 gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"200",height:"280",viewBox:"0 0 200 280",className:"mb-2",children:[[...Array(5)].map((h,c)=>e.jsx("line",{x1:"40",y1:60+c*40,x2:"160",y2:60+c*40,stroke:"#666",strokeWidth:c===0&&a===1?"4":"2"},`fret-${c}`)),[...Array(6)].map((h,c)=>e.jsx("line",{x1:40+c*24,y1:"60",x2:40+c*24,y2:"220",stroke:"#666",strokeWidth:"2"},`string-${c}`)),a>1&&e.jsxs("text",{x:"20",y:"65",fontSize:"14",fill:"#666",children:[a,"fr"]}),i.map((h,c)=>e.jsx("text",{x:40+c*24,y:"250",fontSize:"12",fill:"#666",textAnchor:"middle",children:h},`label-${c}`)),n.map((h,c)=>{const d=40+c*24;if(h===-1)return e.jsxs("g",{children:[e.jsx("line",{x1:d-4,y1:"36",x2:d+4,y2:"44",stroke:"#999",strokeWidth:"2"}),e.jsx("line",{x1:d+4,y1:"36",x2:d-4,y2:"44",stroke:"#999",strokeWidth:"2"})]},`marker-${c}`);if(h===0)return e.jsx("circle",{cx:d,cy:"40",r:"6",fill:"none",stroke:"#666",strokeWidth:"2"},`marker-${c}`);{const m=h-a+1;if(m>=1&&m<=5){const p=60+(m-.5)*40,f=o?.[c];return e.jsxs("g",{children:[e.jsx("circle",{cx:d,cy:p,r:"10",fill:"#2563eb"}),f&&f>0&&e.jsx("text",{x:d,y:p+4,fontSize:"12",fill:"white",textAnchor:"middle",children:f})]},`marker-${c}`)}return null}})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Finger positions: ",o?.filter(h=>h>0).join(", ")||"N/A"]})]})},mn=({chord:t,customData:r})=>{const s=Je[t],{keys:n}=r||s?.piano||{keys:["C","E","G"]};if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=["C#","D#","F#","G#","A#"],a=()=>{gs(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:a,className:"mb-3 gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"400",height:"180",viewBox:"0 0 400 180",className:"mb-2",children:[o.filter(i=>!l.includes(i)).map((i,u)=>{const h=20+u*50,c=n.includes(i);return e.jsx("rect",{x:h,y:"20",width:"48",height:"140",fill:c?"#2563eb":"white",stroke:"#333",strokeWidth:"2",rx:"4"},`white-${i}`)}),o.filter(i=>l.includes(i)).map(i=>{const h=20+(o.indexOf(i)-Math.floor((o.indexOf(i)+1)/2))*50+35,c=n.includes(i);return e.jsx("rect",{x:h,y:"20",width:"26",height:"90",fill:c?"#1e40af":"#333",stroke:"#000",strokeWidth:"2",rx:"3"},`black-${i}`)}),o.filter(i=>!l.includes(i)).map((i,u)=>{const h=20+u*50+24;return e.jsx("text",{x:h,y:"150",fontSize:"14",fill:n.includes(i)?"white":"#666",textAnchor:"middle",children:i},`label-${i}`)})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Notes: ",n.join(" - ")]})]})},hn=({chord:t,customData:r})=>{const s=Je[t],{frets:n,fingers:o,startFret:l=1}=r||s?.ukulele||{frets:[0,0,0,0],fingers:[0,0,0,0]};if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const a=["G","C","E","A"],i=()=>{vs(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:i,className:"mb-3 gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"160",height:"280",viewBox:"0 0 160 280",className:"mb-2",children:[[...Array(5)].map((u,h)=>e.jsx("line",{x1:"40",y1:60+h*40,x2:"136",y2:60+h*40,stroke:"#666",strokeWidth:h===0&&l===1?"4":"2"},`fret-${h}`)),[...Array(4)].map((u,h)=>e.jsx("line",{x1:40+h*32,y1:"60",x2:40+h*32,y2:"220",stroke:"#666",strokeWidth:"2"},`string-${h}`)),l>1&&e.jsxs("text",{x:"20",y:"65",fontSize:"14",fill:"#666",children:[l,"fr"]}),a.map((u,h)=>e.jsx("text",{x:40+h*32,y:"250",fontSize:"12",fill:"#666",textAnchor:"middle",children:u},`label-${h}`)),n.map((u,h)=>{const c=40+h*32;if(u===0)return e.jsx("circle",{cx:c,cy:"40",r:"6",fill:"none",stroke:"#666",strokeWidth:"2"},`marker-${h}`);{const d=u-l+1;if(d>=1&&d<=5){const m=60+(d-.5)*40,p=o?.[h];return e.jsxs("g",{children:[e.jsx("circle",{cx:c,cy:m,r:"10",fill:"#2563eb"}),p&&p>0&&e.jsx("text",{x:c,y:m+4,fontSize:"12",fill:"white",textAnchor:"middle",children:p})]},`marker-${h}`)}return null}})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Finger positions: ",o?.filter(u=>u>0).join(", ")||"N/A"]})]})};function xn({chord:t,isOpen:r,onClose:s,customDiagram:n}){return e.jsx(lt,{open:r,onOpenChange:s,children:e.jsxs(ct,{className:"max-w-2xl",children:[e.jsxs(dt,{children:[e.jsxs(ut,{className:"text-2xl",children:[t," Chord",n?.capo&&n.capo>0&&e.jsxs("span",{className:"ml-3 text-lg text-orange-600",children:["Capo ",n.capo]})]}),e.jsxs(mt,{children:["View chord diagrams for guitar, piano, and ukulele",n&&e.jsx("span",{className:"ml-2 text-blue-600",children:"(Custom)"})]})]}),e.jsxs(cs,{defaultValue:"guitar",className:"w-full",children:[e.jsxs(ds,{className:"grid w-full grid-cols-3",children:[e.jsx(Ze,{value:"guitar",children:"Guitar"}),e.jsx(Ze,{value:"piano",children:"Piano"}),e.jsx(Ze,{value:"ukulele",children:"Ukulele"})]}),e.jsx(Ye,{value:"guitar",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(un,{chord:t,customData:n?.guitar})}),e.jsx(Ye,{value:"piano",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(mn,{chord:t,customData:n?.piano})}),e.jsx(Ye,{value:"ukulele",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(hn,{chord:t,customData:n?.ukulele})})]})]})})}function Cs({className:t,...r}){return e.jsx("textarea",{"data-slot":"textarea",className:Te("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...r})}function fn({open:t,onOpenChange:r,trackName:s,notes:n,onSave:o}){const[l,a]=x.useState(n);H.useEffect(()=>{a(n)},[n,t]);const i=()=>{o(l),r(!1)};return e.jsx(lt,{open:t,onOpenChange:r,children:e.jsxs(ct,{style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},children:[e.jsxs(dt,{children:[e.jsx(ut,{style:{color:"#F1F1F1"},children:"Track Notes"}),e.jsxs(mt,{style:{color:"#9E9E9E"},children:["Add notes for ",s]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Cs,{placeholder:"Enter your notes here...",value:l,onChange:u=>a(u.target.value),rows:6,style:{backgroundColor:"var(--daw-control)",borderColor:"var(--daw-border)",color:"#F1F1F1"}}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"ghost",onClick:()=>r(!1),style:{color:"#9E9E9E"},children:"Cancel"}),e.jsx(P,{onClick:i,style:{backgroundColor:"#3B82F6",color:"#FFFFFF"},children:"Save Notes"})]})]})]})})}const pn=({start:t,end:r,onChange:s,minWidth:n=.01,className:o})=>{const l=x.useRef(null),[a,i]=x.useState(null),u=x.useCallback(p=>{if(!l.current)return 0;const f=l.current.getBoundingClientRect(),g=p-f.left;return Math.max(0,Math.min(1,g/f.width))},[]),h=(p,f)=>{p.preventDefault(),p.stopPropagation(),i({type:f,startX:p.clientX,initialStart:t,initialEnd:r})};x.useEffect(()=>{if(!a)return;const p=g=>{if(!l.current)return;const S=l.current.getBoundingClientRect().width;let b=a.initialStart,M=a.initialEnd;if(a.type==="pan"){const w=(g.clientX-a.startX)/S;if(b=a.initialStart+w,M=a.initialEnd+w,b<0){const j=0-b;b+=j,M+=j}if(M>1){const j=1-M;b+=j,M+=j}b=Math.max(0,Math.min(1-(a.initialEnd-a.initialStart),b)),M=Math.min(1,Math.max(a.initialEnd-a.initialStart,M))}else if(a.type==="left"){const C=u(g.clientX);b=Math.min(C,a.initialEnd-n),b=Math.max(0,b),M=a.initialEnd}else if(a.type==="right"){const C=u(g.clientX);M=Math.max(C,a.initialStart+n),M=Math.min(1,M),b=a.initialStart}(Math.abs(b-t)>1e-4||Math.abs(M-r)>1e-4)&&s({start:b,end:M})},f=()=>{i(null)};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",f)}},[a,t,r,n,s,u]);const c=p=>{if(p.target!==l.current)return;p.preventDefault(),p.stopPropagation();const f=u(p.clientX),g=r-t;let y=f-g/2,S=f+g/2;y<0&&(y=0,S=g),S>1&&(S=1,y=1-g),s({start:y,end:S})},d=t*100,m=(r-t)*100;return e.jsxs("div",{ref:l,onClick:c,className:Te("relative w-full select-none touch-none flex items-center border border-white/10 rounded-full cursor-pointer",o),style:{backgroundColor:"#18181b",height:"14px"},children:[e.jsx("div",{className:"absolute top-0 bottom-0 rounded-full group transition-colors cursor-grab active:cursor-grabbing hover:brightness-110",style:{left:`${d}%`,width:`${m}%`,backgroundColor:"#52525b",border:"1px solid #71717a",boxSizing:"border-box"},onMouseDown:p=>h(p,"pan")}),e.jsx("div",{className:"absolute top-1/2 w-6 h-6 cursor-ew-resize z-20 group/handle",style:{left:`${d}%`,transform:"translate(-50%, -50%)"},onMouseDown:p=>h(p,"left"),children:e.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full shadow-sm transition-transform hover:scale-150",style:{transform:"translate(-50%, -50%)"}})}),e.jsx("div",{className:"absolute top-1/2 w-6 h-6 cursor-ew-resize z-20 group/handle",style:{left:`${r*100}%`,transform:"translate(-50%, -50%)"},onMouseDown:p=>h(p,"right"),children:e.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full shadow-sm transition-transform hover:scale-150",style:{transform:"translate(-50%, -50%)"}})})]})},gn=({start:t,end:r,onChange:s,minHeight:n=.01,className:o})=>{const l=x.useRef(null),[a,i]=x.useState(null),u=x.useCallback(p=>{if(!l.current)return 0;const f=l.current.getBoundingClientRect(),g=p-f.top;return Math.max(0,Math.min(1,g/f.height))},[]),h=p=>{p.preventDefault(),p.stopPropagation(),i({startY:p.clientY,initialStart:t,initialEnd:r})};x.useEffect(()=>{if(!a)return;const p=g=>{if(!l.current)return;const S=l.current.getBoundingClientRect().height,M=(g.clientY-a.startY)/S;let C=a.initialStart+M,w=a.initialEnd+M;if(C<0){const j=0-C;C+=j,w+=j}if(w>1){const j=1-w;C+=j,w+=j}C=Math.max(0,Math.min(1-(a.initialEnd-a.initialStart),C)),w=Math.min(1,Math.max(a.initialEnd-a.initialStart,w)),(Math.abs(C-t)>1e-4||Math.abs(w-r)>1e-4)&&s({start:C,end:w})},f=()=>{i(null)};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",f)}},[a,t,r,s]);const c=p=>{if(p.target!==l.current)return;p.preventDefault(),p.stopPropagation();const f=u(p.clientY),g=r-t;let y=f-g/2,S=f+g/2;y<0&&(y=0,S=g),S>1&&(S=1,y=1-g),s({start:y,end:S})},d=t*100,m=(r-t)*100;return e.jsx("div",{ref:l,onClick:c,className:Te("relative h-full select-none touch-none flex justify-center border border-white/10 rounded-full cursor-pointer",o),style:{backgroundColor:"#18181b",width:"14px"},children:e.jsx("div",{className:"absolute left-0 right-0 rounded-full transition-colors cursor-grab active:cursor-grabbing hover:brightness-110",style:{top:`${d}%`,height:`${m}%`,backgroundColor:"#52525b",border:"1px solid #71717a",boxSizing:"border-box"},onMouseDown:h})})},bn=x.createContext(void 0),vn=({children:t,value:r})=>e.jsx(bn.Provider,{value:r,children:t}),Mt=new WeakMap;function jn(t,r){if(Mt.has(t))return Mt.get(t);const s=[...t].sort((i,u)=>i.time-u.time),n=[];let o=0,l=0;for(let i=0;i<s.length;i++)s[i].time>l;const a=[...s];(a.length===0||a[0].time>0)&&a.unshift({time:0,tempo:r}),o=0;for(let i=0;i<a.length;i++){const u=a[i],h=i<a.length-1?a[i+1].time:Number.MAX_VALUE;if(n.push({startTime:u.time,endTime:h,audioStartTime:o,tempo:u.tempo}),h!==Number.MAX_VALUE){const c=h-u.time,d=r/u.tempo;o+=c*d}}return Mt.set(t,n),n}function yn(t,r,s,n){if(!n||r.length===0)return t;const o=jn(r,s);let l=0,a=o.length-1,i=null;for(;l<=a;){const u=Math.floor((l+a)/2),h=o[u];if(t>=h.startTime&&t<h.endTime){i=h;break}else t<h.startTime?a=u-1:l=u+1}if(!i&&o.length>0&&(i=o[o.length-1]),i){const u=t-i.startTime,h=s/i.tempo;return i.audioStartTime+u*h}return t}function Qt(t,r,s){let n=0,o=0;const a=[{time:0,tempo:s},...r].sort((d,m)=>d.time-m.time).filter((d,m,p)=>m===0||d.time>p[m-1].time);for(let d=1;d<a.length;d++){const m=a[d],p=m.time-o,f=a[d-1].tempo,g=s/f,y=p*g;if(t<n+y){const b=(t-n)/g;return o+b}n+=y,o=m.time}const i=a[a.length-1]?.tempo||s,u=s/i,c=(t-n)/u;return o+c}function wn(){return Pe.getMetronomeFrequencies()}function Ba(t){Pe.setMetronomeFrequencies(t)}function $a(){try{Pe.setMetronomeFrequencies({strongBeat:1e3,normalBeat:800,subdivision:600})}catch{console.warn("Failed to reset metronome frequencies")}}function kn(t,r,s=.5,n=!1,o,l){const a=t,i=l!==void 0?l:a.currentTime,u=a.createOscillator(),h=a.createGain(),c=wn();let d;n?d=c.subdivision:r?d=c.strongBeat:d=c.normalBeat,u.frequency.setValueAtTime(d,i),h.gain.setValueAtTime(s,i),h.gain.exponentialRampToValueAtTime(.001,i+.05),u.connect(h),h.connect(a.destination),u.start(i),u.stop(i+.05)}function _t(t){return!t||!t.trim()?[]:t.split("+").map(r=>parseInt(r.trim())).filter(r=>!isNaN(r)&&r>0)}function Cn(t,r){if(r)return _t(r).length;const[s,n]=t.split("/").map(Number);return n===8&&[6,9,12].includes(s)?s/3:s}function Nn(t,r){const s=_t(r);if(s.length===0)return{groupIndex:0,beatInGroup:1,isGroupStart:!0};let n=0,o=(t-1)%s.reduce((l,a)=>l+a,0)+1;for(let l=0;l<s.length;l++){if(o<=n+s[l])return{groupIndex:l,beatInGroup:o-n,isGroupStart:o===n+1};n+=s[l]}return{groupIndex:0,beatInGroup:1,isGroupStart:!0}}const Tn=({song:t,initialTempo:r=100,initialMetronomeVolume:s=.5,warpModeEnabled:n=!0})=>{const{resumeAudioContext:o,getAudioContext:l}=Kr(),[a,i]=x.useState(!1),[u,h]=x.useState(0),[c,d]=x.useState(0),[m,p]=x.useState(r),[f,g]=x.useState(!1),[y,S]=x.useState(null),[b,M]=x.useState(null),[C,w]=x.useState(!1),[j,k]=x.useState(s),N=x.useRef(0),E=x.useRef(0),z=x.useRef(new Set),V=t?.tempoChanges||[{time:0,tempo:t?.tempo||120,timeSignature:"4/4"}],R=x.useRef(new Map),ie=x.useRef(new Map),de=x.useRef(null),U=x.useRef(m),Z=x.useRef(C),L=x.useRef(j),be=x.useRef(f),le=x.useRef(y),J=x.useRef(b),ee=x.useRef(0),Q=x.useRef(0);x.useEffect(()=>{U.current=m},[m]),x.useEffect(()=>{Z.current=C},[C]),x.useEffect(()=>{L.current=j},[j]),x.useEffect(()=>{be.current=f},[f]),x.useEffect(()=>{le.current=y},[y]),x.useEffect(()=>{J.current=b},[b]);const se=x.useCallback(O=>t?yn(O,V,t.tempo,n):O,[t,V,n]),me=x.useCallback(O=>{if(!t)return;const $=Math.max(0,Math.min(O,t.duration)),T=se($),A=l();ee.current=A.currentTime,Q.current=T,d($),h(T),N.current=0,R.current.forEach(D=>{D.currentTime=T})},[t,se,l]),ce=x.useCallback(()=>{i(O=>!O)},[]),Se=x.useCallback(()=>{i(!1),me(0)},[me]);return x.useEffect(()=>{if(!t)return;const O=l(),$=new Map,T=new Map;for(const A of t.tracks){if(!A.url)continue;const D=new Audio(A.url);D.preload="auto",D.crossOrigin="anonymous";const B=O.createGain(),G=O.createMediaElementSource(D);G.connect(B),B.connect(O.destination),B.gain.value=A.muted?0:A.volume,$.set(A.id,D),T.set(A.id,{gainNode:B,source:G})}return R.current=$,ie.current=T,()=>{$.forEach(A=>{A.pause(),A.src=""}),T.forEach(({gainNode:A,source:D})=>{D.disconnect(),A.disconnect()}),R.current.clear(),ie.current.clear()}},[t?.id,l]),x.useEffect(()=>{if(!t)return;const O=t.tracks.some($=>$.solo);t.tracks.forEach($=>{const T=ie.current.get($.id);if(!T)return;const{gainNode:A}=T;let D=0;O?D=$.solo&&!$.muted?$.volume:0:D=$.muted?0:$.volume,A.gain.value=D})},[t?.tracks]),x.useEffect(()=>{a&&o()},[a,o]),x.useEffect(()=>()=>{de.current&&de.current.terminate()},[]),x.useEffect(()=>{if(!a||!t)return;const O=l(),$=.2;let T=null;ee.current=O.currentTime,Q.current=u;const A=G=>{let _=V[0];for(const K of V)if(K.time<=G)_=K;else break;if(_.curve&&G>=_.time&&G<=_.curve.targetTime){const K=_.tempo,q=_.curve.targetTempo,te=_.curve.targetTime-_.time,ue=(G-_.time)/te;let re=K;if(_.curve.type==="linear")re=K+(q-K)*ue;else if(_.curve.type==="exponential"){const he=1-Math.pow(1-ue,2);re=K+(q-K)*he}return{..._,tempo:re}}return _};R.current.forEach(G=>{G.currentTime=u,G.playbackRate=m/100,G.play().catch(_=>console.warn("Audio play failed:",_))});const D=()=>{const G=O.currentTime,_=U.current,K=be.current,q=le.current,te=J.current;Z.current,L.current;const ue=(G-ee.current)*(_/100),re=Q.current+ue,he=Qt(re,V,t.tempo);R.current.forEach(Y=>{Math.abs(Y.currentTime-re)>.02&&(Y.currentTime=re),Math.abs(Y.playbackRate-_/100)>.01&&(Y.playbackRate=_/100)});const xe=K&&q!==null?se(q):0,we=K&&te!==null?se(te):t.duration;re>=we?K?(ee.current=O.currentTime,Q.current=xe,N.current=0,E.current=0,z.current.clear(),d(q!==null?q:0),h(xe),R.current.forEach(Y=>{Y.currentTime=xe})):(i(!1),N.current=0,E.current=0,z.current.clear(),d(0),h(0),R.current.forEach(Y=>{Y.pause(),Y.currentTime=0})):(h(re),d(he)),T=requestAnimationFrame(D)},B=de.current;return B&&(B.onmessage=()=>{if(Z.current){const G=l(),_=G.currentTime,K=_+$,q=U.current;(E.current===0||E.current<_)&&(E.current=_+.05,z.current.clear());const te=(_-ee.current)*(q/100),ue=Q.current+te,re=Qt(ue,V,t.tempo);for(;E.current<K;){const he=E.current,xe=A(re),Y=60/(xe.tempo*(q/100)),ne=Math.floor(re/Y);if(!z.current.has(ne)){const Oe=xe.timeSignature||"4/4",Re=xe.subdivision,st=Cn(Oe,Re);let Be=!1;if(Re){const ze=_t(Re).reduce((rt,v)=>rt+v,0),_e=ne%ze+1;Be=Nn(_e,Re).isGroupStart}else Be=ne%st+1===1;if(kn(G,Be,L.current,!1,void 0,he),z.current.add(ne),z.current.size>100){const $e=Array.from(z.current).sort((ze,_e)=>ze-_e);z.current=new Set($e.slice(-50))}}E.current+=Y}}},B.postMessage({action:"start",interval:25})),T=requestAnimationFrame(D),()=>{T!==null&&cancelAnimationFrame(T),B&&B.postMessage({action:"stop"}),R.current.forEach(G=>{G.pause()})}},[a,t,V,se,l]),{isPlaying:a,currentTime:u,gridTime:c,tempo:m,loopEnabled:f,loopStart:y,loopEnd:b,metronomeEnabled:C,metronomeVolume:j,actions:{togglePlayPause:ce,stop:Se,seek:me,setTempo:p,setLoopEnabled:g,setLoopStart:S,setLoopEnd:M,setMetronomeEnabled:w,setMetronomeVolume:k}}},Sn=({isPlaying:t,onPlayPause:r,onStop:s,onZoomIn:n,onZoomOut:o,onToggleLoop:l,onToggleMetronome:a,onGoToStart:i,onGoToEnd:u,onFitToView:h,onToggleEditMode:c,onToggleHelp:d,disabled:m=!1})=>{const p=x.useCallback(f=>{if(m)return;const g=f.target;if(!(g.tagName==="INPUT"||g.tagName==="TEXTAREA"||g.isContentEditable))switch(f.code){case"Space":f.preventDefault(),r();break;case"KeyS":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),s());break;case"Home":f.preventDefault(),i();break;case"End":f.preventDefault(),u();break;case"Equal":case"NumpadAdd":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),n());break;case"Minus":case"NumpadSubtract":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),o());break;case"KeyL":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),l());break;case"KeyM":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),a());break;case"Slash":f.shiftKey&&(f.preventDefault(),d?.());break;case"KeyF":!f.ctrlKey&&!f.metaKey&&!f.altKey&&!f.shiftKey&&(f.preventDefault(),h?.());break;case"KeyE":!f.ctrlKey&&!f.metaKey&&!f.altKey&&!f.shiftKey&&(f.preventDefault(),c?.());break}},[m,t,r,s,n,o,l,a,i,u,h,c,d]);return x.useEffect(()=>(window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p)}),[p]),null},Mn=["time","measures","sections","chords","tempo"],En=()=>{const[t,r]=x.useState(()=>Pe.getTrackHeight()),[s,n]=x.useState(1),[o,l]=x.useState(()=>Pe.getRulerOrder()),[a,i]=x.useState(()=>{const w={};return Mn.forEach(j=>{w[j]=Pe.getRulerVisibility(j)}),w}),[u,h]=x.useState(!0),[c,d]=x.useState(!0),[m,p]=x.useState(!1),[f,g]=x.useState(!1);x.useEffect(()=>{Pe.setTrackHeight(t)},[t]),x.useEffect(()=>{Pe.setRulerOrder(o)},[o]);const y=x.useCallback((w,j)=>{i(k=>{const N={...k,[w]:j};return Pe.setRulerVisibility(w,j),N})},[]),S=x.useCallback(()=>{n(w=>Math.min(w+.5,8))},[]),b=x.useCallback(()=>{n(w=>Math.max(w-.5,.5))},[]),M=x.useCallback(w=>{n(Math.max(.5,Math.min(8,w)))},[]),C=x.useCallback(()=>{switch(t){case"small":return 80;case"large":return 180;default:return 120}},[t]);return{trackHeight:t,zoom:s,rulerVisibility:a,rulerOrder:o,sidebarVisible:u,mixerVisible:c,mixerDockVisible:m,notesPanelVisible:f,setTrackHeight:r,setZoom:n,setRulerVisibility:i,setRulerOrder:l,setSidebarVisible:h,setMixerVisible:d,setMixerDockVisible:p,setNotesPanelVisible:g,handleRulerVisibilityChange:y,handleZoomIn:S,handleZoomOut:b,handleZoomChange:M,getTrackHeightPx:C}};function An(t,r){let s=null;return(...n)=>{s&&clearTimeout(s),s=setTimeout(()=>t(...n),r)}}const Fn=(t,r)=>{const[s,n]=x.useState(t?.tracks||[]),[o,l]=x.useState(new Set),a=x.useRef(null),i=x.useRef(null);x.useEffect(()=>{const C=t?.id||null;C!==a.current&&t?.tracks&&(n(t.tracks),a.current=C)},[t?.id]);const u=x.useCallback(C=>{t&&r&&r({...t,...C})},[t,r]);x.useEffect(()=>{i.current=An(C=>{t&&r&&r({...t,...C})},100)},[t,r]);const h=x.useCallback((C,w)=>{const j=isNaN(w)||!isFinite(w)?1:Math.max(0,Math.min(10,w));if(n(k=>k.map(N=>N.id===C?{...N,volume:j}:N)),i.current){const k=s.map(N=>N.id===C?{...N,volume:j}:N);i.current({tracks:k})}},[s]),c=x.useCallback(C=>{n(w=>{const j=w.map(k=>k.id===C?{...k,muted:!k.muted}:k);return u({tracks:j}),j})},[u]),d=x.useCallback(C=>{n(w=>{const j=w.map(k=>k.id===C?{...k,solo:!k.solo}:k);return u({tracks:j}),j})},[u]),m=x.useCallback((C,w)=>{n(j=>{const k=j.map(N=>N.id===C?{...N,name:w}:N);return u({tracks:k}),k})},[u]),p=x.useCallback((C,w)=>{n(j=>{const k=j.map(N=>N.id===C?{...N,color:w}:N);return u({tracks:k}),k})},[u]),f=x.useCallback((C,w)=>{n(j=>{const k=j.map(N=>N.id===C?{...N,tag:w}:N);return u({tracks:k}),k})},[u]),g=x.useCallback((C,w)=>{n(j=>{const k=j.map(N=>N.id===C?{...N,notes:w}:N);return u({tracks:k}),k})},[u]),y=x.useCallback(C=>{l(w=>{const j=new Set(w);return j.has(C)?j.delete(C):j.add(C),j})},[]),S=x.useCallback(C=>{if(!t)return;const w={id:`preset-${Date.now()}`,name:C,tracks:s.filter(j=>!o.has(j.id)).map(j=>({trackId:j.id,volume:j.volume,muted:j.muted}))};if(r){const j=[...t.mixPresets||[],w];r({...t,mixPresets:j})}},[t,s,o,r]),b=x.useCallback(C=>{if(!t||!t.mixPresets)return;const w=t.mixPresets.find(N=>N.id===C);if(!w)return;const j=s.map(N=>{if(o.has(N.id))return N;const E=w.tracks.find(z=>z.trackId===N.id);return E?{...N,volume:E.volume,muted:E.muted}:N}),k=Pe.getMainInstrument();if(k){const N=j.findIndex(E=>E.tag===k);if(N>0){const[E]=j.splice(N,1);j.unshift(E)}}n(j),u({tracks:j})},[t,o,s,u]),M=x.useCallback(C=>{if(!t||!r)return;const w=(t.mixPresets||[]).filter(j=>j.id!==C);r({...t,mixPresets:w})},[t,r]);return{tracks:s,setTracks:n,pinnedTracks:o,isAnySolo:s.some(C=>C.solo),handlers:{handleTrackVolumeChange:h,handleTrackMuteToggle:c,handleTrackSoloToggle:d,handleTrackNameChange:m,handleTrackColorChange:p,handleTrackTagChange:f,handleSaveTrackNotes:g,handleToggleTrackPin:y},presetHandlers:{handleSavePreset:S,handleLoadPreset:b,handleDeletePreset:M}}};function Dn({song:t,onSongUpdate:r}){const s=Fn(t,r),n=s.handlers.handleTrackVolumeChange,o=s.handlers.handleTrackMuteToggle,l=s.handlers.handleTrackSoloToggle,a=s.handlers.handleTrackNameChange,i=s.handlers.handleTrackColorChange,u=s.handlers.handleTrackTagChange;return{handleTrackVolumeChange:n,handleTrackMuteToggle:o,handleTrackSoloToggle:l,handleTrackNameChange:a,handleTrackColorChange:i,handleTrackTagChange:u}}function Pn({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",scrollContainerRef:a,scrollPosRef:i,zoom:u=1}){const h=x.useRef(null),c=x.useRef(null),d=x.useRef({scrollLeft:-1,width:0,totalWidth:0,dataLen:-1,zoom:0}),m=x.useRef(0);x.useEffect(()=>{if(!a.current)return;const f=new ResizeObserver(g=>{for(const y of g)m.current=y.contentRect.width});return f.observe(a.current),m.current=a.current.clientWidth,()=>f.disconnect()},[a]);const p=x.useCallback(()=>{const f=performance.now(),g=h.current,y=a.current;if(!g||!y){c.current=requestAnimationFrame(p);return}const S=i?i.current:y.scrollLeft,b=m.current,M=window.devicePixelRatio||1,C=t?t.length:0;if(S===d.current.scrollLeft&&b===d.current.width&&r===d.current.totalWidth&&C===d.current.dataLen){c.current=requestAnimationFrame(p);return}d.current={scrollLeft:S,width:b,totalWidth:r,dataLen:C,zoom:0};const w=b*M,j=s*M;(g.width!==w||g.height!==j)&&(g.width=w,g.height=j,g.style.width=`${b}px`,g.style.height=`${s}px`),g.style.transform=`translateX(${S}px)`;const k=g.getContext("2d",{alpha:!0});if(!k)return;if(k.setTransform(1,0,0,1,0,0),k.scale(M,M),k.clearRect(0,0,b,s),!t||t.length===0){k.strokeStyle=n,k.globalAlpha=.5,k.lineWidth=2,k.beginPath(),k.moveTo(0,s/2),k.lineTo(b,s/2),k.stroke(),c.current=requestAnimationFrame(p);return}const N=t.length,E=r/N;if(r===0)return;const z=Math.floor(S/E),V=Math.ceil((S+b)/E),R=Math.max(0,z),ie=Math.min(N,V);if(R>=ie){c.current=requestAnimationFrame(p);return}const de=1/E,U=de>1?Math.floor(de):1,Z=s/2;k.fillStyle=n,k.globalAlpha=o,k.beginPath();const L=R*E-S;k.moveTo(L,Z);const be=(J,ee)=>{let Q=0;for(let se=J;se<Math.min(ee,N);se++)t[se]>Q&&(Q=t[se]);return Q};for(let J=R;J<ie;J+=U){const ee=U>1?be(J,J+U):t[J],Q=J*E-S,se=Math.max(.5,ee*Z*.95);k.lineTo(Q,Z-se)}for(let J=ie-1;J>=R;J-=U){const ee=U>1?be(J,J+U):t[J],Q=J*E-S,se=Math.max(.5,ee*Z*.95);k.lineTo(Q,Z+se)}k.closePath(),k.fill();const le=performance.now()-f;le>16&&console.warn(`[LOD Performance Main] Slow render: ${le.toFixed(2)}ms | Step: ${U} | Points: ${ie-R} | Zoom: ${u.toFixed(2)}`),c.current=requestAnimationFrame(p)},[t,r,s,n,o,u,a]);return x.useEffect(()=>(c.current=requestAnimationFrame(p),()=>{c.current&&cancelAnimationFrame(c.current)}),[p]),e.jsx("div",{className:"h-full w-full relative",children:e.jsx("canvas",{ref:h,className:l,style:{display:"block",position:"absolute",left:0,top:0,pointerEvents:"none",willChange:"transform"}})})}function Rn({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",scrollLeft:a=0,viewportWidth:i=1e3,zoom:u=1}){const h=x.useRef(null),c=x.useRef(null);x.useRef(null);const d=x.useRef(!1),m=!t||t.length===0;return x.useEffect(()=>{m||h.current},[m]),x.useEffect(()=>{!d.current||!c.current||m||c.current.postMessage({type:"updateData",data:t})},[t,m]),x.useEffect(()=>{!d.current||!c.current||m||c.current.postMessage({type:"updateMetrics",width:r,height:s})},[r,s,m]),x.useEffect(()=>{!d.current||!c.current||m||c.current.postMessage({type:"render",viewportWidth:i,scrollLeft:a,zoom:u})},[a,i,u,m]),e.jsxs("div",{className:"relative w-full h-full",children:[m&&e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{backgroundColor:`${n}15`,pointerEvents:"none"}}),e.jsx("canvas",{ref:h,className:l,style:{display:"block",width:"100%",height:"100%",backgroundColor:"transparent",pointerEvents:"none",opacity:m?0:1}})]})}const In=H.memo(Rn,(t,r)=>t.data===r.data&&t.width===r.width&&t.height===r.height&&t.fill===r.fill&&t.opacity===r.opacity&&t.scrollLeft===r.scrollLeft&&t.viewportWidth===r.viewportWidth&&t.zoom===r.zoom);In.displayName="WaveformCanvasOffscreenMemoized";function Ln({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",useCanvas:a=!0,scrollContainerRef:i,scrollPosRef:u,zoom:h=1}){return e.jsx(Pn,{data:t,width:r,height:s,fill:n,opacity:o,className:l,scrollContainerRef:i||{current:null},scrollPosRef:u,zoom:h})}const ae={BASE_PPS:50,MIN:.001,MAX:20,FACTOR:1.2},Ge={RULER_HEIGHT:32},Jt={LOW_ZOOM_THRESHOLD:.3,MEDIUM_ZOOM_THRESHOLD:1.5},Et={SIDEBAR_WIDTH:280};function On(t,r=1){const s=x.useCallback(()=>{if(r<Jt.LOW_ZOOM_THRESHOLD){const l=ft.getOverview(t);if(l&&l.length>0)return l}if(r<Jt.MEDIUM_ZOOM_THRESHOLD){const l=ft.getMedium(t);if(l&&l.length>0)return l}return ft.getWaveform(t)||[]},[t,r]),[n,o]=x.useState(()=>s());return x.useEffect(()=>{const l=ft.subscribe(()=>{o(s())}),a=s();return a.length>0&&o(a),l},[s]),n}const Ns=H.memo(({trackId:t,color:r,duration:s,pps:n,height:o,zoom:l,scrollContainerRef:a,scrollPosRef:i})=>{const u=On(t,l);return e.jsx("div",{className:"waveform-container",style:{height:"calc(100% - 20px)"},children:e.jsx(Ln,{data:u,width:s*n,height:o,fill:r||"#3b82f6",opacity:.8,useCanvas:!0,scrollContainerRef:a,scrollPosRef:i,zoom:l})})});Ns.displayName="TrackWaveformRenderer";const Ts=H.memo(H.forwardRef(({song:t,currentTime:r,zoom:s,pixelsPerSecond:n,filteredTracks:o,loopStart:l,loopEnd:a,trackHeightPx:i,onTimelineMouseDown:u,onTimelineMouseMove:h,onTimelineMouseUp:c,onScroll:d},m)=>{const p=x.useRef(null),f=x.useRef(0),g=x.useCallback(b=>{f.current=b.currentTarget.scrollLeft,d(b.currentTarget.scrollLeft)},[d]),y=n||s*100,S=l!==null&&a!==null?{left:`${l*y}px`,width:`${(a-l)*y}px`}:void 0;return e.jsx("div",{className:"timeline-tracks-container flex-1 overflow-auto relative scrollbar-hide",style:{backgroundColor:"var(--daw-bg-main)",overflowY:"auto",scrollbarWidth:"none",msOverflowStyle:"none"},ref:b=>{typeof m=="function"?m(b):m&&(m.current=b),p.current=b},onScroll:g,children:e.jsxs("div",{className:"relative",style:{width:`${t.duration*y}px`,height:`${Math.max(o.length*i,0)}px`,minHeight:"100%",paddingTop:0,paddingBottom:0},onClick:u,onMouseDown:u,onMouseMove:h,onMouseUp:c,onMouseLeave:c,children:[e.jsx("div",{className:"absolute top-0 z-50 pointer-events-none",style:{left:`${r*y}px`,height:"100%"},children:e.jsx("div",{className:"h-full",style:{width:"2px",backgroundColor:"#ef4444",boxShadow:"0 0 4px rgba(239, 68, 68, 0.4)"}})}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"linear-gradient(to right, var(--daw-grid) 1px, transparent 1px)",backgroundSize:"100px 100%",opacity:.3}}),S&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-yellow-500/10 border-l-2 border-r-2 border-yellow-500/50 z-10 pointer-events-none",style:S}),o.map((b,M)=>e.jsx("div",{className:"track-lane absolute left-0 right-0 border-b box-border",style:{top:0,height:`${i}px`,minHeight:`${i}px`,maxHeight:`${i}px`,transform:`translateY(${M*i}px)`,borderColor:"var(--daw-border)",borderBottomWidth:"1px"},children:e.jsxs("div",{className:"clip-box absolute rounded-md overflow-hidden border",style:{left:0,top:"2px",width:`${t.duration*y}px`,height:"calc(100% - 4px)",backgroundColor:`${b.color}20`,borderColor:`${b.color}40`,borderWidth:"1px"},children:[e.jsx("div",{className:"h-5 w-full flex items-center px-2",style:{backgroundColor:`${b.color}60`},children:e.jsx("span",{className:"text-[10px] text-white truncate font-medium drop-shadow",children:b.name})}),e.jsx(Ns,{trackId:b.id,color:b.color||"#3b82f6",duration:t.duration,pps:y,height:i-28,zoom:s,scrollContainerRef:p,scrollPosRef:f})]})},b.id))]})})}));Ts.displayName="TimelineContainer";const Bn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M6 20h12l-2-12H8l-2 12z"}),e.jsx("line",{x1:"12",y1:"8",x2:"14",y2:"13"}),e.jsx("circle",{cx:"14.5",cy:"14",r:"1.5"}),e.jsx("path",{d:"M5 20h14"})]}),es=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10"}),e.jsx("path",{d:"M12 2a10 10 0 0 0-10 10"}),e.jsx("path",{d:"M2 12a10 10 0 0 0 10 10"}),e.jsx("path",{d:"M22 12a10 10 0 0 1-10 10"}),e.jsx("path",{d:"M12 12l4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"5"}),e.jsx("line",{x1:"19",y1:"12",x2:"18",y2:"12"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"6",y2:"12"})]}),$n=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"6",y1:"4",x2:"6",y2:"20",strokeWidth:"1.5"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20",strokeWidth:"2"}),e.jsx("line",{x1:"18",y1:"4",x2:"18",y2:"20",strokeWidth:"1.5"}),e.jsx("circle",{cx:"9",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("path",{d:"M10.5 12h4.5"}),e.jsx("path",{d:"M13 10l2 2-2 2"})]}),zn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M17 2l4 4-4 4"}),e.jsx("path",{d:"M3 11v-1a9 9 0 0 1 9-9h9"}),e.jsx("path",{d:"M7 22l-4-4 4-4"}),e.jsx("path",{d:"M21 13v1a9 9 0 0 1-9 9H3"})]}),ts=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M10 8l6 4-6 4V8z",fill:"currentColor"})]}),ss=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M4 4v16",strokeWidth:"2.5"}),e.jsx("path",{d:"M4 4h12l-2 4 2 4H4"}),e.jsx("path",{d:"M17 15l2-2 2 2-3 3-2-2z"}),e.jsx("path",{d:"M16 18l-2 2"})]}),rs=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"4",y1:"7",x2:"20",y2:"7",strokeWidth:"1.5"}),e.jsx("path",{d:"M4 12 Q 12 9, 20 12",strokeWidth:"2"}),e.jsx("line",{x1:"4",y1:"17",x2:"20",y2:"17",strokeWidth:"1.5"}),e.jsx("line",{x1:"8",y1:"5",x2:"8",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("line",{x1:"16",y1:"5",x2:"16",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("circle",{cx:"12",cy:"9",r:"2",fill:"currentColor"})]}),_n=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"3",rx:"1"}),e.jsx("rect",{x:"3",y:"10",width:"18",height:"3",rx:"1"}),e.jsx("rect",{x:"3",y:"16",width:"18",height:"3",rx:"1"}),e.jsx("circle",{cx:"8",cy:"5.5",r:"0.8",fill:"currentColor"}),e.jsx("circle",{cx:"8",cy:"11.5",r:"0.8",fill:"currentColor"}),e.jsx("circle",{cx:"8",cy:"17.5",r:"0.8",fill:"currentColor"})]});function et({className:t,defaultValue:r,value:s,min:n=0,max:o=100,...l}){const a=x.useMemo(()=>Array.isArray(s)?s:Array.isArray(r)?r:[n,o],[s,r,n,o]);return e.jsxs(lr,{"data-slot":"slider",defaultValue:r,value:s,min:n,max:o,className:Te("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...l,children:[e.jsx(cr,{"data-slot":"slider-track",className:Te("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(dr,{"data-slot":"slider-range",className:Te("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:a.length},(i,u)=>e.jsx(ur,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},u))]})}function Vt({delayDuration:t=0,...r}){return e.jsx(mr,{"data-slot":"tooltip-provider",delayDuration:t,...r})}function fe({...t}){return e.jsx(Vt,{children:e.jsx(hr,{"data-slot":"tooltip",...t})})}function pe({...t}){return e.jsx(xr,{"data-slot":"tooltip-trigger",...t})}function ge({className:t,sideOffset:r=0,children:s,...n}){return e.jsx(fr,{children:e.jsxs(pr,{"data-slot":"tooltip-content",sideOffset:r,className:Te("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...n,children:[s,e.jsx(gr,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function bt({...t}){return e.jsx(br,{"data-slot":"dropdown-menu",...t})}function vt({...t}){return e.jsx(vr,{"data-slot":"dropdown-menu-trigger",...t})}function jt({className:t,sideOffset:r=4,...s}){return e.jsx(jr,{children:e.jsx(yr,{"data-slot":"dropdown-menu-content",sideOffset:r,className:Te("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...s})})}function At({className:t,inset:r,variant:s="default",...n}){return e.jsx(wr,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":s,className:Te("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function Vn({tempo:t,onTempoChange:r,keyShift:s,onKeyShiftChange:n,disabled:o,originalKey:l="C"}){const[a,i]=x.useState(0),u=s+a,h=Dt(l,s),c=Dt(l,u);return e.jsxs(bt,{children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(vt,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:d=>{d.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="var(--daw-control)"},disabled:o,children:e.jsx(es,{className:"w-5 h-5"})})})}),e.jsx(ge,{children:"Playback Settings"})]}),e.jsx(jt,{className:"w-96 p-4",style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},align:"end",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(es,{className:"w-4 h-4"}),"Speed"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:[t,"%"]}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>r(100),className:"h-6 px-2 text-xs",style:{backgroundColor:t===100?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(et,{value:[t],onValueChange:([d])=>r(d),min:50,max:150,step:1,className:"w-full",onDoubleClick:()=>r(100)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"}),e.jsx("span",{children:"150%"})]})]}),e.jsx(It,{style:{backgroundColor:"#3A3A3A"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",style:{color:"#F1F1F1"},children:"Key Information"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center p-3 rounded-md",style:{backgroundColor:"#1E1E1E",border:"1px solid #3A3A3A"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Original"}),e.jsx("div",{className:"text-lg",style:{color:"#F1F1F1"},children:l})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Playing"}),e.jsx("div",{className:"text-lg",style:{color:"#3B82F6"},children:h})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Display"}),e.jsx("div",{className:"text-lg",style:{color:a>0?"#22c55e":"#F1F1F1"},children:c})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(Mr,{className:"w-4 h-4"}),"Transpose"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:[s>0?"+":"",s," ",Math.abs(s)===1?"semitone":"semitones"]}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>n(0),className:"h-6 px-2 text-xs",style:{backgroundColor:s===0?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(et,{value:[s],onValueChange:([d])=>n(d),min:-12,max:12,step:1,className:"w-full",onDoubleClick:()=>n(0)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"-12"}),e.jsx("span",{children:"0"}),e.jsx("span",{children:"+12"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(Er,{className:"w-4 h-4"}),"Capo Position"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:["Fret ",a]}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>i(0),className:"h-6 px-2 text-xs",style:{backgroundColor:a===0?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(et,{value:[a],onValueChange:([d])=>i(d),min:0,max:12,step:1,className:"w-full",onDoubleClick:()=>i(0)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"6"}),e.jsx("span",{children:"12"})]}),e.jsx("div",{className:"text-xs",style:{color:"#9E9E9E"},children:a>0?`Chords shown are ${a} semitone${a>1?"s":""} higher (play as if no capo)`:"No capo - play chords as shown"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",style:{color:"#F1F1F1"},children:"Quick Presets"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>{r(75),n(0)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"Practice (75%)"}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>{r(100),n(0),i(0)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"Reset All"}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>{r(100),n(-2)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"-2 semitones"}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>{r(100),n(2)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"+2 semitones"})]})]})]})})]})}function Wn({trackHeight:t,onTrackHeightChange:r,rulerVisibility:s,onRulerVisibilityChange:n,rulerOrder:o=["time","measures","sections","chords","tempo"],onRulerOrderChange:l}){const{t:a}=tt(),[i,u]=x.useState(null),[h,c]=x.useState(null),d={time:{id:"time",label:a.time,visible:s.time},measures:{id:"measures",label:a.measures,visible:s.measures},sections:{id:"sections",label:a.sections,visible:s.sections},chords:{id:"chords",label:a.chords,visible:s.chords},tempo:{id:"tempo",label:a.tempo,visible:s.tempo}},m=o.map(b=>d[b]).filter(Boolean),p=(b,M)=>{const C={...s,[b]:M};n(C)},f=(b,M)=>{u(M),b.dataTransfer.setData("text/plain",M),b.dataTransfer.effectAllowed="move"},g=(b,M)=>{b.preventDefault(),b.dataTransfer.dropEffect="move",M!==h&&c(M)},y=(b,M)=>{b.preventDefault();const C=b.dataTransfer.getData("text/plain");if(!C||C===M)return;const w=[...o],j=w.indexOf(C),k=w.indexOf(M);if(j===-1||k===-1)return;const[N]=w.splice(j,1);w.splice(k,0,N),l&&l(w)},S=()=>{u(null),c(null)};return e.jsxs(bt,{children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(vt,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:b=>{b.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:b=>{b.currentTarget.style.backgroundColor="var(--daw-control)"},children:e.jsx(_n,{className:"w-5 h-5"})})})}),e.jsx(ge,{children:"View Settings"})]}),e.jsx(jt,{className:"w-72 p-4",style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"text-sm",style:{color:"#F1F1F1"},children:"Track Height"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{size:"sm",variant:t==="small"?"default":"outline",onClick:()=>r("small"),className:"flex-1",style:t==="small"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Small"}),e.jsx(P,{size:"sm",variant:t==="medium"?"default":"outline",onClick:()=>r("medium"),className:"flex-1",style:t==="medium"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Medium"}),e.jsx(P,{size:"sm",variant:t==="large"?"default":"outline",onClick:()=>r("large"),className:"flex-1",style:t==="large"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Large"})]})]}),e.jsx(It,{style:{backgroundColor:"#3A3A3A"}}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{className:"text-sm",style:{color:"#F1F1F1"},children:"Rulers"}),e.jsx("span",{className:"text-xs",style:{color:"#9E9E9E"},children:"Drag to reorder"})]}),e.jsx("div",{className:"space-y-1",children:m.map((b,M)=>e.jsxs("div",{draggable:!!l,onDragStart:C=>l&&f(C,b.id),onDragOver:C=>l&&g(C,b.id),onDrop:C=>l&&y(C,b.id),onDragEnd:S,onDragLeave:()=>c(null),className:Te("flex items-center justify-between p-2 rounded transition-all",l&&"cursor-move",i===b.id?"opacity-50 scale-95":"opacity-100",h===b.id&&i!==b.id&&"bg-blue-500/30"),style:{backgroundColor:"var(--daw-control)"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(ms,{className:"w-4 h-4 cursor-grab active:cursor-grabbing",style:{color:"#6B6B6B"}}),b.visible?e.jsx(Ar,{className:"w-4 h-4",style:{color:"#9E9E9E"}}):e.jsx(Fr,{className:"w-4 h-4",style:{color:"#9E9E9E"}}),e.jsx("span",{className:"text-sm",style:{color:"#F1F1F1"},children:b.label})]}),e.jsx(ot,{checked:b.visible,onCheckedChange:C=>p(b.id,C),onClick:C=>C.stopPropagation()})]},b.id))})]})]})})]})}const Ss=t=>Number.isInteger(t)?t.toString():parseFloat(t.toFixed(2)).toString(),Pt=t=>{if(t==null)return"--:--";const r=Math.floor(t/60),s=Math.floor(t%60);return`${r}:${s.toString().padStart(2,"0")}`},Gn=({songTitle:t,songKey:r,isPlaying:s,currentTime:n,tempo:o,loopEnabled:l,metronomeEnabled:a,metronomeVolume:i,keyShift:u,trackHeight:h,rulerVisibility:c,rulerOrder:d,currentMeasure:m,currentTimeSignature:p,displayTempo:f,snapEnabled:g=!1,snapMode:y="measures",onBack:S,onPlayPause:b,onStop:M,onLoopToggle:C,onMetronomeToggle:w,onMetronomeVolumeChange:j,onTempoChange:k,onKeyShiftChange:N,onTrackHeightChange:E,onRulerVisibilityChange:z,onRulerOrderChange:V,onSnapToggle:R,onSnapModeChange:ie,onExportProject:de,activeTool:U=null,onToolChange:Z})=>e.jsxs("div",{className:"border-b p-3 flex items-center justify-between gap-4",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:S,children:e.jsx(Ot,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Back to Library"})]}),e.jsx("span",{className:"text-lg font-medium",style:{color:"var(--daw-text-primary)"},children:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:M,children:e.jsx(Dr,{className:"w-5 h-5"})})}),e.jsx(ge,{children:"Stop"})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-12 w-12",style:{backgroundColor:s?"#10B981":"#065F46",color:"#FFFFFF",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=s?"#059669":"#047857"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=s?"#10B981":"#065F46"},onClick:b,children:s?e.jsx(Pr,{className:"w-6 h-6"}):e.jsx(qe,{className:"w-6 h-6"})})}),e.jsx(ge,{children:s?"Pause":"Play"})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:l?"#1E3A8A":"var(--daw-control)",color:l?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=l?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=l?"#1E3A8A":"var(--daw-control)"},onClick:C,children:e.jsx(zn,{className:"w-5 h-5"})})}),e.jsx(ge,{children:"Loop"})]})]}),e.jsxs("div",{className:"rounded-lg px-4 py-2 flex items-center gap-4",style:{backgroundColor:"var(--daw-bg-main)",border:"1px solid var(--daw-border)",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{className:"flex flex-col items-center",style:{minWidth:"80px"},children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Time"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:Pt(n)})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Measure"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:m})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Tempo"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:Ss(f)})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Time Sig"}),e.jsx("span",{className:"text-lg font-mono font-bold",style:{color:"#10B981"},children:p})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Key"}),e.jsx("span",{className:"text-lg font-mono font-bold",style:{color:"#10B981"},children:r})]})]}),e.jsxs(bt,{children:[e.jsxs("div",{className:"flex items-center gap-0",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-r-none",style:{backgroundColor:a?"#1E3A8A":"var(--daw-control)",color:a?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px 0 0 8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=a?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=a?"#1E3A8A":"var(--daw-control)"},onClick:w,children:e.jsx(Bn,{className:"w-5 h-5"})})}),e.jsx(ge,{children:"Metronome"})]}),e.jsx(vt,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-6 rounded-l-none px-1",style:{backgroundColor:a?"#1E3A8A":"var(--daw-control)",color:a?"#60A5FA":"var(--daw-text-primary)",borderRadius:"0 8px 8px 0",borderLeft:"1px solid rgba(0,0,0,0.2)"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=a?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=a?"#1E3A8A":"var(--daw-control)"},children:e.jsx(Ht,{className:"w-3 h-3"})})})]}),e.jsx(jt,{className:"w-64 p-4",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{className:"text-sm",style:{color:"var(--daw-text-primary)"},children:"Metronome Volume"}),e.jsxs("span",{className:"text-sm",style:{color:"var(--daw-text-secondary)"},children:[it(Gr(i))," dB"]})]}),e.jsx(et,{value:[Qe(i)],onValueChange:L=>j(Bt(L[0])),max:100,step:.1,className:"w-full",onDoubleClick:()=>{j(.5)}})]})})]}),e.jsxs(bt,{children:[e.jsx(vt,{asChild:!0,children:e.jsxs(P,{variant:"ghost",className:"h-10 px-3 gap-2",style:{backgroundColor:U?"#1E3A8A":"var(--daw-control)",color:U?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px"},children:[U==="marker"?e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Marker Editor"})]}):U==="warp"?e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Warp Grid"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Player Mode"})]}),e.jsx(Ht,{className:"w-3 h-3 opacity-50"})]})}),e.jsxs(jt,{align:"end",className:"w-48",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs(At,{onClick:()=>Z&&Z(null),className:"gap-2 cursor-pointer",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsx("span",{children:"Player Mode"})]}),e.jsxs(At,{onClick:()=>Z&&Z("marker"),className:"gap-2 cursor-pointer",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{children:"Marker Editor"})]}),e.jsxs(At,{onClick:()=>Z&&Z("warp"),className:"gap-2 cursor-pointer",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{children:"Warp Grid Editor"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",className:"h-10 px-3",style:{backgroundColor:g?"#2563EB":"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=g?"#1D4ED8":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=g?"#2563EB":"var(--daw-control)"},onClick:R,children:e.jsx($n,{className:"w-4 h-4"})})}),e.jsx(ge,{children:g?"Snap enabled (measures)":"Snap disabled"})]}),e.jsx(Vn,{tempo:o,onTempoChange:k,keyShift:u,onKeyShiftChange:N,originalKey:r}),e.jsx(Wn,{trackHeight:h,onTrackHeightChange:E,rulerVisibility:c,onRulerVisibilityChange:z,rulerOrder:d,onRulerOrderChange:V}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:de,children:e.jsx(Rr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Export Project"})]})]})]});function Ue(t,r,s){let n=s.initialDeps??[],o,l=!0;function a(){var i,u,h;let c;s.key&&((i=s.debug)!=null&&i.call(s))&&(c=Date.now());const d=t();if(!(d.length!==n.length||d.some((f,g)=>n[g]!==f)))return o;n=d;let p;if(s.key&&((u=s.debug)!=null&&u.call(s))&&(p=Date.now()),o=r(...d),s.key&&((h=s.debug)!=null&&h.call(s))){const f=Math.round((Date.now()-c)*100)/100,g=Math.round((Date.now()-p)*100)/100,y=g/16,S=(b,M)=>{for(b=String(b);b.length<M;)b=" "+b;return b};console.info(`%câ± ${S(g,5)} /${S(f,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,s?.key)}return s?.onChange&&!(l&&s.skipInitialOnChange)&&s.onChange(o),l=!1,o}return a.updateDeps=i=>{n=i},a}function ns(t,r){if(t===void 0)throw new Error("Unexpected undefined");return t}const Hn=(t,r)=>Math.abs(t-r)<1.01,qn=(t,r,s)=>{let n;return function(...o){t.clearTimeout(n),n=t.setTimeout(()=>r.apply(this,o),s)}},as=t=>{const{offsetWidth:r,offsetHeight:s}=t;return{width:r,height:s}},Kn=t=>t,Un=t=>{const r=Math.max(t.startIndex-t.overscan,0),s=Math.min(t.endIndex+t.overscan,t.count-1),n=[];for(let o=r;o<=s;o++)n.push(o);return n},Xn=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;const o=a=>{const{width:i,height:u}=a;r({width:Math.round(i),height:Math.round(u)})};if(o(as(s)),!n.ResizeObserver)return()=>{};const l=new n.ResizeObserver(a=>{const i=()=>{const u=a[0];if(u?.borderBoxSize){const h=u.borderBoxSize[0];if(h){o({width:h.inlineSize,height:h.blockSize});return}}o(as(s))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return l.observe(s,{box:"border-box"}),()=>{l.unobserve(s)}},os={passive:!0},is=typeof window>"u"?!0:"onscrollend"in window,Zn=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;let o=0;const l=t.options.useScrollendEvent&&is?()=>{}:qn(n,()=>{r(o,!1)},t.options.isScrollingResetDelay),a=c=>()=>{const{horizontal:d,isRtl:m}=t.options;o=d?s.scrollLeft*(m&&-1||1):s.scrollTop,l(),r(o,c)},i=a(!0),u=a(!1);u(),s.addEventListener("scroll",i,os);const h=t.options.useScrollendEvent&&is;return h&&s.addEventListener("scrollend",u,os),()=>{s.removeEventListener("scroll",i),h&&s.removeEventListener("scrollend",u)}},Yn=(t,r,s)=>{if(r?.borderBoxSize){const n=r.borderBoxSize[0];if(n)return Math.round(n[s.options.horizontal?"inlineSize":"blockSize"])}return t[s.options.horizontal?"offsetWidth":"offsetHeight"]},Qn=(t,{adjustments:r=0,behavior:s},n)=>{var o,l;const a=t+r;(l=(o=n.scrollElement)==null?void 0:o.scrollTo)==null||l.call(o,{[n.options.horizontal?"left":"top"]:a,behavior:s})};class Jn{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const n=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(o=>{o.forEach(l=>{const a=()=>{this._measureElement(l.target,l)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()})}));return{disconnect:()=>{var o;(o=n())==null||o.disconnect(),s=null},observe:o=>{var l;return(l=n())==null?void 0:l.observe(o,{box:"border-box"})},unobserve:o=>{var l;return(l=n())==null?void 0:l.unobserve(o)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([n,o])=>{typeof o>"u"&&delete s[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Kn,rangeExtractor:Un,onChange:()=>{},measureElement:Yn,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var n,o;(o=(n=this.options).onChange)==null||o.call(n,this,s)},this.maybeNotify=Ue(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(o=>{this.observer.observe(o)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,o=>{this.scrollRect=o,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(o,l)=>{this.scrollAdjustments=0,this.scrollDirection=l?this.getScrollOffset()<o?"forward":"backward":null,this.scrollOffset=o,this.isScrolling=l,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,n)=>{const o=new Map,l=new Map;for(let a=n-1;a>=0;a--){const i=s[a];if(o.has(i.lane))continue;const u=l.get(i.lane);if(u==null||i.end>u.end?l.set(i.lane,i):i.end<u.end&&o.set(i.lane,!0),o.size===this.options.lanes)break}return l.size===this.options.lanes?Array.from(l.values()).sort((a,i)=>a.end===i.end?a.index-i.index:a.end-i.end)[0]:void 0},this.getMeasurementOptions=Ue(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(s,n,o,l,a,i)=>(this.prevLanes!==void 0&&this.prevLanes!==i&&(this.lanesChangedFlag=!0),this.prevLanes=i,this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:n,scrollMargin:o,getItemKey:l,enabled:a,lanes:i}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=Ue(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:n,scrollMargin:o,getItemKey:l,enabled:a,lanes:i},u)=>{if(!a)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>s)for(const m of this.laneAssignments.keys())m>=s&&this.laneAssignments.delete(m);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(m=>{this.itemSizeCache.set(m.key,m.size)}));const h=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===s&&(this.lanesSettling=!1);const c=this.measurementsCache.slice(0,h),d=new Array(i).fill(void 0);for(let m=0;m<h;m++){const p=c[m];p&&(d[p.lane]=m)}for(let m=h;m<s;m++){const p=l(m),f=this.laneAssignments.get(m);let g,y;if(f!==void 0&&this.options.lanes>1){g=f;const C=d[g],w=C!==void 0?c[C]:void 0;y=w?w.end+this.options.gap:n+o}else{const C=this.options.lanes===1?c[m-1]:this.getFurthestMeasurement(c,m);y=C?C.end+this.options.gap:n+o,g=C?C.lane:m%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(m,g)}const S=u.get(p),b=typeof S=="number"?S:this.options.estimateSize(m),M=y+b;c[m]={index:m,start:y,size:b,end:M,key:p,lane:g},d[g]=m}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Ue(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,n,o,l)=>this.range=s.length>0&&n>0?ea({measurements:s,outerSize:n,scrollOffset:o,lanes:l}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Ue(()=>{let s=null,n=null;const o=this.calculateRange();return o&&(s=o.startIndex,n=o.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,n]},(s,n,o,l,a)=>l===null||a===null?[]:s({startIndex:l,endIndex:a,overscan:n,count:o}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const n=this.options.indexAttribute,o=s.getAttribute(n);return o?parseInt(o,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(s,n)=>{const o=this.indexFromElement(s),l=this.measurementsCache[o];if(!l)return;const a=l.key,i=this.elementsCache.get(a);i!==s&&(i&&this.observer.unobserve(i),this.observer.observe(s),this.elementsCache.set(a,s)),s.isConnected&&this.resizeItem(o,this.options.measureElement(s,n,this))},this.resizeItem=(s,n)=>{const o=this.measurementsCache[s];if(!o)return;const l=this.itemSizeCache.get(o.key)??o.size,a=n-l;a!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(o,a,this):o.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=a,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(o.index),this.itemSizeCache=new Map(this.itemSizeCache.set(o.key,n)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((n,o)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(o))});return}this._measureElement(s,void 0)},this.getVirtualItems=Ue(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,n)=>{const o=[];for(let l=0,a=s.length;l<a;l++){const i=s[l],u=n[i];o.push(u)}return o},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const n=this.getMeasurements();if(n.length!==0)return ns(n[Ms(0,n.length-1,o=>ns(n[o]).start,s)])},this.getOffsetForAlignment=(s,n,o=0)=>{const l=this.getSize(),a=this.getScrollOffset();n==="auto"&&(n=s>=a+l?"end":"start"),n==="center"?s+=(o-l)/2:n==="end"&&(s-=l);const i=this.getTotalSize()+this.options.scrollMargin-l;return Math.max(Math.min(i,s),0)},this.getOffsetForIndex=(s,n="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const o=this.measurementsCache[s];if(!o)return;const l=this.getSize(),a=this.getScrollOffset();if(n==="auto")if(o.end>=a+l-this.options.scrollPaddingEnd)n="end";else if(o.start<=a+this.options.scrollPaddingStart)n="start";else return[a,n];const i=n==="end"?o.end+this.options.scrollPaddingEnd:o.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,n,o.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:n="start",behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,n),{adjustments:void 0,behavior:o})},this.scrollToIndex=(s,{align:n="auto",behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1));let l=0;const a=10,i=h=>{if(!this.targetWindow)return;const c=this.getOffsetForIndex(s,h);if(!c){console.warn("Failed to get offset for index:",s);return}const[d,m]=c;this._scrollToOffset(d,{adjustments:void 0,behavior:o}),this.targetWindow.requestAnimationFrame(()=>{const p=this.getScrollOffset(),f=this.getOffsetForIndex(s,m);if(!f){console.warn("Failed to get offset for index:",s);return}Hn(f[0],p)||u(m)})},u=h=>{this.targetWindow&&(l++,l<a?this.targetWindow.requestAnimationFrame(()=>i(h)):console.warn(`Failed to scroll to index ${s} after ${a} attempts.`))};i(n)},this.scrollBy=(s,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var s;const n=this.getMeasurements();let o;if(n.length===0)o=this.options.paddingStart;else if(this.options.lanes===1)o=((s=n[n.length-1])==null?void 0:s.end)??0;else{const l=Array(this.options.lanes).fill(null);let a=n.length-1;for(;a>=0&&l.some(i=>i===null);){const i=n[a];l[i.lane]===null&&(l[i.lane]=i.end),a--}o=Math.max(...l.filter(i=>i!==null))}return Math.max(o-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:n,behavior:o})=>{this.options.scrollToFn(s,{behavior:o,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(r)}}const Ms=(t,r,s,n)=>{for(;t<=r;){const o=(t+r)/2|0,l=s(o);if(l<n)t=o+1;else if(l>n)r=o-1;else return o}return t>0?t-1:0};function ea({measurements:t,outerSize:r,scrollOffset:s,lanes:n}){const o=t.length-1,l=u=>t[u].start;if(t.length<=n)return{startIndex:0,endIndex:o};let a=Ms(0,o,l,s),i=a;if(n===1)for(;i<o&&t[i].end<s+r;)i++;else if(n>1){const u=Array(n).fill(0);for(;i<o&&u.some(c=>c<s+r);){const c=t[i];u[c.lane]=c.end,i++}const h=Array(n).fill(s+r);for(;a>=0&&h.some(c=>c>=s);){const c=t[a];h[c.lane]=c.start,a--}a=Math.max(0,a-a%n),i=Math.min(o,i+(n-1-i%n))}return{startIndex:a,endIndex:i}}const ls=typeof document<"u"?x.useLayoutEffect:x.useEffect;function ta(t){const r=x.useReducer(()=>({}),{})[1],s={...t,onChange:(o,l)=>{var a;l?tr.flushSync(r):r(),(a=t.onChange)==null||a.call(t,o,l)}},[n]=x.useState(()=>new Jn(s));return n.setOptions(s),ls(()=>n._didMount(),[]),ls(()=>n._willUpdate()),n}function sa(t){return ta({observeElementRect:Xn,observeElementOffset:Zn,scrollToFn:Qn,...t})}const Es=H.memo(({trackId:t,trackName:r,trackColor:s,trackVolume:n,trackMuted:o,trackSolo:l,trackHeightPx:a,isAnySolo:i,onVolumeChange:u,onMuteToggle:h,onSoloToggle:c})=>{const[d,m]=H.useState(Qe(n)),[p,f]=H.useState(!1);H.useEffect(()=>{p||m(Qe(n))},[n,p]);const g=b=>{m(b[0])},y=()=>{f(!0)},S=()=>{f(!1),u(t,Bt(d))};return e.jsxs("div",{className:"border-b relative group box-border",style:{height:`${a}px`,minHeight:`${a}px`,maxHeight:`${a}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",borderBottomWidth:"1px"},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1",style:{backgroundColor:s||"#3b82f6"}}),e.jsxs("div",{className:"p-2 pl-6 h-full flex flex-col justify-center gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:e.jsx("span",{className:"font-semibold text-sm truncate text-gray-200",title:r,children:r})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{variant:"ghost",size:"icon",className:`h-6 w-8 rounded-sm border-2 focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${o?"bg-red-600 text-white border-red-500 focus:ring-red-500":"bg-gray-800 text-gray-400 border-gray-600 hover:border-gray-500 focus:ring-gray-500"}`,onClick:()=>h(t),"aria-label":o?`Unmute ${r}`:`Mute ${r}`,"aria-pressed":o,title:o?"Unmute track":"Mute track",children:e.jsx("span",{className:"text-[10px] font-bold",children:"M"})}),e.jsx(P,{variant:"ghost",size:"icon",className:`h-6 w-8 rounded-sm border-2 focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${l?"bg-yellow-500 text-black border-yellow-400 focus:ring-yellow-500":"bg-gray-800 text-gray-400 border-gray-600 hover:border-gray-500 focus:ring-gray-500"}`,onClick:()=>c(t),"aria-label":l?`Unsolo ${r}`:`Solo ${r}`,"aria-pressed":l,title:l?"Unsolo track":"Solo track",children:e.jsx("span",{className:"text-[10px] font-bold",children:"S"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{value:[d],min:0,max:100,step:1,onValueChange:g,onPointerDown:y,onPointerUp:S,className:"flex-1","aria-label":`Volume for ${r}`,"aria-valuenow":d,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":`${it(gt(d))} decibels`}),e.jsx("span",{className:"text-[10px] tabular-nums text-gray-400 w-8 text-right font-mono","aria-hidden":"true",children:it(gt(d))})]})]})]})},(t,r)=>t.trackId===r.trackId&&t.trackName===r.trackName&&t.trackColor===r.trackColor&&t.trackVolume===r.trackVolume&&t.trackMuted===r.trackMuted&&t.trackSolo===r.trackSolo&&t.trackHeightPx===r.trackHeightPx&&t.isAnySolo===r.isAnySolo);Es.displayName="TrackListItem";const As=H.memo(H.forwardRef(({tracks:t,trackHeight:r,editingTrackId:s,trackNameInput:n,pinnedTracks:o,onTrackNameChange:l,onTrackColorChange:a,onTrackVolumeChange:i,onTrackMuteToggle:u,onTrackSoloToggle:h,onTrackTagsChange:c,onTrackNotesOpen:d,onEditingTrackIdChange:m,onTrackNameInputChange:p,onPinnedTracksChange:f,onScroll:g},y)=>{const S=()=>{switch(r){case"small":return 64;case"large":return 128;default:return 96}},b=x.useCallback((N,E)=>{i(N,E)},[i]),M=t.some(N=>N.solo),C=S(),w=x.useRef(null),j=sa({count:t.length,getScrollElement:()=>w.current,estimateSize:()=>C,overscan:3}),k=N=>{g(N.currentTarget.scrollTop)};return e.jsxs("div",{ref:N=>{w.current=N,typeof y=="function"?y(N):y&&(y.current=N)},className:"track-list-sidebar-container flex-shrink-0 border-r flex flex-col overflow-y-auto",style:{width:`${Et.SIDEBAR_WIDTH}px`,minWidth:`${Et.SIDEBAR_WIDTH}px`,maxWidth:`${Et.SIDEBAR_WIDTH}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",scrollbarWidth:"none",msOverflowStyle:"none",paddingTop:0,paddingBottom:0},onScroll:k,children:[e.jsx("div",{className:"flex-1 relative",style:{height:`${j.getTotalSize()}px`,margin:0,padding:0},children:j.getVirtualItems().map(N=>{const E=t[N.index];return e.jsx("div",{"data-index":N.index,ref:j.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${N.start}px)`},children:e.jsx(Es,{trackId:E.id,trackName:E.name,trackColor:E.color||"#3b82f6",trackVolume:E.volume,trackMuted:E.muted,trackSolo:E.solo,trackHeightPx:C,isAnySolo:M,onVolumeChange:b,onMuteToggle:u,onSoloToggle:h})},E.id)})}),e.jsx("style",{children:`
        .track-list-sidebar-container::-webkit-scrollbar {
          display: none;
        }
      `})]})}));As.displayName="TrackListSidebar";const ra={time:"Time",measures:"Measures",sections:"Sections",chords:"Chords",tempo:"Tempo"},na=({visibleRulers:t,rulerOrder:r,onRulerOrderChange:s})=>{const[n,o]=x.useState(null),l=r.filter(c=>t.includes(c)),a=(c,d)=>{o(d),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("text/plain",d)},i=c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},u=(c,d)=>{if(c.preventDefault(),!n||n===d){o(null);return}const m=[...r],p=m.indexOf(n),f=m.indexOf(d);m.splice(p,1),m.splice(f,0,n),s(m),o(null)},h=()=>{o(null)};return e.jsx("div",{className:"flex flex-col",children:l.map(c=>e.jsxs("div",{draggable:!0,onDragStart:d=>a(d,c),onDragOver:i,onDrop:d=>u(d,c),onDragEnd:h,className:`flex items-center justify-start px-3 border-b text-xs font-medium uppercase tracking-wider cursor-grab active:cursor-grabbing transition-opacity ${n===c?"opacity-50":"opacity-100"}`,style:{height:`${Ge.RULER_HEIGHT}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",color:"var(--daw-text-secondary)"},children:[e.jsx(ms,{className:"w-3 h-3 mr-2 text-gray-500"}),ra[c]||c]},c))})},aa=({zoom:t,onZoomIn:r,onZoomOut:s,onFitToView:n})=>e.jsxs("div",{className:"flex items-center justify-center gap-2 px-2",children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",opacity:t<=1?.5:1},onClick:s,disabled:t<=1,children:e.jsx(Ir,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Zoom Out"})]}),e.jsxs("span",{className:"text-xs tabular-nums w-14 text-center",style:{color:"#9E9E9E"},children:[Math.round(t*100),"%"]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",opacity:t>=8?.5:1},onClick:r,disabled:t>=8,children:e.jsx(Lr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Zoom In"})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:n,children:e.jsx(hs,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Fit to View"})]})]});function oa({...t}){return e.jsx(kr,{"data-slot":"popover",...t})}function ia({...t}){return e.jsx(Cr,{"data-slot":"popover-trigger",...t})}function la({className:t,align:r="center",sideOffset:s=4,...n}){return e.jsx(Nr,{children:e.jsx(Tr,{"data-slot":"popover-content",align:r,sideOffset:s,className:Te("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...n})})}function ca({tracks:t,presets:r,onSavePreset:s,onLoadPreset:n,onDeletePreset:o}){const[l,a]=x.useState(!1),[i,u]=x.useState(""),[h,c]=x.useState(""),d=()=>{if(!i.trim()){Ne.error("Please enter a preset name");return}s(i),u(""),a(!1),Ne.success(`Mix preset "${i}" saved successfully`)},m=()=>{if(!h){Ne.error("Please select a preset to load");return}const f=r.find(g=>g.id===h);if(!f){Ne.error("Preset not found");return}n(f),Ne.success(`Mix preset "${f.name}" loaded successfully`)},p=f=>{const g=r.find(y=>y.id===f);window.confirm(`Are you sure you want to delete preset "${g?.name}"?`)&&(o(f),h===f&&c(""),Ne.success("Mix preset deleted"))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(lt,{open:l,onOpenChange:a,children:[e.jsx(sr,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",className:"w-full",title:"Save current mix as preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(Or,{className:"w-4 h-4 mr-2"}),"Save Current Mix"]})}),e.jsxs(ct,{children:[e.jsxs(dt,{children:[e.jsx(ut,{children:"Save Mix Preset"}),e.jsx(mt,{children:"Save the current volume and mute settings as a mix preset."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"preset-name",children:"Preset Name"}),e.jsx(Me,{id:"preset-name",placeholder:"e.g., Rehearsal Mix, Live Mix, etc.",value:i,onChange:f=>u(f.target.value),onKeyDown:f=>{f.key==="Enter"&&d()}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{children:"Current Settings:"}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded p-2 space-y-1",children:t.map(f=>e.jsxs("div",{className:"text-sm flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:f.name}),e.jsx("span",{className:"text-gray-500",children:f.muted?"Muted":`${Math.round(f.volume*100)}%`})]},f.id))})]})]}),e.jsxs(rr,{children:[e.jsx(nr,{asChild:!0,children:e.jsx(P,{variant:"outline",children:"Cancel"})}),e.jsx(P,{onClick:d,children:"Save Preset"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Ee,{value:h,onValueChange:c,children:[e.jsx(Ae,{className:"w-full",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:e.jsx(Fe,{placeholder:"Select preset..."})}),e.jsx(De,{children:r.length===0?e.jsx("div",{className:"px-2 py-1.5 text-sm text-gray-500",children:"No presets saved"}):r.map(f=>e.jsx(ye,{value:f.id,children:f.name},f.id))})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1",onClick:m,disabled:!h,title:"Load selected preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(Br,{className:"w-4 h-4 mr-1"}),"Load"]}),e.jsxs(P,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>h&&p(h),disabled:!h,title:"Delete selected preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(Lt,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]})}const da=({sidebarVisible:t,mixerDockVisible:r,notesPanelVisible:s,mixPresetsPopoverOpen:n,tracks:o,mixPresets:l,onToggleSidebar:a,onToggleMixer:i,onToggleNotes:u,onPerformanceMode:h,onMixPresetsOpenChange:c,onSaveMixPreset:d,onLoadMixPreset:m,onDeleteMixPreset:p})=>e.jsxs("div",{className:"border-t flex items-center justify-between h-10 px-3",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:a,children:t?e.jsx($r,{className:"w-4 h-4"}):e.jsx(zr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:t?"Hide Sidebar":"Show Sidebar"})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(oa,{open:n,onOpenChange:c,children:[e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(ia,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"6",y1:"4",x2:"6",y2:"20"}),e.jsx("rect",{x:"4",y:"7",width:"4",height:"3",rx:"1",fill:"currentColor"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20"}),e.jsx("rect",{x:"10",y:"11",width:"4",height:"3",rx:"1",fill:"currentColor"}),e.jsx("line",{x1:"18",y1:"4",x2:"18",y2:"20"}),e.jsx("rect",{x:"16",y:"9",width:"4",height:"3",rx:"1",fill:"currentColor"})]})})})}),e.jsx(ge,{children:"Mix Presets"})]}),e.jsx(la,{align:"center",className:"w-72",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:e.jsx(ca,{tracks:o,presets:l,onSavePreset:d,onLoadPreset:m,onDeletePreset:p})})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:r?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},onClick:i,children:e.jsx(_r,{className:"w-4 h-4"})})}),e.jsx(ge,{children:r?"Hide Mixer":"Show Mixer"})]}),e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:s?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},onClick:u,children:e.jsx(Vr,{className:"w-4 h-4"})})}),e.jsx(ge,{children:s?"Hide Notes":"Show Notes"})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:h,children:e.jsx(hs,{className:"w-4 h-4"})})}),e.jsx(ge,{children:"Performance Mode"})]})})]}),ua=({zoom:t,setZoom:r,timelineRef:s,rulerRef:n,currentTime:o})=>{const l=x.useRef(0),a=x.useRef(null),i=x.useCallback(c=>{n.current&&(n.current.scrollLeft=c)},[n]),u=x.useCallback(c=>{l.current=c,i(c)},[i]),h=x.useCallback((c,d)=>{r(c),s.current&&(s.current.scrollLeft=d),n.current&&(n.current.scrollLeft=d),l.current=d},[r,s,n]);return x.useEffect(()=>{const c=s.current,d=n.current,m=p=>{if(!p.ctrlKey&&!p.metaKey)return;p.preventDefault(),p.stopPropagation();const f=p.deltaY>0?1/ae.FACTOR:ae.FACTOR,g=Math.max(ae.MIN,Math.min(ae.MAX,t*f));if(g===t)return;const y=s.current?.getBoundingClientRect(),S=y?p.clientX-y.left:0,M=(s.current?.scrollLeft||0)+S,C=ae.BASE_PPS*t,w=M/C;r(g);const j=ae.BASE_PPS*g,k=w*j,N=Math.max(0,k-S);a.current=N};return c&&c.addEventListener("wheel",m,{passive:!1}),d&&d.addEventListener("wheel",m,{passive:!1}),()=>{c&&c.removeEventListener("wheel",m),d&&d.removeEventListener("wheel",m)}},[t,r,s,n]),x.useEffect(()=>{if(a.current!==null){const c=a.current;s.current&&(s.current.scrollLeft=c),n.current&&(n.current.scrollLeft=c),l.current=c,a.current=null}},[t,s,n]),{scrollLeftRef:l,handleTimelineScroll:u,handleNavigatorChange:h}},ma=({song:t,onSongUpdate:r})=>{const[s,n]=x.useState([]),o=x.useCallback(i=>{const u={id:`preset-${Date.now()}`,name:i,tracks:t.tracks.map(h=>({trackId:h.id,volume:h.volume??1,muted:h.muted??!1}))};n(h=>[...h,u])},[t.tracks]),l=x.useCallback(i=>{if(!r)return;const u=t.tracks.map(h=>{const c=i.tracks.find(d=>d.trackId===h.id);return c?{...h,volume:c.volume,muted:c.muted}:h});r({...t,tracks:u})},[t,r]),a=x.useCallback(i=>{n(u=>u.filter(h=>h.id!==i))},[]);return{mixPresets:s,handleSaveMixPreset:o,handleLoadMixPreset:l,handleDeleteMixPreset:a}},ha=({song:t,onSongUpdate:r,editMode:s})=>{const[n,o]=x.useState(!1),[l,a]=x.useState("section"),[i,u]=x.useState(null),[h,c]=x.useState(0),d=x.useCallback(f=>{if(!s)return;const g=f.currentTarget.getBoundingClientRect(),S=(f.clientX-g.left)/50;c(S)},[s]),m=x.useCallback((f,g)=>{if(!r)return;let y={...t};switch(l){case"section":f==="delete"&&i?y.markers=t.markers?.filter(b=>b.time!==i.time)||[]:f==="update"&&i?y.markers=t.markers?.map(b=>b.time===i.time?{...b,...g}:b)||[]:y.markers=[...t.markers||[],g];break;case"chord":f==="delete"&&i?y.chordMarkers=t.chordMarkers?.filter(b=>b.time!==i.time)||[]:f==="update"&&i?y.chordMarkers=t.chordMarkers?.map(b=>b.time===i.time?{...b,...g}:b)||[]:y.chordMarkers=[...t.chordMarkers||[],g];break;case"tempo":f==="delete"&&i?y.tempoChanges=t.tempoChanges?.filter(b=>b.time!==i.time)||[]:f==="update"&&i?y.tempoChanges=t.tempoChanges?.map(b=>b.time===i.time?{...b,...g}:b)||[]:y.tempoChanges=[...t.tempoChanges||[],g];break}r(y),o(!1),u(null)},[t,r,i,l]),p=x.useCallback((f,g,y)=>{a(f),u(g||null),y!==void 0&&c(y),o(!0)},[]);return{editorOpen:n,setEditorOpen:o,editorType:l,editingMarker:i,clickedTime:h,handleTimelineClick:d,handleTimelineItemSubmit:m,openEditor:p}},xa=({zoom:t,setZoom:r,song:s,containerWidth:n})=>{const o=x.useCallback(()=>!s||n===0?1:n/(s.duration*ae.BASE_PPS),[s,n]),l=x.useCallback(()=>{r(u=>Math.max(ae.MIN,u-.25))},[r]),a=x.useCallback(()=>{r(u=>Math.min(ae.MAX,u+.25))},[r]),i=x.useCallback(()=>{const u=o(),h=Math.max(ae.MIN,Math.min(ae.MAX,u));r(h)},[o,r]);return{handleZoomOutOnPlayhead:l,handleZoomInOnPlayhead:a,handleFitToView:i}},fa=({song:t})=>{const[r,s]=x.useState(0),[n,o]=x.useState(t?.source==="project"),[l,a]=x.useState(!1),[i,u]=x.useState(1e3),[h,c]=x.useState(!1),[d,m]=x.useState(!0),[p,f]=x.useState(!0),[g,y]=x.useState(!1),[S,b]=x.useState(!1),[M,C]=x.useState(null),[w,j]=x.useState(!1),[k,N]=x.useState([]),[E,z]=x.useState(!1),[V,R]=x.useState(null),[ie,de]=x.useState(0),[U,Z]=x.useState(new Set),[L,be]=x.useState(null),[le,J]=x.useState(!1),[ee,Q]=x.useState(!1),se=x.useRef(null),me=x.useRef(null),ce=x.useRef(null),Se=x.useRef(null);return x.useEffect(()=>{t&&N(t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}])},[t?.tempoChanges,t?.tempo]),{keyShift:r,setKeyShift:s,editMode:n,setEditMode:o,createProjectOpen:l,setCreateProjectOpen:a,containerWidth:i,setContainerWidth:u,snapEnabled:h,setSnapEnabled:c,sidebarVisible:d,setSidebarVisible:m,mixerVisible:p,setMixerVisible:f,mixerDockVisible:g,setMixerDockVisible:y,mixPresetsPopoverOpen:S,setMixPresetsPopoverOpen:b,selectedChord:M,setSelectedChord:C,showShortcutsHelp:w,setShowShortcutsHelp:j,dynamicTempos:k,setDynamicTempos:N,isDragging:E,setIsDragging:z,dragStartTime:V,setDragStartTime:R,scrollTop:ie,setScrollTop:de,pinnedTracks:U,setPinnedTracks:Z,selectedTrackForNotes:L,setSelectedTrackForNotes:be,notesPanelVisible:le,setNotesPanelVisible:J,warpMode:ee,setWarpMode:Q,rulerRef:se,sidebarRef:me,timelineRef:ce,hoveredContainerRef:Se}};function He(t,r,s,n="4/4"){const[o]=n.split("/").map(Number),l=[...r].sort((c,d)=>c.time-d.time);let a=0,i=1,u=s;for(const c of l){if(c.time<=a){u=c.tempo;continue}const d=o*60/u,m=(c.time-a)/d,p=i+m;if(p>=t){const f=t-i;return a+f*d}a=c.time,i=p,u=c.tempo}const h=t-i;if(h>0){const c=o*60/u;a+=h*c}return a}function Rt(t,r,s,n="4/4"){const[o]=n.split("/").map(Number),l=[...r].sort((m,p)=>m.time-p.time);let a=0,i=1,u=s;for(const m of l){if(m.time<=a){u=m.tempo;continue}if(m.time>t){const y=t-a,S=o*60/u,b=y/S;return i+b}const p=m.time-a,f=o*60/u,g=p/f;a=m.time,i+=g,u=m.tempo}const h=t-a,c=o*60/u,d=h/c;return i+d}function Fs(t,r,s){if(r<=0)return 120;const n=t*s*60/r;return Math.max(10,Math.min(999,n))}const pa=({song:t,zoom:r,currentTime:s,trackHeight:n})=>{const o=()=>ae.BASE_PPS*r,l=()=>{switch(n){case"small":return 64;case"large":return 128;default:return 96}},a=()=>{const h=t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}];return Math.floor(Rt(s,h,t.tempo))},i=h=>{const c=t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}],d=Rt(h,c,t.tempo);return[...c].sort((f,g)=>f.time-g.time).slice().reverse().find(f=>f.time<=d)||c[0]};return{getPixelsPerSecond:o,getTrackHeightPx:l,getCurrentMeasure:a,getCurrentTempoInfo:i,getCurrentTimeSignature:()=>i(s).timeSignature}},ga=({song:t,onSongUpdate:r})=>({handleWarpCommit:x.useCallback((n,o,l)=>{if(!t||!r)return;const a={...t},i=a.tempoChanges?[...a.tempoChanges]:[];i.sort((f,g)=>f.time-g.time);const u=i.find(f=>f.time>o);let h=0,c=0;u&&(c=u.time,h=He(c,i,t.tempo));const d=i.findIndex(f=>f.time===n);d>=0?i[d]={...i[d],tempo:l}:n===1&&i.push({time:1,tempo:l,timeSignature:"4/4"});let m=i.findIndex(f=>f.time===o),p=i[m];if(!p){const f=i.find(g=>g.time===n);p={time:o,tempo:f?f.tempo:l,timeSignature:f?f.timeSignature:"4/4"},i.push(p)}if(i.sort((f,g)=>f.time-g.time),u){const f=He(o,i,t.tempo),g=h-f,y=c-o;if(g>0&&y>0){const[S]=p.timeSignature.split("/").map(Number),b=Fs(y,g,S);p.tempo=b;const M=i.findIndex(C=>C.time===o);M>=0&&(i[M]=p)}}a.tempoChanges=i,r(a)},[t,r])}),ba=({song:t,onSongUpdate:r})=>{const s=x.useCallback((l,a,i)=>{if(!t||!r)return;const u={id:crypto.randomUUID(),userId:"current-user",content:l,time:i,isPrivate:a};r({...t,notes:[...t.notes||[],u]})},[t,r]),n=x.useCallback(l=>{!t||!r||r({...t,notes:(t.notes||[]).filter(a=>a.id!==l)})},[t,r]),o=x.useCallback((l,a)=>{if(!t||!r)return;const i=t.tracks.map(u=>u.id===a?{...u,notes:l}:u);r({...t,tracks:i})},[t,r]);return{handleAddSongNote:s,handleDeleteSongNote:n,handleSaveTrackNotes:o}},va=({timelineRef:t,setContainerWidth:r,song:s,containerWidth:n,setZoom:o})=>{x.useEffect(()=>{const l=()=>{t.current&&r(t.current.clientWidth)},a=setTimeout(l,0);return window.addEventListener("resize",l),()=>{clearTimeout(a),window.removeEventListener("resize",l)}},[t,r]),x.useEffect(()=>{if(!s||n===0)return;const l=n/(s.duration*ae.BASE_PPS),a=Math.max(ae.MIN,Math.min(ae.MAX,l));o(a),t.current&&(t.current.scrollLeft=0)},[s?.id,n,o,t])};function ja({notes:t,currentUser:r,onAddNote:s,onDeleteNote:n}){const[o,l]=x.useState(""),[a,i]=x.useState(!1),u=()=>{o.trim()&&(s(o,a),l(""),i(!1))},h=[...t].sort((d,m)=>d.time!==void 0&&m.time!==void 0?d.time-m.time:d.time!==void 0?-1:m.time!==void 0?1:0),c=d=>{if(d===void 0)return null;const m=Math.floor(d/60),p=Math.floor(d%60);return`${m}:${p.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add personal notes or share with your team"})]}),e.jsx(Wt,{children:e.jsxs(Gt,{className:"pt-6 space-y-3",children:[e.jsx(Cs,{placeholder:"Add a note...",value:o,onChange:d=>l(d.target.value),rows:3}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{id:"private-note",checked:a,onCheckedChange:i}),e.jsxs(W,{htmlFor:"private-note",className:"text-sm flex items-center gap-1",children:[e.jsx(qt,{className:"w-3 h-3"}),"Private Note"]})]}),e.jsxs(P,{onClick:u,disabled:!o.trim(),children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),"Add Note"]})]})]})}),e.jsx("div",{className:"space-y-3",children:h.map(d=>e.jsxs(Wt,{children:[e.jsx(ar,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm",children:d.userId===r.id?"You":"Team Member"}),d.isPrivate?e.jsxs(pt,{variant:"secondary",className:"text-xs",children:[e.jsx(qt,{className:"w-3 h-3 mr-1"}),"Private"]}):e.jsxs(pt,{variant:"outline",className:"text-xs",children:[e.jsx(Wr,{className:"w-3 h-3 mr-1"}),"Shared"]}),d.time!==void 0&&e.jsx(pt,{variant:"outline",className:"text-xs",children:c(d.time)})]})}),d.userId===r.id&&e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n(d.id),children:e.jsx(Lt,{className:"w-4 h-4"})})]})}),e.jsx(Gt,{children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:d.content})})]},d.id))}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No notes yet"})})]})}const Ds=H.memo(({track:t,isAnySolo:r,onVolumeChange:s,onMuteToggle:n,onSoloToggle:o})=>{const[l,a]=H.useState(Qe(t.volume)),[i,u]=H.useState(!1);H.useEffect(()=>{i||a(Qe(t.volume))},[t.volume,i]);const h=g=>{a(g[0])},c=()=>{u(!0)},d=()=>{u(!1),s(t.id,Bt(l))},m=()=>{a(Qe(1)),s(t.id,1)},p=r&&!t.solo,f=t.muted||p;return e.jsxs("div",{className:"flex flex-col items-center gap-3 min-w-[70px]",children:[e.jsx("div",{className:"text-xs text-center truncate w-full px-1 text-neutral-50",title:t.name,children:t.name}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center min-h-0",children:e.jsx(Vt,{children:e.jsxs(fe,{children:[e.jsx(pe,{asChild:!0,children:e.jsx("div",{className:"h-full flex items-center",onDoubleClick:m,children:e.jsx(et,{orientation:"vertical",value:[l],min:0,max:100,step:.1,onValueChange:h,onPointerDown:c,onPointerUp:d,className:"h-32",disabled:f})})}),e.jsxs(ge,{side:"top",children:[it(gt(l))," â€¢ Double-click to reset"]})]})})}),e.jsx("div",{className:`text-xs tabular-nums text-center min-w-[45px] ${f?"text-neutral-600":"text-neutral-400"}`,children:it(gt(l))}),e.jsx(P,{variant:"ghost",size:"sm",className:`h-7 w-8 text-xs p-0 ${t.muted?"bg-red-500 text-white hover:bg-red-600":"bg-neutral-700 text-neutral-50 hover:bg-neutral-600"}`,onClick:()=>n(t.id),children:"M"}),e.jsx(P,{variant:"ghost",size:"sm",className:`h-7 w-8 text-xs p-0 ${t.solo?"bg-amber-400 text-black hover:bg-amber-500":"bg-neutral-700 text-neutral-50 hover:bg-neutral-600"}`,onClick:()=>o(t.id),children:"S"}),e.jsx("div",{className:"w-full h-1 rounded",style:{backgroundColor:t.color}})]})});Ds.displayName="MixerFader";function ya({tracks:t,onTrackVolumeChange:r,onTrackMuteToggle:s,onTrackSoloToggle:n,onClose:o}){const l=t.some(a=>a.solo);return e.jsxs("div",{className:"w-full flex flex-col border-t h-[240px]",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:[e.jsxs("div",{className:"h-10 border-b flex items-center justify-between px-3 bg-neutral-800 border-neutral-700",children:[e.jsx("h3",{className:"text-sm text-neutral-50",children:"Mixer"}),e.jsx(P,{variant:"ghost",size:"icon",className:"h-7 w-7 text-neutral-400 hover:text-neutral-50",onClick:o,children:e.jsx(xs,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden p-4",children:e.jsx("div",{className:"flex gap-4 h-full",children:t.map(a=>e.jsx(Ds,{track:a,isAnySolo:l,onVolumeChange:r,onMuteToggle:s,onSoloToggle:n},a.id))})})]})}const wa=({mixerDockVisible:t,notesPanelVisible:r,song:s,orderedTracks:n,onCloseMixerDock:o,onCloseNotesPanel:l,onTrackVolumeChange:a,onTrackMuteToggle:i,onTrackSoloToggle:u,onAddNote:h,onDeleteNote:c})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(ya,{tracks:n,onTrackVolumeChange:a,onTrackMuteToggle:i,onTrackSoloToggle:u,onClose:o}),r&&s&&e.jsxs("div",{className:"w-full flex flex-col border-t",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",height:"240px"},children:[e.jsxs("div",{className:"h-10 border-b flex items-center justify-between px-3",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:"var(--daw-text-primary)"},children:"Song Notes"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-gray-700 rounded",children:e.jsx(xs,{className:"w-4 h-4",style:{color:"var(--daw-text-primary)"}})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-3",style:{backgroundColor:"var(--daw-bg-contrast)"},children:e.jsx(ja,{notes:s.notes||[],currentUser:{id:"current-user",name:"You"},onAddNote:h,onDeleteNote:c})})]})]});function ka(t,r,s="4/4",n=!0,o=50,l,a,i){const u=[],h=i?[...i].sort((b,M)=>b.time-M.time):[];let c=1,d=0,m=r,p=s,f,g=0;const y=Math.max(0,0),S=Math.min(t,t);for(;d<t;){for(;g<h.length&&h[g].time<=c;){const j=h[g];m=j.tempo,j.timeSignature&&(p=j.timeSignature),f=j.subdivision,g++}const[b]=p.split("/").map(Number),M=60/m,C=M*b;if(d+C>=y&&d<=S){d>=y&&u.push({position:d,opacity:1,type:"measure"});let j=new Set;if(f){const k=f.split("+").map(E=>parseInt(E.trim()));let N=0;for(const E of k)j.add(N),N+=E}else for(let k=0;k<b;k++)j.add(k);for(let k=1;k<b;k++){const N=d+k*M;if(N>=y&&N<S&&N<t&&(j.has(k)?u.push({position:N,opacity:.6,type:"beat"}):n&&o>50&&u.push({position:N,opacity:.4,type:"subdivision"})),n&&o>80)for(let E=1;E<4;E++){const z=N-M+M*E/4;z>d&&z>=y&&z<S&&z<t&&Math.abs(z-N)>.001&&u.push({position:z,opacity:.3,type:"subdivision"})}}if(n&&o>80){const k=d+(b-1)*M;for(let N=1;N<4;N++){const E=k+M*N/4;E>=y&&E<S&&E<t&&u.push({position:E,opacity:.3,type:"subdivision"})}}}d+=C,c++}return u}const Ca=({song:t,timelineWidth:r,onWarpCommit:s,warpMode:n})=>{const[o,l]=x.useState(!1),[a,i]=x.useState(null),[u,h]=x.useState(null),c=x.useCallback((d,m)=>{if(!n)return!1;d.preventDefault(),d.stopPropagation();const f=(d.clientX-m.left)/r*t.duration,g=t.tempoChanges||[],y=Rt(f,g,t.tempo),S=Math.round(y),M=[...g].sort((k,N)=>k.time-N.time).slice().reverse().find(k=>k.time<S),C=M?M.time:1;if(S<=C)return!0;const w=He(C,g,t.tempo),j=He(S,g,t.tempo);return i({dragMeasure:S,anchorMeasure:C,anchorTime:w,startPixel:d.clientX,originalTime:j}),l(!0),h(j),!0},[n,r,t]);return x.useEffect(()=>{if(!o||!a)return;const d=p=>{document.body.style.cursor="col-resize";const f=p.clientX-a.startPixel,g=r/t.duration,y=f/g,S=a.originalTime+y;S>a.anchorTime&&h(S)},m=p=>{document.body.style.cursor="default";const f=p.clientX-a.startPixel,g=r/t.duration,y=f/g,S=a.originalTime+y;if(S<=a.anchorTime){l(!1),i(null),h(null);return}const b=a.dragMeasure-a.anchorMeasure,M=S-a.anchorTime,C=(t.tempoChanges||[]).find(N=>N.time===a.anchorMeasure),w=C?C.timeSignature:"4/4",[j]=w.split("/").map(Number),k=Fs(b,M,j);s&&s(a.anchorMeasure,a.dragMeasure,k),l(!1),i(null),h(null)};return window.addEventListener("mousemove",d),window.addEventListener("mouseup",m),()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",m),document.body.style.cursor="default"}},[o,a,r,t,s]),{isWarpDragging:o,warpState:a,warpGhostTime:u,handleWarpMouseDown:c}},Na=({rulerId:t,song:r,timelineWidth:s,zoom:n,editMode:o,keyShift:l,showBeats:a,onRulerDrop:i,onRulerDragOver:u,onSectionClick:h,onTempoMarkerClick:c,onChordClick:d,onTimeClick:m,onTempoMarkerAdd:p,onChordAdd:f,hoverLineRef:g,onLoopRegionChange:y,loopStart:S=null,loopEnd:b=null,scrollLeft:M=0,containerWidth:C=1e3,warpMode:w=!1,onWarpCommit:j})=>{const{warpGhostTime:k,handleWarpMouseDown:N}=Ca({song:r,timelineWidth:s,onWarpCommit:j,warpMode:w}),[E,z]=H.useState(!1),[V,R]=H.useState(null),[ie,de]=H.useState(null),[U,Z]=H.useState(null),[L,be]=H.useState(!0),[le,J]=H.useState(!1),ee=O=>{if(!L||ce.length===0)return O;let $=0,T=ce.length-1;for(;$<=T;){const B=Math.floor(($+T)/2);ce[B].position<O?$=B+1:T=B-1}const A=ce[$],D=ce[$-1];return A&&D?O-D.position<A.position-O?D.position:A.position:A?A.position:D?D.position:O},Q=O=>{const $=O.currentTarget.getBoundingClientRect();if(!(w&&t==="measures"&&N(O,$))){if(!w&&t==="measures"&&y&&O.shiftKey){O.stopPropagation();const A=(O.clientX-$.left)/s*r.duration,D=ee(A);z(!0),R(D),de(D);return}if(o&&!w){if(t==="tempo"&&p){const A=(O.clientX-$.left)/s*r.duration,D=ee(A);p(D);return}if(t==="chords"&&f){const A=(O.clientX-$.left)/s*r.duration,D=ee(A);f(D);return}}if(!w){const A=(O.clientX-$.left)/s*r.duration,D=ee(A);m&&O.clientY-$.top<Ge.RULER_HEIGHT/2&&m(Math.max(0,Math.min(D,r.duration)))}}},se=()=>{const $=n>=8?1:n>=4?2:n>=2?5:n>=.5?10:30,T=[];for(let A=0;A<=r.duration;A+=$)T.push(A);return T},me=x.useMemo(()=>Math.round(n*10)/10,[n]),ce=x.useMemo(()=>ka(r.duration,r.tempo||120,"4/4",a,me*100,void 0,void 0,r.tempoChanges),[r.duration,r.tempo,r.tempoChanges,o,me,a]),Se=x.useMemo(()=>{const O=[];let $=0,T=-1,A=-100;const D=50,B=s/r.duration,G=60/(r.tempo||120)*B,_=a&&G>=25,K=a&&G>=80;return ce.forEach((q,te)=>{if(q.type==="measure"){$++,T=q.position;const ue=q.position/r.duration*s,he=ue-A>=D;he&&(A=ue),O.push({time:q.position,measure:he?$:null,beat:1,isBeat:!1,opacity:q.opacity,height:"100%",width:2,color:"rgba(255,255,255,0.6)"})}else if(q.type==="beat"&&_){const re=ce.slice(0,te).filter(xe=>xe.position>T&&xe.type==="beat").length+2,he=re===4||re===7||re===10;O.push({time:q.position,measure:null,beat:re,isBeat:!0,opacity:q.opacity,height:he?"70%":"55%",width:he?1.5:1,color:he?"rgba(255,255,255,0.35)":"rgba(255,255,255,0.25)"})}else q.type==="subdivision"&&K&&O.push({time:q.position,measure:null,beat:0,isBeat:!0,opacity:q.opacity*.5,height:"30%",width:1,color:"rgba(255,255,255,0.15)"})}),O},[ce,n,a,r.duration,s,r.tempo,M,C]);switch(t){case"time":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${Ge.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"time"),onDragOver:u,onMouseDown:Q,children:se().map(T=>e.jsx("div",{className:"absolute top-0 bottom-0 border-l",style:{left:T/r.duration*s,borderColor:"var(--daw-border)"},children:e.jsx("span",{className:"absolute top-0.5 left-1 text-[10px]",style:{color:"var(--daw-text-secondary)"},children:Pt(T)})},T))});case"measures":return e.jsxs("div",{className:"border-b relative cursor-pointer transition-colors duration-300",style:{height:`${Ge.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:w?"rgba(249, 115, 22, 0.15)":"var(--daw-bg-contrast)",borderColor:w?"#f97316":"var(--daw-border)"},onDrop:T=>i(T,"measures"),onDragOver:u,onMouseDown:Q,onMouseMove:T=>{const A=T.currentTarget.getBoundingClientRect(),B=(T.clientX-A.left)/s*r.duration,G=ee(B);if(Z(G),E&&V!==null&&y){const _=Math.min(V,G),K=Math.max(V,G);y(_,K)}},onMouseUp:()=>{E&&(z(!1),R(null),de(null))},onMouseLeave:()=>{Z(null),E&&(z(!1),R(null),de(null))},children:[Se.map((T,A)=>{const D=T.time/r.duration*s;if(!T.measure&&!T.isBeat)return null;const B=T.height,G=T.width,_=T.color,K="var(--daw-text-secondary)",q=B==="100%"?"0":B==="70%"?"15%":B==="55%"?"22.5%":"35%",te=r.tempoChanges?.find(ue=>Math.abs(ue.time-T.time)<.01);return te&&te.timeSignature&&te.timeSignature.includes("8")&&["6/8","9/8","12/8"].includes(te.timeSignature),te&&te.subdivision,e.jsxs("div",{className:`absolute transition-colors ${w?"hover:bg-orange-400/30":""}`,style:{left:D,top:q,height:B,width:`${G}px`,backgroundColor:_},title:T.isCompound?"Compound Time":T.isIrregular?"Irregular Time":void 0,children:[T.measure&&e.jsx("span",{className:"absolute -top-4 left-1 text-[10px] font-semibold whitespace-nowrap",style:{color:K},children:T.measure}),a&&T.isBeat&&T.beat>0&&e.jsx("span",{className:"absolute -top-4 left-1 text-[9px] whitespace-nowrap",style:{color:"var(--daw-text-muted)"},children:T.beat})]},A)}),w&&(r.tempoChanges||[]).map((T,A)=>{const B=He(T.time,r.tempoChanges||[],r.tempo)/r.duration*s;return e.jsx("div",{className:"absolute -top-0.5 -left-1.5 w-3 h-3 z-20 pointer-events-none",style:{left:B,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #f97316",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}},`warp-anchor-${A}`)}),U!==null&&!w&&e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-cyan-400/50 pointer-events-none transition-all duration-75",style:{left:U/r.duration*s},children:e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 px-1.5 py-0.5 bg-cyan-500 text-white text-[9px] rounded whitespace-nowrap",children:Pt(U)})}),k!==null&&e.jsxs("div",{className:"absolute top-0 bottom-0 w-0.5 bg-orange-500 z-50 pointer-events-none",style:{left:k/r.duration*s},children:[e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 px-1.5 py-0.5 bg-orange-500 text-white text-[9px] rounded whitespace-nowrap font-bold",children:"WARP"}),e.jsx("div",{className:"absolute -top-0.5 -left-1.5 w-3 h-3 z-50",style:{borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #f97316",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}})]}),E&&V!==null&&U!==null&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-yellow-500/20 border-l-2 border-r-2 border-yellow-500/60 pointer-events-none",style:{left:Math.min(V,U)/r.duration*s,width:Math.abs(U-V)/r.duration*s}})]});case"tempo":const $=[...o?r.tempoChanges||[]:(r.tempoChanges||[]).filter(T=>!T.hidden)].sort((T,A)=>T.time-A.time);return e.jsxs("div",{className:"tempo-ruler-interactive border-b relative cursor-pointer transition-all duration-300",style:{height:le?"120px":`${Ge.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"tempo"),onDragOver:u,onMouseDown:Q,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-4 z-50 flex items-center justify-center hover:bg-white/10 cursor-pointer text-[10px] text-muted-foreground",onClick:T=>{T.stopPropagation(),J(!le)},title:le?"Collapse Tempo View":"Expand Tempo View",children:e.jsx("div",{className:`transform transition-transform ${le?"rotate-90":"rotate-0"}`,children:"â–¶"})}),le&&e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none opacity-30",children:e.jsx("polyline",{points:$.map(T=>{const A=He(T.time,r.tempoChanges||[],r.tempo)/r.duration*s,D=120-(Math.min(Math.max(T.tempo,60),200)-60)/140*120;return`${A},${D}`}).join(" "),fill:"none",stroke:"#f97316",strokeWidth:"2"})}),$.map((T,A)=>{const D=A>0?$[A-1]:null,B=!D||D.timeSignature!==T.timeSignature,G=He(T.time,r.tempoChanges||[],r.tempo);return e.jsxs("div",{className:"absolute top-0.5 flex items-start cursor-pointer group z-10",style:{left:G/r.duration*s},onClick:_=>{_.stopPropagation(),_.preventDefault(),o&&c(T)},children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-px",style:{backgroundColor:"#f97316",opacity:.4,height:le?"120px":"100%"}}),e.jsxs("div",{className:"absolute top-0 -translate-x-1/2 flex gap-1 flex-col items-center",children:[e.jsx("div",{className:"hover:brightness-110 transition-all",style:{backgroundColor:"#f97316",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},children:Ss(T.tempo)}),B&&e.jsx("div",{className:"hover:brightness-110 transition-all mt-0.5",style:{backgroundColor:"#6b7280",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},children:T.timeSignature})]})]},`tempo-${A}`)})]});case"chords":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${Ge.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"chords"),onDragOver:u,onMouseDown:Q,children:(r.chordMarkers||[]).map((T,A)=>e.jsx("div",{className:"absolute top-0.5",style:{left:T.time/r.duration*s},children:e.jsx("div",{className:"cursor-pointer hover:brightness-110 transition-all",style:{backgroundColor:"#3b82f6",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},onClick:D=>{D.stopPropagation(),d(T)},children:Dt(T.chord,l)})},A))});case"sections":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${Ge.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"sections"),onDragOver:u,onMouseDown:Q,children:r.markers.map((T,A)=>{const D=T.time/r.duration*s,B=r.markers[A+1],G=B?(B.time-T.time)/r.duration*s:s-D,_={intro:{bg:"#22c55e",text:"#fff"},verse:{bg:"#3b82f6",text:"#fff"},chorus:{bg:"#ef4444",text:"#fff"},bridge:{bg:"#f59e0b",text:"#fff"},outro:{bg:"#8b5cf6",text:"#fff"},"pre-chorus":{bg:"#ec4899",text:"#fff"},instrumental:{bg:"#14b8a6",text:"#fff"},tag:{bg:"#64748b",text:"#fff"},custom:{bg:"#6b7280",text:"#fff"}},K=_[T.type]||_.custom;return e.jsx("div",{className:"absolute top-0.5 cursor-pointer hover:brightness-110 transition-all",style:{left:D,width:Math.max(40,G-4),height:"24px",backgroundColor:K.bg,borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)"},onClick:q=>{q.stopPropagation(),h(A)},children:e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-semibold pointer-events-none truncate px-2",style:{color:K.text},children:T.label})},T.id)})});default:return null}},Ps=H.memo(({song:t,currentTime:r,gridTime:s,tempo:n,zoom:o,pixelsPerSecond:l,containerWidth:a,visibleRulers:i,rulerOrder:u,onTimeClick:h,onMarkerEdit:c,onMarkerDelete:d,editMode:m,keyShift:p,onChordClick:f,onLoopRegionChange:g,loopStart:y,loopEnd:S,scrollLeft:b,warpMode:M=!1,onWarpCommit:C,onTempoMarkerAdd:w,onChordAdd:j})=>{const k=l||o*100,N=u.filter(R=>i.includes(R)),E=R=>{f&&f(R.chord,R.customDiagram)},z=R=>{m&&!M&&c&&t.markers[R]&&c(t.markers[R],"section")},V=R=>{m&&!M&&c&&c(R,"tempo")};return e.jsxs("div",{className:"relative flex-shrink-0 z-10",style:{width:`${t.duration*k}px`},children:[e.jsx("div",{className:"absolute top-0 bottom-0 z-50 pointer-events-none",style:{left:`${r*k}px`},children:e.jsx("div",{className:"absolute top-0 bottom-0",style:{width:"2px",backgroundColor:"#ef4444"},children:e.jsx("div",{className:"absolute -top-0 left-1/2 -translate-x-1/2",style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"8px solid #ef4444"}})})}),N.map(R=>e.jsx(Na,{rulerId:R,song:t,timelineWidth:t.duration*k,zoom:o,editMode:m,keyShift:p,showBeats:!0,onRulerDrop:()=>{},onRulerDragOver:ie=>ie.preventDefault(),onSectionClick:z,onTempoMarkerClick:V,onChordClick:E,onTimeClick:h,onLoopRegionChange:R==="measures"?g:void 0,loopStart:y,loopEnd:S,scrollLeft:b,containerWidth:a,warpMode:M,onWarpCommit:C,onTempoMarkerAdd:w,onChordAdd:j},R))]})});Ps.displayName="RulersContainer";const Ta=({songDuration:t,zoom:r,containerWidth:s,timelineRef:n,onNavigate:o})=>{const[l,a]=x.useState({start:0,end:1}),i=x.useRef(!1);x.useEffect(()=>{const h=n.current;if(!h)return;const c=()=>{if(i.current)return;const d=h.scrollLeft,m=t*ae.BASE_PPS*r;if(m===0)return;const p=d/m,f=(d+s)/m;a({start:Math.max(0,p),end:Math.min(1,f)})};return c(),h.addEventListener("scroll",c),()=>h.removeEventListener("scroll",c)},[t,r,s,n]);const u=H.useCallback(({start:h,end:c})=>{i.current=!0,a({start:h,end:c});const d=c-h;if(d<=1e-4)return;const p=s/d/(t*ae.BASE_PPS),f=Math.max(ae.MIN,Math.min(ae.MAX,p)),g=t*ae.BASE_PPS*f,y=h*g;o(f,y),setTimeout(()=>{i.current=!1},100)},[s,t,o]);return e.jsx("div",{className:"flex-1 px-4 flex items-center h-full",children:e.jsx(pn,{start:l.start,end:l.end,onChange:u,className:"h-5 w-full"})})};function Sa({song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n,onExportProject:o}){const{t:l}=tt(),a=En(),{zoom:i,setZoom:u,trackHeight:h,setTrackHeight:c,rulerVisibility:d,rulerOrder:m,setRulerOrder:p}=a,f=fa({song:t}),{keyShift:g,setKeyShift:y,editMode:S,setEditMode:b,createProjectOpen:M,setCreateProjectOpen:C,containerWidth:w,setContainerWidth:j,snapEnabled:k,setSnapEnabled:N,sidebarVisible:E,setSidebarVisible:z,mixerVisible:V,mixerDockVisible:R,setMixerDockVisible:ie,mixPresetsPopoverOpen:de,setMixPresetsPopoverOpen:U,selectedChord:Z,setSelectedChord:L,showShortcutsHelp:be,setShowShortcutsHelp:le,setIsDragging:J,scrollTop:ee,pinnedTracks:Q,setPinnedTracks:se,selectedTrackForNotes:me,setSelectedTrackForNotes:ce,notesPanelVisible:Se,setNotesPanelVisible:O,warpMode:$,setWarpMode:T,rulerRef:A,sidebarRef:D,timelineRef:B,hoveredContainerRef:G}=f,{isPlaying:_,currentTime:K,gridTime:q,tempo:te,loopEnabled:ue,loopStart:re,loopEnd:he,metronomeEnabled:xe,metronomeVolume:we,actions:Y}=Tn({song:t,warpModeEnabled:!1}),ne=Dn({song:t,onSongUpdate:r}),{mixPresets:Oe,handleSaveMixPreset:Re,handleLoadMixPreset:st,handleDeleteMixPreset:Be}=ma({song:t,onSongUpdate:r}),{editorOpen:$e,setEditorOpen:ze,editorType:_e,editingMarker:rt,clickedTime:v,handleTimelineClick:F,handleTimelineItemSubmit:oe,openEditor:X}=ha({song:t,onSongUpdate:r,editMode:S}),{handleZoomOutOnPlayhead:ke,handleZoomInOnPlayhead:Ve,handleFitToView:We}=xa({zoom:i,setZoom:u,song:t,containerWidth:w}),{handleTimelineScroll:nt,handleNavigatorChange:at}=ua({zoom:i,setZoom:u,timelineRef:B,rulerRef:A,currentTime:K}),{getPixelsPerSecond:Ke,getTrackHeightPx:wt,getCurrentMeasure:kt,getCurrentTimeSignature:Ct}=pa({song:t,zoom:i,currentTime:K,trackHeight:h}),{handleWarpCommit:Nt}=ga({song:t,onSongUpdate:r}),{handleAddSongNote:Rs,handleDeleteSongNote:Is,handleSaveTrackNotes:Ls}=ba({song:t,onSongUpdate:r});va({timelineRef:B,setContainerWidth:j,song:t,containerWidth:w,setZoom:u});const Os=I=>{a.setRulerVisibility(I),Object.entries(I).forEach(([ve,Ce])=>{Pe.setRulerVisibility(ve,Ce)})},Bs=H.useCallback(()=>{J(!1)},[]),$s=H.useCallback(I=>{G.current!=="timeline"&&B.current&&B.current.scrollTop!==I&&(B.current.scrollTop=I)},[]),zs=H.useCallback(I=>{if(!B.current)return;const ve=B.current.scrollHeight,Ce=I.start*ve;B.current.scrollTop=Ce,D.current&&(D.current.scrollTop=Ce)},[]),_s=H.useCallback(()=>{if(!B.current)return{start:0,end:1};const I=B.current.scrollHeight,ve=B.current.clientHeight;if(I<=ve)return{start:0,end:1};const Ce=B.current.scrollTop,Js=Ce/I,er=(Ce+ve)/I;return{start:Js,end:er}},[ee]),Vs=H.useCallback(I=>{},[]),Ws=H.useCallback((I,ve)=>{},[]),Gs=H.useCallback(()=>{},[]),Hs=H.useCallback(()=>{},[]),qs=H.useCallback(()=>{ie(!1)},[]);Sn({isPlaying:_,onPlayPause:Y.togglePlayPause,onStop:()=>Y.seek(0),onToggleLoop:()=>Y.setLoopEnabled(!ue),onToggleMetronome:()=>Y.setMetronomeEnabled(!xe),onZoomIn:()=>u(I=>Math.min(8,I+.25)),onZoomOut:()=>u(I=>Math.max(.5,I-.25)),onGoToStart:()=>Y.seek(0),onGoToEnd:()=>Y.seek(t?.duration||0),onFitToView:()=>{if(t&&w>0){const I=w/(t.duration*ae.BASE_PPS),ve=Math.max(ae.MIN,Math.min(ae.MAX,I));u(ve),nt(0)}},onToggleEditMode:()=>b(I=>!I)});const[Ks,Ea]=H.useState(null),Us=I=>{S&&!$?X("chord",I):L({chord:I.chord,customDiagram:I.customDiagram})};if(!t)return e.jsxs("div",{className:"flex flex-col h-full text-white",style:{backgroundColor:"var(--daw-bg-main)"},children:[e.jsxs("div",{className:"border-b p-3 flex items-center justify-between",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs(P,{variant:"ghost",size:"sm",onClick:n,className:"text-white hover:bg-gray-700",children:[e.jsx(Ot,{className:"w-4 h-4 mr-2"}),"Back to Library"]}),e.jsx("h2",{children:"Player"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"No Project Loaded"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create a new project or load one from the library"})]})})}),e.jsx(Ft,{open:!1,onOpenChange:()=>{},onCreateProject:async()=>{}})]});const ht=x.useMemo(()=>{if(!t?.tracks)return[];const I=t.tracks.filter(Ce=>Q.has(Ce.id)),ve=t.tracks.filter(Ce=>!Q.has(Ce.id));return[...I,...ve]},[t?.tracks,Q]),Xs=I=>{X("tempo",void 0,I)},Zs=I=>{X("chord",void 0,I)},Ys={song:t,updateSong:I=>{r&&r(I)},tracks:t?.tracks||[],trackActions:{updateVolume:ne.handleTrackVolumeChange,toggleMute:ne.handleTrackMuteToggle,toggleSolo:ne.handleTrackSoloToggle,updateName:ne.handleTrackNameChange,updateColor:ne.handleTrackColorChange,updateTag:ne.handleTrackTagChange},currentTime:K,gridTime:q,tempo:te,isPlaying:_,zoom:i,setZoom:u,editMode:S,setEditMode:b,warpMode:$,setWarpMode:T,keyShift:g,setKeyShift:y},xt=$?"warp":S?"marker":null,Qs=I=>{I==="warp"?(T(!0),b(!0)):I==="marker"?(T(!1),b(!0)):(T(!1),b(!1))};return e.jsx(vn,{value:Ys,children:e.jsx(Vt,{children:e.jsxs("div",{className:"flex flex-col h-full text-white",style:{backgroundColor:"var(--daw-bg-main)"},children:[e.jsx(Gn,{songTitle:t.title,songKey:t.key,isPlaying:_,currentTime:K,tempo:te,loopEnabled:ue,metronomeEnabled:xe,metronomeVolume:we,currentMeasure:String(kt()),currentTimeSignature:Ct(),displayTempo:te,keyShift:g,trackHeight:h,rulerVisibility:d,rulerOrder:m,snapEnabled:k,onBack:n,onPlayPause:Y.togglePlayPause,onStop:Y.stop,onLoopToggle:()=>Y.setLoopEnabled(!ue),onMetronomeToggle:()=>Y.setMetronomeEnabled(!xe),onMetronomeVolumeChange:Y.setMetronomeVolume,onTempoChange:Y.setTempo,onKeyShiftChange:y,onTrackHeightChange:c,onRulerVisibilityChange:Os,onRulerOrderChange:p,onSnapToggle:()=>N(!k),onSnapModeChange:I=>console.log("Snap mode:",I),activeTool:xt,onToolChange:Qs}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-none h-auto border-b z-30",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:[E&&V&&e.jsx("div",{className:"flex-none border-r",style:{width:"280px",minWidth:"280px",maxWidth:"280px",backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:e.jsx(na,{visibleRulers:Object.keys(d).filter(I=>d[I]),rulerOrder:m,onRulerOrderChange:p})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-hidden",ref:A,children:e.jsx(Ps,{song:t,currentTime:K,gridTime:q,tempo:te,zoom:i,pixelsPerSecond:Ke(),containerWidth:w,visibleRulers:Object.keys(d).filter(I=>d[I]),rulerOrder:m,onTimeClick:I=>Y.seek(I),onMarkerEdit:(I,ve)=>X(ve,I),onMarkerDelete:(I,ve)=>{},onTempoMarkerAdd:xt==="marker"?Xs:void 0,onChordAdd:xt==="marker"?Zs:void 0,editMode:xt==="marker",keyShift:g,warpMode:$,onWarpCommit:Nt,onChordClick:I=>{const ve=t?.chordMarkers?.find(Ce=>Ce.chord===I);ve&&Us(ve)}})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[E&&V&&e.jsx(As,{ref:D,tracks:ht,trackHeight:h,editingTrackId:null,trackNameInput:"",pinnedTracks:Q,onTrackVolumeChange:ne.handleTrackVolumeChange,onTrackMuteToggle:ne.handleTrackMuteToggle,onTrackSoloToggle:ne.handleTrackSoloToggle,onTrackNameChange:ne.handleTrackNameChange,onTrackColorChange:ne.handleTrackColorChange,onTrackTagsChange:Ws,onTrackNotesOpen:ce,onEditingTrackIdChange:Gs,onTrackNameInputChange:Hs,onPinnedTracksChange:se,onScroll:$s}),e.jsx(Ts,{ref:B,song:t,currentTime:K,zoom:i,pixelsPerSecond:Ke(),filteredTracks:ht,loopStart:re,loopEnd:he,trackHeightPx:wt(),onTimelineMouseDown:F,onTimelineMouseMove:Vs,onTimelineMouseUp:Bs,onScroll:nt}),e.jsx("div",{className:"w-4 flex-shrink-0",style:{backgroundColor:"var(--daw-bg-contrast)"},children:e.jsx(gn,{..._s(),onChange:zs,minHeight:.05})})]})]}),e.jsx(wa,{mixerDockVisible:R,notesPanelVisible:Se,orderedTracks:ht,song:t,onTrackVolumeChange:ne.handleTrackVolumeChange,onTrackMuteToggle:ne.handleTrackMuteToggle,onTrackSoloToggle:ne.handleTrackSoloToggle,onCloseMixerDock:qs,onCloseNotesPanel:()=>O(!1),onAddNote:Rs,onDeleteNote:Is}),e.jsxs("div",{className:"border-t flex items-center h-8",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("div",{className:"border-r flex items-center flex-shrink-0",style:{width:E&&V?"280px":"0",minWidth:E&&V?"280px":"0",borderColor:"var(--daw-border)"},children:e.jsx(aa,{zoom:i,onZoomIn:Ve,onZoomOut:ke,onFitToView:We})}),e.jsx(Ta,{songDuration:t.duration,zoom:i,containerWidth:w,timelineRef:B,onNavigate:at})]}),e.jsx(da,{sidebarVisible:E,mixerDockVisible:R,notesPanelVisible:Se,mixPresetsPopoverOpen:de,tracks:ht,mixPresets:Oe,onToggleSidebar:()=>z(!E),onToggleMixer:()=>ie(!R),onToggleNotes:()=>O(!Se),onPerformanceMode:s||(()=>{}),onMixPresetsOpenChange:U,onSaveMixPreset:Re,onLoadMixPreset:st,onDeleteMixPreset:Be}),e.jsx(Ft,{open:M,onOpenChange:C,onCreateProject:async()=>{}}),e.jsx(dn,{open:$e,onOpenChange:ze,type:_e,currentTime:Ks??v,initialData:rt,onSubmit:oe}),Z&&e.jsx(xn,{chord:Z.chord,isOpen:!!Z,onClose:()=>L(null),customDiagram:Z.customDiagram}),me&&e.jsx(fn,{open:!!me,onOpenChange:I=>{I||ce(null)},trackName:me.name,notes:me.notes||"",onSave:I=>Ls(I,me.id)}),e.jsx(Ur,{isOpen:be,onClose:()=>le(!1)})]})})})}function Ma({song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n,onCreateProject:o,onExportProject:l}){return t?e.jsx(Sa,{song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n}):e.jsxs("div",{className:"flex flex-col h-full bg-gray-900 text-white",children:[e.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 p-3 flex items-center justify-between",children:[e.jsxs(P,{variant:"ghost",size:"sm",onClick:n,className:"text-white hover:bg-gray-700",children:[e.jsx(Ot,{className:"w-4 h-4 mr-2"}),"Back to Library"]}),e.jsx("h2",{children:"Player"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"No Project Loaded"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create a new project or load one from the library"})]})})}),e.jsx(Ft,{open:!1,onOpenChange:()=>{},onCreateProject:o||(async()=>{})})]})}const za=Object.freeze(Object.defineProperty({__proto__:null,DAWPlayer:Ma},Symbol.toStringTag,{value:"Module"}));export{Oa as A,za as D,La as L,oa as P,et as S,Cs as T,Ba as a,Tn as b,ia as c,la as d,Cn as e,Pt as f,wn as g,Nn as h,_t as p,$a as r,Pe as s,tt as u,ft as w};
