import{c as je,j as e,D as ht,a as mt,b as xt,d as ft,e as pt,R as z,B as jt,S as ls,r as u,u as _e,f as is,g as Tt,P as Ie,h as X,i as An,k as Fn,l as Le,m as et,n as A,o as Ve,L as B,I as Ee,p as De,q as Pe,s as Ae,t as Fe,v as ve,T as Ws,w as Hs,x as Ue,y as qe,z as cs,A as Ks,C as Ne,E as Xs,F as Oe,G as Ut,H as Et,J as Jt,K as Us,M as qs,N as tt,O as Ys,Q as Zs,U as Qs,V as Js,W as Rn,X as ds,Y as _n,Z as er,_ as tr,$ as In,a0 as On,a1 as Ln,a2 as Bn,a3 as $n,a4 as zn,a5 as Gn,a6 as Vn,a7 as Ye,a8 as Wn,a9 as Hn,aa as sr,ab as Kn,ac as es,ad as rr,ae as Ms,af as Xn,ag as Un,ah as us,ai as qn,aj as Yn,ak as Zn,al as Qn,am as Jn,an as eo,ao as to,ap as Ss,aq as Ts,ar as Es,as as so,at as ts,au as ro}from"./index-DDwOnqaL.js";import{formatDb as it,gainToSlider as Ze,sliderToGain as hs,gainToDb as no,sliderToDb as wt}from"./audioUtils-Cc9bhjb-.js";import{S as oo}from"./sliders-vertical-DxPB0Ml8.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ms=je("arrow-left",ao);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lo=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],io=je("eye-off",lo);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],uo=je("eye",co);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ho=[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]],nr=je("maximize-2",ho);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],xo=je("panel-left-close",mo);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],po=je("panel-left",fo);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],vo=je("pen-line",go);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],yo=je("save",bo);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],wo=je("square",jo);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]],ko=je("sticky-note",Co);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Mo=je("triangle-alert",No);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],To=je("users",So);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eo=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Do=je("zoom-in",Eo);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Ao=je("zoom-out",Po),qt=[{category:"Playback",items:[{keys:["Space"],description:"Play / Pause"},{keys:["Home"],description:"Go to start"},{keys:["End"],description:"Go to end"},{keys:["R"],description:"Reset to start"},{keys:["â†"],description:"Jump backward 5 seconds"},{keys:["â†’"],description:"Jump forward 5 seconds"},{keys:["Shift","â†"],description:"Previous section"},{keys:["Shift","â†’"],description:"Next section"}]},{category:"View",items:[{keys:["+"],description:"Zoom in"},{keys:["-"],description:"Zoom out"},{keys:["0"],description:"Reset zoom"}]},{category:"Tools",items:[{keys:["L"],description:"Toggle loop"},{keys:["M"],description:"Toggle metronome"}]}];function Fo({isOpen:t,onClose:r}){return e.jsx(ht,{open:t,onOpenChange:r,children:e.jsxs(mt,{className:"max-w-2xl",children:[e.jsxs(xt,{children:[e.jsx(ft,{children:"Keyboard Shortcuts"}),e.jsx(pt,{children:"Use these keyboard shortcuts to navigate and control the player efficiently"})]}),e.jsx("div",{className:"space-y-6 py-4",children:qt.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700",children:s.category}),e.jsx("div",{className:"space-y-2",children:s.items.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm text-gray-600",children:n.description}),e.jsx("div",{className:"flex gap-1",children:n.keys.map((l,a)=>e.jsxs(z.Fragment,{children:[a>0&&e.jsx("span",{className:"text-gray-400 mx-1",children:"+"}),e.jsx(jt,{variant:"secondary",className:"font-mono px-2 py-1 bg-gray-100 text-gray-700 border",children:l})]},a))})]},o))}),s.category!==qt[qt.length-1].category&&e.jsx(ls,{className:"mt-4"})]},s.category))}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"Tip:"})," Most shortcuts won't work when typing in text fields"]})]})})}var Dt="Switch",[Ro]=Tt(Dt),[_o,Io]=Ro(Dt),or=u.forwardRef((t,r)=>{const{__scopeSwitch:s,name:n,checked:o,defaultChecked:l,required:a,disabled:i,value:h="on",onCheckedChange:m,form:c,...d}=t,[x,p]=u.useState(null),f=_e(r,S=>p(S)),g=u.useRef(!1),b=x?c||!!x.closest("form"):!0,[C,j]=is({prop:o,defaultProp:l??!1,onChange:m,caller:Dt});return e.jsxs(_o,{scope:s,checked:C,disabled:i,children:[e.jsx(Ie.button,{type:"button",role:"switch","aria-checked":C,"aria-required":a,"data-state":cr(C),"data-disabled":i?"":void 0,disabled:i,value:h,...d,ref:f,onClick:X(t.onClick,S=>{j(k=>!k),b&&(g.current=S.isPropagationStopped(),g.current||S.stopPropagation())})}),b&&e.jsx(ir,{control:x,bubbles:!g.current,name:n,value:h,checked:C,required:a,disabled:i,form:c,style:{transform:"translateX(-100%)"}})]})});or.displayName=Dt;var ar="SwitchThumb",lr=u.forwardRef((t,r)=>{const{__scopeSwitch:s,...n}=t,o=Io(ar,s);return e.jsx(Ie.span,{"data-state":cr(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:r})});lr.displayName=ar;var Oo="SwitchBubbleInput",ir=u.forwardRef(({__scopeSwitch:t,control:r,checked:s,bubbles:n=!0,...o},l)=>{const a=u.useRef(null),i=_e(a,l),h=An(s),m=Fn(r);return u.useEffect(()=>{const c=a.current;if(!c)return;const d=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(d,"checked").set;if(h!==s&&p){const f=new Event("click",{bubbles:n});p.call(c,s),c.dispatchEvent(f)}},[h,s,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...o,tabIndex:-1,ref:i,style:{...o.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ir.displayName=Oo;function cr(t){return t?"checked":"unchecked"}var Lo=or,Bo=lr;function lt({className:t,...r}){return e.jsx(Lo,{"data-slot":"switch",className:Le("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(Bo,{"data-slot":"switch-thumb",className:Le("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const xs={C:261.63,"C#":277.18,Db:277.18,D:293.66,"D#":311.13,Eb:311.13,E:329.63,F:349.23,"F#":369.99,Gb:369.99,G:392,"G#":415.3,Ab:415.3,A:440,"A#":466.16,Bb:466.16,B:493.88};let Yt=null;function Pt(){return Yt||(Yt=new(window.AudioContext||window.webkitAudioContext)),Yt}function fs(t,r,s,n=.3){const o=Pt(),l=o.createOscillator(),a=o.createGain();l.type="sine",l.frequency.setValueAtTime(t,s),a.gain.setValueAtTime(0,s),a.gain.linearRampToValueAtTime(n,s+.01),a.gain.exponentialRampToValueAtTime(n*.7,s+.1),a.gain.setValueAtTime(n*.7,s+r-.1),a.gain.exponentialRampToValueAtTime(.01,s+r),l.connect(a),a.connect(o.destination),l.start(s),l.stop(s+r)}function dr(t,r=1.5,s=.25){const o=Pt().currentTime;t.forEach(l=>{const a=xs[l];a&&fs(a,r,o,s)})}function ur(t,r=1.5){const s=["E","A","D","G","B","E"];t.forEach((l,a)=>{});const o=Pt().currentTime;t.forEach((l,a)=>{if(l>=0){const i=s[a],h=xs[i];if(h){const m=h*Math.pow(2,l/12);fs(m,r,o+a*.03,.15)}}})}function hr(t,r=1.5){const s=["G","C","E","A"],o=Pt().currentTime;t.forEach((l,a)=>{if(l>=0){const i=s[a],h=xs[i];if(h){const m=h*Math.pow(2,l/12);fs(m,r,o+a*.03,.2)}}})}function $o({frets:t,fingers:r,startFret:s=1,onChange:n}){const{t:o}=et(),l=["E","A","D","G","B","e"],a=5,i=(c,d)=>{const x=[...t],p=[...r],f=d===0?0:d+s-1;x[c]===f?(x[c]=0,p[c]=0):(x[c]=f,f>0?p[c]=Math.min(4,d):p[c]=0),n(x,p)},h=c=>{const d=[...t],x=[...r];d[c]===-1?(d[c]=0,x[c]=0):(d[c]=-1,x[c]=0),n(d,x)},m=()=>{ur(t)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:o.clickFretsToPlace}),e.jsxs(A,{variant:"outline",size:"sm",onClick:m,className:"gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Play"]})]}),e.jsxs("svg",{width:"240",height:"320",viewBox:"0 0 240 320",className:"border rounded-lg bg-white",children:[[...Array(a)].map((c,d)=>e.jsx("line",{x1:"50",y1:70+d*40,x2:"210",y2:70+d*40,stroke:"#666",strokeWidth:d===0?"4":"2"},`fret-${d}`)),[...Array(6)].map((c,d)=>e.jsx("line",{x1:50+d*32,y1:"70",x2:50+d*32,y2:"230",stroke:"#666",strokeWidth:"2"},`string-${d}`)),s>1&&e.jsxs("text",{x:"25",y:"90",fontSize:"14",fill:"#333",textAnchor:"middle",fontWeight:"600",children:[s,"fr"]}),l.map((c,d)=>{const x=50+d*32,p=t[d]===-1;return e.jsxs("g",{children:[e.jsx("rect",{x:x-12,y:"260",width:"24",height:"24",fill:"transparent",cursor:"pointer",onClick:()=>h(d)}),e.jsx("text",{x,y:"275",fontSize:"14",fill:p?"#999":"#333",textAnchor:"middle",cursor:"pointer",onClick:()=>h(d),style:{userSelect:"none"},children:c})]},`label-${d}`)}),t.map((c,d)=>{const x=50+d*32;if(c===-1)return e.jsxs("g",{children:[e.jsx("circle",{cx:x,cy:"45",r:"8",fill:"#ef4444"}),e.jsx("line",{x1:x-4,y1:"41",x2:x+4,y2:"49",stroke:"white",strokeWidth:"2"}),e.jsx("line",{x1:x+4,y1:"41",x2:x-4,y2:"49",stroke:"white",strokeWidth:"2"})]},`marker-${d}`);if(c===0)return e.jsx("circle",{cx:x,cy:"45",r:"7",fill:"none",stroke:"#22c55e",strokeWidth:"2.5"},`marker-${d}`);{const p=c-s+1;if(p>=1&&p<=a){const f=70+(p-.5)*40,g=r[d];return e.jsxs("g",{children:[e.jsx("circle",{cx:x,cy:f,r:"11",fill:"#2563eb"}),g>0&&e.jsx("text",{x,y:f+5,fontSize:"13",fill:"white",textAnchor:"middle",fontWeight:"600",children:g})]},`marker-${d}`)}return null}}),[...Array(6)].map((c,d)=>[...Array(a)].map((x,p)=>{const f=50+d*32,g=70+p*40,b=p+1;return e.jsx("rect",{x:f-16,y:g-20,width:"32",height:"40",fill:"transparent",cursor:"pointer",onClick:()=>i(d,b)},`click-${d}-${p}`)})),[...Array(6)].map((c,d)=>{const x=50+d*32;return e.jsx("rect",{x:x-16,y:"30",width:"32",height:"30",fill:"transparent",cursor:"pointer",onClick:()=>i(d,0)},`open-${d}`)})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 text-center max-w-xs",children:[e.jsxs("p",{children:["â€¢ ",o.greenCircles]}),e.jsxs("p",{children:["â€¢ ",o.redCircles]}),e.jsxs("p",{children:["â€¢ ",o.blueDots]})]})]})}function zo({frets:t,fingers:r,startFret:s=1,onChange:n}){const{t:o}=et(),l=["G","C","E","A"],a=5,i=(m,c)=>{const d=[...t],x=[...r],p=c===0?0:c+s-1;d[m]===p?(d[m]=0,x[m]=0):(d[m]=p,p>0?x[m]=Math.min(4,c):x[m]=0),n(d,x)},h=()=>{hr(t)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:o.clickFretsToPlace}),e.jsxs(A,{variant:"outline",size:"sm",onClick:h,className:"gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Play"]})]}),e.jsxs("svg",{width:"200",height:"320",viewBox:"0 0 200 320",className:"border rounded-lg bg-white",children:[[...Array(a)].map((m,c)=>e.jsx("line",{x1:"50",y1:70+c*40,x2:"170",y2:70+c*40,stroke:"#666",strokeWidth:c===0?"4":"2"},`fret-${c}`)),[...Array(4)].map((m,c)=>e.jsx("line",{x1:50+c*40,y1:"70",x2:50+c*40,y2:"230",stroke:"#666",strokeWidth:"2"},`string-${c}`)),s>1&&e.jsxs("text",{x:"25",y:"90",fontSize:"14",fill:"#333",textAnchor:"middle",fontWeight:"600",children:[s,"fr"]}),l.map((m,c)=>{const d=50+c*40;return e.jsx("text",{x:d,y:"275",fontSize:"14",fill:"#333",textAnchor:"middle",style:{userSelect:"none"},children:m},`label-${c}`)}),t.map((m,c)=>{const d=50+c*40;if(m===0)return e.jsx("circle",{cx:d,cy:"45",r:"7",fill:"none",stroke:"#22c55e",strokeWidth:"2.5"},`marker-${c}`);{const x=m-s+1;if(x>=1&&x<=a){const p=70+(x-.5)*40,f=r[c];return e.jsxs("g",{children:[e.jsx("circle",{cx:d,cy:p,r:"11",fill:"#2563eb"}),f>0&&e.jsx("text",{x:d,y:p+5,fontSize:"13",fill:"white",textAnchor:"middle",fontWeight:"600",children:f})]},`marker-${c}`)}return null}}),[...Array(4)].map((m,c)=>[...Array(a)].map((d,x)=>{const p=50+c*40,f=70+x*40,g=x+1;return e.jsx("rect",{x:p-20,y:f-20,width:"40",height:"40",fill:"transparent",cursor:"pointer",onClick:()=>i(c,g)},`click-${c}-${x}`)})),[...Array(4)].map((m,c)=>{const d=50+c*40;return e.jsx("rect",{x:d-20,y:"30",width:"40",height:"30",fill:"transparent",cursor:"pointer",onClick:()=>i(c,0)},`open-${c}`)})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center max-w-xs",children:e.jsxs("p",{children:["â€¢ ",o.blueDotsFingers]})})]})}function Go({keys:t,onChange:r}){const{t:s}=et(),n=u.useRef(null),o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],a=[...o.map(x=>`${x}4`),...l.map(x=>`${x}5`)];u.useEffect(()=>{n.current&&(n.current.scrollLeft=200)},[]);const i=x=>{const p=[...t],f=p.indexOf(x);f>-1?p.splice(f,1):p.push(x),r(p)},h=x=>x.replace(/[0-9]/g,""),m=x=>x.includes("#"),c=x=>x.startsWith("C"),d=()=>{const x=t.map(p=>h(p));dr(x)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.clickPianoKeys}),e.jsxs(A,{variant:"outline",size:"sm",onClick:d,className:"gap-2",disabled:t.length===0,children:[e.jsx(Ve,{className:"w-4 h-4"}),"Play"]})]}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto border rounded-lg bg-gray-100 p-4",ref:n,children:e.jsxs("svg",{width:"860",height:"200",viewBox:"0 0 860 200",className:"min-w-[860px]",children:[a.filter(x=>!m(h(x))).map((x,p)=>{const f=20+p*56,g=t.includes(x),b=c(x);return e.jsxs("g",{children:[e.jsx("rect",{x:f,y:"20",width:"54",height:"150",fill:g?"#2563eb":"white",stroke:b?"#dc2626":"#333",strokeWidth:b?"3":"2",rx:"4",cursor:"pointer",onClick:()=>i(x)}),b&&e.jsx("circle",{cx:f+27,cy:"155",r:"4",fill:g?"white":"#dc2626"}),e.jsx("text",{x:f+27,y:"140",fontSize:"12",fill:g?"white":"#666",textAnchor:"middle",cursor:"pointer",onClick:()=>i(x),style:{userSelect:"none"},children:h(x)})]},`white-${x}`)}),a.filter(x=>m(h(x))).map(x=>{const p=h(x),f=x.replace(/[^0-9]/g,""),g=parseInt(f)-4;let b=0;p==="C#"?b=0:p==="D#"?b=1:p==="F#"?b=3:p==="G#"?b=4:p==="A#"&&(b=5);const j=20+(g*7+b)*56+40,S=t.includes(x);return e.jsx("rect",{x:j,y:"20",width:"28",height:"95",fill:S?"#1e40af":"#333",stroke:"#000",strokeWidth:"2",rx:"3",cursor:"pointer",onClick:()=>i(x)},`black-${x}`)})]})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 text-center max-w-md",children:[e.jsxs("p",{children:[e.jsx("strong",{children:s.selectedNotes})," ",t.length>0?t.join(", "):s.none]}),e.jsx("p",{className:"text-gray-400",children:s.clickToToggle}),e.jsx("p",{className:"text-gray-400 italic",children:"Red markers indicate C notes â€¢ Scroll horizontally to view all keys"})]})]})}const Ds=[{value:"1",label:"1 (Whole Note)"},{value:"2",label:"2 (Half Note)"},{value:"4",label:"4 (Quarter Note)"},{value:"8",label:"8 (Eighth Note)"},{value:"16",label:"16 (Sixteenth Note)"},{value:"32",label:"32 (32nd Note)"}],Vo=[{numerator:"4",denominator:"4",label:"4/4 (Common Time)"},{numerator:"3",denominator:"4",label:"3/4 (Waltz)"},{numerator:"6",denominator:"8",label:"6/8"},{numerator:"2",denominator:"4",label:"2/4"},{numerator:"5",denominator:"4",label:"5/4"},{numerator:"7",denominator:"8",label:"7/8"},{numerator:"9",denominator:"8",label:"9/8"},{numerator:"12",denominator:"8",label:"12/8"}],Ps=["C","D","E","F","G","A","B"],mr=[{value:"natural",label:"Natural",symbol:""},{value:"sharp",label:"â™¯ (Sharp)",symbol:"#"},{value:"flat",label:"â™­ (Flat)",symbol:"b"}],xr=[{value:"major",label:"Major",suffix:""},{value:"minor",label:"Minor",suffix:"m"},{value:"diminished",label:"Diminished",suffix:"dim"},{value:"augmented",label:"Augmented",suffix:"aug"},{value:"sus2",label:"Suspended 2nd",suffix:"sus2"},{value:"sus4",label:"Suspended 4th",suffix:"sus4"}],fr=[{value:"none",label:"None",suffix:""},{value:"7",label:"Dominant 7th",suffix:"7"},{value:"maj7",label:"Major 7th",suffix:"maj7"},{value:"9",label:"9th",suffix:"9"},{value:"maj9",label:"Major 9th",suffix:"maj9"},{value:"11",label:"11th",suffix:"11"},{value:"13",label:"13th",suffix:"13"},{value:"6",label:"6th",suffix:"6"},{value:"add9",label:"Add 9",suffix:"add9"}],Qe={C:{guitar:{frets:[-1,3,2,0,1,0],fingers:[0,3,2,0,1,0]},piano:{keys:["C","E","G"]},ukulele:{frets:[0,0,0,3],fingers:[0,0,0,3]}},"C#":{guitar:{frets:[-1,4,6,6,6,4],fingers:[0,1,3,4,4,1],startFret:1},piano:{keys:["C#","F","G#"]},ukulele:{frets:[1,1,1,4],fingers:[1,1,1,4]}},Db:{guitar:{frets:[-1,4,6,6,6,4],fingers:[0,1,3,4,4,1],startFret:1},piano:{keys:["Db","F","Ab"]},ukulele:{frets:[1,1,1,4],fingers:[1,1,1,4]}},D:{guitar:{frets:[-1,-1,0,2,3,2],fingers:[0,0,0,1,3,2]},piano:{keys:["D","F#","A"]},ukulele:{frets:[2,2,2,0],fingers:[1,1,1,0]}},"D#":{guitar:{frets:[-1,-1,1,3,4,3],fingers:[0,0,1,2,4,3]},piano:{keys:["D#","G","A#"]},ukulele:{frets:[0,3,3,1],fingers:[0,3,4,1]}},Eb:{guitar:{frets:[-1,-1,1,3,4,3],fingers:[0,0,1,2,4,3]},piano:{keys:["Eb","G","Bb"]},ukulele:{frets:[0,3,3,1],fingers:[0,3,4,1]}},E:{guitar:{frets:[0,2,2,1,0,0],fingers:[0,2,3,1,0,0]},piano:{keys:["E","G#","B"]},ukulele:{frets:[4,4,4,2],fingers:[3,3,3,1]}},F:{guitar:{frets:[1,3,3,2,1,1],fingers:[1,3,4,2,1,1]},piano:{keys:["F","A","C"]},ukulele:{frets:[2,0,1,0],fingers:[2,0,1,0]}},"F#":{guitar:{frets:[2,4,4,3,2,2],fingers:[1,3,4,2,1,1]},piano:{keys:["F#","A#","C#"]},ukulele:{frets:[3,1,2,1],fingers:[3,1,2,1]}},Gb:{guitar:{frets:[2,4,4,3,2,2],fingers:[1,3,4,2,1,1]},piano:{keys:["Gb","Bb","Db"]},ukulele:{frets:[3,1,2,1],fingers:[3,1,2,1]}},G:{guitar:{frets:[3,2,0,0,0,3],fingers:[3,2,0,0,0,4]},piano:{keys:["G","B","D"]},ukulele:{frets:[0,2,3,2],fingers:[0,1,3,2]}},"G#":{guitar:{frets:[4,6,6,5,4,4],fingers:[1,3,4,2,1,1]},piano:{keys:["G#","C","D#"]},ukulele:{frets:[5,3,4,3],fingers:[3,1,2,1]}},Ab:{guitar:{frets:[4,6,6,5,4,4],fingers:[1,3,4,2,1,1]},piano:{keys:["Ab","C","Eb"]},ukulele:{frets:[5,3,4,3],fingers:[3,1,2,1]}},A:{guitar:{frets:[-1,0,2,2,2,0],fingers:[0,0,1,2,3,0]},piano:{keys:["A","C#","E"]},ukulele:{frets:[2,1,0,0],fingers:[2,1,0,0]}},"A#":{guitar:{frets:[-1,1,3,3,3,1],fingers:[0,1,2,3,4,1]},piano:{keys:["A#","D","F"]},ukulele:{frets:[3,2,1,1],fingers:[3,2,1,1]}},Bb:{guitar:{frets:[-1,1,3,3,3,1],fingers:[0,1,2,3,4,1]},piano:{keys:["Bb","D","F"]},ukulele:{frets:[3,2,1,1],fingers:[3,2,1,1]}},B:{guitar:{frets:[-1,2,4,4,4,2],fingers:[0,1,2,3,4,1]},piano:{keys:["B","D#","F#"]},ukulele:{frets:[4,3,2,2],fingers:[4,3,1,2]}},Am:{guitar:{frets:[-1,0,2,2,1,0],fingers:[0,0,2,3,1,0]},piano:{keys:["A","C","E"]},ukulele:{frets:[2,0,0,0],fingers:[1,0,0,0]}},Bm:{guitar:{frets:[-1,2,4,4,3,2],fingers:[0,1,3,4,2,1]},piano:{keys:["B","D","F#"]},ukulele:{frets:[4,2,2,2],fingers:[4,1,1,1]}},Cm:{guitar:{frets:[-1,3,5,5,4,3],fingers:[0,1,3,4,2,1]},piano:{keys:["C","Eb","G"]},ukulele:{frets:[0,3,3,3],fingers:[0,1,1,1]}},Dm:{guitar:{frets:[-1,-1,0,2,3,1],fingers:[0,0,0,2,3,1]},piano:{keys:["D","F","A"]},ukulele:{frets:[2,2,1,0],fingers:[2,3,1,0]}},Em:{guitar:{frets:[0,2,2,0,0,0],fingers:[0,2,3,0,0,0]},piano:{keys:["E","G","B"]},ukulele:{frets:[0,4,3,2],fingers:[0,4,3,2]}},Fm:{guitar:{frets:[1,3,3,1,1,1],fingers:[1,3,4,1,1,1]},piano:{keys:["F","Ab","C"]},ukulele:{frets:[1,0,1,3],fingers:[1,0,2,4]}},Gm:{guitar:{frets:[3,5,5,3,3,3],fingers:[1,3,4,1,1,1]},piano:{keys:["G","Bb","D"]},ukulele:{frets:[0,2,3,1],fingers:[0,2,3,1]}},Am7:{guitar:{frets:[-1,0,2,0,1,0],fingers:[0,0,2,0,1,0]},piano:{keys:["A","C","E","G"]},ukulele:{frets:[0,0,0,0],fingers:[0,0,0,0]}},C7:{guitar:{frets:[-1,3,2,3,1,0],fingers:[0,3,2,4,1,0]},piano:{keys:["C","E","G","Bb"]},ukulele:{frets:[0,0,0,1],fingers:[0,0,0,1]}},D7:{guitar:{frets:[-1,-1,0,2,1,2],fingers:[0,0,0,2,1,3]},piano:{keys:["D","F#","A","C"]},ukulele:{frets:[2,2,2,3],fingers:[1,1,1,2]}},E7:{guitar:{frets:[0,2,0,1,0,0],fingers:[0,2,0,1,0,0]},piano:{keys:["E","G#","B","D"]},ukulele:{frets:[1,2,0,2],fingers:[1,2,0,3]}},G7:{guitar:{frets:[3,2,0,0,0,1],fingers:[3,2,0,0,0,1]},piano:{keys:["G","B","D","F"]},ukulele:{frets:[0,2,1,2],fingers:[0,2,1,3]}},"C/E":{guitar:{frets:[0,3,2,0,1,0],fingers:[0,3,2,0,1,0]},piano:{keys:["E","G","C"]},ukulele:{frets:[0,0,0,3],fingers:[0,0,0,3]}},"G/B":{guitar:{frets:[-1,2,0,0,0,3],fingers:[0,2,0,0,0,3]},piano:{keys:["B","D","G"]},ukulele:{frets:[0,2,3,2],fingers:[0,1,3,2]}}},As=t=>{switch(t){case 1:return"whole";case 2:return"half";case 4:return"quarter";case 8:return"eighth";case 16:return"sixteenth";case 32:return"32nd";default:return"quarter"}},pr=(t,r,s)=>{let n="simple",o=t,l=As(r),a=[];if(r>=4&&(t===6||t===9||t===12)){n="compound",o=t/3,r===8?l="dotted-quarter":r===4?l="dotted-half":r===16&&(l="dotted-eighth");for(let i=0;i<o;i++)a.push(3)}else if(t===2||t===3||t===4){n="simple",o=t,l=As(r);for(let i=0;i<o;i++)a.push(1)}else{n="irregular";let i=t;const h=s?s.split("+").map(m=>parseInt(m.trim())).filter(m=>!isNaN(m)):[];if(h.length>0&&h.reduce((m,c)=>m+c,0)===t)a=h;else if(t===5)a=[3,2];else if(t===7)a=[2,2,3];else if(r>=8)for(;i>0;)i>=3?(a.push(3),i-=3):(a.push(2),i-=2);else for(let m=0;m<t;m++)a.push(1);o=a.length}return{numerator:t,denominator:r,type:n,beatUnit:l,beatsPerMeasure:o,grouping:a}},Wo=(t,r)=>{if(r===8){if(t===5)return["3+2","2+3"];if(t===7)return["2+2+3","3+2+2","2+3+2"];if(t===8)return["3+3+2","3+2+3"];if(t===9)return["2+2+2+3","3+2+2+2"];if(t===10)return["3+3+2+2","2+3+2+3"];if(t===11)return["3+3+3+2","2+3+3+3"]}return[]},Ho=(t="")=>{if(!t)return{root:"C",accidental:"natural",quality:"major",extension:"none",bassNote:""};const[r,s]=t.split("/"),n=s||"",o=/^([A-G])([#b]?)(maj|m|min|dim|aug|sus2|sus4)?(13|11|9|7|6|add9|maj9|maj7)?(.*)$/,l=r.match(o);if(l){const[,a,i,h,m]=l,c=i==="#"?"sharp":i==="b"?"flat":"natural";let d="major";h==="m"||h==="min"?d="minor":h==="dim"?d="diminished":h==="aug"?d="augmented":h==="sus2"?d="sus2":h==="sus4"?d="sus4":h==="maj"&&!m?.startsWith("maj")&&(d="major");let x="none";return h==="maj"&&m==="7"?x="maj7":h==="maj"&&m==="9"?x="maj9":m==="7"?x="7":m==="9"?x="9":m==="11"?x="11":m==="13"?x="13":m==="6"?x="6":m==="add9"&&(x="add9"),{root:a,accidental:c,quality:d,extension:x,bassNote:n}}else return console.warn("Could not parse chord name accurately:",t),{root:t[0]||"C",accidental:"natural",quality:"major",extension:"none",bassNote:""}},Ko=(t,r,s,n,o)=>{const l=mr.find(m=>m.value===r)?.symbol||"",a=xr.find(m=>m.value===s)?.suffix||"",i=fr.find(m=>m.value===n)?.suffix||"";let h=i;return n==="maj7"&&s!=="major"?h="maj7":n==="maj9"&&s!=="major"?h="maj9":(s==="major"&&(n==="maj7"||n==="maj9")||s==="major"&&n!=="none"||s!=="major"&&n!=="none")&&(h=i),`${t}${l}${a}${h}${o?"/"+o:""}`},ss=(t,r)=>{if(r===0)return t;const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],o=t.includes("b"),l=o?n:s,a=t.match(/^[A-G][#b]?/)?.[0]||"C",i=t.replace(a,"");let h=l.indexOf(a);if(h===-1&&(h=(o?s:n).indexOf(a),h===-1))return t;const m=(h+r+1200)%12;return l[m]+i},Xo=[{value:"intro",label:"Intro"},{value:"verse",label:"Verse"},{value:"chorus",label:"Chorus"},{value:"bridge",label:"Bridge"},{value:"outro",label:"Outro"},{value:"pre-chorus",label:"Pre-Chorus"},{value:"instrumental",label:"Instrumental"},{value:"tag",label:"Tag"},{value:"custom",label:"Custom"}];function Uo({open:t,onOpenChange:r,type:s,currentTime:n,initialData:o,onSubmit:l}){const{t:a}=et(),i=!!o,[h,m]=u.useState("0"),[c,d]=u.useState("120"),[x,p]=u.useState("4"),[f,g]=u.useState("4"),[b,C]=u.useState(!1),[j,S]=u.useState(""),[k,w]=u.useState("verse"),[v,N]=u.useState(""),[M,E]=u.useState("C"),[L,G]=u.useState("natural"),[_,ie]=u.useState("major"),[Z,q]=u.useState("none"),[Q,F]=u.useState(""),[W,D]=u.useState(!1),[J,H]=u.useState([-1,3,2,0,1,0]),[re,ge]=u.useState([0,3,2,0,1,0]),[he,te]=u.useState(1),[fe,O]=u.useState([0,0,0,3]),[K,T]=u.useState([0,0,0,3]),[I,$]=u.useState(1),[V,ne]=u.useState(["C","E","G"]),[oe,ae]=u.useState(0),[Y,le]=u.useState(""),[we,Se]=u.useState(!1),[ke,Re]=u.useState("linear"),[Te,me]=u.useState("120"),[pe,st]=u.useState("0"),[rt,Ot]=u.useState("simple"),Lt=()=>{m(n.toFixed(2)),d("120"),p("4"),g("4"),C(!1),S(""),w("verse"),N(""),E("C"),G("natural"),ie("major"),q("none"),F(""),D(!1);const y=Qe.C;H(y?.guitar.frets||[-1,3,2,0,1,0]),ge(y?.guitar.fingers||[0,3,2,0,1,0]),te(y?.guitar.startFret||1),O(y?.ukulele.frets||[0,0,0,3]),T(y?.ukulele.fingers||[0,0,0,3]),$(1),ne(y?.piano.keys||["C","E","G"]),ae(0),le(""),Se(!1),Re("linear"),me("120"),st("0")};u.useEffect(()=>{if(t)if(i&&o)if(m(o.time.toFixed(2)),s==="chord"){const y=o,P=Ho(y.chord);if(E(P.root),G(P.accidental),ie(P.quality),q(P.extension),F(P.bassNote),N(y.chord),y.customDiagram)D(!0),H(y.customDiagram.guitar.frets),ge(y.customDiagram.guitar.fingers),te(y.customDiagram.guitar.startFret||1),O(y.customDiagram.ukulele.frets),T(y.customDiagram.ukulele.fingers),$(y.customDiagram.ukulele.startFret||1),ne(y.customDiagram.piano.keys),ae(y.customDiagram.capo||0);else{D(!1);const se=y.chord.split("/")[0],U=Qe[se];H(U?.guitar?.frets||[-1,-1,-1,-1,-1,-1]),ge(U?.guitar?.fingers||[0,0,0,0,0,0]),te(U?.guitar?.baseFret||1),O(U?.ukulele?.frets||[0,0,0,0]),T(U?.ukulele?.fingers||[0,0,0,0]),$(1),ne(U?.piano?.keys||[]),ae(0)}}else if(s==="tempo"&&"tempo"in o){const y=o;d(String(y.tempo)),C(y.hidden||!1),le(y.subdivision||""),y.curve&&(Se(!0),Re(y.curve.type),me(String(y.curve.targetTempo)),st(String(y.curve.targetTime)))}else if(s==="timesig"&&"timeSignature"in o){const y=o,[P,se]=y.timeSignature.split("/");p(P),g(se),C(y.hidden||!1),le(y.subdivision||"")}else s==="section"&&"label"in o&&(S(o.label),w(o.type||"custom"));else Lt()},[t,i,o,s,n]),u.useEffect(()=>{const y=parseInt(x),P=parseInt(f);if(!isNaN(y)&&!isNaN(P)){const se=pr(y,P,Y);Ot(se.type)}},[x,f,Y]),u.useEffect(()=>{if(s==="chord"){const y=Ko(M,L,_,Z,Q);N(y)}},[M,L,_,Z,Q,s]),u.useEffect(()=>{if(s==="chord"&&v&&!W){const y=v.split("/")[0],P=Qe[y];P&&(H(P.guitar?.frets||[-1,-1,-1,-1,-1,-1]),ge(P.guitar?.fingers||[0,0,0,0,0,0]),te(P.guitar?.baseFret||1),O(P.ukulele?.frets||[0,0,0,0]),T(P.ukulele?.fingers||[0,0,0,0]),$(1),ne(P.piano?.keys||[]))}},[v,s,W]);const Bt=()=>{const y=parseFloat(h);if(isNaN(y)||y<0){Ne.error("Please enter a valid time");return}let P={time:y};switch(s){case"tempo":const se=parseInt(c);if(isNaN(se)||se<1){Ne.error("Please enter a valid tempo (BPM)");return}if(P.tempo=se,P.timeSignature=`${x}/${f}`,P.hidden=b,P.subdivision=Y.trim()||void 0,we){const Be=parseInt(Te),$e=parseFloat(pe);if(isNaN(Be)||Be<1){Ne.error("Please enter a valid target tempo (BPM)");return}if(isNaN($e)||$e<=y){Ne.error("Target time must be greater than start time");return}P.curve={type:ke,targetTempo:Be,targetTime:$e}}break;case"timesig":const U=parseInt(x),ye=parseInt(f);if(isNaN(U)||isNaN(ye)||U<1||ye<1||!Number.isInteger(Math.log2(ye))){Ne.error("Please enter a valid time signature (e.g., 4/4, 3/4, 6/8)");return}P.timeSignature=`${U}/${ye}`,P.tempo=i&&o&&"tempo"in o?o.tempo:parseInt(c),P.hidden=b,P.subdivision=Y.trim()||void 0;break;case"section":if(!j.trim()){Ne.error("Please enter a section label");return}P.label=j.trim(),P.type=k;break;case"chord":if(!v.trim()){Ne.error("Chord name is empty or invalid");return}P.chord=v.trim(),W?P.customDiagram={guitar:{frets:J,fingers:re,startFret:he},ukulele:{frets:fe,fingers:K,startFret:I},piano:{keys:V},capo:oe>0?oe:void 0}:P.customDiagram=void 0;break}l(i?"update":"add",P)},$t=()=>{i&&l("delete",{})},zt=()=>{switch(s){case"tempo":return"Add Tempo";case"timesig":return"Add Time Sig";case"section":return"Add Section";case"chord":return"Add Chord";default:return"Add Item"}},Gt=()=>{switch(s){case"tempo":return"Add tempo marker";case"timesig":return"Add time signature marker";case"section":return"Add section marker";case"chord":return"Add chord marker";default:return""}};return e.jsx(ht,{open:t,onOpenChange:r,children:e.jsxs(mt,{className:s==="chord"?"sm:max-w-[600px] max-h-[90vh] overflow-y-auto":"sm:max-w-[450px]",children:[e.jsxs(xt,{children:[e.jsx(ft,{children:i?`Edit ${s}`:zt()}),e.jsx(pt,{children:Gt()})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"time",children:"Time (seconds)"}),e.jsx(Ee,{id:"time",type:"number",step:"0.01",value:h,onChange:y=>m(y.target.value)})]}),s==="tempo"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"tempo",children:"Tempo (BPM)"}),e.jsx(Ee,{id:"tempo",type:"number",placeholder:"120",value:c,onChange:y=>d(y.target.value)})]}),e.jsxs("div",{className:"space-y-3 border border-[#2B2B2B] rounded-md p-3",children:[e.jsx(B,{className:"text-sm font-semibold",children:"Time Signature"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"ts-num",className:"text-xs text-muted-foreground",children:"Numerator"}),e.jsx(Ee,{id:"ts-num",type:"number",min:"1",max:"32",value:x,onChange:y=>p(y.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"ts-den",className:"text-xs text-muted-foreground",children:"Denominator"}),e.jsxs(De,{value:f,onValueChange:g,children:[e.jsx(Pe,{id:"ts-den",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:Ds.map(y=>e.jsx(ve,{value:y.value,children:y.value},y.value))})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Type: ",e.jsx("span",{className:"font-semibold text-primary capitalize",children:rt})]}),rt==="irregular"&&e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:e.jsx("div",{className:"text-xs font-mono bg-black/20 px-2 py-1 rounded border border-white/10",children:Y||"Default"})})]}),e.jsx("div",{className:"pt-2",children:e.jsx(Fs,{numerator:parseInt(x)||4,denominator:parseInt(f)||4,subdivision:Y,onSubdivisionChange:le})})]}),e.jsxs("div",{className:"space-y-3 border border-[#2B2B2B] rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(lt,{id:"enable-curve",checked:we,onCheckedChange:Se}),e.jsx(B,{htmlFor:"enable-curve",className:"text-sm cursor-pointer",children:"Enable Tempo Curve (Rallentando/Accelerando)"})]}),we&&e.jsxs("div",{className:"space-y-3 pl-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"curve-type",className:"text-xs text-muted-foreground",children:"Curve Type"}),e.jsxs(De,{value:ke,onValueChange:y=>Re(y),children:[e.jsx(Pe,{id:"curve-type",children:e.jsx(Ae,{})}),e.jsxs(Fe,{children:[e.jsx(ve,{value:"linear",children:"Linear (constant rate)"}),e.jsx(ve,{value:"exponential",children:"Exponential (natural feel)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"target-tempo",className:"text-xs text-muted-foreground",children:"Target Tempo"}),e.jsx(Ee,{id:"target-tempo",type:"number",placeholder:"90",value:Te,onChange:y=>me(y.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"target-time",className:"text-xs text-muted-foreground",children:"Target Time (sec)"}),e.jsx(Ee,{id:"target-time",type:"number",step:"0.1",placeholder:"8.0",value:pe,onChange:y=>st(y.target.value)})]})]}),e.jsxs("div",{className:"bg-[#1E1E1E] border border-[#2B2B2B] rounded-md p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Curve Preview:"}),parseInt(c)>parseInt(Te)?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-blue-500/20 text-blue-400 border border-blue-500/30",children:"Rallentando (slowing down)"}):parseInt(c)<parseInt(Te)?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-orange-500/20 text-orange-400 border border-orange-500/30",children:"Accelerando (speeding up)"}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-500/20 text-gray-400 border border-gray-500/30",children:"No change"})]}),e.jsxs("div",{className:"relative w-full h-16 bg-[#171717] rounded border border-[#2B2B2B] overflow-hidden",children:[e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 200 60",preserveAspectRatio:"none",children:[e.jsx("line",{x1:"0",y1:"15",x2:"200",y2:"15",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("line",{x1:"0",y1:"30",x2:"200",y2:"30",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("line",{x1:"0",y1:"45",x2:"200",y2:"45",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),(()=>{const y=parseInt(c)||120,P=parseInt(Te)||120,se=Math.max(y,P,180),U=Math.min(y,P,60),ye=se-U||1,Be=55-(y-U)/ye*50,$e=55-(P-U)/ye*50;if(ke==="linear")return e.jsx("line",{x1:"10",y1:Be,x2:"190",y2:$e,stroke:y>P?"#60a5fa":"#fb923c",strokeWidth:"2"});{const nt=[];for(let ot=0;ot<=20;ot++){const Ke=ot/20,Vt=y>P?1-Math.pow(1-Ke,2):Math.pow(Ke,2),Wt=y+(P-y)*Vt,Ht=10+Ke*180,Kt=55-(Wt-U)/ye*50;nt.push(`${Ht},${Kt}`)}return e.jsx("polyline",{points:nt.join(" "),fill:"none",stroke:y>P?"#60a5fa":"#fb923c",strokeWidth:"2"})}})(),e.jsx("circle",{cx:"10",cy:(()=>{const y=parseInt(c)||120,P=parseInt(Te)||120,se=Math.max(y,P,180),U=Math.min(y,P,60),ye=se-U||1;return 55-(y-U)/ye*50})(),r:"3",fill:"#10b981"}),e.jsx("circle",{cx:"190",cy:(()=>{const y=parseInt(c)||120,P=parseInt(Te)||120,se=Math.max(y,P,180),U=Math.min(y,P,60),ye=se-U||1;return 55-(P-U)/ye*50})(),r:"3",fill:"#ef4444"})]}),e.jsxs("div",{className:"absolute top-1 left-2 text-[10px] text-green-400",children:[c," BPM"]}),e.jsxs("div",{className:"absolute top-1 right-2 text-[10px] text-red-400",children:[Te," BPM"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs pt-1",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",(parseFloat(pe)-parseFloat(h)).toFixed(2),"s"]}),e.jsxs("span",{className:"text-muted-foreground",children:["Change: ",Math.abs(parseInt(Te)-parseInt(c))," BPM"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(lt,{id:"hide-tempo",checked:b,onCheckedChange:C}),e.jsx(B,{htmlFor:"hide-tempo",className:"text-sm cursor-pointer",children:"Hide in player mode (show only in edit mode)"})]})]}),s==="timesig"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{children:"Time Signature"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"ts-preset",className:"text-xs text-muted-foreground",children:"Common Presets"}),e.jsxs(De,{value:`${x}/${f}`,onValueChange:y=>{const[P,se]=y.split("/");p(P),g(se)},children:[e.jsx(Pe,{id:"ts-preset",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:Vo.map(y=>e.jsx(ve,{value:`${y.numerator}/${y.denominator}`,children:y.label},y.label))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{className:"text-xs text-muted-foreground",children:"Custom Time Signature"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"ts-num",className:"text-xs text-muted-foreground",children:"Numerator (Beats)"}),e.jsx(Ee,{id:"ts-num",type:"number",min:"1",max:"32",value:x,onChange:y=>p(y.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"ts-den",className:"text-xs text-muted-foreground",children:"Denominator (Note Value)"}),e.jsxs(De,{value:f,onValueChange:g,children:[e.jsx(Pe,{id:"ts-den",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:Ds.map(y=>e.jsx(ve,{value:y.value,children:y.label},y.value))})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-xs text-muted-foreground",children:"Note Groups (Visual Feedback)"}),e.jsx(Fs,{numerator:parseInt(x)||4,denominator:parseInt(f)||4,subdivision:Y,onSubdivisionChange:le})]}),rt==="irregular"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm",children:"Beat Grouping (Drag to Rearrange)"}),(()=>{const y=parseInt(x),P=parseInt(f),se=Wo(y,P);return se.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:se.map(U=>e.jsx(A,{type:"button",variant:Y===U?"default":"outline",size:"sm",onClick:()=>le(U),className:"text-xs h-7",children:U},U))}):null})(),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"ðŸ’¡ Drag the note groups in the visualization above to rearrange beat grouping for this irregular time signature."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(lt,{id:"hide-timesig",checked:b,onCheckedChange:C}),e.jsx(B,{htmlFor:"hide-timesig",className:"text-sm cursor-pointer",children:"Hide in player mode (show only in edit mode)"})]})]}),s==="section"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"section-type",children:"Section Type"}),e.jsxs(De,{value:k,onValueChange:w,children:[" ",e.jsx(Pe,{id:"section-type",children:e.jsx(Ae,{})})," ",e.jsx(Fe,{children:Xo.map(y=>e.jsx(ve,{value:y.value,children:y.label},y.value))})," "]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"section-label",children:"Section Label"}),e.jsx(Ee,{id:"section-label",value:j,onChange:y=>S(y.target.value)})]})]}),s==="chord"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 border p-4 rounded-md",children:[e.jsx(B,{className:"text-base font-medium",children:"Chord Builder"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"root-note",className:"text-xs text-muted-foreground",children:"Root"}),e.jsxs(De,{value:M,onValueChange:E,children:[e.jsx(Pe,{id:"root-note",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:Ps.map(y=>e.jsx(ve,{value:y,children:y},y))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"accidental",className:"text-xs text-muted-foreground",children:"Accidental"}),e.jsxs(De,{value:L,onValueChange:G,children:[e.jsx(Pe,{id:"accidental",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:mr.map(y=>e.jsx(ve,{value:y.value,children:y.label},y.value))})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"quality",className:"text-xs text-muted-foreground",children:"Quality"}),e.jsxs(De,{value:_,onValueChange:ie,children:[e.jsx(Pe,{id:"quality",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:xr.map(y=>e.jsx(ve,{value:y.value,children:y.label},y.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"extension",className:"text-xs text-muted-foreground",children:"Extension"}),e.jsxs(De,{value:Z,onValueChange:q,children:[e.jsx(Pe,{id:"extension",children:e.jsx(Ae,{})}),e.jsx(Fe,{children:fr.map(y=>e.jsx(ve,{value:y.value,children:y.label},y.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"bass-note",className:"text-xs text-muted-foreground",children:"Bass Note"}),e.jsxs(De,{value:Q||"none",onValueChange:y=>F(y==="none"?"":y),children:[e.jsx(Pe,{id:"bass-note",children:e.jsx(Ae,{placeholder:"None"})}),e.jsxs(Fe,{children:[e.jsx(ve,{value:"none",children:"None"}),Ps.map(y=>e.jsxs(z.Fragment,{children:[e.jsx(ve,{value:y,children:y}),e.jsx(ve,{value:`${y}#`,children:`${y}â™¯`}),e.jsx(ve,{value:`${y}b`,children:`${y}â™­`})]},y))]})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx(B,{className:"text-xs text-muted-foreground",children:"Generated Chord"}),e.jsx("p",{className:"text-lg font-semibold",children:v||"-"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{type:"button",variant:"outline",onClick:()=>D(!W),className:"w-full",children:[" ",e.jsx(vo,{className:"w-4 h-4 mr-2"})," ",W?"Hide":"Customize"," Diagrams "]}),W&&e.jsxs("div",{className:"border rounded-md p-4 space-y-4",children:[" ",e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"capo",children:"Capo Fret"}),e.jsx(Ee,{id:"capo",type:"number",min:"0",max:"12",value:oe,onChange:y=>ae(parseInt(y.target.value)||0)})]})," ",e.jsxs(Ws,{defaultValue:"guitar",children:[e.jsxs(Hs,{className:"grid w-full grid-cols-3",children:[" ",e.jsx(Ue,{value:"guitar",children:"Guitar"})," ",e.jsx(Ue,{value:"ukulele",children:"Ukulele"})," ",e.jsx(Ue,{value:"piano",children:"Piano"})," "]}),e.jsxs(qe,{value:"guitar",className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"guitar-start-fret",children:"Start Fret"}),e.jsx(Ee,{id:"guitar-start-fret",type:"number",min:"1",max:"15",value:he,onChange:y=>te(parseInt(y.target.value)||1)})]}),e.jsx($o,{frets:J,fingers:re,startFret:he,onChange:(y,P)=>{H(y),ge(P)}})]}),e.jsxs(qe,{value:"ukulele",className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(B,{htmlFor:"ukulele-start-fret",children:"Start Fret"}),e.jsx(Ee,{id:"ukulele-start-fret",type:"number",min:"1",max:"15",value:I,onChange:y=>$(parseInt(y.target.value)||1)})]}),e.jsx(zo,{frets:fe,fingers:K,startFret:I,onChange:(y,P)=>{O(y),T(P)}})]}),e.jsxs(qe,{value:"piano",className:"mt-4 space-y-3",children:[" ",e.jsx(Go,{keys:V,onChange:ne})," "]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[i&&e.jsxs(A,{variant:"destructive",onClick:$t,className:"mr-auto",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"})," Delete"]}),e.jsx(A,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsx(A,{onClick:Bt,children:i?"Update":e.jsxs(e.Fragment,{children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Add"]})})]})]})})}const Fs=({numerator:t,denominator:r,subdivision:s,onSubdivisionChange:n})=>{const o=pr(t,r,s),{grouping:l,type:a}=o,[i,h]=z.useState(l),[m,c]=z.useState(null),[d,x]=z.useState(null);z.useEffect(()=>{h(l)},[JSON.stringify(l)]);const p=60,f=50,g=40,b=35,C=(w,v)=>{a!=="irregular"||!n||(c(v),w.dataTransfer.effectAllowed="move")},j=(w,v)=>{if(w.preventDefault(),a!=="irregular"||!n||m===null||m===v)return;const N=[...i],[M]=N.splice(m,1);N.splice(v,0,M),h(N),c(v)},S=w=>{if(w.preventDefault(),a!=="irregular"||!n||m===null)return;c(null);const v=i.join("+");v!==s&&n(v)};return a==="irregular"&&n?e.jsxs("div",{className:"w-full p-4 bg-[#171717] rounded-md border border-[#2B2B2B] space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-lg",children:"âœ‹"}),e.jsx("span",{children:"Drag beat groups to rearrange the meter pattern"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-[#1F1F1F] border border-[#333] rounded px-3 py-2",children:[e.jsx("span",{className:"text-2xl font-bold leading-none",children:t}),e.jsx("div",{className:"w-full h-[1px] bg-[#444] my-0.5"}),e.jsx("span",{className:"text-2xl font-bold leading-none",children:r})]}),e.jsx("div",{className:"text-2xl text-muted-foreground",children:"="}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:i.map((w,v)=>e.jsxs("div",{draggable:!0,onDragStart:N=>C(N,v),onDragEnter:N=>j(N,v),onDragEnd:S,onDragOver:N=>N.preventDefault(),className:`
                  flex items-center justify-center gap-1 px-4 py-3 rounded-lg border-2
                  transition-all duration-200 select-none
                  ${m===v?"opacity-40 scale-95 border-blue-500/50 bg-blue-500/10":"opacity-100 scale-100 border-[#333] bg-[#1F1F1F] hover:border-blue-500/30 hover:bg-[#252525]"}
                  cursor-move
                `,children:[e.jsx("span",{className:"text-xl font-bold",children:w}),e.jsx("span",{className:"text-xs text-muted-foreground",children:w===3?"â™©.":w===2?"â™©":"â™ª"})]},v))})]}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground",children:["Pattern: ",i.join(" + ")," = ",t]})]}):e.jsx("div",{className:"w-full overflow-x-auto p-4 bg-[#171717] rounded-md border border-[#2B2B2B]",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("svg",{height:"80",width:Math.max(300,f+i.length*p+40),children:[e.jsx("line",{x1:"0",y1:g,x2:"100%",y2:g,stroke:"#444",strokeWidth:"1"}),e.jsx("text",{x:"10",y:g-5,fontFamily:"serif",fontSize:"24",fontWeight:"bold",fill:"#e5e5e5",children:t}),e.jsx("text",{x:"10",y:g+20,fontFamily:"serif",fontSize:"24",fontWeight:"bold",fill:"#e5e5e5",children:r}),i.map((w,v)=>{const N=f+40+v*p,M=[];let E=!0,L=!0,G=!1,_=!1;return r===8?w===3?(E=!0,L=!0,_=!0,G=!1):w===2?(E=!0,L=!0,_=!1,G=!1):(E=!0,L=!0,_=!1,G=!0):r===4?w===3?(E=!1,L=!0,_=!0,G=!1):w===2?(E=!1,L=!0,_=!1,G=!1):(E=!0,L=!0,_=!1,G=!1):r===2?w===1&&(E=!1,L=!0,_=!1,G=!1):r===1&&w===1&&(E=!1,L=!1,_=!1,G=!1),E?M.push(e.jsx("ellipse",{cx:N,cy:g,rx:"6",ry:"5",fill:"#e5e5e5",transform:`rotate(-15 ${N} ${g})`},`head-${v}`)):M.push(e.jsx("ellipse",{cx:N,cy:g,rx:"6",ry:"5",fill:"none",stroke:"#e5e5e5",strokeWidth:"2",transform:`rotate(-15 ${N} ${g})`},`head-${v}`)),L&&M.push(e.jsx("line",{x1:N+5,y1:g,x2:N+5,y2:g-b,stroke:"#e5e5e5",strokeWidth:"1.5"},`stem-${v}`)),_&&M.push(e.jsx("circle",{cx:N+12,cy:g,r:"2",fill:"#e5e5e5"},`dot-${v}`)),G&&M.push(e.jsx("path",{d:`M${N+5},${g-b} Q${N+15},${g-b+10} ${N+10},${g-b+25}`,fill:"none",stroke:"#e5e5e5",strokeWidth:"2"},`flag-${v}`)),e.jsx("g",{children:M},v)})]})})})},qo=({chord:t,customData:r})=>{const s=Qe[t],{frets:n,fingers:o,startFret:l=1}=r||s?.guitar||{frets:[0,0,0,0,0,0],fingers:[0,0,0,0,0,0]},a=l;if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const i=["E","A","D","G","B","e"],h=()=>{ur(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:h,className:"mb-3 gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"200",height:"280",viewBox:"0 0 200 280",className:"mb-2",children:[[...Array(5)].map((m,c)=>e.jsx("line",{x1:"40",y1:60+c*40,x2:"160",y2:60+c*40,stroke:"#666",strokeWidth:c===0&&a===1?"4":"2"},`fret-${c}`)),[...Array(6)].map((m,c)=>e.jsx("line",{x1:40+c*24,y1:"60",x2:40+c*24,y2:"220",stroke:"#666",strokeWidth:"2"},`string-${c}`)),a>1&&e.jsxs("text",{x:"20",y:"65",fontSize:"14",fill:"#666",children:[a,"fr"]}),i.map((m,c)=>e.jsx("text",{x:40+c*24,y:"250",fontSize:"12",fill:"#666",textAnchor:"middle",children:m},`label-${c}`)),n.map((m,c)=>{const d=40+c*24;if(m===-1)return e.jsxs("g",{children:[e.jsx("line",{x1:d-4,y1:"36",x2:d+4,y2:"44",stroke:"#999",strokeWidth:"2"}),e.jsx("line",{x1:d+4,y1:"36",x2:d-4,y2:"44",stroke:"#999",strokeWidth:"2"})]},`marker-${c}`);if(m===0)return e.jsx("circle",{cx:d,cy:"40",r:"6",fill:"none",stroke:"#666",strokeWidth:"2"},`marker-${c}`);{const x=m-a+1;if(x>=1&&x<=5){const p=60+(x-.5)*40,f=o?.[c];return e.jsxs("g",{children:[e.jsx("circle",{cx:d,cy:p,r:"10",fill:"#2563eb"}),f&&f>0&&e.jsx("text",{x:d,y:p+4,fontSize:"12",fill:"white",textAnchor:"middle",children:f})]},`marker-${c}`)}return null}})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Finger positions: ",o?.filter(m=>m>0).join(", ")||"N/A"]})]})},Yo=({chord:t,customData:r})=>{const s=Qe[t],{keys:n}=r||s?.piano||{keys:["C","E","G"]};if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=["C#","D#","F#","G#","A#"],a=()=>{dr(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:a,className:"mb-3 gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"400",height:"180",viewBox:"0 0 400 180",className:"mb-2",children:[o.filter(i=>!l.includes(i)).map((i,h)=>{const m=20+h*50,c=n.includes(i);return e.jsx("rect",{x:m,y:"20",width:"48",height:"140",fill:c?"#2563eb":"white",stroke:"#333",strokeWidth:"2",rx:"4"},`white-${i}`)}),o.filter(i=>l.includes(i)).map(i=>{const m=20+(o.indexOf(i)-Math.floor((o.indexOf(i)+1)/2))*50+35,c=n.includes(i);return e.jsx("rect",{x:m,y:"20",width:"26",height:"90",fill:c?"#1e40af":"#333",stroke:"#000",strokeWidth:"2",rx:"3"},`black-${i}`)}),o.filter(i=>!l.includes(i)).map((i,h)=>{const m=20+h*50+24;return e.jsx("text",{x:m,y:"150",fontSize:"14",fill:n.includes(i)?"white":"#666",textAnchor:"middle",children:i},`label-${i}`)})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Notes: ",n.join(" - ")]})]})},Zo=({chord:t,customData:r})=>{const s=Qe[t],{frets:n,fingers:o,startFret:l=1}=r||s?.ukulele||{frets:[0,0,0,0],fingers:[0,0,0,0]};if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const a=["G","C","E","A"],i=()=>{hr(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:i,className:"mb-3 gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"160",height:"280",viewBox:"0 0 160 280",className:"mb-2",children:[[...Array(5)].map((h,m)=>e.jsx("line",{x1:"40",y1:60+m*40,x2:"136",y2:60+m*40,stroke:"#666",strokeWidth:m===0&&l===1?"4":"2"},`fret-${m}`)),[...Array(4)].map((h,m)=>e.jsx("line",{x1:40+m*32,y1:"60",x2:40+m*32,y2:"220",stroke:"#666",strokeWidth:"2"},`string-${m}`)),l>1&&e.jsxs("text",{x:"20",y:"65",fontSize:"14",fill:"#666",children:[l,"fr"]}),a.map((h,m)=>e.jsx("text",{x:40+m*32,y:"250",fontSize:"12",fill:"#666",textAnchor:"middle",children:h},`label-${m}`)),n.map((h,m)=>{const c=40+m*32;if(h===0)return e.jsx("circle",{cx:c,cy:"40",r:"6",fill:"none",stroke:"#666",strokeWidth:"2"},`marker-${m}`);{const d=h-l+1;if(d>=1&&d<=5){const x=60+(d-.5)*40,p=o?.[m];return e.jsxs("g",{children:[e.jsx("circle",{cx:c,cy:x,r:"10",fill:"#2563eb"}),p&&p>0&&e.jsx("text",{x:c,y:x+4,fontSize:"12",fill:"white",textAnchor:"middle",children:p})]},`marker-${m}`)}return null}})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Finger positions: ",o?.filter(h=>h>0).join(", ")||"N/A"]})]})};function Qo({chord:t,isOpen:r,onClose:s,customDiagram:n}){return e.jsx(ht,{open:r,onOpenChange:s,children:e.jsxs(mt,{className:"max-w-2xl",children:[e.jsxs(xt,{children:[e.jsxs(ft,{className:"text-2xl",children:[t," Chord",n?.capo&&n.capo>0&&e.jsxs("span",{className:"ml-3 text-lg text-orange-600",children:["Capo ",n.capo]})]}),e.jsxs(pt,{children:["View chord diagrams for guitar, piano, and ukulele",n&&e.jsx("span",{className:"ml-2 text-blue-600",children:"(Custom)"})]})]}),e.jsxs(Ws,{defaultValue:"guitar",className:"w-full",children:[e.jsxs(Hs,{className:"grid w-full grid-cols-3",children:[e.jsx(Ue,{value:"guitar",children:"Guitar"}),e.jsx(Ue,{value:"piano",children:"Piano"}),e.jsx(Ue,{value:"ukulele",children:"Ukulele"})]}),e.jsx(qe,{value:"guitar",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(qo,{chord:t,customData:n?.guitar})}),e.jsx(qe,{value:"piano",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(Yo,{chord:t,customData:n?.piano})}),e.jsx(qe,{value:"ukulele",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(Zo,{chord:t,customData:n?.ukulele})})]})]})})}function Jo({open:t,onOpenChange:r,trackName:s,notes:n,onSave:o}){const[l,a]=u.useState(n);z.useEffect(()=>{a(n)},[n,t]);const i=()=>{o(l),r(!1)};return e.jsx(ht,{open:t,onOpenChange:r,children:e.jsxs(mt,{style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},children:[e.jsxs(xt,{children:[e.jsx(ft,{style:{color:"#F1F1F1"},children:"Track Notes"}),e.jsxs(pt,{style:{color:"#9E9E9E"},children:["Add notes for ",s]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Xs,{placeholder:"Enter your notes here...",value:l,onChange:h=>a(h.target.value),rows:6,style:{backgroundColor:"var(--daw-control)",borderColor:"var(--daw-border)",color:"#F1F1F1"}}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(A,{variant:"ghost",onClick:()=>r(!1),style:{color:"#9E9E9E"},children:"Cancel"}),e.jsx(A,{onClick:i,style:{backgroundColor:"#3B82F6",color:"#FFFFFF"},children:"Save Notes"})]})]})]})})}const ea=({start:t,end:r,onChange:s,minWidth:n=.01,className:o})=>{const l=u.useRef(null),[a,i]=u.useState(null),h=u.useCallback(p=>{if(!l.current)return 0;const f=l.current.getBoundingClientRect(),g=p-f.left;return Math.max(0,Math.min(1,g/f.width))},[]),m=(p,f)=>{p.preventDefault(),p.stopPropagation(),i({type:f,startX:p.clientX,initialStart:t,initialEnd:r})};u.useEffect(()=>{if(!a)return;const p=g=>{if(!l.current)return;const C=l.current.getBoundingClientRect().width;let j=a.initialStart,S=a.initialEnd;if(a.type==="pan"){const w=(g.clientX-a.startX)/C;if(j=a.initialStart+w,S=a.initialEnd+w,j<0){const v=0-j;j+=v,S+=v}if(S>1){const v=1-S;j+=v,S+=v}j=Math.max(0,Math.min(1-(a.initialEnd-a.initialStart),j)),S=Math.min(1,Math.max(a.initialEnd-a.initialStart,S))}else if(a.type==="left"){const k=h(g.clientX);j=Math.min(k,a.initialEnd-n),j=Math.max(0,j),S=a.initialEnd}else if(a.type==="right"){const k=h(g.clientX);S=Math.max(k,a.initialStart+n),S=Math.min(1,S),j=a.initialStart}(Math.abs(j-t)>1e-4||Math.abs(S-r)>1e-4)&&s({start:j,end:S})},f=()=>{i(null)};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",f)}},[a,t,r,n,s,h]);const c=p=>{if(p.target!==l.current)return;p.preventDefault(),p.stopPropagation();const f=h(p.clientX),g=r-t;let b=f-g/2,C=f+g/2;b<0&&(b=0,C=g),C>1&&(C=1,b=1-g),s({start:b,end:C})},d=t*100,x=(r-t)*100;return e.jsxs("div",{ref:l,onClick:c,className:Le("relative w-full select-none touch-none flex items-center border border-white/10 rounded-full cursor-pointer",o),style:{backgroundColor:"#18181b",height:"14px"},children:[e.jsx("div",{className:"absolute top-0 bottom-0 rounded-full group transition-colors cursor-grab active:cursor-grabbing hover:brightness-110",style:{left:`${d}%`,width:`${x}%`,backgroundColor:"#52525b",border:"1px solid #71717a",boxSizing:"border-box"},onMouseDown:p=>m(p,"pan")}),e.jsx("div",{className:"absolute top-1/2 w-6 h-6 cursor-ew-resize z-20 group/handle",style:{left:`${d}%`,transform:"translate(-50%, -50%)"},onMouseDown:p=>m(p,"left"),children:e.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full shadow-sm transition-transform hover:scale-150",style:{transform:"translate(-50%, -50%)"}})}),e.jsx("div",{className:"absolute top-1/2 w-6 h-6 cursor-ew-resize z-20 group/handle",style:{left:`${r*100}%`,transform:"translate(-50%, -50%)"},onMouseDown:p=>m(p,"right"),children:e.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full shadow-sm transition-transform hover:scale-150",style:{transform:"translate(-50%, -50%)"}})})]})},ta=({start:t,end:r,onChange:s,minHeight:n=.01,className:o})=>{const l=u.useRef(null),[a,i]=u.useState(null),h=u.useCallback(p=>{if(!l.current)return 0;const f=l.current.getBoundingClientRect(),g=p-f.top;return Math.max(0,Math.min(1,g/f.height))},[]),m=p=>{p.preventDefault(),p.stopPropagation(),i({startY:p.clientY,initialStart:t,initialEnd:r})};u.useEffect(()=>{if(!a)return;const p=g=>{if(!l.current)return;const C=l.current.getBoundingClientRect().height,S=(g.clientY-a.startY)/C;let k=a.initialStart+S,w=a.initialEnd+S;if(k<0){const v=0-k;k+=v,w+=v}if(w>1){const v=1-w;k+=v,w+=v}k=Math.max(0,Math.min(1-(a.initialEnd-a.initialStart),k)),w=Math.min(1,Math.max(a.initialEnd-a.initialStart,w)),(Math.abs(k-t)>1e-4||Math.abs(w-r)>1e-4)&&s({start:k,end:w})},f=()=>{i(null)};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",f)}},[a,t,r,s]);const c=p=>{if(p.target!==l.current)return;p.preventDefault(),p.stopPropagation();const f=h(p.clientY),g=r-t;let b=f-g/2,C=f+g/2;b<0&&(b=0,C=g),C>1&&(C=1,b=1-g),s({start:b,end:C})},d=t*100,x=(r-t)*100;return e.jsx("div",{ref:l,onClick:c,className:Le("relative h-full select-none touch-none flex justify-center border border-white/10 rounded-full cursor-pointer",o),style:{backgroundColor:"#18181b",width:"14px"},children:e.jsx("div",{className:"absolute left-0 right-0 rounded-full transition-colors cursor-grab active:cursor-grabbing hover:brightness-110",style:{top:`${d}%`,height:`${x}%`,backgroundColor:"#52525b",border:"1px solid #71717a",boxSizing:"border-box"},onMouseDown:m})})},sa=u.createContext(void 0),ra=({children:t,value:r})=>e.jsx(sa.Provider,{value:r,children:t}),na=({isPlaying:t,onPlayPause:r,onStop:s,onZoomIn:n,onZoomOut:o,onToggleLoop:l,onToggleMetronome:a,onGoToStart:i,onGoToEnd:h,onFitToView:m,onToggleEditMode:c,onToggleHelp:d,disabled:x=!1})=>{const p=u.useCallback(f=>{if(x)return;const g=f.target;if(!(g.tagName==="INPUT"||g.tagName==="TEXTAREA"||g.isContentEditable))switch(f.code){case"Space":f.preventDefault(),r();break;case"KeyS":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),s());break;case"Home":f.preventDefault(),i();break;case"End":f.preventDefault(),h();break;case"Equal":case"NumpadAdd":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),n());break;case"Minus":case"NumpadSubtract":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),o());break;case"KeyL":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),l());break;case"KeyM":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),a());break;case"Slash":f.shiftKey&&(f.preventDefault(),d?.());break;case"KeyF":!f.ctrlKey&&!f.metaKey&&!f.altKey&&!f.shiftKey&&(f.preventDefault(),m?.());break;case"KeyE":!f.ctrlKey&&!f.metaKey&&!f.altKey&&!f.shiftKey&&(f.preventDefault(),c?.());break}},[x,t,r,s,n,o,l,a,i,h,m,c,d]);return u.useEffect(()=>(window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p)}),[p]),null},oa=["time","measures","sections","chords","tempo"],aa=()=>{const[t,r]=u.useState(()=>Oe.getTrackHeight()),[s,n]=u.useState(1),[o,l]=u.useState(()=>Oe.getRulerOrder()),[a,i]=u.useState(()=>{const w={};return oa.forEach(v=>{w[v]=Oe.getRulerVisibility(v)}),w}),[h,m]=u.useState(!0),[c,d]=u.useState(!0),[x,p]=u.useState(!1),[f,g]=u.useState(!1);u.useEffect(()=>{Oe.setTrackHeight(t)},[t]),u.useEffect(()=>{Oe.setRulerOrder(o)},[o]);const b=u.useCallback((w,v)=>{i(N=>{const M={...N,[w]:v};return Oe.setRulerVisibility(w,v),M})},[]),C=u.useCallback(()=>{n(w=>Math.min(w+.5,8))},[]),j=u.useCallback(()=>{n(w=>Math.max(w-.5,.5))},[]),S=u.useCallback(w=>{n(Math.max(.5,Math.min(8,w)))},[]),k=u.useCallback(()=>{switch(t){case"small":return 80;case"large":return 180;default:return 120}},[t]);return{trackHeight:t,zoom:s,rulerVisibility:a,rulerOrder:o,sidebarVisible:h,mixerVisible:c,mixerDockVisible:x,notesPanelVisible:f,setTrackHeight:r,setZoom:n,setRulerVisibility:i,setRulerOrder:l,setSidebarVisible:m,setMixerVisible:d,setMixerDockVisible:p,setNotesPanelVisible:g,handleRulerVisibilityChange:b,handleZoomIn:C,handleZoomOut:j,handleZoomChange:S,getTrackHeightPx:k}};function la(t,r){let s=null;return(...n)=>{s&&clearTimeout(s),s=setTimeout(()=>t(...n),r)}}const ia=(t,r)=>{const[s,n]=u.useState(t?.tracks||[]),[o,l]=u.useState(new Set),a=u.useRef(null),i=u.useRef(null);u.useEffect(()=>{const k=t?.id||null;k!==a.current&&t?.tracks&&(n(t.tracks),a.current=k)},[t?.id]);const h=u.useCallback(k=>{t&&r&&r({...t,...k})},[t,r]);u.useEffect(()=>{i.current=la(k=>{t&&r&&r({...t,...k})},100)},[t,r]);const m=u.useCallback((k,w)=>{const v=isNaN(w)||!isFinite(w)?1:Math.max(0,Math.min(10,w));if(n(N=>N.map(M=>M.id===k?{...M,volume:v}:M)),i.current){const N=s.map(M=>M.id===k?{...M,volume:v}:M);i.current({tracks:N})}},[s]),c=u.useCallback(k=>{n(w=>{const v=w.map(N=>N.id===k?{...N,muted:!N.muted}:N);return h({tracks:v}),v})},[h]),d=u.useCallback(k=>{n(w=>{const v=w.map(N=>N.id===k?{...N,solo:!N.solo}:N);return h({tracks:v}),v})},[h]),x=u.useCallback((k,w)=>{n(v=>{const N=v.map(M=>M.id===k?{...M,name:w}:M);return h({tracks:N}),N})},[h]),p=u.useCallback((k,w)=>{n(v=>{const N=v.map(M=>M.id===k?{...M,color:w}:M);return h({tracks:N}),N})},[h]),f=u.useCallback((k,w)=>{n(v=>{const N=v.map(M=>M.id===k?{...M,tag:w}:M);return h({tracks:N}),N})},[h]),g=u.useCallback((k,w)=>{n(v=>{const N=v.map(M=>M.id===k?{...M,notes:w}:M);return h({tracks:N}),N})},[h]),b=u.useCallback(k=>{l(w=>{const v=new Set(w);return v.has(k)?v.delete(k):v.add(k),v})},[]),C=u.useCallback(k=>{if(!t)return;const w={id:`preset-${Date.now()}`,name:k,tracks:s.filter(v=>!o.has(v.id)).map(v=>({trackId:v.id,volume:v.volume,muted:v.muted}))};if(r){const v=[...t.mixPresets||[],w];r({...t,mixPresets:v})}},[t,s,o,r]),j=u.useCallback(k=>{if(!t||!t.mixPresets)return;const w=t.mixPresets.find(M=>M.id===k);if(!w)return;const v=s.map(M=>{if(o.has(M.id))return M;const E=w.tracks.find(L=>L.trackId===M.id);return E?{...M,volume:E.volume,muted:E.muted}:M}),N=Oe.getMainInstrument();if(N){const M=v.findIndex(E=>E.tag===N);if(M>0){const[E]=v.splice(M,1);v.unshift(E)}}n(v),h({tracks:v})},[t,o,s,h]),S=u.useCallback(k=>{if(!t||!r)return;const w=(t.mixPresets||[]).filter(v=>v.id!==k);r({...t,mixPresets:w})},[t,r]);return{tracks:s,setTracks:n,pinnedTracks:o,isAnySolo:s.some(k=>k.solo),handlers:{handleTrackVolumeChange:m,handleTrackMuteToggle:c,handleTrackSoloToggle:d,handleTrackNameChange:x,handleTrackColorChange:p,handleTrackTagChange:f,handleSaveTrackNotes:g,handleToggleTrackPin:b},presetHandlers:{handleSavePreset:C,handleLoadPreset:j,handleDeletePreset:S}}};function ca({song:t,onSongUpdate:r}){const s=ia(t,r),n=s.handlers.handleTrackVolumeChange,o=s.handlers.handleTrackMuteToggle,l=s.handlers.handleTrackSoloToggle,a=s.handlers.handleTrackNameChange,i=s.handlers.handleTrackColorChange,h=s.handlers.handleTrackTagChange;return{handleTrackVolumeChange:n,handleTrackMuteToggle:o,handleTrackSoloToggle:l,handleTrackNameChange:a,handleTrackColorChange:i,handleTrackTagChange:h}}function da({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",scrollContainerRef:a,scrollPosRef:i,zoom:h=1}){const m=u.useRef(null),c=u.useRef(null),d=u.useRef({scrollLeft:-1,width:0,totalWidth:0,dataLen:-1,zoom:0}),x=u.useRef(0);u.useEffect(()=>{if(!a.current)return;const f=new ResizeObserver(g=>{for(const b of g)x.current=b.contentRect.width});return f.observe(a.current),x.current=a.current.clientWidth,()=>f.disconnect()},[a]);const p=u.useCallback(()=>{const f=m.current,g=a.current;if(!f||!g){c.current=requestAnimationFrame(p);return}const b=i?i.current:g.scrollLeft,C=x.current,j=window.devicePixelRatio||1,S=t?t.length:0;if(b===d.current.scrollLeft&&C===d.current.width&&r===d.current.totalWidth&&S===d.current.dataLen){c.current=requestAnimationFrame(p);return}d.current={scrollLeft:b,width:C,totalWidth:r,dataLen:S,zoom:0};const k=C*j,w=s*j;(f.width!==k||f.height!==w)&&(f.width=k,f.height=w,f.style.width=`${C}px`,f.style.height=`${s}px`),f.style.transform=`translateX(${b}px)`;const v=f.getContext("2d",{alpha:!0});if(!v)return;if(v.setTransform(1,0,0,1,0,0),v.scale(j,j),v.clearRect(0,0,C,s),!t||t.length===0){v.strokeStyle=n,v.globalAlpha=.5,v.lineWidth=2,v.beginPath(),v.moveTo(0,s/2),v.lineTo(C,s/2),v.stroke(),c.current=requestAnimationFrame(p);return}const N=t.length,M=r/N;if(r===0)return;const E=Math.floor(b/M),L=Math.ceil((b+C)/M),G=Math.max(0,E),_=Math.min(N,L);if(G>=_){c.current=requestAnimationFrame(p);return}const ie=1/M,Z=ie>1?Math.floor(ie):1,q=s/2;v.fillStyle=n,v.globalAlpha=o,v.beginPath();const Q=G*M-b;v.moveTo(Q,q);const F=(W,D)=>{let J=0;for(let H=W;H<Math.min(D,N);H++)t[H]>J&&(J=t[H]);return J};for(let W=G;W<_;W+=Z){const D=Z>1?F(W,W+Z):t[W],J=W*M-b,H=Math.max(.5,D*q*.95);v.lineTo(J,q-H)}for(let W=_-1;W>=G;W-=Z){const D=Z>1?F(W,W+Z):t[W],J=W*M-b,H=Math.max(.5,D*q*.95);v.lineTo(J,q+H)}v.closePath(),v.fill(),c.current=requestAnimationFrame(p)},[t,r,s,n,o,h,a]);return u.useEffect(()=>(c.current=requestAnimationFrame(p),()=>{c.current&&cancelAnimationFrame(c.current)}),[p]),e.jsx("div",{className:"h-full w-full relative",children:e.jsx("canvas",{ref:m,className:l,style:{display:"block",position:"absolute",left:0,top:0,pointerEvents:"none",willChange:"transform"}})})}function ua({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",scrollLeft:a=0,viewportWidth:i=1e3,zoom:h=1}){const m=u.useRef(null),c=u.useRef(null);u.useRef(null);const d=u.useRef(!1),x=!t||t.length===0;return u.useEffect(()=>{x||m.current},[x]),u.useEffect(()=>{!d.current||!c.current||x||c.current.postMessage({type:"updateData",data:t})},[t,x]),u.useEffect(()=>{!d.current||!c.current||x||c.current.postMessage({type:"updateMetrics",width:r,height:s})},[r,s,x]),u.useEffect(()=>{!d.current||!c.current||x||c.current.postMessage({type:"render",viewportWidth:i,scrollLeft:a,zoom:h})},[a,i,h,x]),e.jsxs("div",{className:"relative w-full h-full",children:[x&&e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{backgroundColor:`${n}15`,pointerEvents:"none"}}),e.jsx("canvas",{ref:m,className:l,style:{display:"block",width:"100%",height:"100%",backgroundColor:"transparent",pointerEvents:"none",opacity:x?0:1}})]})}const ha=z.memo(ua,(t,r)=>t.data===r.data&&t.width===r.width&&t.height===r.height&&t.fill===r.fill&&t.opacity===r.opacity&&t.scrollLeft===r.scrollLeft&&t.viewportWidth===r.viewportWidth&&t.zoom===r.zoom);ha.displayName="WaveformCanvasOffscreenMemoized";function ma({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:l="",useCanvas:a=!0,scrollContainerRef:i,scrollPosRef:h,zoom:m=1}){return e.jsx(da,{data:t,width:r,height:s,fill:n,opacity:o,className:l,scrollContainerRef:i||{current:null},scrollPosRef:h,zoom:m})}function xa(t,r=1){const s=u.useCallback(()=>{if(r<.5){const a=Ut.getOverview(t);if(a&&a.length>0)return a}return Ut.getWaveform(t)||[]},[t,r]),[n,o]=u.useState(()=>s());return u.useEffect(()=>{const l=Ut.subscribe(()=>{o(s())}),a=s();return a.length>0&&o(a),l},[s]),n}const gr=z.memo(({trackId:t,color:r,duration:s,pps:n,height:o,zoom:l,scrollContainerRef:a,scrollPosRef:i})=>{const h=xa(t,l);return e.jsx("div",{className:"waveform-container",style:{height:"calc(100% - 20px)"},children:e.jsx(ma,{data:h,width:s*n,height:o,fill:r||"#3b82f6",opacity:.8,useCanvas:!0,scrollContainerRef:a,scrollPosRef:i,zoom:l})})});gr.displayName="TrackWaveformRenderer";const vr=z.memo(z.forwardRef(({song:t,currentTime:r,zoom:s,pixelsPerSecond:n,filteredTracks:o,loopStart:l,loopEnd:a,trackHeightPx:i,onTimelineMouseDown:h,onTimelineMouseMove:m,onTimelineMouseUp:c,onScroll:d},x)=>{const p=u.useRef(null),f=u.useRef(0),g=u.useCallback(j=>{f.current=j.currentTarget.scrollLeft,d(j.currentTarget.scrollLeft)},[d]),b=n||s*100,C=l!==null&&a!==null?{left:`${l*b}px`,width:`${(a-l)*b}px`}:void 0;return e.jsx("div",{className:"timeline-tracks-container flex-1 overflow-auto relative scrollbar-hide",style:{backgroundColor:"var(--daw-bg-main)",overflowY:"auto",scrollbarWidth:"none",msOverflowStyle:"none"},ref:j=>{typeof x=="function"?x(j):x&&(x.current=j),p.current=j},onScroll:g,children:e.jsxs("div",{className:"relative",style:{width:`${t.duration*b}px`,height:`${Math.max(o.length*i,0)}px`,minHeight:"100%",paddingTop:0,paddingBottom:0},onClick:h,onMouseDown:h,onMouseMove:m,onMouseUp:c,onMouseLeave:c,children:[e.jsx("div",{className:"absolute top-0 z-50 pointer-events-none",style:{left:`${r*b}px`,height:"100%"},children:e.jsx("div",{className:"h-full",style:{width:"2px",backgroundColor:"#ef4444",boxShadow:"0 0 4px rgba(239, 68, 68, 0.4)"}})}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"linear-gradient(to right, var(--daw-grid) 1px, transparent 1px)",backgroundSize:"100px 100%",opacity:.3}}),C&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-yellow-500/10 border-l-2 border-r-2 border-yellow-500/50 z-10 pointer-events-none",style:C}),o.map((j,S)=>e.jsx("div",{className:"track-lane absolute left-0 right-0 border-b box-border",style:{top:0,height:`${i}px`,minHeight:`${i}px`,maxHeight:`${i}px`,transform:`translateY(${S*i}px)`,borderColor:"var(--daw-border)",borderBottomWidth:"1px"},children:e.jsxs("div",{className:"clip-box absolute rounded-md overflow-hidden border",style:{left:0,top:"2px",width:`${t.duration*b}px`,height:"calc(100% - 4px)",backgroundColor:`${j.color}20`,borderColor:`${j.color}40`,borderWidth:"1px"},children:[e.jsx("div",{className:"h-5 w-full flex items-center px-2",style:{backgroundColor:`${j.color}60`},children:e.jsx("span",{className:"text-[10px] text-white truncate font-medium drop-shadow",children:j.name})}),e.jsx(gr,{trackId:j.id,color:j.color||"#3b82f6",duration:t.duration,pps:b,height:i-28,zoom:s,scrollContainerRef:p,scrollPosRef:f})]})},j.id))]})})}));vr.displayName="TimelineContainer";const fa=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M6 20h12l-2-12H8l-2 12z"}),e.jsx("line",{x1:"12",y1:"8",x2:"14",y2:"13"}),e.jsx("circle",{cx:"14.5",cy:"14",r:"1.5"}),e.jsx("path",{d:"M5 20h14"})]}),Rs=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10"}),e.jsx("path",{d:"M12 2a10 10 0 0 0-10 10"}),e.jsx("path",{d:"M2 12a10 10 0 0 0 10 10"}),e.jsx("path",{d:"M22 12a10 10 0 0 1-10 10"}),e.jsx("path",{d:"M12 12l4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"5"}),e.jsx("line",{x1:"19",y1:"12",x2:"18",y2:"12"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"6",y2:"12"})]}),pa=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"6",y1:"4",x2:"6",y2:"20",strokeWidth:"1.5"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20",strokeWidth:"2"}),e.jsx("line",{x1:"18",y1:"4",x2:"18",y2:"20",strokeWidth:"1.5"}),e.jsx("circle",{cx:"9",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("path",{d:"M10.5 12h4.5"}),e.jsx("path",{d:"M13 10l2 2-2 2"})]}),ga=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M17 2l4 4-4 4"}),e.jsx("path",{d:"M3 11v-1a9 9 0 0 1 9-9h9"}),e.jsx("path",{d:"M7 22l-4-4 4-4"}),e.jsx("path",{d:"M21 13v1a9 9 0 0 1-9 9H3"})]}),_s=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M10 8l6 4-6 4V8z",fill:"currentColor"})]}),Is=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M4 4v16",strokeWidth:"2.5"}),e.jsx("path",{d:"M4 4h12l-2 4 2 4H4"}),e.jsx("path",{d:"M17 15l2-2 2 2-3 3-2-2z"}),e.jsx("path",{d:"M16 18l-2 2"})]}),Os=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"4",y1:"7",x2:"20",y2:"7",strokeWidth:"1.5"}),e.jsx("path",{d:"M4 12 Q 12 9, 20 12",strokeWidth:"2"}),e.jsx("line",{x1:"4",y1:"17",x2:"20",y2:"17",strokeWidth:"1.5"}),e.jsx("line",{x1:"8",y1:"5",x2:"8",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("line",{x1:"16",y1:"5",x2:"16",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("circle",{cx:"12",cy:"9",r:"2",fill:"currentColor"})]}),va=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"3",rx:"1"}),e.jsx("rect",{x:"3",y:"10",width:"18",height:"3",rx:"1"}),e.jsx("rect",{x:"3",y:"16",width:"18",height:"3",rx:"1"}),e.jsx("circle",{cx:"8",cy:"5.5",r:"0.8",fill:"currentColor"}),e.jsx("circle",{cx:"8",cy:"11.5",r:"0.8",fill:"currentColor"}),e.jsx("circle",{cx:"8",cy:"17.5",r:"0.8",fill:"currentColor"})]});var ba=Symbol("radix.slottable");function ya(t){const r=({children:s})=>e.jsx(e.Fragment,{children:s});return r.displayName=`${t}.Slottable`,r.__radixId=ba,r}var[At]=Tt("Tooltip",[Et]),Ft=Et(),br="TooltipProvider",ja=700,rs="tooltip.open",[wa,ps]=At(br),yr=t=>{const{__scopeTooltip:r,delayDuration:s=ja,skipDelayDuration:n=300,disableHoverableContent:o=!1,children:l}=t,a=u.useRef(!0),i=u.useRef(!1),h=u.useRef(0);return u.useEffect(()=>{const m=h.current;return()=>window.clearTimeout(m)},[]),e.jsx(wa,{scope:r,isOpenDelayedRef:a,delayDuration:s,onOpen:u.useCallback(()=>{window.clearTimeout(h.current),a.current=!1},[]),onClose:u.useCallback(()=>{window.clearTimeout(h.current),h.current=window.setTimeout(()=>a.current=!0,n)},[n]),isPointerInTransitRef:i,onPointerInTransitChange:u.useCallback(m=>{i.current=m},[]),disableHoverableContent:o,children:l})};yr.displayName=br;var ct="Tooltip",[Ca,gt]=At(ct),jr=t=>{const{__scopeTooltip:r,children:s,open:n,defaultOpen:o,onOpenChange:l,disableHoverableContent:a,delayDuration:i}=t,h=ps(ct,t.__scopeTooltip),m=Ft(r),[c,d]=u.useState(null),x=Jt(),p=u.useRef(0),f=a??h.disableHoverableContent,g=i??h.delayDuration,b=u.useRef(!1),[C,j]=is({prop:n,defaultProp:o??!1,onChange:N=>{N?(h.onOpen(),document.dispatchEvent(new CustomEvent(rs))):h.onClose(),l?.(N)},caller:ct}),S=u.useMemo(()=>C?b.current?"delayed-open":"instant-open":"closed",[C]),k=u.useCallback(()=>{window.clearTimeout(p.current),p.current=0,b.current=!1,j(!0)},[j]),w=u.useCallback(()=>{window.clearTimeout(p.current),p.current=0,j(!1)},[j]),v=u.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{b.current=!0,j(!0),p.current=0},g)},[g,j]);return u.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),e.jsx(Us,{...m,children:e.jsx(Ca,{scope:r,contentId:x,open:C,stateAttribute:S,trigger:c,onTriggerChange:d,onTriggerEnter:u.useCallback(()=>{h.isOpenDelayedRef.current?v():k()},[h.isOpenDelayedRef,v,k]),onTriggerLeave:u.useCallback(()=>{f?w():(window.clearTimeout(p.current),p.current=0)},[w,f]),onOpen:k,onClose:w,disableHoverableContent:f,children:s})})};jr.displayName=ct;var ns="TooltipTrigger",wr=u.forwardRef((t,r)=>{const{__scopeTooltip:s,...n}=t,o=gt(ns,s),l=ps(ns,s),a=Ft(s),i=u.useRef(null),h=_e(r,i,o.onTriggerChange),m=u.useRef(!1),c=u.useRef(!1),d=u.useCallback(()=>m.current=!1,[]);return u.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),e.jsx(qs,{asChild:!0,...a,children:e.jsx(Ie.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...n,ref:h,onPointerMove:X(t.onPointerMove,x=>{x.pointerType!=="touch"&&!c.current&&!l.isPointerInTransitRef.current&&(o.onTriggerEnter(),c.current=!0)}),onPointerLeave:X(t.onPointerLeave,()=>{o.onTriggerLeave(),c.current=!1}),onPointerDown:X(t.onPointerDown,()=>{o.open&&o.onClose(),m.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:X(t.onFocus,()=>{m.current||o.onOpen()}),onBlur:X(t.onBlur,o.onClose),onClick:X(t.onClick,o.onClose)})})});wr.displayName=ns;var gs="TooltipPortal",[ka,Na]=At(gs,{forceMount:void 0}),Cr=t=>{const{__scopeTooltip:r,forceMount:s,children:n,container:o}=t,l=gt(gs,r);return e.jsx(ka,{scope:r,forceMount:s,children:e.jsx(tt,{present:s||l.open,children:e.jsx(Ys,{asChild:!0,container:o,children:n})})})};Cr.displayName=gs;var Je="TooltipContent",kr=u.forwardRef((t,r)=>{const s=Na(Je,t.__scopeTooltip),{forceMount:n=s.forceMount,side:o="top",...l}=t,a=gt(Je,t.__scopeTooltip);return e.jsx(tt,{present:n||a.open,children:a.disableHoverableContent?e.jsx(Nr,{side:o,...l,ref:r}):e.jsx(Ma,{side:o,...l,ref:r})})}),Ma=u.forwardRef((t,r)=>{const s=gt(Je,t.__scopeTooltip),n=ps(Je,t.__scopeTooltip),o=u.useRef(null),l=_e(r,o),[a,i]=u.useState(null),{trigger:h,onClose:m}=s,c=o.current,{onPointerInTransitChange:d}=n,x=u.useCallback(()=>{i(null),d(!1)},[d]),p=u.useCallback((f,g)=>{const b=f.currentTarget,C={x:f.clientX,y:f.clientY},j=Da(C,b.getBoundingClientRect()),S=Pa(C,j),k=Aa(g.getBoundingClientRect()),w=Ra([...S,...k]);i(w),d(!0)},[d]);return u.useEffect(()=>()=>x(),[x]),u.useEffect(()=>{if(h&&c){const f=b=>p(b,c),g=b=>p(b,h);return h.addEventListener("pointerleave",f),c.addEventListener("pointerleave",g),()=>{h.removeEventListener("pointerleave",f),c.removeEventListener("pointerleave",g)}}},[h,c,p,x]),u.useEffect(()=>{if(a){const f=g=>{const b=g.target,C={x:g.clientX,y:g.clientY},j=h?.contains(b)||c?.contains(b),S=!Fa(C,a);j?x():S&&(x(),m())};return document.addEventListener("pointermove",f),()=>document.removeEventListener("pointermove",f)}},[h,c,a,m,x]),e.jsx(Nr,{...t,ref:l})}),[Sa,Ta]=At(ct,{isInside:!1}),Ea=ya("TooltipContent"),Nr=u.forwardRef((t,r)=>{const{__scopeTooltip:s,children:n,"aria-label":o,onEscapeKeyDown:l,onPointerDownOutside:a,...i}=t,h=gt(Je,s),m=Ft(s),{onClose:c}=h;return u.useEffect(()=>(document.addEventListener(rs,c),()=>document.removeEventListener(rs,c)),[c]),u.useEffect(()=>{if(h.trigger){const d=x=>{x.target?.contains(h.trigger)&&c()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[h.trigger,c]),e.jsx(Qs,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:a,onFocusOutside:d=>d.preventDefault(),onDismiss:c,children:e.jsxs(Js,{"data-state":h.stateAttribute,...m,...i,ref:r,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(Ea,{children:n}),e.jsx(Sa,{scope:s,isInside:!0,children:e.jsx(Rn,{id:h.contentId,role:"tooltip",children:o||n})})]})})});kr.displayName=Je;var Mr="TooltipArrow",Sr=u.forwardRef((t,r)=>{const{__scopeTooltip:s,...n}=t,o=Ft(s);return Ta(Mr,s).isInside?null:e.jsx(Zs,{...o,...n,ref:r})});Sr.displayName=Mr;function Da(t,r){const s=Math.abs(r.top-t.y),n=Math.abs(r.bottom-t.y),o=Math.abs(r.right-t.x),l=Math.abs(r.left-t.x);switch(Math.min(s,n,o,l)){case l:return"left";case o:return"right";case s:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function Pa(t,r,s=5){const n=[];switch(r){case"top":n.push({x:t.x-s,y:t.y+s},{x:t.x+s,y:t.y+s});break;case"bottom":n.push({x:t.x-s,y:t.y-s},{x:t.x+s,y:t.y-s});break;case"left":n.push({x:t.x+s,y:t.y-s},{x:t.x+s,y:t.y+s});break;case"right":n.push({x:t.x-s,y:t.y-s},{x:t.x-s,y:t.y+s});break}return n}function Aa(t){const{top:r,right:s,bottom:n,left:o}=t;return[{x:o,y:r},{x:s,y:r},{x:s,y:n},{x:o,y:n}]}function Fa(t,r){const{x:s,y:n}=t;let o=!1;for(let l=0,a=r.length-1;l<r.length;a=l++){const i=r[l],h=r[a],m=i.x,c=i.y,d=h.x,x=h.y;c>n!=x>n&&s<(d-m)*(n-c)/(x-c)+m&&(o=!o)}return o}function Ra(t){const r=t.slice();return r.sort((s,n)=>s.x<n.x?-1:s.x>n.x?1:s.y<n.y?-1:s.y>n.y?1:0),_a(r)}function _a(t){if(t.length<=1)return t.slice();const r=[];for(let n=0;n<t.length;n++){const o=t[n];for(;r.length>=2;){const l=r[r.length-1],a=r[r.length-2];if((l.x-a.x)*(o.y-a.y)>=(l.y-a.y)*(o.x-a.x))r.pop();else break}r.push(o)}r.pop();const s=[];for(let n=t.length-1;n>=0;n--){const o=t[n];for(;s.length>=2;){const l=s[s.length-1],a=s[s.length-2];if((l.x-a.x)*(o.y-a.y)>=(l.y-a.y)*(o.x-a.x))s.pop();else break}s.push(o)}return s.pop(),r.length===1&&s.length===1&&r[0].x===s[0].x&&r[0].y===s[0].y?r:r.concat(s)}var Ia=yr,Oa=jr,La=wr,Ba=Cr,$a=kr,za=Sr;function vs({delayDuration:t=0,...r}){return e.jsx(Ia,{"data-slot":"tooltip-provider",delayDuration:t,...r})}function ce({...t}){return e.jsx(vs,{children:e.jsx(Oa,{"data-slot":"tooltip",...t})})}function de({...t}){return e.jsx(La,{"data-slot":"tooltip-trigger",...t})}function ue({className:t,sideOffset:r=0,children:s,...n}){return e.jsx(Ba,{children:e.jsxs($a,{"data-slot":"tooltip-content",sideOffset:r,className:Le("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...n,children:[s,e.jsx(za,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function Ga(t){const r=Va(t),s=u.forwardRef((n,o)=>{const{children:l,...a}=n,i=u.Children.toArray(l),h=i.find(Ha);if(h){const m=h.props.children,c=i.map(d=>d===h?u.Children.count(m)>1?u.Children.only(null):u.isValidElement(m)?m.props.children:null:d);return e.jsx(r,{...a,ref:o,children:u.isValidElement(m)?u.cloneElement(m,void 0,c):null})}return e.jsx(r,{...a,ref:o,children:l})});return s.displayName=`${t}.Slot`,s}function Va(t){const r=u.forwardRef((s,n)=>{const{children:o,...l}=s;if(u.isValidElement(o)){const a=Xa(o),i=Ka(l,o.props);return o.type!==u.Fragment&&(i.ref=n?ds(n,a):a),u.cloneElement(o,i)}return u.Children.count(o)>1?u.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var Wa=Symbol("radix.slottable");function Ha(t){return u.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Wa}function Ka(t,r){const s={...r};for(const n in r){const o=t[n],l=r[n];/^on[A-Z]/.test(n)?o&&l?s[n]=(...i)=>{const h=l(...i);return o(...i),h}:o&&(s[n]=o):n==="style"?s[n]={...o,...l}:n==="className"&&(s[n]=[o,l].filter(Boolean).join(" "))}return{...t,...s}}function Xa(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=r&&"isReactWarning"in r&&r.isReactWarning;return s?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var os=["Enter"," "],Ua=["ArrowDown","PageUp","Home"],Tr=["ArrowUp","PageDown","End"],qa=[...Ua,...Tr],Ya={ltr:[...os,"ArrowRight"],rtl:[...os,"ArrowLeft"]},Za={ltr:["ArrowLeft"],rtl:["ArrowRight"]},vt="Menu",[dt,Qa,Ja]=_n(vt),[We,Er]=Tt(vt,[Ja,Et,er]),Rt=Et(),Dr=er(),[el,He]=We(vt),[tl,bt]=We(vt),Pr=t=>{const{__scopeMenu:r,open:s=!1,children:n,dir:o,onOpenChange:l,modal:a=!0}=t,i=Rt(r),[h,m]=u.useState(null),c=u.useRef(!1),d=tr(l),x=In(o);return u.useEffect(()=>{const p=()=>{c.current=!0,document.addEventListener("pointerdown",f,{capture:!0,once:!0}),document.addEventListener("pointermove",f,{capture:!0,once:!0})},f=()=>c.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",f,{capture:!0}),document.removeEventListener("pointermove",f,{capture:!0})}},[]),e.jsx(Us,{...i,children:e.jsx(el,{scope:r,open:s,onOpenChange:d,content:h,onContentChange:m,children:e.jsx(tl,{scope:r,onClose:u.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:c,dir:x,modal:a,children:n})})})};Pr.displayName=vt;var sl="MenuAnchor",bs=u.forwardRef((t,r)=>{const{__scopeMenu:s,...n}=t,o=Rt(s);return e.jsx(qs,{...o,...n,ref:r})});bs.displayName=sl;var ys="MenuPortal",[rl,Ar]=We(ys,{forceMount:void 0}),Fr=t=>{const{__scopeMenu:r,forceMount:s,children:n,container:o}=t,l=He(ys,r);return e.jsx(rl,{scope:r,forceMount:s,children:e.jsx(tt,{present:s||l.open,children:e.jsx(Ys,{asChild:!0,container:o,children:n})})})};Fr.displayName=ys;var Me="MenuContent",[nl,js]=We(Me),Rr=u.forwardRef((t,r)=>{const s=Ar(Me,t.__scopeMenu),{forceMount:n=s.forceMount,...o}=t,l=He(Me,t.__scopeMenu),a=bt(Me,t.__scopeMenu);return e.jsx(dt.Provider,{scope:t.__scopeMenu,children:e.jsx(tt,{present:n||l.open,children:e.jsx(dt.Slot,{scope:t.__scopeMenu,children:a.modal?e.jsx(ol,{...o,ref:r}):e.jsx(al,{...o,ref:r})})})})}),ol=u.forwardRef((t,r)=>{const s=He(Me,t.__scopeMenu),n=u.useRef(null),o=_e(r,n);return u.useEffect(()=>{const l=n.current;if(l)return On(l)},[]),e.jsx(ws,{...t,ref:o,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:X(t.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),al=u.forwardRef((t,r)=>{const s=He(Me,t.__scopeMenu);return e.jsx(ws,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>s.onOpenChange(!1)})}),ll=Ga("MenuContent.ScrollLock"),ws=u.forwardRef((t,r)=>{const{__scopeMenu:s,loop:n=!1,trapFocus:o,onOpenAutoFocus:l,onCloseAutoFocus:a,disableOutsidePointerEvents:i,onEntryFocus:h,onEscapeKeyDown:m,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:x,onDismiss:p,disableOutsideScroll:f,...g}=t,b=He(Me,s),C=bt(Me,s),j=Rt(s),S=Dr(s),k=Qa(s),[w,v]=u.useState(null),N=u.useRef(null),M=_e(r,N,b.onContentChange),E=u.useRef(0),L=u.useRef(""),G=u.useRef(0),_=u.useRef(null),ie=u.useRef("right"),Z=u.useRef(0),q=f?zn:u.Fragment,Q=f?{as:ll,allowPinchZoom:!0}:void 0,F=D=>{const J=L.current+D,H=k().filter(O=>!O.disabled),re=document.activeElement,ge=H.find(O=>O.ref.current===re)?.textValue,he=H.map(O=>O.textValue),te=bl(he,J,ge),fe=H.find(O=>O.textValue===te)?.ref.current;(function O(K){L.current=K,window.clearTimeout(E.current),K!==""&&(E.current=window.setTimeout(()=>O(""),1e3))})(J),fe&&setTimeout(()=>fe.focus())};u.useEffect(()=>()=>window.clearTimeout(E.current),[]),$n();const W=u.useCallback(D=>ie.current===_.current?.side&&jl(D,_.current?.area),[]);return e.jsx(nl,{scope:s,searchRef:L,onItemEnter:u.useCallback(D=>{W(D)&&D.preventDefault()},[W]),onItemLeave:u.useCallback(D=>{W(D)||(N.current?.focus(),v(null))},[W]),onTriggerLeave:u.useCallback(D=>{W(D)&&D.preventDefault()},[W]),pointerGraceTimerRef:G,onPointerGraceIntentChange:u.useCallback(D=>{_.current=D},[]),children:e.jsx(q,{...Q,children:e.jsx(Gn,{asChild:!0,trapped:o,onMountAutoFocus:X(l,D=>{D.preventDefault(),N.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:a,children:e.jsx(Qs,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:m,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:x,onDismiss:p,children:e.jsx(Vn,{asChild:!0,...S,dir:C.dir,orientation:"vertical",loop:n,currentTabStopId:w,onCurrentTabStopIdChange:v,onEntryFocus:X(h,D=>{C.isUsingKeyboardRef.current||D.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Js,{role:"menu","aria-orientation":"vertical","data-state":Yr(b.open),"data-radix-menu-content":"",dir:C.dir,...j,...g,ref:M,style:{outline:"none",...g.style},onKeyDown:X(g.onKeyDown,D=>{const H=D.target.closest("[data-radix-menu-content]")===D.currentTarget,re=D.ctrlKey||D.altKey||D.metaKey,ge=D.key.length===1;H&&(D.key==="Tab"&&D.preventDefault(),!re&&ge&&F(D.key));const he=N.current;if(D.target!==he||!qa.includes(D.key))return;D.preventDefault();const fe=k().filter(O=>!O.disabled).map(O=>O.ref.current);Tr.includes(D.key)&&fe.reverse(),gl(fe)}),onBlur:X(t.onBlur,D=>{D.currentTarget.contains(D.target)||(window.clearTimeout(E.current),L.current="")}),onPointerMove:X(t.onPointerMove,ut(D=>{const J=D.target,H=Z.current!==D.clientX;if(D.currentTarget.contains(J)&&H){const re=D.clientX>Z.current?"right":"left";ie.current=re,Z.current=D.clientX}}))})})})})})})});Rr.displayName=Me;var il="MenuGroup",Cs=u.forwardRef((t,r)=>{const{__scopeMenu:s,...n}=t;return e.jsx(Ie.div,{role:"group",...n,ref:r})});Cs.displayName=il;var cl="MenuLabel",_r=u.forwardRef((t,r)=>{const{__scopeMenu:s,...n}=t;return e.jsx(Ie.div,{...n,ref:r})});_r.displayName=cl;var Ct="MenuItem",Ls="menu.itemSelect",_t=u.forwardRef((t,r)=>{const{disabled:s=!1,onSelect:n,...o}=t,l=u.useRef(null),a=bt(Ct,t.__scopeMenu),i=js(Ct,t.__scopeMenu),h=_e(r,l),m=u.useRef(!1),c=()=>{const d=l.current;if(!s&&d){const x=new CustomEvent(Ls,{bubbles:!0,cancelable:!0});d.addEventListener(Ls,p=>n?.(p),{once:!0}),Bn(d,x),x.defaultPrevented?m.current=!1:a.onClose()}};return e.jsx(Ir,{...o,ref:h,disabled:s,onClick:X(t.onClick,c),onPointerDown:d=>{t.onPointerDown?.(d),m.current=!0},onPointerUp:X(t.onPointerUp,d=>{m.current||d.currentTarget?.click()}),onKeyDown:X(t.onKeyDown,d=>{const x=i.searchRef.current!=="";s||x&&d.key===" "||os.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});_t.displayName=Ct;var Ir=u.forwardRef((t,r)=>{const{__scopeMenu:s,disabled:n=!1,textValue:o,...l}=t,a=js(Ct,s),i=Dr(s),h=u.useRef(null),m=_e(r,h),[c,d]=u.useState(!1),[x,p]=u.useState("");return u.useEffect(()=>{const f=h.current;f&&p((f.textContent??"").trim())},[l.children]),e.jsx(dt.ItemSlot,{scope:s,disabled:n,textValue:o??x,children:e.jsx(Ln,{asChild:!0,...i,focusable:!n,children:e.jsx(Ie.div,{role:"menuitem","data-highlighted":c?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...l,ref:m,onPointerMove:X(t.onPointerMove,ut(f=>{n?a.onItemLeave(f):(a.onItemEnter(f),f.defaultPrevented||f.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:X(t.onPointerLeave,ut(f=>a.onItemLeave(f))),onFocus:X(t.onFocus,()=>d(!0)),onBlur:X(t.onBlur,()=>d(!1))})})})}),dl="MenuCheckboxItem",Or=u.forwardRef((t,r)=>{const{checked:s=!1,onCheckedChange:n,...o}=t;return e.jsx(Gr,{scope:t.__scopeMenu,checked:s,children:e.jsx(_t,{role:"menuitemcheckbox","aria-checked":kt(s)?"mixed":s,...o,ref:r,"data-state":Ns(s),onSelect:X(o.onSelect,()=>n?.(kt(s)?!0:!s),{checkForDefaultPrevented:!1})})})});Or.displayName=dl;var Lr="MenuRadioGroup",[ul,hl]=We(Lr,{value:void 0,onValueChange:()=>{}}),Br=u.forwardRef((t,r)=>{const{value:s,onValueChange:n,...o}=t,l=tr(n);return e.jsx(ul,{scope:t.__scopeMenu,value:s,onValueChange:l,children:e.jsx(Cs,{...o,ref:r})})});Br.displayName=Lr;var $r="MenuRadioItem",zr=u.forwardRef((t,r)=>{const{value:s,...n}=t,o=hl($r,t.__scopeMenu),l=s===o.value;return e.jsx(Gr,{scope:t.__scopeMenu,checked:l,children:e.jsx(_t,{role:"menuitemradio","aria-checked":l,...n,ref:r,"data-state":Ns(l),onSelect:X(n.onSelect,()=>o.onValueChange?.(s),{checkForDefaultPrevented:!1})})})});zr.displayName=$r;var ks="MenuItemIndicator",[Gr,ml]=We(ks,{checked:!1}),Vr=u.forwardRef((t,r)=>{const{__scopeMenu:s,forceMount:n,...o}=t,l=ml(ks,s);return e.jsx(tt,{present:n||kt(l.checked)||l.checked===!0,children:e.jsx(Ie.span,{...o,ref:r,"data-state":Ns(l.checked)})})});Vr.displayName=ks;var xl="MenuSeparator",Wr=u.forwardRef((t,r)=>{const{__scopeMenu:s,...n}=t;return e.jsx(Ie.div,{role:"separator","aria-orientation":"horizontal",...n,ref:r})});Wr.displayName=xl;var fl="MenuArrow",Hr=u.forwardRef((t,r)=>{const{__scopeMenu:s,...n}=t,o=Rt(s);return e.jsx(Zs,{...o,...n,ref:r})});Hr.displayName=fl;var pl="MenuSub",[ec,Kr]=We(pl),at="MenuSubTrigger",Xr=u.forwardRef((t,r)=>{const s=He(at,t.__scopeMenu),n=bt(at,t.__scopeMenu),o=Kr(at,t.__scopeMenu),l=js(at,t.__scopeMenu),a=u.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:h}=l,m={__scopeMenu:t.__scopeMenu},c=u.useCallback(()=>{a.current&&window.clearTimeout(a.current),a.current=null},[]);return u.useEffect(()=>c,[c]),u.useEffect(()=>{const d=i.current;return()=>{window.clearTimeout(d),h(null)}},[i,h]),e.jsx(bs,{asChild:!0,...m,children:e.jsx(Ir,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":o.contentId,"data-state":Yr(s.open),...t,ref:ds(r,o.onTriggerChange),onClick:d=>{t.onClick?.(d),!(t.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),s.open||s.onOpenChange(!0))},onPointerMove:X(t.onPointerMove,ut(d=>{l.onItemEnter(d),!d.defaultPrevented&&!t.disabled&&!s.open&&!a.current&&(l.onPointerGraceIntentChange(null),a.current=window.setTimeout(()=>{s.onOpenChange(!0),c()},100))})),onPointerLeave:X(t.onPointerLeave,ut(d=>{c();const x=s.content?.getBoundingClientRect();if(x){const p=s.content?.dataset.side,f=p==="right",g=f?-5:5,b=x[f?"left":"right"],C=x[f?"right":"left"];l.onPointerGraceIntentChange({area:[{x:d.clientX+g,y:d.clientY},{x:b,y:x.top},{x:C,y:x.top},{x:C,y:x.bottom},{x:b,y:x.bottom}],side:p}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(d),d.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:X(t.onKeyDown,d=>{const x=l.searchRef.current!=="";t.disabled||x&&d.key===" "||Ya[n.dir].includes(d.key)&&(s.onOpenChange(!0),s.content?.focus(),d.preventDefault())})})})});Xr.displayName=at;var Ur="MenuSubContent",qr=u.forwardRef((t,r)=>{const s=Ar(Me,t.__scopeMenu),{forceMount:n=s.forceMount,...o}=t,l=He(Me,t.__scopeMenu),a=bt(Me,t.__scopeMenu),i=Kr(Ur,t.__scopeMenu),h=u.useRef(null),m=_e(r,h);return e.jsx(dt.Provider,{scope:t.__scopeMenu,children:e.jsx(tt,{present:n||l.open,children:e.jsx(dt.Slot,{scope:t.__scopeMenu,children:e.jsx(ws,{id:i.contentId,"aria-labelledby":i.triggerId,...o,ref:m,align:"start",side:a.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:c=>{a.isUsingKeyboardRef.current&&h.current?.focus(),c.preventDefault()},onCloseAutoFocus:c=>c.preventDefault(),onFocusOutside:X(t.onFocusOutside,c=>{c.target!==i.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:X(t.onEscapeKeyDown,c=>{a.onClose(),c.preventDefault()}),onKeyDown:X(t.onKeyDown,c=>{const d=c.currentTarget.contains(c.target),x=Za[a.dir].includes(c.key);d&&x&&(l.onOpenChange(!1),i.trigger?.focus(),c.preventDefault())})})})})})});qr.displayName=Ur;function Yr(t){return t?"open":"closed"}function kt(t){return t==="indeterminate"}function Ns(t){return kt(t)?"indeterminate":t?"checked":"unchecked"}function gl(t){const r=document.activeElement;for(const s of t)if(s===r||(s.focus(),document.activeElement!==r))return}function vl(t,r){return t.map((s,n)=>t[(r+n)%t.length])}function bl(t,r,s){const o=r.length>1&&Array.from(r).every(m=>m===r[0])?r[0]:r,l=s?t.indexOf(s):-1;let a=vl(t,Math.max(l,0));o.length===1&&(a=a.filter(m=>m!==s));const h=a.find(m=>m.toLowerCase().startsWith(o.toLowerCase()));return h!==s?h:void 0}function yl(t,r){const{x:s,y:n}=t;let o=!1;for(let l=0,a=r.length-1;l<r.length;a=l++){const i=r[l],h=r[a],m=i.x,c=i.y,d=h.x,x=h.y;c>n!=x>n&&s<(d-m)*(n-c)/(x-c)+m&&(o=!o)}return o}function jl(t,r){if(!r)return!1;const s={x:t.clientX,y:t.clientY};return yl(s,r)}function ut(t){return r=>r.pointerType==="mouse"?t(r):void 0}var wl=Pr,Cl=bs,kl=Fr,Nl=Rr,Ml=Cs,Sl=_r,Tl=_t,El=Or,Dl=Br,Pl=zr,Al=Vr,Fl=Wr,Rl=Hr,_l=Xr,Il=qr,It="DropdownMenu",[Ol]=Tt(It,[Er]),be=Er(),[Ll,Zr]=Ol(It),Qr=t=>{const{__scopeDropdownMenu:r,children:s,dir:n,open:o,defaultOpen:l,onOpenChange:a,modal:i=!0}=t,h=be(r),m=u.useRef(null),[c,d]=is({prop:o,defaultProp:l??!1,onChange:a,caller:It});return e.jsx(Ll,{scope:r,triggerId:Jt(),triggerRef:m,contentId:Jt(),open:c,onOpenChange:d,onOpenToggle:u.useCallback(()=>d(x=>!x),[d]),modal:i,children:e.jsx(wl,{...h,open:c,onOpenChange:d,dir:n,modal:i,children:s})})};Qr.displayName=It;var Jr="DropdownMenuTrigger",en=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,disabled:n=!1,...o}=t,l=Zr(Jr,s),a=be(s);return e.jsx(Cl,{asChild:!0,...a,children:e.jsx(Ie.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...o,ref:ds(r,l.triggerRef),onPointerDown:X(t.onPointerDown,i=>{!n&&i.button===0&&i.ctrlKey===!1&&(l.onOpenToggle(),l.open||i.preventDefault())}),onKeyDown:X(t.onKeyDown,i=>{n||(["Enter"," "].includes(i.key)&&l.onOpenToggle(),i.key==="ArrowDown"&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});en.displayName=Jr;var Bl="DropdownMenuPortal",tn=t=>{const{__scopeDropdownMenu:r,...s}=t,n=be(r);return e.jsx(kl,{...n,...s})};tn.displayName=Bl;var sn="DropdownMenuContent",rn=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=Zr(sn,s),l=be(s),a=u.useRef(!1);return e.jsx(Nl,{id:o.contentId,"aria-labelledby":o.triggerId,...l,...n,ref:r,onCloseAutoFocus:X(t.onCloseAutoFocus,i=>{a.current||o.triggerRef.current?.focus(),a.current=!1,i.preventDefault()}),onInteractOutside:X(t.onInteractOutside,i=>{const h=i.detail.originalEvent,m=h.button===0&&h.ctrlKey===!0,c=h.button===2||m;(!o.modal||c)&&(a.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});rn.displayName=sn;var $l="DropdownMenuGroup",zl=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Ml,{...o,...n,ref:r})});zl.displayName=$l;var Gl="DropdownMenuLabel",Vl=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Sl,{...o,...n,ref:r})});Vl.displayName=Gl;var Wl="DropdownMenuItem",nn=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Tl,{...o,...n,ref:r})});nn.displayName=Wl;var Hl="DropdownMenuCheckboxItem",Kl=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(El,{...o,...n,ref:r})});Kl.displayName=Hl;var Xl="DropdownMenuRadioGroup",Ul=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Dl,{...o,...n,ref:r})});Ul.displayName=Xl;var ql="DropdownMenuRadioItem",Yl=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Pl,{...o,...n,ref:r})});Yl.displayName=ql;var Zl="DropdownMenuItemIndicator",Ql=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Al,{...o,...n,ref:r})});Ql.displayName=Zl;var Jl="DropdownMenuSeparator",ei=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Fl,{...o,...n,ref:r})});ei.displayName=Jl;var ti="DropdownMenuArrow",si=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Rl,{...o,...n,ref:r})});si.displayName=ti;var ri="DropdownMenuSubTrigger",ni=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(_l,{...o,...n,ref:r})});ni.displayName=ri;var oi="DropdownMenuSubContent",ai=u.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...n}=t,o=be(s);return e.jsx(Il,{...o,...n,ref:r,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});ai.displayName=oi;var li=Qr,ii=en,ci=tn,di=rn,ui=nn;function Nt({...t}){return e.jsx(li,{"data-slot":"dropdown-menu",...t})}function Mt({...t}){return e.jsx(ii,{"data-slot":"dropdown-menu-trigger",...t})}function St({className:t,sideOffset:r=4,...s}){return e.jsx(ci,{children:e.jsx(di,{"data-slot":"dropdown-menu-content",sideOffset:r,className:Le("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...s})})}function Zt({className:t,inset:r,variant:s="default",...n}){return e.jsx(ui,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":s,className:Le("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function hi({tempo:t,onTempoChange:r,keyShift:s,onKeyShiftChange:n,disabled:o,originalKey:l="C"}){const[a,i]=u.useState(0),h=s+a,m=ss(l,s),c=ss(l,h);return e.jsxs(Nt,{children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(Mt,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:d=>{d.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="var(--daw-control)"},disabled:o,children:e.jsx(Rs,{className:"w-5 h-5"})})})}),e.jsx(ue,{children:"Playback Settings"})]}),e.jsx(St,{className:"w-96 p-4",style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},align:"end",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(Rs,{className:"w-4 h-4"}),"Speed"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:[t,"%"]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:()=>r(100),className:"h-6 px-2 text-xs",style:{backgroundColor:t===100?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(Ye,{value:[t],onValueChange:([d])=>r(d),min:50,max:150,step:1,className:"w-full",onDoubleClick:()=>r(100)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"}),e.jsx("span",{children:"150%"})]})]}),e.jsx(ls,{style:{backgroundColor:"#3A3A3A"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm",style:{color:"#F1F1F1"},children:"Key Information"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center p-3 rounded-md",style:{backgroundColor:"#1E1E1E",border:"1px solid #3A3A3A"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Original"}),e.jsx("div",{className:"text-lg",style:{color:"#F1F1F1"},children:l})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Playing"}),e.jsx("div",{className:"text-lg",style:{color:"#3B82F6"},children:m})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Display"}),e.jsx("div",{className:"text-lg",style:{color:a>0?"#22c55e":"#F1F1F1"},children:c})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(Wn,{className:"w-4 h-4"}),"Transpose"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:[s>0?"+":"",s," ",Math.abs(s)===1?"semitone":"semitones"]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:()=>n(0),className:"h-6 px-2 text-xs",style:{backgroundColor:s===0?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(Ye,{value:[s],onValueChange:([d])=>n(d),min:-12,max:12,step:1,className:"w-full",onDoubleClick:()=>n(0)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"-12"}),e.jsx("span",{children:"0"}),e.jsx("span",{children:"+12"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(Hn,{className:"w-4 h-4"}),"Capo Position"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:["Fret ",a]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:()=>i(0),className:"h-6 px-2 text-xs",style:{backgroundColor:a===0?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(Ye,{value:[a],onValueChange:([d])=>i(d),min:0,max:12,step:1,className:"w-full",onDoubleClick:()=>i(0)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"6"}),e.jsx("span",{children:"12"})]}),e.jsx("div",{className:"text-xs",style:{color:"#9E9E9E"},children:a>0?`Chords shown are ${a} semitone${a>1?"s":""} higher (play as if no capo)`:"No capo - play chords as shown"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm",style:{color:"#F1F1F1"},children:"Quick Presets"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(A,{size:"sm",variant:"outline",onClick:()=>{r(75),n(0)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"Practice (75%)"}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>{r(100),n(0),i(0)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"Reset All"}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>{r(100),n(-2)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"-2 semitones"}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>{r(100),n(2)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"+2 semitones"})]})]})]})})]})}function mi({trackHeight:t,onTrackHeightChange:r,rulerVisibility:s,onRulerVisibilityChange:n,rulerOrder:o=["time","measures","sections","chords","tempo"],onRulerOrderChange:l}){const{t:a}=et(),[i,h]=u.useState(null),[m,c]=u.useState(null),d={time:{id:"time",label:a.time,visible:s.time},measures:{id:"measures",label:a.measures,visible:s.measures},sections:{id:"sections",label:a.sections,visible:s.sections},chords:{id:"chords",label:a.chords,visible:s.chords},tempo:{id:"tempo",label:a.tempo,visible:s.tempo}},x=o.map(j=>d[j]).filter(Boolean),p=(j,S)=>{const k={...s,[j]:S};n(k)},f=(j,S)=>{h(S),j.dataTransfer.setData("text/plain",S),j.dataTransfer.effectAllowed="move"},g=(j,S)=>{j.preventDefault(),j.dataTransfer.dropEffect="move",S!==m&&c(S)},b=(j,S)=>{j.preventDefault();const k=j.dataTransfer.getData("text/plain");if(!k||k===S)return;const w=[...o],v=w.indexOf(k),N=w.indexOf(S);if(v===-1||N===-1)return;const[M]=w.splice(v,1);w.splice(N,0,M),l&&l(w)},C=()=>{h(null),c(null)};return e.jsxs(Nt,{children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(Mt,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:j=>{j.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:j=>{j.currentTarget.style.backgroundColor="var(--daw-control)"},children:e.jsx(va,{className:"w-5 h-5"})})})}),e.jsx(ue,{children:"View Settings"})]}),e.jsx(St,{className:"w-72 p-4",style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"text-sm",style:{color:"#F1F1F1"},children:"Track Height"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{size:"sm",variant:t==="small"?"default":"outline",onClick:()=>r("small"),className:"flex-1",style:t==="small"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Small"}),e.jsx(A,{size:"sm",variant:t==="medium"?"default":"outline",onClick:()=>r("medium"),className:"flex-1",style:t==="medium"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Medium"}),e.jsx(A,{size:"sm",variant:t==="large"?"default":"outline",onClick:()=>r("large"),className:"flex-1",style:t==="large"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Large"})]})]}),e.jsx(ls,{style:{backgroundColor:"#3A3A3A"}}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{className:"text-sm",style:{color:"#F1F1F1"},children:"Rulers"}),e.jsx("span",{className:"text-xs",style:{color:"#9E9E9E"},children:"Drag to reorder"})]}),e.jsx("div",{className:"space-y-1",children:x.map((j,S)=>e.jsxs("div",{draggable:!!l,onDragStart:k=>l&&f(k,j.id),onDragOver:k=>l&&g(k,j.id),onDrop:k=>l&&b(k,j.id),onDragEnd:C,onDragLeave:()=>c(null),className:Le("flex items-center justify-between p-2 rounded transition-all",l&&"cursor-move",i===j.id?"opacity-50 scale-95":"opacity-100",m===j.id&&i!==j.id&&"bg-blue-500/30"),style:{backgroundColor:"var(--daw-control)"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(sr,{className:"w-4 h-4 cursor-grab active:cursor-grabbing",style:{color:"#6B6B6B"}}),j.visible?e.jsx(uo,{className:"w-4 h-4",style:{color:"#9E9E9E"}}):e.jsx(io,{className:"w-4 h-4",style:{color:"#9E9E9E"}}),e.jsx("span",{className:"text-sm",style:{color:"#F1F1F1"},children:j.label})]}),e.jsx(lt,{checked:j.visible,onCheckedChange:k=>p(j.id,k),onClick:k=>k.stopPropagation()})]},j.id))})]})]})})]})}const xi=({songTitle:t,songKey:r,isPlaying:s,currentTime:n,tempo:o,loopEnabled:l,metronomeEnabled:a,metronomeVolume:i,keyShift:h,trackHeight:m,rulerVisibility:c,rulerOrder:d,currentMeasure:x,currentTimeSignature:p,displayTempo:f,snapEnabled:g=!1,snapMode:b="measures",onBack:C,onPlayPause:j,onStop:S,onLoopToggle:k,onMetronomeToggle:w,onMetronomeVolumeChange:v,onTempoChange:N,onKeyShiftChange:M,onTrackHeightChange:E,onRulerVisibilityChange:L,onRulerOrderChange:G,onSnapToggle:_,onSnapModeChange:ie,onExportProject:Z,activeTool:q=null,onToolChange:Q})=>e.jsxs("div",{className:"border-b p-3 flex items-center justify-between gap-4",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:F=>{F.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:C,children:e.jsx(ms,{className:"w-4 h-4"})})}),e.jsx(ue,{children:"Back to Library"})]}),e.jsx("span",{className:"text-lg font-medium",style:{color:"var(--daw-text-primary)"},children:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:F=>{F.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:S,children:e.jsx(wo,{className:"w-5 h-5"})})}),e.jsx(ue,{children:"Stop"})]}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-12 w-12",style:{backgroundColor:s?"#10B981":"#065F46",color:"#FFFFFF",borderRadius:"8px"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor=s?"#059669":"#047857"},onMouseLeave:F=>{F.currentTarget.style.backgroundColor=s?"#10B981":"#065F46"},onClick:j,children:s?e.jsx(Kn,{className:"w-6 h-6"}):e.jsx(Ve,{className:"w-6 h-6"})})}),e.jsx(ue,{children:s?"Pause":"Play"})]}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:l?"#1E3A8A":"var(--daw-control)",color:l?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor=l?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:F=>{F.currentTarget.style.backgroundColor=l?"#1E3A8A":"var(--daw-control)"},onClick:k,children:e.jsx(ga,{className:"w-5 h-5"})})}),e.jsx(ue,{children:"Loop"})]})]}),e.jsxs("div",{className:"rounded-lg px-4 py-2 flex items-center gap-4",style:{backgroundColor:"var(--daw-bg-main)",border:"1px solid var(--daw-border)",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{className:"flex flex-col items-center",style:{minWidth:"80px"},children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Time"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:es(n)})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Measure"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:x})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Tempo"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:rr(f)})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Time Sig"}),e.jsx("span",{className:"text-lg font-mono font-bold",style:{color:"#10B981"},children:p})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Key"}),e.jsx("span",{className:"text-lg font-mono font-bold",style:{color:"#10B981"},children:r})]})]}),e.jsxs(Nt,{children:[e.jsxs("div",{className:"flex items-center gap-0",children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-r-none",style:{backgroundColor:a?"#1E3A8A":"var(--daw-control)",color:a?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px 0 0 8px"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor=a?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:F=>{F.currentTarget.style.backgroundColor=a?"#1E3A8A":"var(--daw-control)"},onClick:w,children:e.jsx(fa,{className:"w-5 h-5"})})}),e.jsx(ue,{children:"Metronome"})]}),e.jsx(Mt,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-6 rounded-l-none px-1",style:{backgroundColor:a?"#1E3A8A":"var(--daw-control)",color:a?"#60A5FA":"var(--daw-text-primary)",borderRadius:"0 8px 8px 0",borderLeft:"1px solid rgba(0,0,0,0.2)"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor=a?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:F=>{F.currentTarget.style.backgroundColor=a?"#1E3A8A":"var(--daw-control)"},children:e.jsx(Ms,{className:"w-3 h-3"})})})]}),e.jsx(St,{className:"w-64 p-4",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{className:"text-sm",style:{color:"var(--daw-text-primary)"},children:"Metronome Volume"}),e.jsxs("span",{className:"text-sm",style:{color:"var(--daw-text-secondary)"},children:[it(no(i))," dB"]})]}),e.jsx(Ye,{value:[Ze(i)],onValueChange:F=>v(hs(F[0])),max:100,step:.1,className:"w-full",onDoubleClick:()=>{v(.5)}})]})})]}),e.jsxs(Nt,{children:[e.jsx(Mt,{asChild:!0,children:e.jsxs(A,{variant:"ghost",className:"h-10 px-3 gap-2",style:{backgroundColor:q?"#1E3A8A":"var(--daw-control)",color:q?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px"},children:[q==="marker"?e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Marker Editor"})]}):q==="warp"?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Warp Grid"})]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Player Mode"})]}),e.jsx(Ms,{className:"w-3 h-3 opacity-50"})]})}),e.jsxs(St,{align:"end",className:"w-48",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs(Zt,{onClick:()=>Q&&Q(null),className:"gap-2 cursor-pointer",children:[e.jsx(_s,{className:"w-4 h-4"}),e.jsx("span",{children:"Player Mode"})]}),e.jsxs(Zt,{onClick:()=>Q&&Q("marker"),className:"gap-2 cursor-pointer",children:[e.jsx(Is,{className:"w-4 h-4"}),e.jsx("span",{children:"Marker Editor"})]}),e.jsxs(Zt,{onClick:()=>Q&&Q("warp"),className:"gap-2 cursor-pointer",children:[e.jsx(Os,{className:"w-4 h-4"}),e.jsx("span",{children:"Warp Grid Editor"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"sm",className:"h-10 px-3",style:{backgroundColor:g?"#2563EB":"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor=g?"#1D4ED8":"var(--daw-control-hover)"},onMouseLeave:F=>{F.currentTarget.style.backgroundColor=g?"#2563EB":"var(--daw-control)"},onClick:_,children:e.jsx(pa,{className:"w-4 h-4"})})}),e.jsx(ue,{children:g?"Snap enabled (measures)":"Snap disabled"})]}),e.jsx(hi,{tempo:o,onTempoChange:N,keyShift:h,onKeyShiftChange:M,originalKey:r}),e.jsx(mi,{trackHeight:m,onTrackHeightChange:E,rulerVisibility:c,onRulerVisibilityChange:L,rulerOrder:d,onRulerOrderChange:G}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:F=>{F.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:Z,children:e.jsx(Xn,{className:"w-4 h-4"})})}),e.jsx(ue,{children:"Export Project"})]})]})]});function Xe(t,r,s){let n=s.initialDeps??[],o,l=!0;function a(){var i,h,m;let c;s.key&&((i=s.debug)!=null&&i.call(s))&&(c=Date.now());const d=t();if(!(d.length!==n.length||d.some((f,g)=>n[g]!==f)))return o;n=d;let p;if(s.key&&((h=s.debug)!=null&&h.call(s))&&(p=Date.now()),o=r(...d),s.key&&((m=s.debug)!=null&&m.call(s))){const f=Math.round((Date.now()-c)*100)/100,g=Math.round((Date.now()-p)*100)/100,b=g/16,C=(j,S)=>{for(j=String(j);j.length<S;)j=" "+j;return j};console.info(`%câ± ${C(g,5)} /${C(f,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*b,120))}deg 100% 31%);`,s?.key)}return s?.onChange&&!(l&&s.skipInitialOnChange)&&s.onChange(o),l=!1,o}return a.updateDeps=i=>{n=i},a}function Bs(t,r){if(t===void 0)throw new Error("Unexpected undefined");return t}const fi=(t,r)=>Math.abs(t-r)<1.01,pi=(t,r,s)=>{let n;return function(...o){t.clearTimeout(n),n=t.setTimeout(()=>r.apply(this,o),s)}},$s=t=>{const{offsetWidth:r,offsetHeight:s}=t;return{width:r,height:s}},gi=t=>t,vi=t=>{const r=Math.max(t.startIndex-t.overscan,0),s=Math.min(t.endIndex+t.overscan,t.count-1),n=[];for(let o=r;o<=s;o++)n.push(o);return n},bi=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;const o=a=>{const{width:i,height:h}=a;r({width:Math.round(i),height:Math.round(h)})};if(o($s(s)),!n.ResizeObserver)return()=>{};const l=new n.ResizeObserver(a=>{const i=()=>{const h=a[0];if(h?.borderBoxSize){const m=h.borderBoxSize[0];if(m){o({width:m.inlineSize,height:m.blockSize});return}}o($s(s))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return l.observe(s,{box:"border-box"}),()=>{l.unobserve(s)}},zs={passive:!0},Gs=typeof window>"u"?!0:"onscrollend"in window,yi=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;let o=0;const l=t.options.useScrollendEvent&&Gs?()=>{}:pi(n,()=>{r(o,!1)},t.options.isScrollingResetDelay),a=c=>()=>{const{horizontal:d,isRtl:x}=t.options;o=d?s.scrollLeft*(x&&-1||1):s.scrollTop,l(),r(o,c)},i=a(!0),h=a(!1);h(),s.addEventListener("scroll",i,zs);const m=t.options.useScrollendEvent&&Gs;return m&&s.addEventListener("scrollend",h,zs),()=>{s.removeEventListener("scroll",i),m&&s.removeEventListener("scrollend",h)}},ji=(t,r,s)=>{if(r?.borderBoxSize){const n=r.borderBoxSize[0];if(n)return Math.round(n[s.options.horizontal?"inlineSize":"blockSize"])}return t[s.options.horizontal?"offsetWidth":"offsetHeight"]},wi=(t,{adjustments:r=0,behavior:s},n)=>{var o,l;const a=t+r;(l=(o=n.scrollElement)==null?void 0:o.scrollTo)==null||l.call(o,{[n.options.horizontal?"left":"top"]:a,behavior:s})};class Ci{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const n=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(o=>{o.forEach(l=>{const a=()=>{this._measureElement(l.target,l)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()})}));return{disconnect:()=>{var o;(o=n())==null||o.disconnect(),s=null},observe:o=>{var l;return(l=n())==null?void 0:l.observe(o,{box:"border-box"})},unobserve:o=>{var l;return(l=n())==null?void 0:l.unobserve(o)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([n,o])=>{typeof o>"u"&&delete s[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:gi,rangeExtractor:vi,onChange:()=>{},measureElement:ji,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var n,o;(o=(n=this.options).onChange)==null||o.call(n,this,s)},this.maybeNotify=Xe(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(o=>{this.observer.observe(o)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,o=>{this.scrollRect=o,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(o,l)=>{this.scrollAdjustments=0,this.scrollDirection=l?this.getScrollOffset()<o?"forward":"backward":null,this.scrollOffset=o,this.isScrolling=l,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,n)=>{const o=new Map,l=new Map;for(let a=n-1;a>=0;a--){const i=s[a];if(o.has(i.lane))continue;const h=l.get(i.lane);if(h==null||i.end>h.end?l.set(i.lane,i):i.end<h.end&&o.set(i.lane,!0),o.size===this.options.lanes)break}return l.size===this.options.lanes?Array.from(l.values()).sort((a,i)=>a.end===i.end?a.index-i.index:a.end-i.end)[0]:void 0},this.getMeasurementOptions=Xe(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(s,n,o,l,a,i)=>(this.prevLanes!==void 0&&this.prevLanes!==i&&(this.lanesChangedFlag=!0),this.prevLanes=i,this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:n,scrollMargin:o,getItemKey:l,enabled:a,lanes:i}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=Xe(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:n,scrollMargin:o,getItemKey:l,enabled:a,lanes:i},h)=>{if(!a)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>s)for(const x of this.laneAssignments.keys())x>=s&&this.laneAssignments.delete(x);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(x=>{this.itemSizeCache.set(x.key,x.size)}));const m=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===s&&(this.lanesSettling=!1);const c=this.measurementsCache.slice(0,m),d=new Array(i).fill(void 0);for(let x=0;x<m;x++){const p=c[x];p&&(d[p.lane]=x)}for(let x=m;x<s;x++){const p=l(x),f=this.laneAssignments.get(x);let g,b;if(f!==void 0&&this.options.lanes>1){g=f;const k=d[g],w=k!==void 0?c[k]:void 0;b=w?w.end+this.options.gap:n+o}else{const k=this.options.lanes===1?c[x-1]:this.getFurthestMeasurement(c,x);b=k?k.end+this.options.gap:n+o,g=k?k.lane:x%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(x,g)}const C=h.get(p),j=typeof C=="number"?C:this.options.estimateSize(x),S=b+j;c[x]={index:x,start:b,size:j,end:S,key:p,lane:g},d[g]=x}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Xe(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,n,o,l)=>this.range=s.length>0&&n>0?ki({measurements:s,outerSize:n,scrollOffset:o,lanes:l}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Xe(()=>{let s=null,n=null;const o=this.calculateRange();return o&&(s=o.startIndex,n=o.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,n]},(s,n,o,l,a)=>l===null||a===null?[]:s({startIndex:l,endIndex:a,overscan:n,count:o}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const n=this.options.indexAttribute,o=s.getAttribute(n);return o?parseInt(o,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(s,n)=>{const o=this.indexFromElement(s),l=this.measurementsCache[o];if(!l)return;const a=l.key,i=this.elementsCache.get(a);i!==s&&(i&&this.observer.unobserve(i),this.observer.observe(s),this.elementsCache.set(a,s)),s.isConnected&&this.resizeItem(o,this.options.measureElement(s,n,this))},this.resizeItem=(s,n)=>{const o=this.measurementsCache[s];if(!o)return;const l=this.itemSizeCache.get(o.key)??o.size,a=n-l;a!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(o,a,this):o.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=a,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(o.index),this.itemSizeCache=new Map(this.itemSizeCache.set(o.key,n)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((n,o)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(o))});return}this._measureElement(s,void 0)},this.getVirtualItems=Xe(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,n)=>{const o=[];for(let l=0,a=s.length;l<a;l++){const i=s[l],h=n[i];o.push(h)}return o},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const n=this.getMeasurements();if(n.length!==0)return Bs(n[on(0,n.length-1,o=>Bs(n[o]).start,s)])},this.getOffsetForAlignment=(s,n,o=0)=>{const l=this.getSize(),a=this.getScrollOffset();n==="auto"&&(n=s>=a+l?"end":"start"),n==="center"?s+=(o-l)/2:n==="end"&&(s-=l);const i=this.getTotalSize()+this.options.scrollMargin-l;return Math.max(Math.min(i,s),0)},this.getOffsetForIndex=(s,n="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const o=this.measurementsCache[s];if(!o)return;const l=this.getSize(),a=this.getScrollOffset();if(n==="auto")if(o.end>=a+l-this.options.scrollPaddingEnd)n="end";else if(o.start<=a+this.options.scrollPaddingStart)n="start";else return[a,n];const i=n==="end"?o.end+this.options.scrollPaddingEnd:o.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,n,o.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:n="start",behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,n),{adjustments:void 0,behavior:o})},this.scrollToIndex=(s,{align:n="auto",behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1));let l=0;const a=10,i=m=>{if(!this.targetWindow)return;const c=this.getOffsetForIndex(s,m);if(!c){console.warn("Failed to get offset for index:",s);return}const[d,x]=c;this._scrollToOffset(d,{adjustments:void 0,behavior:o}),this.targetWindow.requestAnimationFrame(()=>{const p=this.getScrollOffset(),f=this.getOffsetForIndex(s,x);if(!f){console.warn("Failed to get offset for index:",s);return}fi(f[0],p)||h(x)})},h=m=>{this.targetWindow&&(l++,l<a?this.targetWindow.requestAnimationFrame(()=>i(m)):console.warn(`Failed to scroll to index ${s} after ${a} attempts.`))};i(n)},this.scrollBy=(s,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var s;const n=this.getMeasurements();let o;if(n.length===0)o=this.options.paddingStart;else if(this.options.lanes===1)o=((s=n[n.length-1])==null?void 0:s.end)??0;else{const l=Array(this.options.lanes).fill(null);let a=n.length-1;for(;a>=0&&l.some(i=>i===null);){const i=n[a];l[i.lane]===null&&(l[i.lane]=i.end),a--}o=Math.max(...l.filter(i=>i!==null))}return Math.max(o-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:n,behavior:o})=>{this.options.scrollToFn(s,{behavior:o,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(r)}}const on=(t,r,s,n)=>{for(;t<=r;){const o=(t+r)/2|0,l=s(o);if(l<n)t=o+1;else if(l>n)r=o-1;else return o}return t>0?t-1:0};function ki({measurements:t,outerSize:r,scrollOffset:s,lanes:n}){const o=t.length-1,l=h=>t[h].start;if(t.length<=n)return{startIndex:0,endIndex:o};let a=on(0,o,l,s),i=a;if(n===1)for(;i<o&&t[i].end<s+r;)i++;else if(n>1){const h=Array(n).fill(0);for(;i<o&&h.some(c=>c<s+r);){const c=t[i];h[c.lane]=c.end,i++}const m=Array(n).fill(s+r);for(;a>=0&&m.some(c=>c>=s);){const c=t[a];m[c.lane]=c.start,a--}a=Math.max(0,a-a%n),i=Math.min(o,i+(n-1-i%n))}return{startIndex:a,endIndex:i}}const Vs=typeof document<"u"?u.useLayoutEffect:u.useEffect;function Ni(t){const r=u.useReducer(()=>({}),{})[1],s={...t,onChange:(o,l)=>{var a;l?Un.flushSync(r):r(),(a=t.onChange)==null||a.call(t,o,l)}},[n]=u.useState(()=>new Ci(s));return n.setOptions(s),Vs(()=>n._didMount(),[]),Vs(()=>n._willUpdate()),n}function Mi(t){return Ni({observeElementRect:bi,observeElementOffset:yi,scrollToFn:wi,...t})}const ee={BASE_PPS:50,MIN:.001,MAX:20,FACTOR:1.2},ze={RULER_HEIGHT:32},Qt={SIDEBAR_WIDTH:280},an=z.memo(({trackId:t,trackName:r,trackColor:s,trackVolume:n,trackMuted:o,trackSolo:l,trackHeightPx:a,isAnySolo:i,onVolumeChange:h,onMuteToggle:m,onSoloToggle:c})=>{const[d,x]=z.useState(Ze(n)),[p,f]=z.useState(!1);z.useEffect(()=>{p||x(Ze(n))},[n,p]);const g=j=>{x(j[0])},b=()=>{f(!0)},C=()=>{f(!1),h(t,hs(d))};return e.jsxs("div",{className:"border-b relative group box-border",style:{height:`${a}px`,minHeight:`${a}px`,maxHeight:`${a}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",borderBottomWidth:"1px"},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1",style:{backgroundColor:s||"#3b82f6"}}),e.jsxs("div",{className:"p-2 pl-6 h-full flex flex-col justify-center gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:e.jsx("span",{className:"font-semibold text-sm truncate text-gray-200",title:r,children:r})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{variant:"ghost",size:"icon",className:`h-6 w-8 rounded-sm border-2 focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${o?"bg-red-600 text-white border-red-500 focus:ring-red-500":"bg-gray-800 text-gray-400 border-gray-600 hover:border-gray-500 focus:ring-gray-500"}`,onClick:()=>m(t),"aria-label":o?`Unmute ${r}`:`Mute ${r}`,"aria-pressed":o,title:o?"Unmute track":"Mute track",children:e.jsx("span",{className:"text-[10px] font-bold",children:"M"})}),e.jsx(A,{variant:"ghost",size:"icon",className:`h-6 w-8 rounded-sm border-2 focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${l?"bg-yellow-500 text-black border-yellow-400 focus:ring-yellow-500":"bg-gray-800 text-gray-400 border-gray-600 hover:border-gray-500 focus:ring-gray-500"}`,onClick:()=>c(t),"aria-label":l?`Unsolo ${r}`:`Solo ${r}`,"aria-pressed":l,title:l?"Unsolo track":"Solo track",children:e.jsx("span",{className:"text-[10px] font-bold",children:"S"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{value:[d],min:0,max:100,step:1,onValueChange:g,onPointerDown:b,onPointerUp:C,className:"flex-1","aria-label":`Volume for ${r}`,"aria-valuenow":d,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":`${it(wt(d))} decibels`}),e.jsx("span",{className:"text-[10px] tabular-nums text-gray-400 w-8 text-right font-mono","aria-hidden":"true",children:it(wt(d))})]})]})]})},(t,r)=>t.trackId===r.trackId&&t.trackName===r.trackName&&t.trackColor===r.trackColor&&t.trackVolume===r.trackVolume&&t.trackMuted===r.trackMuted&&t.trackSolo===r.trackSolo&&t.trackHeightPx===r.trackHeightPx&&t.isAnySolo===r.isAnySolo);an.displayName="TrackListItem";const ln=z.memo(z.forwardRef(({tracks:t,trackHeight:r,editingTrackId:s,trackNameInput:n,pinnedTracks:o,onTrackNameChange:l,onTrackColorChange:a,onTrackVolumeChange:i,onTrackMuteToggle:h,onTrackSoloToggle:m,onTrackTagsChange:c,onTrackNotesOpen:d,onEditingTrackIdChange:x,onTrackNameInputChange:p,onPinnedTracksChange:f,onScroll:g},b)=>{const C=()=>{switch(r){case"small":return 64;case"large":return 128;default:return 96}},j=u.useCallback((M,E)=>{i(M,E)},[i]),S=t.some(M=>M.solo),k=C(),w=u.useRef(null),v=Mi({count:t.length,getScrollElement:()=>w.current,estimateSize:()=>k,overscan:3}),N=M=>{g(M.currentTarget.scrollTop)};return e.jsxs("div",{ref:M=>{w.current=M,typeof b=="function"?b(M):b&&(b.current=M)},className:"track-list-sidebar-container flex-shrink-0 border-r flex flex-col overflow-y-auto",style:{width:`${Qt.SIDEBAR_WIDTH}px`,minWidth:`${Qt.SIDEBAR_WIDTH}px`,maxWidth:`${Qt.SIDEBAR_WIDTH}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",scrollbarWidth:"none",msOverflowStyle:"none",paddingTop:0,paddingBottom:0},onScroll:N,children:[e.jsx("div",{className:"flex-1 relative",style:{height:`${v.getTotalSize()}px`,margin:0,padding:0},children:v.getVirtualItems().map(M=>{const E=t[M.index];return e.jsx("div",{"data-index":M.index,ref:v.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${M.start}px)`},children:e.jsx(an,{trackId:E.id,trackName:E.name,trackColor:E.color||"#3b82f6",trackVolume:E.volume,trackMuted:E.muted,trackSolo:E.solo,trackHeightPx:k,isAnySolo:S,onVolumeChange:j,onMuteToggle:h,onSoloToggle:m})},E.id)})}),e.jsx("style",{children:`
        .track-list-sidebar-container::-webkit-scrollbar {
          display: none;
        }
      `})]})}));ln.displayName="TrackListSidebar";const Si=()=>{const[t,r]=u.useState(()=>localStorage.getItem("beta-warning-dismissed")==="true"),s=()=>{localStorage.setItem("beta-warning-dismissed","true"),r(!0)};return t?null:e.jsxs("div",{className:"flex items-start gap-3 px-4 py-2 border-b text-sm",style:{backgroundColor:"rgba(251, 191, 36, 0.1)",borderColor:"rgba(251, 191, 36, 0.3)"},children:[e.jsx(Mo,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-yellow-500"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"text-yellow-200",children:[e.jsx("strong",{className:"font-semibold",children:"Beta Notice:"})," ","Multi-track sync is not sample-accurate due to HTML5 Audio limitations. Minor timing drift may occur on slower devices or with 10+ tracks. Professional Web Audio API implementation coming soon."]})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0 hover:bg-yellow-900/30 text-yellow-400",onClick:s,title:"Dismiss warning",children:e.jsx(us,{className:"w-3 h-3"})})]})},Ti={time:"Time",measures:"Measures",sections:"Sections",chords:"Chords",tempo:"Tempo"},Ei=({visibleRulers:t,rulerOrder:r,onRulerOrderChange:s})=>{const[n,o]=u.useState(null),l=r.filter(c=>t.includes(c)),a=(c,d)=>{o(d),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("text/plain",d)},i=c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},h=(c,d)=>{if(c.preventDefault(),!n||n===d){o(null);return}const x=[...r],p=x.indexOf(n),f=x.indexOf(d);x.splice(p,1),x.splice(f,0,n),s(x),o(null)},m=()=>{o(null)};return e.jsx("div",{className:"flex flex-col",children:l.map(c=>e.jsxs("div",{draggable:!0,onDragStart:d=>a(d,c),onDragOver:i,onDrop:d=>h(d,c),onDragEnd:m,className:`flex items-center justify-start px-3 border-b text-xs font-medium uppercase tracking-wider cursor-grab active:cursor-grabbing transition-opacity ${n===c?"opacity-50":"opacity-100"}`,style:{height:`${ze.RULER_HEIGHT}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",color:"var(--daw-text-secondary)"},children:[e.jsx(sr,{className:"w-3 h-3 mr-2 text-gray-500"}),Ti[c]||c]},c))})},Di=({zoom:t,onZoomIn:r,onZoomOut:s,onFitToView:n})=>e.jsxs("div",{className:"flex items-center justify-center gap-2 px-2",children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",opacity:t<=1?.5:1},onClick:s,disabled:t<=1,children:e.jsx(Ao,{className:"w-4 h-4"})})}),e.jsx(ue,{children:"Zoom Out"})]}),e.jsxs("span",{className:"text-xs tabular-nums w-14 text-center",style:{color:"#9E9E9E"},children:[Math.round(t*100),"%"]}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",opacity:t>=8?.5:1},onClick:r,disabled:t>=8,children:e.jsx(Do,{className:"w-4 h-4"})})}),e.jsx(ue,{children:"Zoom In"})]}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:n,children:e.jsx(nr,{className:"w-4 h-4"})})}),e.jsx(ue,{children:"Fit to View"})]})]});function Pi({tracks:t,presets:r,onSavePreset:s,onLoadPreset:n,onDeletePreset:o}){const[l,a]=u.useState(!1),[i,h]=u.useState(""),[m,c]=u.useState(""),d=()=>{if(!i.trim()){Ne.error("Please enter a preset name");return}s(i),h(""),a(!1),Ne.success(`Mix preset "${i}" saved successfully`)},x=()=>{if(!m){Ne.error("Please select a preset to load");return}n(m);const f=r.find(g=>g.id===m);Ne.success(`Mix preset "${f?.name}" loaded successfully`)},p=f=>{const g=r.find(b=>b.id===f);window.confirm(`Are you sure you want to delete preset "${g?.name}"?`)&&(o(f),m===f&&c(""),Ne.success("Mix preset deleted"))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ht,{open:l,onOpenChange:a,children:[e.jsx(qn,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"sm",className:"w-full",title:"Save current mix as preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(yo,{className:"w-4 h-4 mr-2"}),"Save Current Mix"]})}),e.jsxs(mt,{children:[e.jsxs(xt,{children:[e.jsx(ft,{children:"Save Mix Preset"}),e.jsx(pt,{children:"Save the current volume and mute settings as a mix preset."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"preset-name",children:"Preset Name"}),e.jsx(Ee,{id:"preset-name",placeholder:"e.g., Rehearsal Mix, Live Mix, etc.",value:i,onChange:f=>h(f.target.value),onKeyDown:f=>{f.key==="Enter"&&d()}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Current Settings:"}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded p-2 space-y-1",children:t.map(f=>e.jsxs("div",{className:"text-sm flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:f.name}),e.jsx("span",{className:"text-gray-500",children:f.muted?"Muted":`${Math.round(f.volume*100)}%`})]},f.id))})]})]}),e.jsxs(Yn,{children:[e.jsx(Zn,{asChild:!0,children:e.jsx(A,{variant:"outline",children:"Cancel"})}),e.jsx(A,{onClick:d,children:"Save Preset"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(De,{value:m,onValueChange:c,children:[e.jsx(Pe,{className:"w-full",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:e.jsx(Ae,{placeholder:"Select preset..."})}),e.jsx(Fe,{children:r.length===0?e.jsx("div",{className:"px-2 py-1.5 text-sm text-gray-500",children:"No presets saved"}):r.map(f=>e.jsx(ve,{value:f.id,children:f.name},f.id))})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(A,{variant:"outline",size:"sm",className:"flex-1",onClick:x,disabled:!m,title:"Load selected preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(Qn,{className:"w-4 h-4 mr-1"}),"Load"]}),e.jsxs(A,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>m&&p(m),disabled:!m,title:"Delete selected preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(cs,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]})}const Ai=({sidebarVisible:t,mixerDockVisible:r,notesPanelVisible:s,mixPresetsPopoverOpen:n,tracks:o,mixPresets:l,onToggleSidebar:a,onToggleMixer:i,onToggleNotes:h,onPerformanceMode:m,onMixPresetsOpenChange:c,onSaveMixPreset:d,onLoadMixPreset:x,onDeleteMixPreset:p})=>e.jsxs("div",{className:"border-t flex items-center justify-between h-10 px-3",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:a,children:t?e.jsx(xo,{className:"w-4 h-4"}):e.jsx(po,{className:"w-4 h-4"})})}),e.jsx(ue,{children:t?"Hide Sidebar":"Show Sidebar"})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Jn,{open:n,onOpenChange:c,children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(eo,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"6",y1:"4",x2:"6",y2:"20"}),e.jsx("rect",{x:"4",y:"7",width:"4",height:"3",rx:"1",fill:"currentColor"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20"}),e.jsx("rect",{x:"10",y:"11",width:"4",height:"3",rx:"1",fill:"currentColor"}),e.jsx("line",{x1:"18",y1:"4",x2:"18",y2:"20"}),e.jsx("rect",{x:"16",y:"9",width:"4",height:"3",rx:"1",fill:"currentColor"})]})})})}),e.jsx(ue,{children:"Mix Presets"})]}),e.jsx(to,{align:"center",className:"w-72",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:e.jsx(Pi,{tracks:o,presets:l,onSavePreset:d,onLoadPreset:x,onDeletePreset:p})})]}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:r?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},onClick:i,children:e.jsx(oo,{className:"w-4 h-4"})})}),e.jsx(ue,{children:r?"Hide Mixer":"Show Mixer"})]}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:s?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},onClick:h,children:e.jsx(ko,{className:"w-4 h-4"})})}),e.jsx(ue,{children:s?"Hide Notes":"Show Notes"})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:m,children:e.jsx(nr,{className:"w-4 h-4"})})}),e.jsx(ue,{children:"Performance Mode"})]})})]}),Fi=({zoom:t,setZoom:r,timelineRef:s,rulerRef:n,currentTime:o})=>{const l=u.useRef(0),a=u.useRef(null),i=u.useCallback(c=>{n.current&&(n.current.scrollLeft=c)},[n]),h=u.useCallback(c=>{l.current=c,i(c)},[i]),m=u.useCallback((c,d)=>{r(c),s.current&&(s.current.scrollLeft=d),n.current&&(n.current.scrollLeft=d),l.current=d},[r,s,n]);return u.useEffect(()=>{const c=s.current,d=n.current,x=p=>{if(!p.ctrlKey&&!p.metaKey)return;p.preventDefault(),p.stopPropagation();const f=p.deltaY>0?1/ee.FACTOR:ee.FACTOR,g=Math.max(ee.MIN,Math.min(ee.MAX,t*f));if(g===t)return;const b=s.current?.getBoundingClientRect(),C=b?p.clientX-b.left:0,S=(s.current?.scrollLeft||0)+C,k=ee.BASE_PPS*t,w=S/k;r(g);const v=ee.BASE_PPS*g,N=w*v,M=Math.max(0,N-C);a.current=M};return c&&c.addEventListener("wheel",x,{passive:!1}),d&&d.addEventListener("wheel",x,{passive:!1}),()=>{c&&c.removeEventListener("wheel",x),d&&d.removeEventListener("wheel",x)}},[t,r,s,n]),u.useEffect(()=>{if(a.current!==null){const c=a.current;s.current&&(s.current.scrollLeft=c),n.current&&(n.current.scrollLeft=c),l.current=c,a.current=null}},[t,s,n]),{scrollLeftRef:l,handleTimelineScroll:h,handleNavigatorChange:m}},Ri=({song:t,onSongUpdate:r})=>{const[s,n]=u.useState([]),o=u.useCallback(i=>{const h={id:`preset-${Date.now()}`,name:i,trackSettings:t.tracks.map(m=>({trackId:m.id,volume:m.volume??1,pan:m.pan??0,solo:m.solo??!1,mute:m.mute??!1}))};n(m=>[...m,h])},[t.tracks]),l=u.useCallback(i=>{if(!r)return;const h=t.tracks.map(m=>{const c=i.trackSettings.find(d=>d.trackId===m.id);return c?{...m,volume:c.volume,pan:c.pan,solo:c.solo,mute:c.mute}:m});r({...t,tracks:h})},[t,r]),a=u.useCallback(i=>{n(h=>h.filter(m=>m.id!==i))},[]);return{mixPresets:s,handleSaveMixPreset:o,handleLoadMixPreset:l,handleDeleteMixPreset:a}},_i=({song:t,onSongUpdate:r,editMode:s})=>{const[n,o]=u.useState(!1),[l,a]=u.useState("section"),[i,h]=u.useState(null),[m,c]=u.useState(0),d=u.useCallback(f=>{if(!s)return;const g=f.currentTarget.getBoundingClientRect(),C=(f.clientX-g.left)/50;c(C)},[s]),x=u.useCallback((f,g)=>{if(!r)return;let b={...t};switch(f){case"section":i&&"name"in i?b.sections=t.sections?.map(C=>C.time===i.time?{...C,...g}:C)||[]:b.sections=[...t.sections||[],g];break;case"chord":i&&"chord"in i?b.chords=t.chords?.map(C=>C.time===i.time?{...C,...g}:C)||[]:b.chords=[...t.chords||[],g];break;case"tempo":i&&"tempo"in i?b.tempoChanges=t.tempoChanges?.map(C=>C.time===i.time?{...C,...g}:C)||[]:b.tempoChanges=[...t.tempoChanges||[],g];break}r(b),o(!1),h(null)},[t,r,i]),p=u.useCallback((f,g,b)=>{a(f),h(g||null),b!==void 0&&c(b),o(!0)},[]);return{editorOpen:n,setEditorOpen:o,editorType:l,editingMarker:i,clickedTime:m,handleTimelineClick:d,handleTimelineItemSubmit:x,openEditor:p}},Ii=({zoom:t,setZoom:r,song:s,containerWidth:n})=>{const o=u.useCallback(()=>!s||n===0?1:n/(s.duration*ee.BASE_PPS),[s,n]),l=u.useCallback(()=>{r(h=>Math.max(ee.MIN,h-.25))},[r]),a=u.useCallback(()=>{r(h=>Math.min(ee.MAX,h+.25))},[r]),i=u.useCallback(()=>{const h=o(),m=Math.max(ee.MIN,Math.min(ee.MAX,h));r(m)},[o,r]);return{handleZoomOutOnPlayhead:l,handleZoomInOnPlayhead:a,handleFitToView:i}},Oi=({song:t})=>{const[r,s]=u.useState(0),[n,o]=u.useState(t?.source==="project"),[l,a]=u.useState(!1),[i,h]=u.useState(1e3),[m,c]=u.useState(!1),[d,x]=u.useState(!0),[p,f]=u.useState(!0),[g,b]=u.useState(!1),[C,j]=u.useState(!1),[S,k]=u.useState(null),[w,v]=u.useState(!1),[N,M]=u.useState([]),[E,L]=u.useState(!1),[G,_]=u.useState(null),[ie,Z]=u.useState(0),[q,Q]=u.useState(new Set),[F,W]=u.useState(null),[D,J]=u.useState(!1),[H,re]=u.useState(!1),ge=u.useRef(null),he=u.useRef(null),te=u.useRef(null),fe=u.useRef(null);return u.useEffect(()=>{t&&M(t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}])},[t?.tempoChanges,t?.tempo]),{keyShift:r,setKeyShift:s,editMode:n,setEditMode:o,createProjectOpen:l,setCreateProjectOpen:a,containerWidth:i,setContainerWidth:h,snapEnabled:m,setSnapEnabled:c,sidebarVisible:d,setSidebarVisible:x,mixerVisible:p,setMixerVisible:f,mixerDockVisible:g,setMixerDockVisible:b,mixPresetsPopoverOpen:C,setMixPresetsPopoverOpen:j,selectedChord:S,setSelectedChord:k,showShortcutsHelp:w,setShowShortcutsHelp:v,dynamicTempos:N,setDynamicTempos:M,isDragging:E,setIsDragging:L,dragStartTime:G,setDragStartTime:_,scrollTop:ie,setScrollTop:Z,pinnedTracks:q,setPinnedTracks:Q,selectedTrackForNotes:F,setSelectedTrackForNotes:W,notesPanelVisible:D,setNotesPanelVisible:J,warpMode:H,setWarpMode:re,rulerRef:ge,sidebarRef:he,timelineRef:te,hoveredContainerRef:fe}};function Ge(t,r,s,n="4/4"){const[o]=n.split("/").map(Number),l=[...r].sort((c,d)=>c.time-d.time);let a=0,i=1,h=s;for(const c of l){if(c.time<=a){h=c.tempo;continue}const d=o*60/h,x=(c.time-a)/d,p=i+x;if(p>=t){const f=t-i;return a+f*d}a=c.time,i=p,h=c.tempo}const m=t-i;if(m>0){const c=o*60/h;a+=m*c}return a}function as(t,r,s,n="4/4"){const[o]=n.split("/").map(Number),l=[...r].sort((x,p)=>x.time-p.time);let a=0,i=1,h=s;for(const x of l){if(x.time<=a){h=x.tempo;continue}if(x.time>t){const b=t-a,C=o*60/h,j=b/C;return i+j}const p=x.time-a,f=o*60/h,g=p/f;a=x.time,i+=g,h=x.tempo}const m=t-a,c=o*60/h,d=m/c;return i+d}function cn(t,r,s){if(r<=0)return 120;const n=t*s*60/r;return Math.max(10,Math.min(999,n))}const Li=({song:t,zoom:r,currentTime:s,trackHeight:n})=>{const o=()=>ee.BASE_PPS*r,l=()=>{switch(n){case"small":return 64;case"large":return 128;default:return 96}},a=()=>{const m=t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}];return Math.floor(as(s,m,t.tempo))},i=m=>{const c=t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}],d=as(m,c,t.tempo);return[...c].sort((f,g)=>f.time-g.time).slice().reverse().find(f=>f.time<=d)||c[0]};return{getPixelsPerSecond:o,getTrackHeightPx:l,getCurrentMeasure:a,getCurrentTempoInfo:i,getCurrentTimeSignature:()=>i(s).timeSignature}},Bi=({song:t,onSongUpdate:r})=>({handleWarpCommit:u.useCallback((n,o,l)=>{if(!t||!r)return;const a={...t},i=a.tempoChanges?[...a.tempoChanges]:[];i.sort((f,g)=>f.time-g.time);const h=i.find(f=>f.time>o);let m=0,c=0;h&&(c=h.time,m=Ge(c,i,t.tempo));const d=i.findIndex(f=>f.time===n);d>=0?i[d]={...i[d],tempo:l}:n===1&&i.push({time:1,tempo:l,timeSignature:"4/4"});let x=i.findIndex(f=>f.time===o),p=i[x];if(!p){const f=i.find(g=>g.time===n);p={time:o,tempo:f?f.tempo:l,timeSignature:f?f.timeSignature:"4/4"},i.push(p)}if(i.sort((f,g)=>f.time-g.time),h){const f=Ge(o,i,t.tempo),g=m-f,b=c-o;if(g>0&&b>0){const[C]=p.timeSignature.split("/").map(Number),j=cn(b,g,C);p.tempo=j;const S=i.findIndex(k=>k.time===o);S>=0&&(i[S]=p)}}a.tempoChanges=i,r(a)},[t,r])}),$i=({song:t,onSongUpdate:r})=>{const s=u.useCallback((l,a,i)=>{if(!t||!r)return;const h={id:crypto.randomUUID(),userId:"current-user",content:l,time:i,isPrivate:a};r({...t,notes:[...t.notes||[],h]})},[t,r]),n=u.useCallback(l=>{!t||!r||r({...t,notes:(t.notes||[]).filter(a=>a.id!==l)})},[t,r]),o=u.useCallback((l,a)=>{if(!t||!r)return;const i=t.tracks.map(h=>h.id===a?{...h,notes:l}:h);r({...t,tracks:i})},[t,r]);return{handleAddSongNote:s,handleDeleteSongNote:n,handleSaveTrackNotes:o}},zi=({timelineRef:t,setContainerWidth:r,song:s,containerWidth:n,setZoom:o})=>{u.useEffect(()=>{const l=()=>{t.current&&r(t.current.clientWidth)},a=setTimeout(l,0);return window.addEventListener("resize",l),()=>{clearTimeout(a),window.removeEventListener("resize",l)}},[t,r]),u.useEffect(()=>{if(!s||n===0)return;const l=n/(s.duration*ee.BASE_PPS),a=Math.max(ee.MIN,Math.min(ee.MAX,l));o(a),t.current&&(t.current.scrollLeft=0)},[s?.id,n,o,t])};function Gi({notes:t,currentUser:r,onAddNote:s,onDeleteNote:n}){const[o,l]=u.useState(""),[a,i]=u.useState(!1),h=()=>{o.trim()&&(s(o,a),l(""),i(!1))},m=[...t].sort((d,x)=>d.time!==void 0&&x.time!==void 0?d.time-x.time:d.time!==void 0?-1:x.time!==void 0?1:0),c=d=>{if(d===void 0)return null;const x=Math.floor(d/60),p=Math.floor(d%60);return`${x}:${p.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add personal notes or share with your team"})]}),e.jsx(Ss,{children:e.jsxs(Ts,{className:"pt-6 space-y-3",children:[e.jsx(Xs,{placeholder:"Add a note...",value:o,onChange:d=>l(d.target.value),rows:3}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{id:"private-note",checked:a,onCheckedChange:i}),e.jsxs(B,{htmlFor:"private-note",className:"text-sm flex items-center gap-1",children:[e.jsx(Es,{className:"w-3 h-3"}),"Private Note"]})]}),e.jsxs(A,{onClick:h,disabled:!o.trim(),children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Add Note"]})]})]})}),e.jsx("div",{className:"space-y-3",children:m.map(d=>e.jsxs(Ss,{children:[e.jsx(so,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm",children:d.userId===r.id?"You":"Team Member"}),d.isPrivate?e.jsxs(jt,{variant:"secondary",className:"text-xs",children:[e.jsx(Es,{className:"w-3 h-3 mr-1"}),"Private"]}):e.jsxs(jt,{variant:"outline",className:"text-xs",children:[e.jsx(To,{className:"w-3 h-3 mr-1"}),"Shared"]}),d.time!==void 0&&e.jsx(jt,{variant:"outline",className:"text-xs",children:c(d.time)})]})}),d.userId===r.id&&e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n(d.id),children:e.jsx(cs,{className:"w-4 h-4"})})]})}),e.jsx(Ts,{children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:d.content})})]},d.id))}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No notes yet"})})]})}const dn=z.memo(({track:t,isAnySolo:r,onVolumeChange:s,onMuteToggle:n,onSoloToggle:o})=>{const[l,a]=z.useState(Ze(t.volume)),[i,h]=z.useState(!1);z.useEffect(()=>{i||a(Ze(t.volume))},[t.volume,i]);const m=g=>{a(g[0])},c=()=>{h(!0)},d=()=>{h(!1),s(t.id,hs(l))},x=()=>{a(Ze(1)),s(t.id,1)},p=r&&!t.solo,f=t.muted||p;return e.jsxs("div",{className:"flex flex-col items-center gap-3 min-w-[70px]",children:[e.jsx("div",{className:"text-xs text-center truncate w-full px-1 text-neutral-50",title:t.name,children:t.name}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center min-h-0",children:e.jsx(vs,{children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx("div",{className:"h-full flex items-center",onDoubleClick:x,children:e.jsx(Ye,{orientation:"vertical",value:[l],min:0,max:100,step:.1,onValueChange:m,onPointerDown:c,onPointerUp:d,className:"h-32",disabled:f})})}),e.jsxs(ue,{side:"top",children:[it(wt(l))," â€¢ Double-click to reset"]})]})})}),e.jsx("div",{className:`text-xs tabular-nums text-center min-w-[45px] ${f?"text-neutral-600":"text-neutral-400"}`,children:it(wt(l))}),e.jsx(A,{variant:"ghost",size:"sm",className:`h-7 w-8 text-xs p-0 ${t.muted?"bg-red-500 text-white hover:bg-red-600":"bg-neutral-700 text-neutral-50 hover:bg-neutral-600"}`,onClick:()=>n(t.id),children:"M"}),e.jsx(A,{variant:"ghost",size:"sm",className:`h-7 w-8 text-xs p-0 ${t.solo?"bg-amber-400 text-black hover:bg-amber-500":"bg-neutral-700 text-neutral-50 hover:bg-neutral-600"}`,onClick:()=>o(t.id),children:"S"}),e.jsx("div",{className:"w-full h-1 rounded",style:{backgroundColor:t.color}})]})});dn.displayName="MixerFader";function Vi({tracks:t,onTrackVolumeChange:r,onTrackMuteToggle:s,onTrackSoloToggle:n,onClose:o}){const l=t.some(a=>a.solo);return e.jsxs("div",{className:"w-full flex flex-col border-t h-[240px]",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:[e.jsxs("div",{className:"h-10 border-b flex items-center justify-between px-3 bg-neutral-800 border-neutral-700",children:[e.jsx("h3",{className:"text-sm text-neutral-50",children:"Mixer"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-7 w-7 text-neutral-400 hover:text-neutral-50",onClick:o,children:e.jsx(us,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden p-4",children:e.jsx("div",{className:"flex gap-4 h-full",children:t.map(a=>e.jsx(dn,{track:a,isAnySolo:l,onVolumeChange:r,onMuteToggle:s,onSoloToggle:n},a.id))})})]})}const Wi=({mixerDockVisible:t,notesPanelVisible:r,song:s,orderedTracks:n,onCloseMixerDock:o,onCloseNotesPanel:l,onTrackVolumeChange:a,onTrackMuteToggle:i,onTrackSoloToggle:h,onAddNote:m,onDeleteNote:c})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(Vi,{tracks:n,onTrackVolumeChange:a,onTrackMuteToggle:i,onTrackSoloToggle:h,onClose:o}),r&&s&&e.jsxs("div",{className:"w-full flex flex-col border-t",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",height:"240px"},children:[e.jsxs("div",{className:"h-10 border-b flex items-center justify-between px-3",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:"var(--daw-text-primary)"},children:"Song Notes"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-gray-700 rounded",children:e.jsx(us,{className:"w-4 h-4",style:{color:"var(--daw-text-primary)"}})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-3",style:{backgroundColor:"var(--daw-bg-contrast)"},children:e.jsx(Gi,{notes:s.notes||[],currentUser:{id:"current-user",name:"You"},onAddNote:m,onDeleteNote:c})})]})]});function Hi(t,r,s="4/4",n=!0,o=50,l,a,i){const h=[],m=i?[...i].sort((j,S)=>j.time-S.time):[];let c=1,d=0,x=r,p=s,f,g=0;const b=Math.max(0,0),C=Math.min(t,t);for(;d<t;){for(;g<m.length&&m[g].time<=c;){const v=m[g];x=v.tempo,v.timeSignature&&(p=v.timeSignature),f=v.subdivision,g++}const[j]=p.split("/").map(Number),S=60/x,k=S*j;if(d+k>=b&&d<=C){d>=b&&h.push({position:d,opacity:1,type:"measure"});let v=new Set;if(f){const N=f.split("+").map(E=>parseInt(E.trim()));let M=0;for(const E of N)v.add(M),M+=E}else for(let N=0;N<j;N++)v.add(N);for(let N=1;N<j;N++){const M=d+N*S;if(M>=b&&M<C&&M<t&&(v.has(N)?h.push({position:M,opacity:.6,type:"beat"}):n&&o>50&&h.push({position:M,opacity:.4,type:"subdivision"})),n&&o>80)for(let E=1;E<4;E++){const L=M-S+S*E/4;L>d&&L>=b&&L<C&&L<t&&Math.abs(L-M)>.001&&h.push({position:L,opacity:.3,type:"subdivision"})}}if(n&&o>80){const N=d+(j-1)*S;for(let M=1;M<4;M++){const E=N+S*M/4;E>=b&&E<C&&E<t&&h.push({position:E,opacity:.3,type:"subdivision"})}}}d+=k,c++}return h}const Ki=({song:t,timelineWidth:r,onWarpCommit:s,warpMode:n})=>{const[o,l]=u.useState(!1),[a,i]=u.useState(null),[h,m]=u.useState(null),c=u.useCallback((d,x)=>{if(!n)return!1;d.preventDefault(),d.stopPropagation();const f=(d.clientX-x.left)/r*t.duration,g=t.tempoChanges||[],b=as(f,g,t.tempo),C=Math.round(b),S=[...g].sort((N,M)=>N.time-M.time).slice().reverse().find(N=>N.time<C),k=S?S.time:1;if(C<=k)return!0;const w=Ge(k,g,t.tempo),v=Ge(C,g,t.tempo);return i({dragMeasure:C,anchorMeasure:k,anchorTime:w,startPixel:d.clientX,originalTime:v}),l(!0),m(v),!0},[n,r,t]);return u.useEffect(()=>{if(!o||!a)return;const d=p=>{document.body.style.cursor="col-resize";const f=p.clientX-a.startPixel,g=r/t.duration,b=f/g,C=a.originalTime+b;C>a.anchorTime&&m(C)},x=p=>{document.body.style.cursor="default";const f=p.clientX-a.startPixel,g=r/t.duration,b=f/g,C=a.originalTime+b;if(C<=a.anchorTime){l(!1),i(null),m(null);return}const j=a.dragMeasure-a.anchorMeasure,S=C-a.anchorTime,k=(t.tempoChanges||[]).find(M=>M.time===a.anchorMeasure),w=k?k.timeSignature:"4/4",[v]=w.split("/").map(Number),N=cn(j,S,v);s&&s(a.anchorMeasure,a.dragMeasure,N),l(!1),i(null),m(null)};return window.addEventListener("mousemove",d),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",x),document.body.style.cursor="default"}},[o,a,r,t,s]),{isWarpDragging:o,warpState:a,warpGhostTime:h,handleWarpMouseDown:c}},Xi=({rulerId:t,song:r,timelineWidth:s,zoom:n,editMode:o,keyShift:l,showBeats:a,onRulerDrop:i,onRulerDragOver:h,onSectionClick:m,onTempoMarkerClick:c,onChordClick:d,onTimeClick:x,onTempoMarkerAdd:p,onChordAdd:f,hoverLineRef:g,onLoopRegionChange:b,loopStart:C=null,loopEnd:j=null,scrollLeft:S=0,containerWidth:k=1e3,warpMode:w=!1,onWarpCommit:v})=>{const{warpGhostTime:N,handleWarpMouseDown:M}=Ki({song:r,timelineWidth:s,onWarpCommit:v,warpMode:w}),[E,L]=z.useState(!1),[G,_]=z.useState(null),[ie,Z]=z.useState(null),[q,Q]=z.useState(null),[F,W]=z.useState(!0),[D,J]=z.useState(!1),H=O=>{if(!F||te.length===0)return O;let K=0,T=te.length-1;for(;K<=T;){const V=Math.floor((K+T)/2);te[V].position<O?K=V+1:T=V-1}const I=te[K],$=te[K-1];return I&&$?O-$.position<I.position-O?$.position:I.position:I?I.position:$?$.position:O},re=O=>{const K=O.currentTarget.getBoundingClientRect();if(!(w&&t==="measures"&&M(O,K))){if(!w&&t==="measures"&&b&&O.shiftKey){O.stopPropagation();const I=(O.clientX-K.left)/s*r.duration,$=H(I);L(!0),_($),Z($);return}if(o&&!w){if(t==="tempo"&&p){const I=(O.clientX-K.left)/s*r.duration,$=H(I);p($);return}if(t==="chords"&&f){const I=(O.clientX-K.left)/s*r.duration,$=H(I);f($);return}}if(!w){const I=(O.clientX-K.left)/s*r.duration,$=H(I);x&&O.clientY-K.top<ze.RULER_HEIGHT/2&&x(Math.max(0,Math.min($,r.duration)))}}},ge=()=>{const K=n>=8?1:n>=4?2:n>=2?5:n>=.5?10:30,T=[];for(let I=0;I<=r.duration;I+=K)T.push(I);return T},he=u.useMemo(()=>Math.round(n*10)/10,[n]),te=u.useMemo(()=>Hi(r.duration,r.tempo||120,"4/4",a,he*100,void 0,void 0,r.tempoChanges),[r.duration,r.tempo,r.tempoChanges,o,he,a]),fe=u.useMemo(()=>{const O=[];let K=0,T=-1,I=-100;const $=50,V=s/r.duration,ne=60/(r.tempo||120)*V,oe=a&&ne>=25,ae=a&&ne>=80;return te.forEach((Y,le)=>{if(Y.type==="measure"){K++,T=Y.position;const we=Y.position/r.duration*s,ke=we-I>=$;ke&&(I=we),O.push({time:Y.position,measure:ke?K:null,beat:1,isBeat:!1,opacity:Y.opacity,height:"100%",width:2,color:"rgba(255,255,255,0.6)"})}else if(Y.type==="beat"&&oe){const Se=te.slice(0,le).filter(Re=>Re.position>T&&Re.type==="beat").length+2,ke=Se===4||Se===7||Se===10;O.push({time:Y.position,measure:null,beat:Se,isBeat:!0,opacity:Y.opacity,height:ke?"70%":"55%",width:ke?1.5:1,color:ke?"rgba(255,255,255,0.35)":"rgba(255,255,255,0.25)"})}else Y.type==="subdivision"&&ae&&O.push({time:Y.position,measure:null,beat:0,isBeat:!0,opacity:Y.opacity*.5,height:"30%",width:1,color:"rgba(255,255,255,0.15)"})}),O},[te,n,a,r.duration,s,r.tempo,S,k]);switch(t){case"time":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${ze.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"time"),onDragOver:h,onMouseDown:re,children:ge().map(T=>e.jsx("div",{className:"absolute top-0 bottom-0 border-l",style:{left:T/r.duration*s,borderColor:"var(--daw-border)"},children:e.jsx("span",{className:"absolute top-0.5 left-1 text-[10px]",style:{color:"var(--daw-text-secondary)"},children:es(T)})},T))});case"measures":return e.jsxs("div",{className:"border-b relative cursor-pointer transition-colors duration-300",style:{height:`${ze.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:w?"rgba(249, 115, 22, 0.15)":"var(--daw-bg-contrast)",borderColor:w?"#f97316":"var(--daw-border)"},onDrop:T=>i(T,"measures"),onDragOver:h,onMouseDown:re,onMouseMove:T=>{const I=T.currentTarget.getBoundingClientRect(),V=(T.clientX-I.left)/s*r.duration,ne=H(V);if(Q(ne),E&&G!==null&&b){const oe=Math.min(G,ne),ae=Math.max(G,ne);b(oe,ae)}},onMouseUp:()=>{E&&(L(!1),_(null),Z(null))},onMouseLeave:()=>{Q(null),E&&(L(!1),_(null),Z(null))},children:[fe.map((T,I)=>{const $=T.time/r.duration*s;if(!T.measure&&!T.isBeat)return null;const V=T.height,ne=T.width,oe=T.color,ae="var(--daw-text-secondary)",Y=V==="100%"?"0":V==="70%"?"15%":V==="55%"?"22.5%":"35%",le=r.tempoChanges?.find(we=>Math.abs(we.time-T.time)<.01);return le&&le.timeSignature&&le.timeSignature.includes("8")&&["6/8","9/8","12/8"].includes(le.timeSignature),le&&le.subdivision,e.jsxs("div",{className:`absolute transition-colors ${w?"hover:bg-orange-400/30":""}`,style:{left:$,top:Y,height:V,width:`${ne}px`,backgroundColor:oe},title:T.isCompound?"Compound Time":T.isIrregular?"Irregular Time":void 0,children:[T.measure&&e.jsx("span",{className:"absolute -top-4 left-1 text-[10px] font-semibold whitespace-nowrap",style:{color:ae},children:T.measure}),a&&T.isBeat&&T.beat>0&&e.jsx("span",{className:"absolute -top-4 left-1 text-[9px] whitespace-nowrap",style:{color:"var(--daw-text-muted)"},children:T.beat})]},I)}),w&&(r.tempoChanges||[]).map((T,I)=>{const V=Ge(T.time,r.tempoChanges||[],r.tempo)/r.duration*s;return e.jsx("div",{className:"absolute -top-0.5 -left-1.5 w-3 h-3 z-20 pointer-events-none",style:{left:V,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #f97316",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}},`warp-anchor-${I}`)}),q!==null&&!w&&e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-cyan-400/50 pointer-events-none transition-all duration-75",style:{left:q/r.duration*s},children:e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 px-1.5 py-0.5 bg-cyan-500 text-white text-[9px] rounded whitespace-nowrap",children:es(q)})}),N!==null&&e.jsxs("div",{className:"absolute top-0 bottom-0 w-0.5 bg-orange-500 z-50 pointer-events-none",style:{left:N/r.duration*s},children:[e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 px-1.5 py-0.5 bg-orange-500 text-white text-[9px] rounded whitespace-nowrap font-bold",children:"WARP"}),e.jsx("div",{className:"absolute -top-0.5 -left-1.5 w-3 h-3 z-50",style:{borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #f97316",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}})]}),E&&G!==null&&q!==null&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-yellow-500/20 border-l-2 border-r-2 border-yellow-500/60 pointer-events-none",style:{left:Math.min(G,q)/r.duration*s,width:Math.abs(q-G)/r.duration*s}})]});case"tempo":const K=[...o?r.tempoChanges||[]:(r.tempoChanges||[]).filter(T=>!T.hidden)].sort((T,I)=>T.time-I.time);return e.jsxs("div",{className:"tempo-ruler-interactive border-b relative cursor-pointer transition-all duration-300",style:{height:D?"120px":`${ze.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"tempo"),onDragOver:h,onMouseDown:re,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-4 z-50 flex items-center justify-center hover:bg-white/10 cursor-pointer text-[10px] text-muted-foreground",onClick:T=>{T.stopPropagation(),J(!D)},title:D?"Collapse Tempo View":"Expand Tempo View",children:e.jsx("div",{className:`transform transition-transform ${D?"rotate-90":"rotate-0"}`,children:"â–¶"})}),D&&e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none opacity-30",children:e.jsx("polyline",{points:K.map(T=>{const I=Ge(T.time,r.tempoChanges||[],r.tempo)/r.duration*s,$=120-(Math.min(Math.max(T.tempo,60),200)-60)/140*120;return`${I},${$}`}).join(" "),fill:"none",stroke:"#f97316",strokeWidth:"2"})}),K.map((T,I)=>{const $=I>0?K[I-1]:null,V=!$||$.timeSignature!==T.timeSignature,ne=Ge(T.time,r.tempoChanges||[],r.tempo);return e.jsxs("div",{className:"absolute top-0.5 flex items-start cursor-pointer group z-10",style:{left:ne/r.duration*s},onClick:oe=>{oe.stopPropagation(),oe.preventDefault(),o&&c(T)},children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-px",style:{backgroundColor:"#f97316",opacity:.4,height:D?"120px":"100%"}}),e.jsxs("div",{className:"absolute top-0 -translate-x-1/2 flex gap-1 flex-col items-center",children:[e.jsx("div",{className:"hover:brightness-110 transition-all",style:{backgroundColor:"#f97316",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},children:rr(T.tempo)}),V&&e.jsx("div",{className:"hover:brightness-110 transition-all mt-0.5",style:{backgroundColor:"#6b7280",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},children:T.timeSignature})]})]},`tempo-${I}`)})]});case"chords":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${ze.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"chords"),onDragOver:h,onMouseDown:re,children:(r.chordMarkers||[]).map((T,I)=>e.jsx("div",{className:"absolute top-0.5",style:{left:T.time/r.duration*s},children:e.jsx("div",{className:"cursor-pointer hover:brightness-110 transition-all",style:{backgroundColor:"#3b82f6",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},onClick:$=>{$.stopPropagation(),d(T)},children:ss(T.chord,l)})},I))});case"sections":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${ze.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:T=>i(T,"sections"),onDragOver:h,onMouseDown:re,children:r.markers.map((T,I)=>{const $=T.time/r.duration*s,V=r.markers[I+1],ne=V?(V.time-T.time)/r.duration*s:s-$,oe={intro:{bg:"#22c55e",text:"#fff"},verse:{bg:"#3b82f6",text:"#fff"},chorus:{bg:"#ef4444",text:"#fff"},bridge:{bg:"#f59e0b",text:"#fff"},outro:{bg:"#8b5cf6",text:"#fff"},"pre-chorus":{bg:"#ec4899",text:"#fff"},instrumental:{bg:"#14b8a6",text:"#fff"},tag:{bg:"#64748b",text:"#fff"},custom:{bg:"#6b7280",text:"#fff"}},ae=oe[T.type]||oe.custom;return e.jsx("div",{className:"absolute top-0.5 cursor-pointer hover:brightness-110 transition-all",style:{left:$,width:Math.max(40,ne-4),height:"24px",backgroundColor:ae.bg,borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)"},onClick:Y=>{Y.stopPropagation(),m(I)},children:e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-semibold pointer-events-none truncate px-2",style:{color:ae.text},children:T.label})},T.id)})});default:return null}},un=z.memo(({song:t,currentTime:r,gridTime:s,tempo:n,zoom:o,pixelsPerSecond:l,containerWidth:a,visibleRulers:i,rulerOrder:h,onTimeClick:m,onMarkerEdit:c,onMarkerDelete:d,editMode:x,keyShift:p,onChordClick:f,onLoopRegionChange:g,loopStart:b,loopEnd:C,scrollLeft:j,warpMode:S=!1,onWarpCommit:k,onTempoMarkerAdd:w,onChordAdd:v})=>{const N=l||o*100,M=h.filter(_=>i.includes(_)),E=_=>{f&&f(_.chord,_.customDiagram)},L=_=>{x&&!S&&c&&t.markers[_]&&c(t.markers[_],"section")},G=_=>{x&&!S&&c&&c(_,"tempo")};return e.jsxs("div",{className:"relative flex-shrink-0 z-10",style:{width:`${t.duration*N}px`},children:[e.jsx("div",{className:"absolute top-0 bottom-0 z-50 pointer-events-none",style:{left:`${r*N}px`},children:e.jsx("div",{className:"absolute top-0 bottom-0",style:{width:"2px",backgroundColor:"#ef4444"},children:e.jsx("div",{className:"absolute -top-0 left-1/2 -translate-x-1/2",style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"8px solid #ef4444"}})})}),M.map(_=>e.jsx(Xi,{rulerId:_,song:t,timelineWidth:t.duration*N,zoom:o,editMode:x,keyShift:p,showBeats:!0,onRulerDrop:()=>{},onRulerDragOver:ie=>ie.preventDefault(),onSectionClick:L,onTempoMarkerClick:G,onChordClick:E,onTimeClick:m,onLoopRegionChange:_==="measures"?g:void 0,loopStart:b,loopEnd:C,scrollLeft:j,containerWidth:a,warpMode:S,onWarpCommit:k,onTempoMarkerAdd:w,onChordAdd:v},_))]})});un.displayName="RulersContainer";const Ui=({songDuration:t,zoom:r,containerWidth:s,timelineRef:n,onNavigate:o})=>{const[l,a]=u.useState({start:0,end:1}),i=u.useRef(!1);u.useEffect(()=>{const m=n.current;if(!m)return;const c=()=>{if(i.current)return;const d=m.scrollLeft,x=t*ee.BASE_PPS*r;if(x===0)return;const p=d/x,f=(d+s)/x;a({start:Math.max(0,p),end:Math.min(1,f)})};return c(),m.addEventListener("scroll",c),()=>m.removeEventListener("scroll",c)},[t,r,s,n]);const h=z.useCallback(({start:m,end:c})=>{i.current=!0,a({start:m,end:c});const d=c-m;if(d<=1e-4)return;const p=s/d/(t*ee.BASE_PPS),f=Math.max(ee.MIN,Math.min(ee.MAX,p)),g=t*ee.BASE_PPS*f,b=m*g;o(f,b),setTimeout(()=>{i.current=!1},100)},[s,t,o]);return e.jsx("div",{className:"flex-1 px-4 flex items-center h-full",children:e.jsx(ea,{start:l.start,end:l.end,onChange:h,className:"h-5 w-full"})})};function qi({song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n,onExportProject:o}){const{t:l}=et(),a=aa(),{zoom:i,setZoom:h,trackHeight:m,setTrackHeight:c,rulerVisibility:d,rulerOrder:x,setRulerOrder:p}=a,f=Oi({song:t}),{keyShift:g,setKeyShift:b,editMode:C,setEditMode:j,createProjectOpen:S,setCreateProjectOpen:k,containerWidth:w,setContainerWidth:v,snapEnabled:N,setSnapEnabled:M,sidebarVisible:E,setSidebarVisible:L,mixerVisible:G,mixerDockVisible:_,setMixerDockVisible:ie,mixPresetsPopoverOpen:Z,setMixPresetsPopoverOpen:q,selectedChord:Q,setSelectedChord:F,showShortcutsHelp:W,setShowShortcutsHelp:D,setIsDragging:J,scrollTop:H,pinnedTracks:re,setPinnedTracks:ge,selectedTrackForNotes:he,setSelectedTrackForNotes:te,notesPanelVisible:fe,setNotesPanelVisible:O,warpMode:K,setWarpMode:T,rulerRef:I,sidebarRef:$,timelineRef:V,hoveredContainerRef:ne}=f,{isPlaying:oe,currentTime:ae,gridTime:Y,tempo:le,loopEnabled:we,loopStart:Se,loopEnd:ke,metronomeEnabled:Re,metronomeVolume:Te,actions:me}=ro({song:t,warpModeEnabled:!1}),pe=ca({song:t,onSongUpdate:r}),{mixPresets:st,handleSaveMixPreset:rt,handleLoadMixPreset:Ot,handleDeleteMixPreset:Lt}=Ri({song:t,onSongUpdate:r}),{editorOpen:Bt,setEditorOpen:$t,editorType:zt,editingMarker:Gt,clickedTime:y,handleTimelineClick:P,handleTimelineItemSubmit:se,openEditor:U}=_i({song:t,onSongUpdate:r,editMode:C}),{handleZoomOutOnPlayhead:ye,handleZoomInOnPlayhead:Be,handleFitToView:$e}=Ii({zoom:i,setZoom:h,song:t,containerWidth:w}),{handleTimelineScroll:nt,handleNavigatorChange:ot}=Fi({zoom:i,setZoom:h,timelineRef:V,rulerRef:I,currentTime:ae}),{getPixelsPerSecond:Ke,getTrackHeightPx:Vt,getCurrentMeasure:Wt,getCurrentTimeSignature:Ht}=Li({song:t,zoom:i,currentTime:ae,trackHeight:m}),{handleWarpCommit:Kt}=Bi({song:t,onSongUpdate:r}),{handleAddSongNote:hn,handleDeleteSongNote:mn,handleSaveTrackNotes:xn}=$i({song:t,onSongUpdate:r});zi({timelineRef:V,setContainerWidth:v,song:t,containerWidth:w,setZoom:h});const fn=R=>{a.setRulerVisibility(R),Object.entries(R).forEach(([xe,Ce])=>{Oe.setRulerVisibility(xe,Ce)})},pn=z.useCallback(()=>{J(!1)},[]),gn=z.useCallback(R=>{ne.current!=="timeline"&&V.current&&V.current.scrollTop!==R&&(V.current.scrollTop=R)},[]),vn=z.useCallback(R=>{if(!V.current)return;const xe=V.current.scrollHeight,Ce=R.start*xe;V.current.scrollTop=Ce,$.current&&($.current.scrollTop=Ce)},[]),bn=z.useCallback(()=>{if(!V.current)return{start:0,end:1};const R=V.current.scrollHeight,xe=V.current.clientHeight;if(R<=xe)return{start:0,end:1};const Ce=V.current.scrollTop,Dn=Ce/R,Pn=(Ce+xe)/R;return{start:Dn,end:Pn}},[H]),yn=z.useCallback(R=>{},[]),jn=z.useCallback((R,xe)=>{},[]),wn=z.useCallback(()=>{},[]),Cn=z.useCallback(()=>{},[]),kn=z.useCallback(()=>{ie(!1)},[]);na({isPlaying:oe,onPlayPause:me.togglePlayPause,onStop:()=>me.seek(0),onToggleLoop:()=>me.setLoopEnabled(!we),onToggleMetronome:()=>me.setMetronomeEnabled(!Re),onZoomIn:()=>h(R=>Math.min(8,R+.25)),onZoomOut:()=>h(R=>Math.max(.5,R-.25)),onGoToStart:()=>me.seek(0),onGoToEnd:()=>me.seek(t?.duration||0),onFitToView:()=>{if(t&&w>0){const R=w/(t.duration*ee.BASE_PPS),xe=Math.max(ee.MIN,Math.min(ee.MAX,R));h(xe),nt(0)}},onToggleEditMode:()=>j(R=>!R)});const[Nn,Yi]=z.useState(null),Mn=R=>{C&&!K?U("chord",R):F({chord:R.chord,customDiagram:R.customDiagram})};if(!t)return e.jsxs("div",{className:"flex flex-col h-full text-white",style:{backgroundColor:"var(--daw-bg-main)"},children:[e.jsxs("div",{className:"border-b p-3 flex items-center justify-between",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs(A,{variant:"ghost",size:"sm",onClick:n,className:"text-white hover:bg-gray-700",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Back to Library"]}),e.jsx("h2",{children:"Player"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"No Project Loaded"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create a new project or load one from the library"})]})})}),e.jsx(ts,{open:!1,onOpenChange:()=>{},onCreateProject:async()=>{}})]});const yt=u.useMemo(()=>{if(!t?.tracks)return[];const R=t.tracks.filter(Ce=>re.has(Ce.id)),xe=t.tracks.filter(Ce=>!re.has(Ce.id));return[...R,...xe]},[t?.tracks,re]),Sn=R=>{U("tempo",void 0,R)},Tn={song:t,updateSong:R=>{r&&r(R)},tracks:t?.tracks||[],trackActions:{updateVolume:pe.handleTrackVolumeChange,toggleMute:pe.handleTrackMuteToggle,toggleSolo:pe.handleTrackSoloToggle,updateName:pe.handleTrackNameChange,updateColor:pe.handleTrackColorChange,updateTag:pe.handleTrackTagChange},currentTime:ae,gridTime:Y,tempo:le,isPlaying:oe,zoom:i,setZoom:h,editMode:C,setEditMode:j,warpMode:K,setWarpMode:T,keyShift:g,setKeyShift:b},Xt=K?"warp":C?"marker":null,En=R=>{R==="warp"?(T(!0),j(!0)):R==="marker"?(T(!1),j(!0)):(T(!1),j(!1))};return e.jsx(ra,{value:Tn,children:e.jsx(vs,{children:e.jsxs("div",{className:"flex flex-col h-full text-white",style:{backgroundColor:"var(--daw-bg-main)"},children:[e.jsx(xi,{songTitle:t.title,songKey:t.key,isPlaying:oe,currentTime:ae,tempo:le,loopEnabled:we,metronomeEnabled:Re,metronomeVolume:Te,currentMeasure:String(Wt()),currentTimeSignature:Ht(),displayTempo:le,keyShift:g,trackHeight:m,rulerVisibility:d,rulerOrder:x,snapEnabled:N,onBack:n,onPlayPause:me.togglePlayPause,onStop:me.stop,onLoopToggle:()=>me.setLoopEnabled(!we),onMetronomeToggle:()=>me.setMetronomeEnabled(!Re),onMetronomeVolumeChange:me.setMetronomeVolume,onTempoChange:me.setTempo,onKeyShiftChange:b,onTrackHeightChange:c,onRulerVisibilityChange:fn,onRulerOrderChange:p,onSnapToggle:()=>M(!N),onSnapModeChange:R=>console.log("Snap mode:",R),activeTool:Xt,onToolChange:En}),e.jsx(Si,{}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-none h-auto border-b z-30",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:[E&&G&&e.jsx("div",{className:"flex-none border-r",style:{width:"280px",minWidth:"280px",maxWidth:"280px",backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:e.jsx(Ei,{visibleRulers:Object.keys(d).filter(R=>d[R]),rulerOrder:x,onRulerOrderChange:p})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-hidden",ref:I,children:e.jsx(un,{song:t,currentTime:ae,gridTime:Y,tempo:le,zoom:i,pixelsPerSecond:Ke(),containerWidth:w,visibleRulers:Object.keys(d).filter(R=>d[R]),rulerOrder:x,onTimeClick:R=>me.seek(R),onMarkerEdit:(R,xe)=>U(xe,R),onMarkerDelete:(R,xe)=>{},onTempoMarkerAdd:Xt==="marker"?Sn:void 0,editMode:Xt==="marker",keyShift:g,warpMode:K,onWarpCommit:Kt,onChordClick:R=>{const xe=t?.chordMarkers?.find(Ce=>Ce.chord===R);xe&&Mn(xe)}})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[E&&G&&e.jsx(ln,{ref:$,tracks:yt,trackHeight:m,editingTrackId:null,trackNameInput:"",pinnedTracks:re,onTrackVolumeChange:pe.handleTrackVolumeChange,onTrackMuteToggle:pe.handleTrackMuteToggle,onTrackSoloToggle:pe.handleTrackSoloToggle,onTrackNameChange:pe.handleTrackNameChange,onTrackColorChange:pe.handleTrackColorChange,onTrackTagsChange:jn,onTrackNotesOpen:te,onEditingTrackIdChange:wn,onTrackNameInputChange:Cn,onPinnedTracksChange:ge,onScroll:gn}),e.jsx(vr,{ref:V,song:t,currentTime:ae,zoom:i,pixelsPerSecond:Ke(),filteredTracks:yt,loopStart:Se,loopEnd:ke,trackHeightPx:Vt(),isPlaying:oe,onTimelineMouseDown:P,onTimelineMouseMove:yn,onTimelineMouseUp:pn,onScroll:nt}),e.jsx("div",{className:"w-4 flex-shrink-0",style:{backgroundColor:"var(--daw-bg-contrast)"},children:e.jsx(ta,{...bn(),onChange:vn,minHeight:.05})})]})]}),e.jsx(Wi,{mixerDockVisible:_,notesPanelVisible:fe,orderedTracks:yt,song:t,trackActions:pe,onCloseMixerDock:kn,onCloseNotesPanel:()=>O(!1),onAddNote:hn,onDeleteNote:mn}),e.jsxs("div",{className:"border-t flex items-center h-8",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("div",{className:"border-r flex items-center flex-shrink-0",style:{width:E&&G?"280px":"0",minWidth:E&&G?"280px":"0",borderColor:"var(--daw-border)"},children:e.jsx(Di,{zoom:i,onZoomIn:Be,onZoomOut:ye,onFitToView:$e})}),e.jsx(Ui,{songDuration:t.duration,zoom:i,containerWidth:w,timelineRef:V,onNavigate:ot})]}),e.jsx(Ai,{sidebarVisible:E,mixerDockVisible:_,notesPanelVisible:fe,mixPresetsPopoverOpen:Z,tracks:yt,mixPresets:st,onToggleSidebar:()=>L(!E),onToggleMixer:()=>ie(!_),onToggleNotes:()=>O(!fe),onPerformanceMode:s,onMixPresetsOpenChange:q,onSaveMixPreset:rt,onLoadMixPreset:Ot,onDeleteMixPreset:Lt}),e.jsx(ts,{open:S,onOpenChange:k,onCreateProject:async()=>{}}),e.jsx(Uo,{open:Bt,onOpenChange:$t,type:zt,currentTime:Nn??y,initialData:Gt,onSubmit:se}),Q&&e.jsx(Qo,{chord:Q.chord,isOpen:!!Q,onClose:()=>F(null),customDiagram:Q.customDiagram}),he&&e.jsx(Jo,{open:!!he,onOpenChange:R=>{R||te(null)},trackName:he.name,notes:he.notes||"",onSave:xn}),e.jsx(Fo,{isOpen:W,onClose:()=>D(!1)})]})})})}function tc({song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n,onCreateProject:o,onExportProject:l}){return t?e.jsx(qi,{song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n}):e.jsxs("div",{className:"flex flex-col h-full bg-gray-900 text-white",children:[e.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 p-3 flex items-center justify-between",children:[e.jsxs(A,{variant:"ghost",size:"sm",onClick:n,className:"text-white hover:bg-gray-700",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Back to Library"]}),e.jsx("h2",{children:"Player"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"No Project Loaded"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create a new project or load one from the library"})]})})}),e.jsx(ts,{open:!1,onOpenChange:()=>{},onCreateProject:o||(async()=>{})})]})}export{tc as DAWPlayer};
