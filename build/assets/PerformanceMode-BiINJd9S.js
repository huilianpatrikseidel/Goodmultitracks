import{r as l,j as e}from"./react-vendor-BoGJM_Cg.js";import{f as u,_ as Z,ad as ee,v as te,P as se,ae as re,B as $,af as ie,ag as ae,L as S}from"./library-feature-aYpkCHpW.js";import{b as ne,f as p,P as oe,c as le,d as ce,S as de,e as me,p as xe,h as ue}from"./player-feature-DB2NXcFp.js";import"./utils-vendor-BznqKjY6.js";import"./ui-vendor-1btjq6i-.js";import"./setlist-feature-BUAd_USg.js";import"./icons-vendor-B5W4h_yA.js";import"./toast-vendor-CHPPPCQ6.js";import"./audio-processing-DdlKDC9D.js";function ke({song:r,onClose:F}){const{isPlaying:w,currentTime:o,actions:c,metronomeEnabled:v,metronomeVolume:k,loopStart:C,loopEnd:M}=ne({song:r,initialTempo:r.tempo,warpModeEnabled:!1}),[A,j]=l.useState(""),[P,y]=l.useState(""),[E,b]=l.useState(""),[R,B]=l.useState(r.tempo),[D,I]=l.useState("4/4"),T=l.useRef(0),[O,V]=l.useState(1),[X,H]=l.useState(4),[f,K]=l.useState(!1),[L,_]=l.useState(void 0),z=s=>{if(!r.tempoChanges||r.tempoChanges.length===0)return{tempo:r.tempo,timeSignature:"4/4",subdivision:void 0};const i=[...r.tempoChanges].sort((n,x)=>n.time-x.time);let t=i[0];for(const n of i)if(n.time<=s)t=n;else break;let a=t.tempo;if(t.curve&&s>=t.time&&s<=t.curve.targetTime){const n=t.tempo,x=t.curve.targetTempo,h=t.curve.targetTime-t.time,d=(s-t.time)/h;if(t.curve.type==="linear")a=n+(x-n)*d;else if(t.curve.type==="exponential"){const m=1-Math.pow(1-d,2);a=n+(x-n)*m}}return{tempo:a,timeSignature:t.timeSignature,subdivision:t.subdivision}};l.useEffect(()=>{(i=>{const t=r.markers?.sort((d,m)=>d.time-m.time).slice().reverse().find(d=>d.time<=i);if(t){j(t.label);const d=r.markers?.findIndex(g=>g.id===t.id)||0,m=r.markers?.[d+1];y(m?m.label:"End")}else j("Intro"),y(r.markers?.[0]?.label||"End");const a=r.chordMarkers?.sort((d,m)=>d.time-m.time).slice().reverse().find(d=>d.time<=i);b(a?a.chord:"-");const n=z(i);B(n.tempo),I(n.timeSignature);const x=60/n.tempo,h=Math.floor(i/x);if(h>T.current){const d=n.timeSignature,m=n.subdivision;_(m);const g=me(d,m);H(g);let N=1;if(m){const Q=xe(m).reduce((W,Y)=>W+Y,0),U=h%Q+1;N=ue(U,m).groupIndex+1}else N=h%g+1;V(N),T.current=h}})(o)},[o,r]),l.useEffect(()=>{const s=i=>{if(i.code==="Space"&&i.target instanceof HTMLElement){const t=i.target.tagName.toLowerCase();t!=="input"&&t!=="textarea"&&!i.target.isContentEditable&&(i.preventDefault(),c.togglePlayPause())}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),l.useEffect(()=>{const s=[...r.markers].sort((a,n)=>a.time-n.time),i=s.reverse().find(a=>a.time<=o),t=s.find(a=>a.time>o);j(i?.label||"Start"),y(t?.label||"End")},[o,r.markers]),l.useEffect(()=>{if(!r.chordMarkers||r.chordMarkers.length===0){b("");return}const i=[...r.chordMarkers].sort((t,a)=>t.time-a.time).reverse().find(t=>t.time<=o);b(i?.chord||"")},[o,r.chordMarkers]),l.useEffect(()=>{const s=z(o);B(s.tempo),I(s.timeSignature)},[o,r.tempoChanges,r.tempo]);const J=s=>{const i=s.currentTarget.getBoundingClientRect(),n=(s.clientX-i.left)/i.width*r.duration;c.seek(Math.max(0,Math.min(r.duration,n)))},q=s=>{const i=[...r.markers].sort((n,x)=>n.time-x.time),t=i.findIndex(n=>n.id===s.id),a=i[t+1];c.setLoopStart(s.time),c.setLoopEnd(a?a.time:r.duration),c.seek(s.time),c.setLoopEnabled(!0)},G=o/r.duration*100;return e.jsxs("div",{className:"fixed inset-0 bg-black text-white z-50 flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl mb-1",children:r.title}),e.jsx("p",{className:"text-xl text-gray-400",children:r.artist})]}),e.jsx(u,{variant:"ghost",size:"icon",onClick:F,className:"text-white hover:bg-gray-800",children:e.jsx(Z,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8",children:[E&&e.jsx("div",{className:"text-center mb-12",children:e.jsx("div",{className:"font-mono tracking-wider",style:{fontSize:"clamp(8rem, 20vw, 16rem)",lineHeight:"1",textShadow:"0 0 40px rgba(59, 130, 246, 0.5)"},children:E})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-5xl md:text-7xl mb-4 text-gray-300",children:A}),P&&e.jsxs("div",{className:"text-xl text-gray-500",children:["Next: ",P]})]}),e.jsxs("div",{className:"flex items-center gap-6 mb-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"BPM"}),e.jsx("div",{className:"text-3xl",children:Math.round(R)})]}),e.jsx("div",{className:"text-gray-600 text-4xl",children:"|"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"Time Signature"}),e.jsx("div",{className:"text-3xl",children:D})]})]}),v&&w&&e.jsxs("div",{className:"flex flex-col items-center gap-2 mb-8",children:[e.jsx("div",{className:"flex items-center gap-3",children:Array.from({length:X}).map((s,i)=>{const t=i+1,a=t===O,n=t===1;return e.jsx("div",{className:`w-4 h-4 rounded-full transition-all duration-100 ${a?n?"bg-yellow-500 scale-150 shadow-lg shadow-yellow-500/50":"bg-gray-400 scale-125 shadow-md shadow-gray-400/50":"bg-gray-700"}`},i)})}),f&&L&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Pattern: ",L]})]}),e.jsxs("div",{className:"text-4xl mb-8",children:[p(o)," / ",p(r.duration)]}),e.jsxs("div",{className:"w-full max-w-2xl mb-12",children:[e.jsx("div",{className:"relative mb-2 h-8",children:r.markers.map(s=>{const i=s.time/r.duration*100,t=s.time<=o&&(r.markers.find(a=>a.time>o)?.time||1/0)>s.time;return e.jsx("button",{onClick:()=>q(s),className:`absolute -translate-x-1/2 px-2 py-1 text-xs rounded transition-all hover:scale-110 ${t?"bg-yellow-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,style:{left:`${i}%`,bottom:0},title:`Jump to ${s.label} at ${p(s.time)}`,children:s.label},s.id)})}),e.jsxs("div",{className:"h-4 bg-gray-800 rounded-full overflow-hidden cursor-pointer hover:bg-gray-700 transition-colors relative",onClick:J,children:[r.markers.map(s=>{const i=s.time/r.duration*100;return e.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-gray-600",style:{left:`${i}%`}},`div-${s.id}`)}),e.jsx("div",{className:"h-full bg-white transition-all pointer-events-none",style:{width:`${G}%`}})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"w-16 h-16 text-white hover:bg-gray-800",onClick:()=>{const i=[...r.markers].sort((t,a)=>t.time-a.time).reverse().find(t=>t.time<o-1);i&&c.seek(i.time)},children:e.jsx(ee,{className:"w-8 h-8"})}),e.jsx(u,{size:"icon",className:`w-24 h-24 rounded-full ${w?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-yellow-800 text-white hover:bg-yellow-700"}`,onClick:()=>c.togglePlayPause(),children:w?e.jsx(te,{className:"w-12 h-12"}):e.jsx(se,{className:"w-12 h-12"})}),e.jsx(u,{variant:"ghost",size:"icon",className:"w-16 h-16 text-white hover:bg-gray-800",onClick:()=>{const i=[...r.markers].sort((t,a)=>t.time-a.time).find(t=>t.time>o);i&&c.seek(i.time)},children:e.jsx(re,{className:"w-8 h-8"})})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{variant:"outline",className:"text-lg py-2 px-4 border-white text-white",children:["Key: ",r.key]}),e.jsxs($,{variant:"outline",className:"text-lg py-2 px-4 border-white text-white",children:[r.tempo," BPM"]}),C!==null&&M!==null&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{c.setLoopEnabled(!1),c.setLoopStart(null),c.setLoopEnd(null)},className:"gap-2 border-yellow-600 text-yellow-500 hover:bg-yellow-900",children:[e.jsx(ie,{className:"w-4 h-4"}),"Loop: ",p(C)," - ",p(M)]}),e.jsxs(oe,{children:[e.jsx(le,{asChild:!0,children:e.jsx(u,{variant:"outline",size:"icon",className:`w-10 h-10 ${v?"bg-yellow-600 border-yellow-600 text-white hover:bg-yellow-700":"border-white text-white hover:bg-gray-800"}`,children:e.jsx(ae,{className:"w-5 h-5"})})}),e.jsx(ce,{className:"w-64 bg-gray-900 border-gray-700",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{className:"text-white",children:"Metronome"}),e.jsx(u,{variant:v?"default":"outline",size:"sm",onClick:()=>c.setMetronomeEnabled(!v),children:v?"ON":"OFF"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-white text-sm",children:"Volume"}),e.jsx(de,{value:[k*100],onValueChange:s=>c.setMetronomeVolume(s[0]/100),max:100,step:1,className:"w-full"}),e.jsxs("div",{className:"text-xs text-gray-400 text-right",children:[Math.round(k*100),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-700",children:[e.jsx(S,{className:"text-white text-sm",children:"Show Subdivisions"}),e.jsx(u,{variant:f?"default":"outline",size:"sm",onClick:()=>K(!f),children:f?"ON":"OFF"})]})]})})]})]}),e.jsx("div",{className:"text-sm text-gray-400",children:"MIDI Controls Active â€¢ Performance Mode"})]})})]})}export{ke as PerformanceMode};
