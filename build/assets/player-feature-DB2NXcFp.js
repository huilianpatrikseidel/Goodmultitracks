import{r as g,j as e,R as W,a as kr}from"./react-vendor-BoGJM_Cg.js";import{D as bt,a as yt,b as jt,c as wt,d as Nt,B as Xe,S as es,e as Ee,f as I,P as Qe,g as xt,L as _,I as Ie,h as Pe,i as Ae,j as De,k as Fe,l as je,E as Mr,T as As,m as Ds,n as nt,o as at,p as ts,q as Fs,M as Sr,G as Tr,r as Rs,s as Er,t as Pr,A as ss,u as Ar,v as Dr,C as cs,w as Fr,Z as Rr,x as Ir,y as Is,z as $r,F as Br,H as Lr,J as Or,U as zr,K as Vr,N as _r,O as Gr,Q as Wr,R as ds,V as us,W as ms,X as Hr,Y as qr,_ as $s,$ as qt}from"./library-feature-aYpkCHpW.js";import{z as Kr,A as Ur,B as Xr,E as Zr,F as Yr,G as Qr,H as Jr,J as en,K as tn,M as sn,N as rn,Q as nn,U as an,W as on,X as ln,Y as cn,Z as dn,_ as un,$ as mn,a0 as hn,a1 as fn}from"./ui-vendor-1btjq6i-.js";import{t as Te}from"./toast-vendor-CHPPPCQ6.js";import{f as gt,g as ot,s as rs,a as xn,b as Pt}from"./audio-processing-DdlKDC9D.js";const pn={library:"Library",setlists:"Setlists",settings:"Settings",songLibrary:"Song Library",searchSongs:"Search songs...",importProject:"Import Project",createNew:"Create New",songs:"songs",duration:"Duration",tempo:"Tempo",tracks:"tracks",play:"Play",edit:"Edit",delete:"Delete",addToSetlist:"Add to Setlist",setlistManager:"Setlist Manager",searchSetlists:"Search setlists...",createSetlist:"Create Setlist",setlistName:"Setlist Name",noSetlists:"No setlists yet",createFirstSetlist:"Create your first setlist to organize your songs",editSetlist:"Edit Setlist",deleteSetlist:"Delete Setlist",addSongs:"Add Songs",removeSong:"Remove from setlist",backToLibrary:"Back to Library",performanceMode:"Performance Mode",editMode:"Edit Mode",master:"Master",volume:"Volume",pan:"Pan",solo:"Solo",mute:"Mute",metronome:"Metronome",metronomeVolume:"Metronome Volume",time:"Time (mm:ss)",chords:"Chords",sections:"Sections",measures:"Measures",insertChord:"Insert Chord",insertSection:"Insert Section",insertTempo:"Insert Tempo/Time Sig",exitPerformance:"Exit Performance Mode",previous:"Previous",next:"Next",upNext:"Up Next",appSettings:"App Settings",appearance:"Appearance",theme:"Theme",light:"Light",dark:"Dark",system:"System",language:"Language",english:"English",portuguese:"Portuguese",audio:"Audio",audioOutput:"Audio Output Device",bufferSize:"Buffer Size",sampleRate:"Sample Rate",midi:"MIDI",midiInput:"MIDI Input Device",enableMidi:"Enable MIDI Control",midiChannel:"MIDI Channel",playPause:"Play/Pause",stop:"Stop",skipForward:"Skip Forward",skipBackward:"Skip Backward",about:"About",version:"Version",cancel:"Cancel",save:"Save",create:"Create",close:"Close",confirm:"Confirm",createProject:"Create New Project",projectName:"Project Name",artist:"Artist",defaultTempo:"Default Tempo",timeSignature:"Time Signature",selectSetlist:"Select a setlist",addToExisting:"Add to existing setlist",editTimeline:"Edit Timeline",chordInsertion:"Chord Insertion",sectionInsertion:"Section Insertion",tempoInsertion:"Tempo/Time Signature Insertion",position:"Position",chord:"Chord",section:"Section",tempoValue:"Tempo",root:"Root",accidental:"Accidental",quality:"Quality",major:"Major",minor:"Minor",augmented:"Augmented",diminished:"Diminished",dominant7:"Dominant 7th",major7:"Major 7th",minor7:"Minor 7th",extension:"Extension",none:"None",ninth:"9th",eleventh:"11th",thirteenth:"13th",bassNote:"Bass Note",customizeDiagram:"Customize Diagram",guitar:"Guitar",ukulele:"Ukulele",piano:"Piano",intro:"Intro",verse:"Verse",chorus:"Chorus",bridge:"Bridge",outro:"Outro",interlude:"Interlude",preChorus:"Pre-Chorus",notes:"Notes",songNotes:"Song notes and reminders...",confirmDelete:"Are you sure you want to delete this?",confirmDeleteSong:"Are you sure you want to delete this song?",confirmDeleteSetlist:"Are you sure you want to delete this setlist?",noSongsInLibrary:"No songs in your library",importFirstSong:"Import your first song to get started",clickFretsToPlace:"Click on frets to place fingers, click string labels to mute/unmute",clickToMute:"Click string labels to mute/unmute",greenCircles:"Green circles = open/active strings",redCircles:"Red circles with ✕ = muted strings",blueDots:"Blue dots = finger positions",clickPianoKeys:"Click on piano keys to build your chord",selectedNotes:"Selected notes:",clickToToggle:"Click keys to toggle selection",blueDotsFingers:"Blue dots show finger positions on the fretboard"},Bs=g.createContext(void 0);function wo({children:t}){const r={t:pn};return e.jsx(Bs.Provider,{value:r,children:t})}function dt(){const t=g.useContext(Bs);if(t===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return t}const Ne={TRACK_HEIGHT:"goodmultitracks_track_height",ZOOM_LEVEL:"goodmultitracks_zoom_level",RULER_ORDER:"goodmultitracks_ruler_order",METRONOME_FREQUENCIES:"metronome_frequencies",THEME:"goodmultitracks_theme",LANGUAGE:"goodmultitracks_language",MAIN_INSTRUMENT:"goodmultitracks_main_instrument",FIRST_TIME_SETUP_COMPLETE:"goodmultitracks_first_time_setup"};function Le(t,r){try{const s=localStorage.getItem(t);return s===null?r:typeof r!="string"?JSON.parse(s):s}catch(s){return console.warn(`Failed to read from localStorage: ${t}`,s),r}}function Oe(t,r){try{const s=typeof r=="string"?r:JSON.stringify(r);return localStorage.setItem(t,s),!0}catch(s){return console.warn(`Failed to write to localStorage: ${t}`,s),!1}}function gn(t){try{return localStorage.removeItem(t),!0}catch(r){return console.warn(`Failed to remove from localStorage: ${t}`,r),!1}}const $e={getTrackHeight:()=>Le(Ne.TRACK_HEIGHT,"medium"),setTrackHeight:t=>Oe(Ne.TRACK_HEIGHT,t),getZoomLevel:()=>Le(Ne.ZOOM_LEVEL,1),setZoomLevel:t=>Oe(Ne.ZOOM_LEVEL,t),getRulerVisibility:t=>{const r=`goodmultitracks_show_${t}_ruler`;return Le(r,!0)},setRulerVisibility:(t,r)=>{const s=`goodmultitracks_show_${t}_ruler`;return Oe(s,r)},getRulerOrder:()=>Le(Ne.RULER_ORDER,["time","measures","sections","chords","tempo"]),setRulerOrder:t=>Oe(Ne.RULER_ORDER,t),getMetronomeFrequencies:()=>Le(Ne.METRONOME_FREQUENCIES,{strongBeat:1e3,normalBeat:800,subdivision:600}),setMetronomeFrequencies:t=>Oe(Ne.METRONOME_FREQUENCIES,t),getTheme:()=>Le(Ne.THEME,"dark"),setTheme:t=>Oe(Ne.THEME,t),getLanguage:()=>Le(Ne.LANGUAGE,"pt"),setLanguage:t=>Oe(Ne.LANGUAGE,t),getMainInstrument:()=>Le(Ne.MAIN_INSTRUMENT,null),setMainInstrument:t=>t?Oe(Ne.MAIN_INSTRUMENT,t):gn(Ne.MAIN_INSTRUMENT),isFirstTimeSetupComplete:()=>Le(Ne.FIRST_TIME_SETUP_COMPLETE,!1),setFirstTimeSetupComplete:()=>Oe(Ne.FIRST_TIME_SETUP_COMPLETE,!0)},Ls=g.createContext(void 0),No=({children:t})=>{const r=g.useRef(null),s=()=>(r.current||(r.current=new(window.AudioContext||window.webkitAudioContext)),r.current),n=async()=>{const a=s();a.state==="suspended"&&await a.resume()},o=async()=>{r.current&&r.current.state==="running"&&await r.current.suspend()};g.useEffect(()=>()=>{r.current&&r.current.state!=="closed"&&(r.current.close(),r.current=null)},[]);const i={audioContext:r.current,getAudioContext:s,resumeAudioContext:n,suspendAudioContext:o};return e.jsx(Ls.Provider,{value:i,children:t})},vn=()=>{const t=g.useContext(Ls);if(!t)throw new Error("useAudioContext must be used within an AudioContextProvider");return t};class st{static instance;waveforms=new Map;mediums=new Map;overviews=new Map;listeners=new Set;notifyTimeout=null;constructor(){}static getInstance(){return st.instance||(st.instance=new st),st.instance}subscribe(r){return this.listeners.add(r),()=>this.listeners.delete(r)}notify(){this.notifyTimeout&&clearTimeout(this.notifyTimeout),this.notifyTimeout=setTimeout(()=>{this.listeners.forEach(r=>{try{r()}catch(s){console.error("Error in waveform store listener:",s)}}),this.notifyTimeout=null},0)}setWaveform(r,s){this.waveforms.set(r,s),this.notify()}getWaveform(r){return this.waveforms.get(r)}setOverview(r,s){this.overviews.set(r,s),this.notify()}getOverview(r){return this.overviews.get(r)}setMedium(r,s){this.mediums.set(r,s),this.notify()}getMedium(r){return this.mediums.get(r)}clear(){this.waveforms.clear(),this.mediums.clear(),this.overviews.clear(),this.notify()}has(r){return this.waveforms.has(r)}delete(r){this.waveforms.delete(r),this.mediums.delete(r),this.overviews.delete(r),this.notify()}}const Et=st.getInstance(),Vt=[{category:"Playback",items:[{keys:["Space"],description:"Play / Pause"},{keys:["Home"],description:"Go to start"},{keys:["End"],description:"Go to end"},{keys:["R"],description:"Reset to start"},{keys:["←"],description:"Jump backward 5 seconds"},{keys:["→"],description:"Jump forward 5 seconds"},{keys:["Shift","←"],description:"Previous section"},{keys:["Shift","→"],description:"Next section"}]},{category:"View",items:[{keys:["+"],description:"Zoom in"},{keys:["-"],description:"Zoom out"},{keys:["0"],description:"Reset zoom"}]},{category:"Tools",items:[{keys:["L"],description:"Toggle loop"},{keys:["M"],description:"Toggle metronome"}]}];function bn({isOpen:t,onClose:r}){return e.jsx(bt,{open:t,onOpenChange:r,children:e.jsxs(yt,{className:"max-w-2xl",children:[e.jsxs(jt,{children:[e.jsx(wt,{children:"Keyboard Shortcuts"}),e.jsx(Nt,{children:"Use these keyboard shortcuts to navigate and control the player efficiently"})]}),e.jsx("div",{className:"space-y-6 py-4",children:Vt.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700",children:s.category}),e.jsx("div",{className:"space-y-2",children:s.items.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm text-gray-600",children:n.description}),e.jsx("div",{className:"flex gap-1",children:n.keys.map((i,a)=>e.jsxs(W.Fragment,{children:[a>0&&e.jsx("span",{className:"text-gray-400 mx-1",children:"+"}),e.jsx(Xe,{variant:"secondary",className:"font-mono px-2 py-1 bg-gray-100 text-gray-700 border",children:i})]},a))})]},o))}),s.category!==Vt[Vt.length-1].category&&e.jsx(es,{className:"mt-4"})]},s.category))}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"Tip:"})," Most shortcuts won't work when typing in text fields"]})]})})}function pt({className:t,...r}){return e.jsx(Kr,{"data-slot":"switch",className:Ee("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(Ur,{"data-slot":"switch-thumb",className:Ee("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const ns={C:261.63,"C#":277.18,Db:277.18,D:293.66,"D#":311.13,Eb:311.13,E:329.63,F:349.23,"F#":369.99,Gb:369.99,G:392,"G#":415.3,Ab:415.3,A:440,"A#":466.16,Bb:466.16,B:493.88};let _t=null;function $t(){return _t||(_t=new(window.AudioContext||window.webkitAudioContext)),_t}function as(t,r,s,n=.3){const o=$t(),i=o.createOscillator(),a=o.createGain();i.type="sine",i.frequency.setValueAtTime(t,s),a.gain.setValueAtTime(0,s),a.gain.linearRampToValueAtTime(n,s+.01),a.gain.exponentialRampToValueAtTime(n*.7,s+.1),a.gain.setValueAtTime(n*.7,s+r-.1),a.gain.exponentialRampToValueAtTime(.01,s+r),i.connect(a),a.connect(o.destination),i.start(s),i.stop(s+r)}function Kt(t,r=1.5,s=.25){const o=$t().currentTime;t.forEach(i=>{const a=ns[i];a&&as(a,r,o,s)})}function Ut(t,r=1.5){const s=["E","A","D","G","B","E"];t.forEach((i,a)=>{});const o=$t().currentTime;t.forEach((i,a)=>{if(i>=0){const l=s[a],h=ns[l];if(h){const m=h*Math.pow(2,i/12);as(m,r,o+a*.03,.15)}}})}function Xt(t,r=1.5){const s=["G","C","E","A"],o=$t().currentTime;t.forEach((i,a)=>{if(i>=0){const l=s[a],h=ns[l];if(h){const m=h*Math.pow(2,i/12);as(m,r,o+a*.03,.2)}}})}function yn({frets:t,fingers:r,startFret:s=1,onChange:n}){const{t:o}=dt(),i=["E","A","D","G","B","e"],a=5,l=(c,u)=>{const p=[...t],x=[...r],f=u===0?0:u+s-1;if(p[c]===f)p[c]=0,x[c]=0;else{p[c]=f;const v=[-1,-1,-1,-1,-1,-1];v[c]=f,Ut(v,.5),f>0?x[c]=Math.min(4,u):x[c]=0}n(p,x)},h=c=>{const u=[...t],p=[...r];u[c]===-1?(u[c]=0,p[c]=0):(u[c]=-1,p[c]=0),n(u,p)},m=()=>{Ut(t)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:o.clickFretsToPlace}),e.jsxs(I,{variant:"outline",size:"sm",onClick:m,className:"gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Play"]})]}),e.jsxs("svg",{width:"240",height:"320",viewBox:"0 0 240 320",className:"border rounded-lg bg-card",role:"img","aria-label":"Interactive guitar fretboard diagram",children:[[...Array(a)].map((c,u)=>e.jsx("line",{x1:"50",y1:70+u*40,x2:"210",y2:70+u*40,stroke:"hsl(var(--muted-foreground))",strokeWidth:u===0?"4":"2"},`fret-${u}`)),[...Array(6)].map((c,u)=>e.jsx("line",{x1:50+u*32,y1:"70",x2:50+u*32,y2:"230",stroke:"hsl(var(--muted-foreground))",strokeWidth:"2"},`string-${u}`)),s>1&&e.jsxs("text",{x:"25",y:"90",fontSize:"14",fill:"hsl(var(--foreground))",textAnchor:"middle",fontWeight:"600",children:[s,"fr"]}),i.map((c,u)=>{const p=50+u*32,x=t[u]===-1;return e.jsxs("g",{children:[e.jsx("rect",{x:p-12,y:"260",width:"24",height:"24",fill:"transparent",cursor:"pointer",onClick:()=>h(u),role:"button","aria-label":`${c} string${x?" (muted)":" (open)"}`,tabIndex:0,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),h(u))}}),e.jsx("text",{x:p,y:"275",fontSize:"14",fill:x?"hsl(var(--muted-foreground))":"hsl(var(--foreground))",textAnchor:"middle",cursor:"pointer",onClick:()=>h(u),style:{userSelect:"none"},children:c})]},`label-${u}`)}),t.map((c,u)=>{const p=50+u*32;if(c===-1)return e.jsxs("g",{children:[e.jsx("circle",{cx:p,cy:"45",r:"9",fill:"hsl(var(--destructive))"}),e.jsx("line",{x1:p-4,y1:"41",x2:p+4,y2:"49",stroke:"hsl(var(--destructive-foreground))",strokeWidth:"2"}),e.jsx("line",{x1:p+4,y1:"41",x2:p-4,y2:"49",stroke:"hsl(var(--destructive-foreground))",strokeWidth:"2"})]},`marker-${u}`);if(c===0)return e.jsx("circle",{cx:p,cy:"45",r:"7",fill:"none",stroke:"#22c55e",strokeWidth:"2.5"},`marker-${u}`);{const x=c-s+1;if(x>=1&&x<=a){const f=70+(x-.5)*40,v=r[u];return e.jsxs("g",{children:[e.jsx("circle",{cx:p,cy:f,r:"11",fill:"hsl(var(--primary))"}),v>0&&e.jsx("text",{x:p,y:f+5,fontSize:"13",fill:"hsl(var(--primary-foreground))",textAnchor:"middle",fontWeight:"600",children:v})]},`marker-${u}`)}return null}}),[...Array(6)].map((c,u)=>[...Array(a)].map((p,x)=>{const f=50+u*32,v=70+x*40,y=x+1;return e.jsx("rect",{x:f-16,y:v-20,width:"32",height:"40",fill:"transparent",cursor:"pointer",onClick:()=>l(u,y)},`click-${u}-${x}`)})),[...Array(6)].map((c,u)=>{const p=50+u*32;return e.jsx("rect",{x:p-16,y:"30",width:"32",height:"30",fill:"transparent",cursor:"pointer",onClick:()=>l(u,0)},`open-${u}`)})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 text-center max-w-xs",children:[e.jsxs("p",{children:["• ",o.greenCircles]}),e.jsxs("p",{children:["• ",o.redCircles]}),e.jsxs("p",{children:["• ",o.blueDots]})]})]})}function jn({frets:t,fingers:r,startFret:s=1,onChange:n}){const{t:o}=dt(),i=["G","C","E","A"],a=5,l=(m,c)=>{const u=[...t],p=[...r],x=c===0?0:c+s-1;if(u[m]===x)u[m]=0,p[m]=0;else{u[m]=x;const f=[-1,-1,-1,-1];f[m]=x,Xt(f,.5),x>0?p[m]=Math.min(4,c):p[m]=0}n(u,p)},h=()=>{Xt(t)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:o.clickFretsToPlace}),e.jsxs(I,{variant:"outline",size:"sm",onClick:h,className:"gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Play"]})]}),e.jsxs("svg",{width:"200",height:"320",viewBox:"0 0 200 320",className:"border rounded-lg bg-card",children:[[...Array(a)].map((m,c)=>e.jsx("line",{x1:"50",y1:70+c*40,x2:"170",y2:70+c*40,stroke:"hsl(var(--muted-foreground))",strokeWidth:c===0?"4":"2"},`fret-${c}`)),[...Array(4)].map((m,c)=>e.jsx("line",{x1:50+c*40,y1:"70",x2:50+c*40,y2:"230",stroke:"hsl(var(--muted-foreground))",strokeWidth:"2"},`string-${c}`)),s>1&&e.jsxs("text",{x:"25",y:"90",fontSize:"14",fill:"hsl(var(--foreground))",textAnchor:"middle",fontWeight:"600",children:[s,"fr"]}),i.map((m,c)=>{const u=50+c*40;return e.jsx("text",{x:u,y:"275",fontSize:"14",fill:"hsl(var(--foreground))",textAnchor:"middle",style:{userSelect:"none"},children:m},`label-${c}`)}),t.map((m,c)=>{const u=50+c*40;if(m===0)return e.jsx("circle",{cx:u,cy:"45",r:"7",fill:"none",stroke:"#22c55e",strokeWidth:"2.5"},`marker-${c}`);{const p=m-s+1;if(p>=1&&p<=a){const x=70+(p-.5)*40,f=r[c];return e.jsxs("g",{children:[e.jsx("circle",{cx:u,cy:x,r:"11",fill:"hsl(var(--primary))"}),f>0&&e.jsx("text",{x:u,y:x+5,fontSize:"13",fill:"hsl(var(--primary-foreground))",textAnchor:"middle",fontWeight:"600",children:f})]},`marker-${c}`)}return null}}),[...Array(4)].map((m,c)=>[...Array(a)].map((u,p)=>{const x=50+c*40,f=70+p*40,v=p+1;return e.jsx("rect",{x:x-20,y:f-20,width:"40",height:"40",fill:"transparent",cursor:"pointer",onClick:()=>l(c,v)},`click-${c}-${p}`)})),[...Array(4)].map((m,c)=>{const u=50+c*40;return e.jsx("rect",{x:u-20,y:"30",width:"40",height:"30",fill:"transparent",cursor:"pointer",onClick:()=>l(c,0)},`open-${c}`)})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center max-w-xs",children:e.jsxs("p",{children:["• ",o.blueDotsFingers]})})]})}function wn({keys:t,onChange:r}){const{t:s}=dt(),n=g.useRef(null),o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],a=[...o.map(x=>`${x}4`),...i.map(x=>`${x}5`)];g.useEffect(()=>{n.current&&(n.current.scrollLeft=200)},[]);const l=x=>{Kt([m(x)],.5);const f=[...t],v=f.indexOf(x);v>-1?f.splice(v,1):f.push(x),r(f)},h=(x,f)=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),l(f))},m=x=>x.replace(/[0-9]/g,""),c=x=>x.includes("#"),u=x=>x.startsWith("C"),p=()=>{const x=t.map(f=>m(f));Kt(x)};return e.jsxs("div",{className:"flex flex-col items-center space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.clickPianoKeys}),e.jsxs(I,{variant:"outline",size:"sm",onClick:p,className:"gap-2",disabled:t.length===0,children:[e.jsx(Qe,{className:"w-4 h-4"}),"Play"]})]}),e.jsx("div",{className:"w-full max-w-full overflow-x-auto border rounded-lg bg-muted/30 p-4",ref:n,children:e.jsxs("svg",{width:"860",height:"200",viewBox:"0 0 860 200",className:"min-w-[860px]",role:"img","aria-label":"Interactive piano keyboard diagram",children:[a.filter(x=>!c(m(x))).map((x,f)=>{const v=20+f*56,y=t.includes(x),k=u(x);return e.jsxs("g",{children:[e.jsx("rect",{x:v,y:"20",width:"54",height:"150",fill:y?"hsl(var(--primary))":"hsl(var(--background))",stroke:k?"hsl(var(--destructive))":"hsl(var(--border))",strokeWidth:k?"3":"2",rx:"4",cursor:"pointer",onClick:()=>l(x),onKeyDown:b=>h(b,x),role:"button","aria-label":`${m(x)} key${y?" (selected)":""}`,tabIndex:0}),k&&e.jsx("circle",{cx:v+27,cy:"155",r:"4",fill:y?"hsl(var(--primary-foreground))":"hsl(var(--destructive))"}),e.jsx("text",{x:v+27,y:"140",fontSize:"12",fill:y?"hsl(var(--primary-foreground))":"hsl(var(--muted-foreground))",textAnchor:"middle",cursor:"pointer",onClick:()=>l(x),style:{userSelect:"none"},children:m(x)})]},`white-${x}`)}),a.filter(x=>c(m(x))).map(x=>{const f=m(x),v=x.replace(/[^0-9]/g,""),y=parseInt(v)-4;let k=0;f==="C#"?k=0:f==="D#"?k=1:f==="F#"?k=3:f==="G#"?k=4:f==="A#"&&(k=5);const T=20+(y*7+k)*56+40,w=t.includes(x);return e.jsx("rect",{x:T,y:"20",width:"28",height:"95",fill:w?"hsl(var(--primary))":"hsl(var(--foreground))",stroke:"hsl(var(--border))",strokeWidth:"2",role:"button","aria-label":`${f} sharp key${w?" (selected)":""}`,tabIndex:0,rx:"3",cursor:"pointer",onKeyDown:N=>h(N,x),onClick:()=>l(x)},`black-${x}`)})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 text-center max-w-md",children:[e.jsxs("p",{children:[e.jsx("strong",{children:s.selectedNotes})," ",t.length>0?t.join(", "):s.none]}),e.jsx("p",{className:"opacity-70",children:s.clickToToggle}),e.jsx("p",{className:"opacity-70 italic",children:"Red markers indicate C notes • Scroll horizontally to view all keys"})]})]})}const Nn=["C","D","E","F","G","A","B"],Os={C:0,D:1,E:2,F:3,G:4,A:5,B:6},Zt=[0,2,4,5,7,9,11],d={P1:{id:"P1",semitones:0,degree:0,quality:"P"},A1:{id:"A1",semitones:1,degree:0,quality:"A"},AA1:{id:"AA1",semitones:2,degree:0,quality:"AA"},d2:{id:"d2",semitones:0,degree:1,quality:"d"},m2:{id:"m2",semitones:1,degree:1,quality:"m"},M2:{id:"M2",semitones:2,degree:1,quality:"M"},A2:{id:"A2",semitones:3,degree:1,quality:"A"},AA2:{id:"AA2",semitones:4,degree:1,quality:"AA"},dd3:{id:"dd3",semitones:1,degree:2,quality:"dd"},d3:{id:"d3",semitones:2,degree:2,quality:"d"},m3:{id:"m3",semitones:3,degree:2,quality:"m"},M3:{id:"M3",semitones:4,degree:2,quality:"M"},A3:{id:"A3",semitones:5,degree:2,quality:"A"},d4:{id:"d4",semitones:4,degree:3,quality:"d"},P4:{id:"P4",semitones:5,degree:3,quality:"P"},A4:{id:"A4",semitones:6,degree:3,quality:"A"},AA4:{id:"AA4",semitones:7,degree:3,quality:"AA"},dd5:{id:"dd5",semitones:5,degree:4,quality:"dd"},d5:{id:"d5",semitones:6,degree:4,quality:"d"},P5:{id:"P5",semitones:7,degree:4,quality:"P"},A5:{id:"A5",semitones:8,degree:4,quality:"A"},AA5:{id:"AA5",semitones:9,degree:4,quality:"AA"},dd6:{id:"dd6",semitones:6,degree:5,quality:"dd"},d6:{id:"d6",semitones:7,degree:5,quality:"d"},m6:{id:"m6",semitones:8,degree:5,quality:"m"},M6:{id:"M6",semitones:9,degree:5,quality:"M"},A6:{id:"A6",semitones:10,degree:5,quality:"A"},dd7:{id:"dd7",semitones:8,degree:6,quality:"dd"},dim7:{id:"dim7",semitones:9,degree:6,quality:"d"},m7:{id:"m7",semitones:10,degree:6,quality:"m"},M7:{id:"M7",semitones:11,degree:6,quality:"M"},A7:{id:"A7",semitones:12,degree:6,quality:"A"},d8:{id:"d8",semitones:11,degree:7,quality:"d"},P8:{id:"P8",semitones:12,degree:7,quality:"P"},b9:{id:"b9",semitones:13,degree:8,quality:"m"},9:{id:"9",semitones:14,degree:8,quality:"M"},"#9":{id:"#9",semitones:15,degree:8,quality:"A"},11:{id:"11",semitones:17,degree:10,quality:"P"},"#11":{id:"#11",semitones:18,degree:10,quality:"A"},b13:{id:"b13",semitones:20,degree:12,quality:"m"},13:{id:"13",semitones:21,degree:12,quality:"M"}};function zs(t){const r=t.match(/^([A-G])(x|#+|b+)?(\d*)$/);if(!r)throw new Error(`Invalid note format: ${t}`);const s=r[1],n=r[2]||"",o=r[3]?parseInt(r[3]):void 0;let i=0;return n==="x"?i=2:n.startsWith("#")?i=n.length:n.startsWith("b")&&(i=-n.length),{letter:s,accidentalStr:n,accidentalValue:i,octave:o}}function Cn(t){return t===0?"":t===1?"#":t===2?"x":t===-1?"b":t===-2?"bb":t===3?"#x":t===-3?"bbb":t>0?"#".repeat(t):"b".repeat(Math.abs(t))}function hs(t){const{letter:r,accidentalValue:s}=zs(t),n=Os[r];return(Zt[n]+s+12)%12}function At(t,r){const s=t.replace(/\d+$/,""),n=r.replace(/\d+$/,"");return s===n?!0:hs(s)===hs(n)}const kn={0:"P1",1:"A1",2:"M2",3:"A2",4:"M3",5:"P4",6:"A4",7:"P5",8:"A5",9:"M6",10:"A6",11:"M7"},Mn={0:"P1",1:"m2",2:"M2",3:"m3",4:"M3",5:"P4",6:"d5",7:"P5",8:"m6",9:"M6",10:"m7",11:"M7"};function Ye(t,r){const s=typeof r=="string"?d[r]:r;if(!s)return console.error(`Invalid interval: ${r}`),t;const{letter:n,accidentalValue:o,octave:i}=zs(t),a=Os[n],l=(a+s.degree)%7,h=Nn[l];let m=Zt[l]-Zt[a];m<0&&(m+=12);const u=o+s.semitones-m;let p=i;if(i!==void 0){const x=s.degree,f=a+x>=7,v=Math.floor(s.degree/7);p=i+(f?1:0)+v}return`${h}${Cn(u)}${p!==void 0?p:""}`}function Dt(t,r,s){if(r===0)return t;const n=t.match(/^([A-G][#b]?)(.*)/);if(!n)return t;const[,o,i]=n,a=(r%12+12)%12;let l;{const c=["C","G","D","A","E","B","F#","C#","G#","D#","A#"],u=o.replace(/\d+$/,"");l=c.includes(u)||o.includes("#")}const h=l?kn[a]:Mn[a];return h?Ye(o,h)+i:(console.error(`Invalid semitone value: ${a}`),t)}const Sn={"":[d.P1,d.M3,d.P5],m:[d.P1,d.m3,d.P5],dim:[d.P1,d.m3,d.d5],aug:[d.P1,d.M3,d.A5],sus2:[d.P1,d.M2,d.P5],sus4:[d.P1,d.P4,d.P5],"7sus2":[d.P1,d.M2,d.P5,d.m7],"7sus4":[d.P1,d.P4,d.P5,d.m7],7:[d.P1,d.M3,d.P5,d.m7],maj7:[d.P1,d.M3,d.P5,d.M7],m7:[d.P1,d.m3,d.P5,d.m7],dim7:[d.P1,d.m3,d.d5,d.dim7],m7b5:[d.P1,d.m3,d.d5,d.m7],aug7:[d.P1,d.M3,d.A5,d.m7],mMaj7:[d.P1,d.m3,d.P5,d.M7],9:[d.P1,d.M3,d.P5,d.m7,d[9]],maj9:[d.P1,d.M3,d.P5,d.M7,d[9]],m9:[d.P1,d.m3,d.P5,d.m7,d[9]],"7b9":[d.P1,d.M3,d.P5,d.m7,d.b9],"7#9":[d.P1,d.M3,d.P5,d.m7,d["#9"]],11:[d.P1,d.P5,d.m7,d[9],d[11]],"11(no3)":[d.P1,d.P5,d.m7,d[9],d[11]],m11:[d.P1,d.m3,d.P5,d.m7,d[9],d[11]],"7#11":[d.P1,d.M3,d.P5,d.m7,d["#11"]],"maj7#11":[d.P1,d.M3,d.P5,d.M7,d["#11"]],maj11:[d.P1,d.M3,d.P5,d.M7,d[9],d["#11"]],alt:[d.P1,d.M3,d.d5,d.m7,d.b9],"7alt":[d.P1,d.M3,d.d5,d.m7,d.b9],"7b5b9":[d.P1,d.M3,d.d5,d.m7,d.b9],"7#5#9":[d.P1,d.M3,d.A5,d.m7,d["#9"]],"7b5#9":[d.P1,d.M3,d.d5,d.m7,d["#9"]],"7#5b9":[d.P1,d.M3,d.A5,d.m7,d.b9],13:[d.P1,d.M3,d.P5,d.m7,d[9],d[13]],maj13:[d.P1,d.M3,d.P5,d.M7,d[9],d[13]],m13:[d.P1,d.m3,d.P5,d.m7,d[9],d[13]],"7b13":[d.P1,d.M3,d.P5,d.m7,d.b13],add9:[d.P1,d.M3,d.P5,d[9]],madd9:[d.P1,d.m3,d.P5,d[9]],6:[d.P1,d.M3,d.P5,d.M6],m6:[d.P1,d.m3,d.P5,d.M6],"6/9":[d.P1,d.M3,d.P5,d.M6,d[9]]};function Ct(t,r="",s){let n=r;const o=Sn[n];return o?o.map(i=>Ye(t,i)):(console.warn(`Unknown chord quality: ${n}. Defaulting to major triad.`),Ct(t,""))}function Tn(t,r=""){return Ct(t,r)}const Vs=[{value:"natural",label:xt.accidentalNatural,symbol:""},{value:"sharp",label:xt.accidentalSharp,symbol:"#"},{value:"flat",label:xt.accidentalFlat,symbol:"b"}],_s=[{value:"major",label:"Major",suffix:""},{value:"minor",label:"Minor",suffix:"m"},{value:"diminished",label:"Diminished",suffix:"dim"},{value:"augmented",label:"Augmented",suffix:"aug"},{value:"sus2",label:"Suspended 2nd",suffix:"sus2"},{value:"sus4",label:"Suspended 4th",suffix:"sus4"}],Gs=[{value:"none",label:"None",suffix:""},{value:"7",label:"Dominant 7th",suffix:"7"},{value:"maj7",label:"Major 7th",suffix:"maj7"},{value:"9",label:"9th",suffix:"9"},{value:"maj9",label:"Major 9th",suffix:"maj9"},{value:"11",label:"11th",suffix:"11"},{value:"13",label:"13th",suffix:"13"},{value:"6",label:"6th",suffix:"6"},{value:"add9",label:"Add 9",suffix:"add9"}],Ve=(t="")=>{if(!t)return{root:"C",accidental:"natural",quality:"major",extension:"none",bassNote:"",isPolychord:!1};const[r,s]=t.split("/");let n=s||"",o=!1,i;if(s){const h=/^([A-G])([#b]?)(maj|m|min|dim|aug|sus2|sus4)?(13|11|9|7|6|add9|maj9|maj7)?(.*)$/,m=s.match(h);m&&(m[3]||m[4])?(o=!0,i=Ve(s)):n=s}const a=/^([A-G])([#b]?)(2|maj|m|min|dim|aug|sus2|sus4)?(13|11|9|7|6|add9|maj9|maj7)?(.*)$/,l=r.match(a);if(l){const[,h,m,c,u]=l,p=m==="#"?"sharp":m==="b"?"flat":"natural";let x="major";c==="m"||c==="min"?x="minor":c==="dim"?x="diminished":c==="aug"?x="augmented":c==="sus2"||c==="2"?x="sus2":c==="sus4"?x="sus4":c==="maj"&&!u?.startsWith("maj")&&(x="major");let f="none";return c==="maj"&&u==="7"?f="maj7":c==="maj"&&u==="9"?f="maj9":u==="7"?f="7":u==="9"?f="9":u==="11"?f="11":u==="13"?f="13":u==="6"?f="6":u==="add9"&&(f="add9"),{root:h,accidental:p,quality:x,extension:f,bassNote:n,isPolychord:o,upperChord:i}}else return console.warn("Could not parse chord name accurately:",t),{root:t[0]||"C",accidental:"natural",quality:"major",extension:"none",bassNote:"",isPolychord:!1}},En=(t,r,s,n,o)=>{const i=Vs.find(m=>m.value===r)?.symbol||"",a=_s.find(m=>m.value===s)?.suffix||"",l=Gs.find(m=>m.value===n)?.suffix||"";let h=l;return n==="maj7"&&s!=="major"?h="maj7":n==="maj9"&&s!=="major"?h="maj9":(s==="major"&&(n==="maj7"||n==="maj9")||s==="major"&&n!=="none"||s!=="major"&&n!=="none")&&(h=l),`${t}${i}${a}${h}${o?"/"+o:""}`},Pn={major:[d.P1,d.M2,d.M3,d.P4,d.P5,d.M6,d.M7],minor:[d.P1,d.M2,d.m3,d.P4,d.P5,d.m6,d.m7],"harmonic-minor":[d.P1,d.M2,d.m3,d.P4,d.P5,d.m6,d.M7],"melodic-minor-asc":[d.P1,d.M2,d.m3,d.P4,d.P5,d.M6,d.M7],"melodic-minor-desc":[d.P1,d.M2,d.m3,d.P4,d.P5,d.m6,d.m7],dorian:[d.P1,d.M2,d.m3,d.P4,d.P5,d.M6,d.m7],phrygian:[d.P1,d.m2,d.m3,d.P4,d.P5,d.m6,d.m7],lydian:[d.P1,d.M2,d.M3,d.A4,d.P5,d.M6,d.M7],mixolydian:[d.P1,d.M2,d.M3,d.P4,d.P5,d.M6,d.m7],locrian:[d.P1,d.m2,d.m3,d.P4,d.d5,d.m6,d.m7],"pentatonic-major":[d.P1,d.M2,d.M3,d.P5,d.M6],"pentatonic-minor":[d.P1,d.m3,d.P4,d.P5,d.m7],blues:[d.P1,d.m3,d.P4,d.d5,d.P5,d.m7],"whole-tone":[d.P1,d.M2,d.M3,d.A4,d.A5,{id:"A6",semitones:10,degree:5,quality:"A"}],"diminished-whole-half":[d.P1,d.M2,d.m3,d.P4,d.d5,d.m6,{id:"dim7",semitones:9,degree:6,quality:"d"},d.M7],"diminished-half-whole":[d.P1,d.m2,d.m3,d.M3,d.A4,d.P5,d.M6,d.m7],"bebop-major":[d.P1,d.M2,d.M3,d.P4,d.P5,d.A5,d.M6,d.M7],"bebop-dominant":[d.P1,d.M2,d.M3,d.P4,d.P5,d.M6,d.m7,d.M7],"bebop-minor":[d.P1,d.M2,d.m3,d.M3,d.P4,d.P5,d.M6,d.m7],"bebop-harmonic-minor":[d.P1,d.M2,d.m3,d.P4,d.P5,d.m6,d.m7,d.M7],altered:[d.P1,d.m2,d.m3,d.M3,d.d5,d.m6,d.m7],augmented:[d.P1,d.m3,d.M3,d.P5,d.A5,d.M7]};function Je(t,r="major"){const s=Pn[r];return s?s.map(n=>Ye(t,n)):(console.warn(`Unknown scale: ${r}. Using major scale.`),Je(t,"major"))}function fs(t,r,s="major"){const n=Je(r,s),o=t.replace(/\d+$/,"");return n.some(i=>{const a=i.replace(/\d+$/,"");return a===o||At(a,o)})}const it={C:{guitar:{frets:[-1,3,2,0,1,0],fingers:[0,3,2,0,1,0]},piano:{keys:["C","E","G"]},ukulele:{frets:[0,0,0,3],fingers:[0,0,0,3]}},D:{guitar:{frets:[-1,-1,0,2,3,2],fingers:[0,0,0,1,3,2]},piano:{keys:["D","F#","A"]},ukulele:{frets:[2,2,2,0],fingers:[1,1,1,0]}},E:{guitar:{frets:[0,2,2,1,0,0],fingers:[0,2,3,1,0,0]},piano:{keys:["E","G#","B"]},ukulele:{frets:[4,4,4,2],fingers:[3,3,3,1]}},F:{guitar:{frets:[1,3,3,2,1,1],fingers:[1,3,4,2,1,1]},piano:{keys:["F","A","C"]},ukulele:{frets:[2,0,1,0],fingers:[2,0,1,0]}},G:{guitar:{frets:[3,2,0,0,0,3],fingers:[3,2,0,0,0,4]},piano:{keys:["G","B","D"]},ukulele:{frets:[0,2,3,2],fingers:[0,1,3,2]}},A:{guitar:{frets:[-1,0,2,2,2,0],fingers:[0,0,1,2,3,0]},piano:{keys:["A","C#","E"]},ukulele:{frets:[2,1,0,0],fingers:[2,1,0,0]}},B:{guitar:{frets:[-1,2,4,4,4,2],fingers:[0,1,2,3,4,1]},piano:{keys:["B","D#","F#"]},ukulele:{frets:[4,3,2,2],fingers:[4,3,1,2]}},"C#":{guitar:{frets:[-1,4,6,6,6,4],fingers:[0,1,3,4,4,1],startFret:1},piano:{keys:["C#","F","G#"]},ukulele:{frets:[1,1,1,4],fingers:[1,1,1,4]}},"D#":{guitar:{frets:[-1,-1,1,3,4,3],fingers:[0,0,1,2,4,3]},piano:{keys:["D#","G","A#"]},ukulele:{frets:[0,3,3,1],fingers:[0,3,4,1]}},"F#":{guitar:{frets:[2,4,4,3,2,2],fingers:[1,3,4,2,1,1]},piano:{keys:["F#","A#","C#"]},ukulele:{frets:[3,1,2,1],fingers:[3,1,2,1]}},"G#":{guitar:{frets:[4,6,6,5,4,4],fingers:[1,3,4,2,1,1]},piano:{keys:["G#","C","D#"]},ukulele:{frets:[5,3,4,3],fingers:[3,1,2,1]}},"A#":{guitar:{frets:[-1,1,3,3,3,1],fingers:[0,1,2,3,4,1]},piano:{keys:["A#","D","F"]},ukulele:{frets:[3,2,1,1],fingers:[3,2,1,1]}},Db:{guitar:{frets:[-1,4,6,6,6,4],fingers:[0,1,3,4,4,1],startFret:1},piano:{keys:["Db","F","Ab"]},ukulele:{frets:[1,1,1,4],fingers:[1,1,1,4]}},Eb:{guitar:{frets:[-1,-1,1,3,4,3],fingers:[0,0,1,2,4,3]},piano:{keys:["Eb","G","Bb"]},ukulele:{frets:[0,3,3,1],fingers:[0,3,4,1]}},Gb:{guitar:{frets:[2,4,4,3,2,2],fingers:[1,3,4,2,1,1]},piano:{keys:["Gb","Bb","Db"]},ukulele:{frets:[3,1,2,1],fingers:[3,1,2,1]}},Ab:{guitar:{frets:[4,6,6,5,4,4],fingers:[1,3,4,2,1,1]},piano:{keys:["Ab","C","Eb"]},ukulele:{frets:[5,3,4,3],fingers:[3,1,2,1]}},Bb:{guitar:{frets:[-1,1,3,3,3,1],fingers:[0,1,2,3,4,1]},piano:{keys:["Bb","D","F"]},ukulele:{frets:[3,2,1,1],fingers:[3,2,1,1]}},Am:{guitar:{frets:[-1,0,2,2,1,0],fingers:[0,0,2,3,1,0]},piano:{keys:["A","C","E"]},ukulele:{frets:[2,0,0,0],fingers:[1,0,0,0]}},Bm:{guitar:{frets:[-1,2,4,4,3,2],fingers:[0,1,3,4,2,1]},piano:{keys:["B","D","F#"]},ukulele:{frets:[4,2,2,2],fingers:[4,1,1,1]}},Cm:{guitar:{frets:[-1,3,5,5,4,3],fingers:[0,1,3,4,2,1]},piano:{keys:["C","Eb","G"]},ukulele:{frets:[0,3,3,3],fingers:[0,1,1,1]}},Dm:{guitar:{frets:[-1,-1,0,2,3,1],fingers:[0,0,0,2,3,1]},piano:{keys:["D","F","A"]},ukulele:{frets:[2,2,1,0],fingers:[2,3,1,0]}},Em:{guitar:{frets:[0,2,2,0,0,0],fingers:[0,2,3,0,0,0]},piano:{keys:["E","G","B"]},ukulele:{frets:[0,4,3,2],fingers:[0,4,3,2]}},Fm:{guitar:{frets:[1,3,3,1,1,1],fingers:[1,3,4,1,1,1]},piano:{keys:["F","Ab","C"]},ukulele:{frets:[1,0,1,3],fingers:[1,0,2,4]}},Gm:{guitar:{frets:[3,5,5,3,3,3],fingers:[1,3,4,1,1,1]},piano:{keys:["G","Bb","D"]},ukulele:{frets:[0,2,3,1],fingers:[0,2,3,1]}}},xs=["C","D","E","F","G","A","B"],ps=[{value:"1",label:"1 (Whole Note)"},{value:"2",label:"2 (Half Note)"},{value:"3",label:"3 (Triplet Half Note)"},{value:"4",label:"4 (Quarter Note)"},{value:"6",label:"6 (Triplet Quarter Note)"},{value:"8",label:"8 (Eighth Note)"},{value:"12",label:"12 (Triplet Eighth Note)"},{value:"16",label:"16 (Sixteenth Note)"},{value:"32",label:"32 (32nd Note)"}],An=[{numerator:"4",denominator:"4",label:"4/4 (Common Time)"},{numerator:"3",denominator:"4",label:"3/4 (Waltz)"},{numerator:"6",denominator:"8",label:"6/8"},{numerator:"2",denominator:"4",label:"2/4"},{numerator:"5",denominator:"4",label:"5/4"},{numerator:"7",denominator:"8",label:"7/8"},{numerator:"9",denominator:"8",label:"9/8"},{numerator:"12",denominator:"8",label:"12/8"}],ze=t=>{switch(t){case 1:return"whole";case 2:return"half";case 4:return"quarter";case 8:return"eighth";case 16:return"sixteenth";case 32:return"32nd"}return t===3||t===6?"quarter":t===12?"eighth":t<2?"whole":t<4?"half":t<8?"quarter":t<16?"eighth":t<32?"sixteenth":"32nd"},Dn=t=>{if(!t.includes("+"))return null;const r=t.split("+").map(n=>parseInt(n.trim(),10));return r.some(n=>isNaN(n)||n<=0)?null:{total:r.reduce((n,o)=>n+o,0),grouping:r}},vt=(t,r,s,n="default",o="auto")=>{let i="simple",a,l,h,m,c=[];if(typeof t=="string"){const x=Dn(t);if(x){h=x.total,m=x.total,i="irregular",c=x.grouping,l=x.grouping.length,a=ze(r);const f=r===6?2/3:r===12?1/3:1,v=h/r*4*f;return{numerator:h,denominator:r,type:i,beatUnit:a,beatsPerMeasure:l,pulsesPerMeasure:m,grouping:c,beatRatio:f!==1?f:void 0,measureDurationInQuarters:v}}else h=parseInt(t,10),isNaN(h)&&(h=4)}else h=t;if(m=h,s)i="irregular",c=s.split("+").map(Number),l=c.length,a=ze(r);else if(h%3===0&&h>=6&&h<=15&&h!==3)o==="simple"?(i="simple",l=h,a=ze(r),c=Array(l).fill(1)):o==="compound"?(i="compound",l=h/3,r===8?a="dotted-quarter":r===4?a="dotted-half":r===16?a="dotted-eighth":a=ze(r),c=Array(l).fill(3)):n==="very-slow"&&h===6?(i="simple",l=h,a=ze(r),c=Array(l).fill(1)):(i="compound",l=h/3,r===8?a="dotted-quarter":r===4?a="dotted-half":r===16?a="dotted-eighth":a=ze(r),c=Array(l).fill(3));else{const x=Ws(h);n==="fast"&&h===3?(i="simple",l=1,a=ze(r),c=[3]):x.length>0?(i="irregular",c=x[0].split("+").map(Number),l=c.length,a=ze(r)):(i="simple",l=h,a=ze(r),c=Array(l).fill(1))}let u;(r===6||r===12||r===3)&&(u=2/3);const p=h/r*4*(u||1);return{numerator:h,denominator:r,type:i,beatUnit:a,beatsPerMeasure:l,pulsesPerMeasure:m,grouping:c,beatRatio:u,measureDurationInQuarters:p}},Fn=t=>{const r=[],s=new Set;function n(o,i){if(o===t){const a=i.join(",");s.has(a)||(s.add(a),r.push([...i]));return}o>t||(n(o+3,[...i,3]),n(o+2,[...i,2]))}return n(0,[]),r},Ws=(t,r)=>{const s=t<=4,n=t%3===0&&t>=6&&t<=15&&t!==3;return s||n?[]:Fn(t).map(i=>i.join("+"))};function rt(t){const r=t.match(/^([A-G])(#{1,3}|b{1,3}|x)?(-?\d+)$/);if(!r)return 60;const[,s,n="",o]=r;let a={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[s];return n==="x"||n==="##"?a+=2:n==="###"?a+=3:a+=(n.match(/#/g)||[]).length,a-=(n.match(/b/g)||[]).length,a+(parseInt(o)+1)*12}const Yt={standard:["E","A","D","G","B","E"],"drop-d":["D","A","D","G","B","E"],"drop-c":["C","G","C","F","A","D"],dadgad:["D","A","D","G","A","D"],"open-g":["D","G","D","G","B","D"],"open-d":["D","A","D","F#","A","D"],"eb-standard":["Eb","Ab","Db","Gb","Bb","Eb"],"half-step-down":["Eb","Ab","Db","Gb","Bb","Eb"]};function Rn(t){return{"B#":"C","E#":"F",Cb:"B",Fb:"E","C##":"D","D##":"E","E##":"F#","F##":"G","G##":"A","A##":"B","B##":"C#",Dbb:"C",Ebb:"D",Fbb:"Eb",Gbb:"F",Abb:"G",Bbb:"A",Cbb:"Bb"}[t]||t}function ct(t){const r=Rn(t);return{C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[r]??0}function os(t,r){return ct(t)===ct(r)}function gs(t,r,s=15){const n=[],o=ct(t);return r.forEach((i,a)=>{const l=ct(i);for(let h=0;h<=s;h++)(l+h)%12===o&&n.push({string:a,fret:h,note:t})}),n}function In(t,r,s){const n=s?.maxFret,o=s?.maxResults;if(t.map(m=>gs(m,r,n)).some(m=>m.length===0))return[];const a=[],l=r.length;function h(m,c,u,p){if(!(a.length>=o*3)){if(m===l){const x=u.map(v=>v.note),f=t.every(v=>x.some(y=>os(y,v)));if(u.length>=3&&f){const v=$n(c,u,r,s);a.push({frets:c,positions:u,score:v})}return}h(m+1,[...c,-1],u,p);for(const x of t){const f=gs(x,[r[m]],n);for(const v of f){if(u.length>0){const y=c.filter(k=>k>0);if(y.length>0){const k=Math.min(...y),b=Math.max(...y);if(v.fret>0&&(v.fret<k-4||v.fret>b+4))continue}}h(m+1,[...c,v.fret],[...u,{...v,string:m}],new Set([...p,x]))}}}}return h(0,[],[],new Set),a.sort((m,c)=>m.score.total-c.score.total).slice(0,o)}function $n(t,r,s,n){const o=t.filter(b=>b>0),i=t.filter(b=>b===-1).length;let a=0;if(o.length>0){const b=Math.min(...o),w=Math.max(...o)-b;w===0?a=0:w===1?a=5:w===2?a=10:w===3?a=20:w===4?a=40:a=80}let l=0;const h=new Map;o.forEach(b=>{h.set(b,(h.get(b)||0)+1)});for(const[b,T]of h)T>=3&&(l+=20,T>=5&&(l+=15));let m=i*5,c=0;for(let b=1;b<t.length-1;b++)if(t[b]===-1){const T=t[b-1]>0,w=t[b+1]>0;T&&w&&(t[b-1]===t[b+1]||(c+=15))}m+=c;let u=0;const p=[...r].sort((b,T)=>{const w=rt(b.note),N=rt(T.note);return w-N});for(let b=0;b<p.length-1;b++){const T=p[b].note,w=p[b+1].note,N=rt(T),M=rt(w)-N;if(N<43&&M>0&&M<=4){const E=Math.max(0,43-N)/10;u+=10*E}}u=Math.min(40,u);let x=0;if(n?.bassNote){const b=r.reduce((T,w)=>w.string<T.string?w:T,r[0]);os(b.note,n.bassNote)?x=-15:x=10}let f=0;if(n?.previousVoicing){let b=0,T=0;t.forEach((w,N)=>{const C=n.previousVoicing[N];if(w===-1||C===-1)return;const M=Math.abs(w-C);T+=M,M===0&&b++}),f=T*2-b*5}const v=o.length>0?o.reduce((b,T)=>b+T,0)/o.length:0,y=v>7?(v-7)*2:0,k=a+l+m+x+f+y+u;return{fingerStretch:a,barreComplexity:l,mutedStrings:m,bassNote:x,voiceLeading:f,lowIntervalPenalty:u,total:k}}function Bn(t){const r=t.map(a=>a===-1||a===0?0:1),s=t.filter(a=>a>0);if(s.length===0)return r;const n=Math.min(...s);Math.max(...s);const o=new Map;t.forEach((a,l)=>{a>0&&(o.has(a)||o.set(a,0),o.set(a,o.get(a)+1))});let i=-1;for(const[a,l]of o)if(l>=3&&a===n){i=a;break}return t.map((a,l)=>{if(a===-1||a===0)return 0;if(i!==-1&&a===i)return 1;const h=a-n;return Math.min(h+1,4)})}function Ln(t,r){const s=r?.tuning||Yt.standard;if(!r?.tuning||r.tuning===Yt.standard){const h=t[0],m=it[h];if(m?.guitar){const c=m.guitar,u=[];if(c.frets.forEach((x,f)=>{if(x>=0){const v=s[f],k=(ct(v)+x)%12;for(const b of t)if(ct(b)===k&&!u.includes(b)){u.push(b);break}}}),t.every(x=>u.some(f=>os(f,x))))return m.guitar}}const n=In(t,s,{maxFret:r?.maxFret||15,bassNote:r?.bassNote||t[0],maxResults:10});if(n.length===0)return console.warn("generateGuitarVoicing: Could not generate any valid voicings for notes:",t),null;const o=n[0],i=Bn(o.frets),a=o.frets.filter(h=>h>0),l=a.length>0?Math.min(...a):void 0;return{frets:o.frets,fingers:i,startFret:l&&l>1?l:void 0}}function On(t){const r=t[0];return it[r]?.ukulele||null}function zn(t,r){if(t.length===0)return{keys:[]};const s=2,n=4,o=[],i=[];if(i.push(`${t[0]}${s}`),t.length>1){const a=rt(`${t[0]}${s}`),l=`${t[1]}${s}`,h=rt(l),m=Math.abs(h-a);if(a<52&&m>0&&m<=4){const c=s+1;for(let u=1;u<t.length;u++)i.push(`${t[u]}${c}`);o.push("Adjusted voicing to avoid muddy low intervals (moved 3rd up one octave)")}else if(t.length>=3){i.push(`${t[1]}${s}`);for(let c=2;c<t.length;c++)i.push(`${t[c]}${n}`)}else i.push(`${t[1]}${n}`)}return o.length>0?{keys:i,warnings:o}:{keys:i}}function Vn(t,r){if(t.length===0)return{leftHand:[],rightHand:[]};let o=[],i=[],a;{o.push(`${t[0]}2`),t.length>=3&&o.push(`${t[2]||t[1]}2`),t.length>=2&&i.push(`${t[1]}4`);for(let l=3;l<t.length;l++)i.push(`${t[l]}${4+(l>5?1:0)}`);t.length===3&&i.push(`${t[0]}5`),t.length>=5&&(a="Consider rolling chord for medium hands")}return{leftHand:o,rightHand:i,playabilityNote:a}}const Hs=["I","II","III","IV","V","VI","VII"],_n=["i","ii°","III","iv","v","VI","VII"];function _e(t,r,s="major"){const n=Je(r,s),i=String(t).replace(/\d+$/,""),l=n.map(m=>m.replace(/\d+$/,"")).indexOf(i);return l===-1?null:s==="minor"||s==="harmonic-minor"||s==="melodic-minor-asc"?_n[l]:Hs[l]}function ft(t,r,s="major"){const o=Je(r,s).map(i=>i.replace(/\d+$/,""));return t.every(i=>{const a=i.replace(/\d+$/,"");return o.includes(a)})}function Gn(t,r,s="major"){const n=Ve(t),o=n.root+(n.accidental==="sharp"?"#":n.accidental==="flat"?"b":"");let i="";n.quality==="minor"?i="m":n.quality==="diminished"?i="dim":n.quality==="augmented"&&(i="aug"),n.extension!=="none"&&(i+=n.extension);const a=Ct(o,i),m=Je(r,s).map(x=>x.replace(/\d+$/,"")).findIndex(x=>x===o||At(x,o)),c=ft(a,r,s),u=_e(o,r,s);let p;return m===-1?Hn(t,r,s).isSecondary?p="secondary":p="chromatic":c?s==="major"?m===0||m===5?p="tonic":m===3||m===1?p="subdominant":m===4||m===6?p="dominant":p="tonic":m===0||m===2?p="tonic":m===3||m===1?p="subdominant":m===4||m===6?p="dominant":p="tonic":p="borrowed",{function:p,romanNumeral:u||(m>=0?Hs[m]:null),scaleDegree:m>=0?m+1:null,isDiatonic:c,notes:a,quality:i||"major"}}function Wn(t,r,s="major"){const n=Ve(t),o=n.root+(n.accidental==="sharp"?"#":n.accidental==="flat"?"b":"");let i="";n.quality==="minor"?i="m":n.quality==="diminished"?i="dim":n.quality==="augmented"&&(i="aug"),n.extension!=="none"&&(i+=n.extension);const a=Ct(o,i);if(ft(a,r,s))return{isBorrowed:!1};const m=s==="major"?"minor":"major";if(ft(a,r,m)){const u=_e(o,r,m);return{isBorrowed:!0,sourceKey:r,sourceMode:m,explanation:`${u||"?"} from parallel ${m}`}}if(s==="major"){const u=Ye(r,"m6");if(ft(a,u,"minor")){const x=_e(o,u,"minor");return{isBorrowed:!0,sourceKey:u,sourceMode:"minor",explanation:`${x||"?"} from relative minor (${u})`}}}else{const u=Ye(r,"m3");if(ft(a,u,"major")){const x=_e(o,u,"major");return{isBorrowed:!0,sourceKey:u,sourceMode:"major",explanation:`${x||"?"} from relative major (${u})`}}}return{isBorrowed:!1}}function Hn(t,r,s="major"){const n=Ve(t),o=n.root+(n.accidental==="sharp"?"#":n.accidental==="flat"?"b":""),i=n.extension==="7"&&n.quality==="major",a=n.quality==="diminished",l=n.extension==="m7b5";if(!i&&!a&&!l)return{isSecondary:!1};const m=Je(r,s).map(c=>c.replace(/\d+$/,""));for(let c=0;c<m.length;c++){const u=m[c],p=Ye(u,"P5"),x=Ye(u,"M7");if(At(o,p)&&i){const f=_e(u,r,s);return{isSecondary:!0,targetChord:u,targetDegree:c+1,romanNumeral:`V7/${f||c+1}`,type:"dominant",explanation:`Secondary dominant resolving to ${f||u}`}}if(At(o,x)&&(a||l)){const f=_e(u,r,s),v=a?"vii°":"viiø7";return{isSecondary:!0,targetChord:u,targetDegree:c+1,romanNumeral:`${v}/${f||c+1}`,type:l?"half-diminished":"leading-tone",explanation:`Secondary leading tone resolving to ${f||u}`}}}return{isSecondary:!1}}function vs(t){const r=[],s=[],n=[];for(let o=0;o<t.pulsesPerMeasure;o++)s.push(o);if(t.type==="compound"){const o=t.beatsPerMeasure,i=t.numerator/o;for(let a=0;a<o;a++)r.push(a*i);for(let a=0;a<t.pulsesPerMeasure;a++)a===0?n.push(2):r.includes(a)?n.push(1):n.push(0)}else if(t.type==="irregular"){let o=0;for(const i of t.grouping)r.push(o),o+=i;for(let i=0;i<t.pulsesPerMeasure;i++)i===0?n.push(2):r.includes(i)?n.push(1):n.push(0)}else{for(let o=0;o<t.beatsPerMeasure;o++)r.push(o);for(let o=0;o<t.pulsesPerMeasure;o++)o===0?n.push(2):t.beatsPerMeasure===4&&o===2?n.push(1):n.push(0)}return{macroBeats:r,allPulses:s,accentLevels:n}}const qn=[{value:"intro",label:"Intro"},{value:"verse",label:"Verse"},{value:"chorus",label:"Chorus"},{value:"bridge",label:"Bridge"},{value:"outro",label:"Outro"},{value:"pre-chorus",label:"Pre-Chorus"},{value:"instrumental",label:"Instrumental"},{value:"tag",label:"Tag"},{value:"custom",label:"Custom"}];function Kn({open:t,onOpenChange:r,type:s,currentTime:n,initialData:o,onSubmit:i}){const{t:a}=dt(),l=!!o,[h,m]=g.useState("0"),[c,u]=g.useState("120"),[p,x]=g.useState("4"),[f,v]=g.useState("4"),[y,k]=g.useState(!1),[b,T]=g.useState(""),[w,N]=g.useState("verse"),[C,M]=g.useState(""),[E,P]=g.useState("C"),[z,G]=g.useState("natural"),[$,J]=g.useState("major"),[fe,ue]=g.useState("none"),[te,se]=g.useState(""),[re,L]=g.useState(!1),[ne,ee]=g.useState([-1,3,2,0,1,0]),[ae,U]=g.useState([0,3,2,0,1,0]),[me,Ce]=g.useState(1),[Me,H]=g.useState([0,0,0,3]),[Z,O]=g.useState([0,0,0,3]),[V,S]=g.useState(1),[R,F]=g.useState(["C","E","G"]),[A,K]=g.useState(0),[q,Y]=g.useState(""),[Q,X]=g.useState(!1),[xe,pe]=g.useState("linear"),[he,ie]=g.useState("120"),[Re,ge]=g.useState("0"),[le,ut]=g.useState("simple"),Ge=()=>{m(n.toFixed(2)),u("120"),x("4"),v("4"),k(!1),T(""),N("verse"),M(""),P("C"),G("natural"),J("major"),ue("none"),se(""),L(!1);const j=it.C;ee(j?.guitar.frets||[-1,3,2,0,1,0]),U(j?.guitar.fingers||[0,3,2,0,1,0]),Ce(j?.guitar.startFret||1),H(j?.ukulele.frets||[0,0,0,3]),O(j?.ukulele.fingers||[0,0,0,3]),S(1),F(j?.piano.keys||["C","E","G"]),K(0),Y(""),X(!1),pe("linear"),ie("120"),ge("0")};g.useEffect(()=>{if(t)if(l&&o)if(m(o.time.toFixed(2)),s==="chord"){const j=o,D=Ve(j.chord);if(P(D.root),G(D.accidental),J(D.quality),ue(D.extension),se(D.bassNote),M(j.chord),j.customDiagram)L(!0),ee(j.customDiagram.guitar.frets),U(j.customDiagram.guitar.fingers),Ce(j.customDiagram.guitar.startFret||1),H(j.customDiagram.ukulele.frets),O(j.customDiagram.ukulele.fingers),S(j.customDiagram.ukulele.startFret||1),F(j.customDiagram.piano.keys),K(j.customDiagram.capo||0);else{L(!1);const oe=j.chord.split("/")[0],ce=it[oe];ee(ce?.guitar?.frets||[-1,-1,-1,-1,-1,-1]),U(ce?.guitar?.fingers||[0,0,0,0,0,0]),Ce(ce?.guitar?.startFret||1),H(ce?.ukulele?.frets||[0,0,0,0]),O(ce?.ukulele?.fingers||[0,0,0,0]),S(1),F(ce?.piano?.keys||[]),K(0)}}else if(s==="tempo"&&"tempo"in o){const j=o;u(String(j.tempo)),k(j.hidden||!1),Y(j.subdivision||""),j.curve&&(X(!0),pe(j.curve.type),ie(String(j.curve.targetTempo)),ge(String(j.curve.targetTime)))}else if(s==="timesig"&&"timeSignature"in o){const j=o,[D,oe]=j.timeSignature.split("/");x(D),v(oe),k(j.hidden||!1),Y(j.subdivision||"")}else s==="section"&&"label"in o&&(T(o.label),N(o.type||"custom"));else Ge()},[t,l,o,s,n]),g.useEffect(()=>{const j=parseInt(p),D=parseInt(f);if(!isNaN(j)&&!isNaN(D)){const oe=vt(j,D,q);ut(oe.type)}},[p,f,q]),g.useEffect(()=>{if(s==="chord"){const j=En(E,z,$,fe,te);M(j)}},[E,z,$,fe,te,s]),g.useEffect(()=>{if(s==="chord"&&C&&!re){const j=C.split("/")[0],D=it[j];D&&(ee(D.guitar?.frets||[-1,-1,-1,-1,-1,-1]),U(D.guitar?.fingers||[0,0,0,0,0,0]),Ce(D.guitar?.startFret||1),H(D.ukulele?.frets||[0,0,0,0]),O(D.ukulele?.fingers||[0,0,0,0]),S(1),F(D.piano?.keys||[]))}},[C,s,re]);const We=()=>{const j=parseFloat(h);if(isNaN(j)||j<0){Te.error("Please enter a valid time");return}let D={time:j};switch(s){case"tempo":const oe=parseInt(c);if(isNaN(oe)||oe<1){Te.error("Please enter a valid tempo (BPM)");return}if(D.tempo=oe,D.timeSignature=`${p}/${f}`,D.hidden=y,D.subdivision=q.trim()||void 0,Q){const Be=parseInt(he),Ke=parseFloat(Re);if(isNaN(Be)||Be<1){Te.error("Please enter a valid target tempo (BPM)");return}if(isNaN(Ke)||Ke<=j){Te.error("Target time must be greater than start time");return}D.curve={type:xe,targetTempo:Be,targetTime:Ke}}break;case"timesig":const ce=parseInt(p),ke=parseInt(f);if(isNaN(ce)||isNaN(ke)||ce<1||ke<1||!Number.isInteger(Math.log2(ke))){Te.error("Please enter a valid time signature (e.g., 4/4, 3/4, 6/8)");return}D.timeSignature=`${ce}/${ke}`,D.tempo=l&&o&&"tempo"in o?o.tempo:parseInt(c),D.hidden=y,D.subdivision=q.trim()||void 0;break;case"section":if(!b.trim()){Te.error("Please enter a section label");return}D.label=b.trim(),D.type=w;break;case"chord":if(!C.trim()){Te.error("Chord name is empty or invalid");return}D.chord=C.trim(),re?D.customDiagram={guitar:{frets:ne,fingers:ae,startFret:me},ukulele:{frets:Me,fingers:Z,startFret:V},piano:{keys:R},capo:A>0?A:void 0}:D.customDiagram=void 0;break}i(l?"update":"add",D)},He=()=>{l&&i("delete",{})},qe=()=>{switch(s){case"tempo":return"Add Tempo";case"timesig":return"Add Time Sig";case"section":return"Add Section";case"chord":return"Add Chord";default:return"Add Item"}},mt=()=>{switch(s){case"tempo":return"Add tempo marker";case"timesig":return"Add time signature marker";case"section":return"Add section marker";case"chord":return"Add chord marker";default:return""}};return e.jsx(bt,{open:t,onOpenChange:r,children:e.jsxs(yt,{className:s==="chord"?"sm:max-w-[600px] max-h-[90vh] overflow-y-auto":"sm:max-w-[450px]",children:[e.jsxs(jt,{children:[e.jsx(wt,{children:l?`Edit ${s}`:qe()}),e.jsx(Nt,{children:mt()})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"time",children:"Time (seconds)"}),e.jsx(Ie,{id:"time",type:"number",step:"0.01",value:h,onChange:j=>m(j.target.value)})]}),s==="tempo"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"tempo",children:"Tempo (BPM)"}),e.jsx(Ie,{id:"tempo",type:"number",placeholder:"120",value:c,onChange:j=>u(j.target.value)})]}),e.jsxs("div",{className:"space-y-3 border border-[#2B2B2B] rounded-md p-3",children:[e.jsx(_,{className:"text-sm font-semibold",children:"Time Signature"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"ts-num",className:"text-xs text-muted-foreground",children:"Numerator"}),e.jsx(Ie,{id:"ts-num",type:"number",min:"1",max:"32",value:p,onChange:j=>x(j.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"ts-den",className:"text-xs text-muted-foreground",children:"Denominator"}),e.jsxs(Pe,{value:f,onValueChange:v,children:[e.jsx(Ae,{id:"ts-den",children:e.jsx(De,{})}),e.jsx(Fe,{children:ps.map(j=>e.jsx(je,{value:j.value,children:j.value},j.value))})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Type: ",e.jsx("span",{className:"font-semibold text-primary capitalize",children:le})]}),le==="irregular"&&e.jsx("div",{className:"flex items-center gap-2 flex-1 justify-end",children:e.jsx("div",{className:"text-xs font-mono bg-black/20 px-2 py-1 rounded border border-white/10",children:q||"Default"})})]}),e.jsx("div",{className:"pt-2",children:e.jsx(bs,{numerator:parseInt(p)||4,denominator:parseInt(f)||4,subdivision:q,onSubdivisionChange:Y})})]}),e.jsxs("div",{className:"space-y-3 border border-[#2B2B2B] rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pt,{id:"enable-curve",checked:Q,onCheckedChange:X}),e.jsx(_,{htmlFor:"enable-curve",className:"text-sm cursor-pointer",children:"Enable Tempo Curve (Rallentando/Accelerando)"})]}),Q&&e.jsxs("div",{className:"space-y-3 pl-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"curve-type",className:"text-xs text-muted-foreground",children:"Curve Type"}),e.jsxs(Pe,{value:xe,onValueChange:j=>pe(j),children:[e.jsx(Ae,{id:"curve-type",children:e.jsx(De,{})}),e.jsxs(Fe,{children:[e.jsx(je,{value:"linear",children:"Linear (constant rate)"}),e.jsx(je,{value:"exponential",children:"Exponential (natural feel)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"target-tempo",className:"text-xs text-muted-foreground",children:"Target Tempo"}),e.jsx(Ie,{id:"target-tempo",type:"number",placeholder:"90",value:he,onChange:j=>ie(j.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"target-time",className:"text-xs text-muted-foreground",children:"Target Time (sec)"}),e.jsx(Ie,{id:"target-time",type:"number",step:"0.1",placeholder:"8.0",value:Re,onChange:j=>ge(j.target.value)})]})]}),e.jsxs("div",{className:"bg-[#1E1E1E] border border-[#2B2B2B] rounded-md p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Curve Preview:"}),parseInt(c)>parseInt(he)?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-yellow-500/20 text-yellow-400 border border-yellow-500/30",children:"Rallentando (slowing down)"}):parseInt(c)<parseInt(he)?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-orange-500/20 text-orange-400 border border-orange-500/30",children:"Accelerando (speeding up)"}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-500/20 text-gray-400 border border-gray-500/30",children:"No change"})]}),e.jsxs("div",{className:"relative w-full h-16 bg-[#171717] rounded border border-[#2B2B2B] overflow-hidden",children:[e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 200 60",preserveAspectRatio:"none",children:[e.jsx("line",{x1:"0",y1:"15",x2:"200",y2:"15",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("line",{x1:"0",y1:"30",x2:"200",y2:"30",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("line",{x1:"0",y1:"45",x2:"200",y2:"45",stroke:"#2B2B2B",strokeWidth:"0.5",strokeDasharray:"2,2"}),(()=>{const j=parseInt(c)||120,D=parseInt(he)||120,oe=Math.max(j,D,180),ce=Math.min(j,D,60),ke=oe-ce||1,Be=55-(j-ce)/ke*50,Ke=55-(D-ce)/ke*50;if(xe==="linear")return e.jsx("line",{x1:"10",y1:Be,x2:"190",y2:Ke,stroke:j>D?"#60a5fa":"#fb923c",strokeWidth:"2"});{const kt=[];for(let ht=0;ht<=20;ht++){const et=ht/20,Lt=j>D?1-Math.pow(1-et,2):Math.pow(et,2),Mt=j+(D-j)*Lt,Ot=10+et*180,zt=55-(Mt-ce)/ke*50;kt.push(`${Ot},${zt}`)}return e.jsx("polyline",{points:kt.join(" "),fill:"none",stroke:j>D?"#60a5fa":"#fb923c",strokeWidth:"2"})}})(),e.jsx("circle",{cx:"10",cy:(()=>{const j=parseInt(c)||120,D=parseInt(he)||120,oe=Math.max(j,D,180),ce=Math.min(j,D,60),ke=oe-ce||1;return 55-(j-ce)/ke*50})(),r:"3",fill:"#10b981"}),e.jsx("circle",{cx:"190",cy:(()=>{const j=parseInt(c)||120,D=parseInt(he)||120,oe=Math.max(j,D,180),ce=Math.min(j,D,60),ke=oe-ce||1;return 55-(D-ce)/ke*50})(),r:"3",fill:"#ef4444"})]}),e.jsxs("div",{className:"absolute top-1 left-2 text-[10px] text-yellow-400",children:[c," BPM"]}),e.jsxs("div",{className:"absolute top-1 right-2 text-[10px] text-red-400",children:[he," BPM"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs pt-1",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Duration: ",(parseFloat(Re)-parseFloat(h)).toFixed(2),"s"]}),e.jsxs("span",{className:"text-muted-foreground",children:["Change: ",Math.abs(parseInt(he)-parseInt(c))," BPM"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pt,{id:"hide-tempo",checked:y,onCheckedChange:k}),e.jsx(_,{htmlFor:"hide-tempo",className:"text-sm cursor-pointer",children:"Hide in player mode (show only in edit mode)"})]})]}),s==="timesig"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{children:"Time Signature"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"ts-preset",className:"text-xs text-muted-foreground",children:"Common Presets"}),e.jsxs(Pe,{value:`${p}/${f}`,onValueChange:j=>{const[D,oe]=j.split("/");x(D),v(oe)},children:[e.jsx(Ae,{id:"ts-preset",children:e.jsx(De,{})}),e.jsx(Fe,{children:An.map(j=>e.jsx(je,{value:`${j.numerator}/${j.denominator}`,children:j.label},j.label))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Custom Time Signature"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"ts-num",className:"text-xs text-muted-foreground",children:"Numerator (Beats)"}),e.jsx(Ie,{id:"ts-num",type:"number",min:"1",max:"32",value:p,onChange:j=>x(j.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"ts-den",className:"text-xs text-muted-foreground",children:"Denominator (Note Value)"}),e.jsxs(Pe,{value:f,onValueChange:v,children:[e.jsx(Ae,{id:"ts-den",children:e.jsx(De,{})}),e.jsx(Fe,{children:ps.map(j=>e.jsx(je,{value:j.value,children:j.label},j.value))})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Note Groups (Visual Feedback)"}),e.jsx(bs,{numerator:parseInt(p)||4,denominator:parseInt(f)||4,subdivision:q,onSubdivisionChange:Y})]}),le==="irregular"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-sm",children:"Beat Grouping (Drag to Rearrange)"}),(()=>{const j=parseInt(p),D=Ws(j);return D.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:D.map(oe=>e.jsx(I,{type:"button",variant:q===oe?"default":"outline",size:"sm",onClick:()=>Y(oe),className:"text-xs h-7",children:oe},oe))}):null})(),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"💡 Drag the note groups in the visualization above to rearrange beat grouping for this irregular time signature."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pt,{id:"hide-timesig",checked:y,onCheckedChange:k}),e.jsx(_,{htmlFor:"hide-timesig",className:"text-sm cursor-pointer",children:"Hide in player mode (show only in edit mode)"})]})]}),s==="section"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"section-type",children:"Section Type"}),e.jsxs(Pe,{value:w,onValueChange:N,children:[" ",e.jsx(Ae,{id:"section-type",children:e.jsx(De,{})})," ",e.jsx(Fe,{children:qn.map(j=>e.jsx(je,{value:j.value,children:j.label},j.value))})," "]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"section-label",children:"Section Label"}),e.jsx(Ie,{id:"section-label",value:b,onChange:j=>T(j.target.value)})]})]}),s==="chord"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 border p-4 rounded-md",children:[e.jsx(_,{className:"text-base font-medium",children:"Chord Builder"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"root-note",className:"text-xs text-muted-foreground",children:"Root"}),e.jsxs(Pe,{value:E,onValueChange:P,children:[e.jsx(Ae,{id:"root-note",children:e.jsx(De,{})}),e.jsx(Fe,{children:xs.map(j=>e.jsx(je,{value:j,children:j},j))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"accidental",className:"text-xs text-muted-foreground",children:"Accidental"}),e.jsxs(Pe,{value:z,onValueChange:G,children:[e.jsx(Ae,{id:"accidental",className:"music-notation",children:e.jsx(De,{})}),e.jsx(Fe,{children:Vs.map(j=>e.jsx(je,{value:j.value,className:"music-notation",children:j.label},j.value))})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"quality",className:"text-xs text-muted-foreground",children:"Quality"}),e.jsxs(Pe,{value:$,onValueChange:J,children:[e.jsx(Ae,{id:"quality",children:e.jsx(De,{})}),e.jsx(Fe,{children:_s.map(j=>e.jsx(je,{value:j.value,children:j.label},j.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"extension",className:"text-xs text-muted-foreground",children:"Extension"}),e.jsxs(Pe,{value:fe,onValueChange:ue,children:[e.jsx(Ae,{id:"extension",children:e.jsx(De,{})}),e.jsx(Fe,{children:Gs.map(j=>e.jsx(je,{value:j.value,children:j.label},j.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"bass-note",className:"text-xs text-muted-foreground",children:"Bass Note"}),e.jsxs(Pe,{value:te||"none",onValueChange:j=>se(j==="none"?"":j),children:[e.jsx(Ae,{id:"bass-note",children:e.jsx(De,{placeholder:"None"})}),e.jsxs(Fe,{children:[e.jsx(je,{value:"none",children:"None"}),xs.map(j=>e.jsxs(W.Fragment,{children:[e.jsx(je,{value:j,children:j}),e.jsx(je,{value:`${j}#`,className:"music-notation",children:`${j}${xt.accidentalSharp}`}),e.jsx(je,{value:`${j}b`,className:"music-notation",children:`${j}${xt.accidentalFlat}`})]},j))]})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx(_,{className:"text-xs text-muted-foreground",children:"Generated Chord"}),e.jsx("p",{className:"text-lg font-semibold",children:C||"-"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{type:"button",variant:"outline",onClick:()=>L(!re),className:"w-full",children:[" ",e.jsx(Mr,{className:"w-4 h-4 mr-2"})," ",re?"Hide":"Customize"," Diagrams "]}),re&&e.jsxs("div",{className:"border rounded-md p-4 space-y-4",children:[" ",e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"capo",children:"Capo Fret"}),e.jsx(Ie,{id:"capo",type:"number",min:"0",max:"12",value:A,onChange:j=>K(parseInt(j.target.value)||0)})]})," ",e.jsxs(As,{defaultValue:"guitar",children:[e.jsxs(Ds,{className:"grid w-full grid-cols-3",children:[" ",e.jsx(nt,{value:"guitar",children:"Guitar"})," ",e.jsx(nt,{value:"ukulele",children:"Ukulele"})," ",e.jsx(nt,{value:"piano",children:"Piano"})," "]}),e.jsxs(at,{value:"guitar",className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"guitar-start-fret",children:"Start Fret"}),e.jsx(Ie,{id:"guitar-start-fret",type:"number",min:"1",max:"15",value:me,onChange:j=>Ce(parseInt(j.target.value)||1)})]}),e.jsx(yn,{frets:ne,fingers:ae,startFret:me,onChange:(j,D)=>{ee(j),U(D)}})]}),e.jsxs(at,{value:"ukulele",className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"ukulele-start-fret",children:"Start Fret"}),e.jsx(Ie,{id:"ukulele-start-fret",type:"number",min:"1",max:"15",value:V,onChange:j=>S(parseInt(j.target.value)||1)})]}),e.jsx(jn,{frets:Me,fingers:Z,startFret:V,onChange:(j,D)=>{H(j),O(D)}})]}),e.jsxs(at,{value:"piano",className:"mt-4 space-y-3",children:[" ",e.jsx(wn,{keys:R,onChange:F})," "]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[l&&e.jsxs(I,{variant:"destructive",onClick:He,className:"mr-auto",children:[e.jsx(ts,{className:"w-4 h-4 mr-2"})," Delete"]}),e.jsx(I,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsx(I,{onClick:We,children:l?"Update":e.jsxs(e.Fragment,{children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"}),"Add"]})})]})]})})}const bs=({numerator:t,denominator:r,subdivision:s,onSubdivisionChange:n})=>{const o=vt(t,r,s),{grouping:i,type:a}=o,[l,h]=W.useState(i),[m,c]=W.useState(null),[u,p]=W.useState(null);W.useEffect(()=>{h(i)},[JSON.stringify(i)]);const x=60,f=50,v=40,y=35,k=(N,C)=>{a!=="irregular"||!n||(c(C),N.dataTransfer.effectAllowed="move")},b=(N,C)=>{if(N.preventDefault(),a!=="irregular"||!n||m===null||m===C)return;const M=[...l],[E]=M.splice(m,1);M.splice(C,0,E),h(M),c(C)},T=N=>{if(N.preventDefault(),a!=="irregular"||!n||m===null)return;c(null);const C=l.join("+");C!==s&&n(C)};return a==="irregular"&&n?e.jsxs("div",{className:"w-full p-4 bg-[#171717] rounded-md border border-[#2B2B2B] space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-lg",children:"✋"}),e.jsx("span",{children:"Drag beat groups to rearrange the meter pattern"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-[#1F1F1F] border border-[#333] rounded px-3 py-2",children:[e.jsx("span",{className:"text-2xl font-bold leading-none",children:t}),e.jsx("div",{className:"w-full h-[1px] bg-[#444] my-0.5"}),e.jsx("span",{className:"text-2xl font-bold leading-none",children:r})]}),e.jsx("div",{className:"text-2xl text-muted-foreground",children:"="}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:l.map((N,C)=>e.jsxs("div",{draggable:!0,onDragStart:M=>k(M,C),onDragEnter:M=>b(M,C),onDragEnd:T,onDragOver:M=>M.preventDefault(),className:`
                  flex items-center justify-center gap-1 px-4 py-3 rounded-lg border-2
                  transition-all duration-200 select-none
                  ${m===C?"opacity-40 scale-95 border-yellow-500/50 bg-yellow-500/10":"opacity-100 scale-100 border-[#333] bg-[#1F1F1F] hover:border-yellow-500/30 hover:bg-[#252525]"}
                  cursor-move
                `,children:[e.jsx("span",{className:"text-xl font-bold",children:N}),e.jsx("span",{className:"text-xs text-muted-foreground",children:N===3?"♩.":N===2?"♩":"♪"})]},C))})]}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground",children:["Pattern: ",l.join(" + ")," = ",t]})]}):e.jsx("div",{className:"w-full overflow-x-auto p-4 bg-[#171717] rounded-md border border-[#2B2B2B]",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("svg",{height:"80",width:Math.max(300,f+l.length*x+40),children:[e.jsx("line",{x1:"0",y1:v,x2:"100%",y2:v,stroke:"#444",strokeWidth:"1"}),e.jsx("text",{x:"10",y:v-5,fontFamily:"serif",fontSize:"24",fontWeight:"bold",fill:"#e5e5e5",children:t}),e.jsx("text",{x:"10",y:v+20,fontFamily:"serif",fontSize:"24",fontWeight:"bold",fill:"#e5e5e5",children:r}),l.map((N,C)=>{const M=f+40+C*x,E=[];let P=!0,z=!0,G=!1,$=!1;return r===8?N===3?(P=!0,z=!0,$=!0,G=!1):N===2?(P=!0,z=!0,$=!1,G=!1):(P=!0,z=!0,$=!1,G=!0):r===4?N===3?(P=!1,z=!0,$=!0,G=!1):N===2?(P=!1,z=!0,$=!1,G=!1):(P=!0,z=!0,$=!1,G=!1):r===2?N===1&&(P=!1,z=!0,$=!1,G=!1):r===1&&N===1&&(P=!1,z=!1,$=!1,G=!1),P?E.push(e.jsx("ellipse",{cx:M,cy:v,rx:"6",ry:"5",fill:"#e5e5e5",transform:`rotate(-15 ${M} ${v})`},`head-${C}`)):E.push(e.jsx("ellipse",{cx:M,cy:v,rx:"6",ry:"5",fill:"none",stroke:"#e5e5e5",strokeWidth:"2",transform:`rotate(-15 ${M} ${v})`},`head-${C}`)),z&&E.push(e.jsx("line",{x1:M+5,y1:v,x2:M+5,y2:v-y,stroke:"#e5e5e5",strokeWidth:"1.5"},`stem-${C}`)),$&&E.push(e.jsx("circle",{cx:M+12,cy:v,r:"2",fill:"#e5e5e5"},`dot-${C}`)),G&&E.push(e.jsx("path",{d:`M${M+5},${v-y} Q${M+15},${v-y+10} ${M+10},${v-y+25}`,fill:"none",stroke:"#e5e5e5",strokeWidth:"2"},`flag-${C}`)),e.jsx("g",{children:E},C)})]})})})};function is(t,r,s={}){const{tuning:n="standard",handSize:o="medium",startFret:i=0,preferOpen:a=!1,maxStretch:l=4,pianoStyle:h="compact"}=s;return g.useMemo(()=>{const m=Ve(t);if(!m)return console.warn(`[useChordVoicing] Failed to parse chord: ${t}`),null;const c=m.quality==="major"?"":m.quality,u=m.extension==="none"?"":m.extension,p=c+u,x=Ct(m.root,p),f=it[t];if(f){const y={notes:x,source:"database"};if(r==="guitar"&&f.guitar&&(y.guitar={...f.guitar,tuning:n}),r==="piano"&&f.piano&&(y.piano=f.piano),r==="ukulele"&&f.ukulele&&(y.ukulele=f.ukulele),y.guitar||y.piano||y.ukulele)return y}const v={notes:x,source:"generated"};try{switch(r){case"guitar":{const y=n==="standard"?"standard":n,k=Yt[y];if(!k)return console.warn(`[useChordVoicing] Unknown tuning: ${n}`),null;const b=Ln(x,{tuning:k,maxFret:i+l,preferredPosition:i});b&&(v.guitar={...b,tuning:y});break}case"piano":{if(h==="tenth"){const y=Vn(x);v.piano={keys:[...y.leftHand,...y.rightHand],leftHand:y.leftHand,rightHand:y.rightHand}}else if(h==="rootless"){const y=x.slice(1),k=Math.floor(y.length/2);v.piano={keys:y,leftHand:y.slice(0,k),rightHand:y.slice(k)}}else{const y=zn(x),k=Math.floor(y.keys.length/2);v.piano={keys:y.keys,leftHand:y.keys.slice(0,k),rightHand:y.keys.slice(k)}}break}case"ukulele":{const y=On(x);y&&(v.ukulele=y);break}}}catch(y){return console.error("[useChordVoicing] Error generating voicing:",y),null}return v},[t,r,n,o,i,a,l,h])}const Un=({chord:t,customData:r})=>{const s=is(t,"guitar"),{frets:n,fingers:o,startFret:i=1}=r||s?.guitar||{frets:[0,0,0,0,0,0],fingers:[0,0,0,0,0,0]},a=i;if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const l=["E","A","D","G","B","e"],h=()=>{Ut(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:h,className:"mb-3 gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"200",height:"280",viewBox:"0 0 200 280",className:"mb-2",children:[[...Array(5)].map((m,c)=>e.jsx("line",{x1:"40",y1:60+c*40,x2:"160",y2:60+c*40,stroke:"hsl(var(--muted-foreground))",strokeWidth:c===0&&a===1?"4":"2"},`fret-${c}`)),[...Array(6)].map((m,c)=>e.jsx("line",{x1:40+c*24,y1:"60",x2:40+c*24,y2:"220",stroke:"hsl(var(--muted-foreground))",strokeWidth:"2"},`string-${c}`)),a>1&&e.jsxs("text",{x:"20",y:"65",fontSize:"14",fill:"hsl(var(--muted-foreground))",children:[a,"fr"]}),l.map((m,c)=>e.jsx("text",{x:40+c*24,y:"250",fontSize:"12",fill:"hsl(var(--muted-foreground))",textAnchor:"middle",children:m},`label-${c}`)),n.map((m,c)=>{const u=40+c*24;if(m===-1)return e.jsxs("g",{children:[e.jsx("line",{x1:u-4,y1:"36",x2:u+4,y2:"44",stroke:"hsl(var(--muted-foreground))",strokeWidth:"2"}),e.jsx("line",{x1:u+4,y1:"36",x2:u-4,y2:"44",stroke:"hsl(var(--muted-foreground))",strokeWidth:"2"})]},`marker-${c}`);if(m===0)return e.jsx("circle",{cx:u,cy:"40",r:"6",fill:"none",stroke:"hsl(var(--muted-foreground))",strokeWidth:"2"},`marker-${c}`);{const p=m-a+1;if(p>=1&&p<=5){const x=60+(p-.5)*40,f=o?.[c];return e.jsxs("g",{children:[e.jsx("circle",{cx:u,cy:x,r:"10",fill:"hsl(var(--primary))"}),f&&f>0&&e.jsx("text",{x:u,y:x+4,fontSize:"12",fill:"hsl(var(--primary-foreground))",textAnchor:"middle",children:f})]},`marker-${c}`)}return null}})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Finger positions: ",o?.filter(m=>m>0).join(", ")||"N/A"]}),s&&e.jsx(Xe,{variant:s.source==="database"?"default":"secondary",children:s.source==="database"?"Database":"Generated"})]})]})},Xn=({chord:t,customData:r})=>{const s=is(t,"piano"),{keys:n}=r||s?.piano||{keys:["C","E","G"]};if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i=["C#","D#","F#","G#","A#"],a=()=>{Kt(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:a,className:"mb-3 gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"400",height:"180",viewBox:"0 0 400 180",className:"mb-2",children:[o.filter(l=>!i.includes(l)).map((l,h)=>{const m=20+h*50,c=n.includes(l);return e.jsx("rect",{x:m,y:"20",width:"48",height:"140",fill:c?"hsl(var(--primary))":"hsl(var(--background))",stroke:"hsl(var(--border))",strokeWidth:"2",rx:"4"},`white-${l}`)}),o.filter(l=>i.includes(l)).map(l=>{const m=20+(o.indexOf(l)-Math.floor((o.indexOf(l)+1)/2))*50+35,c=n.includes(l);return e.jsx("rect",{x:m,y:"20",width:"26",height:"90",fill:c?"hsl(var(--primary))":"hsl(var(--foreground))",stroke:"hsl(var(--border))",strokeWidth:"2",rx:"3"},`black-${l}`)}),o.filter(l=>!i.includes(l)).map((l,h)=>{const m=20+h*50+24;return e.jsx("text",{x:m,y:"150",fontSize:"14",fill:n.includes(l)?"hsl(var(--primary-foreground))":"hsl(var(--muted-foreground))",textAnchor:"middle",children:l},`label-${l}`)})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["Notes: ",n.join(" - ")]}),s&&e.jsx(Xe,{variant:s.source==="database"?"default":"secondary",children:s.source==="database"?"Database":"Generated"})]})]})},Zn=({chord:t,customData:r})=>{const s=is(t,"ukulele"),{frets:n,fingers:o,startFret:i=1}=r||s?.ukulele||{frets:[0,0,0,0],fingers:[0,0,0,0]};if(!s&&!r)return e.jsx("div",{className:"text-gray-400",children:"Chord diagram not available"});const a=["G","C","E","A"],l=()=>{Xt(n)};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:l,className:"mb-3 gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Play Chord"]}),e.jsxs("svg",{width:"160",height:"280",viewBox:"0 0 160 280",className:"mb-2",children:[[...Array(5)].map((h,m)=>e.jsx("line",{x1:"40",y1:60+m*40,x2:"136",y2:60+m*40,stroke:"hsl(var(--muted-foreground))",strokeWidth:m===0&&i===1?"4":"2"},`fret-${m}`)),[...Array(4)].map((h,m)=>e.jsx("line",{x1:40+m*32,y1:"60",x2:40+m*32,y2:"220",stroke:"hsl(var(--muted-foreground))",strokeWidth:"2"},`string-${m}`)),i>1&&e.jsxs("text",{x:"20",y:"65",fontSize:"14",fill:"hsl(var(--muted-foreground))",children:[i,"fr"]}),a.map((h,m)=>e.jsx("text",{x:40+m*32,y:"250",fontSize:"12",fill:"hsl(var(--muted-foreground))",textAnchor:"middle",children:h},`label-${m}`)),n.map((h,m)=>{const c=40+m*32;if(h===0)return e.jsx("circle",{cx:c,cy:"40",r:"6",fill:"none",stroke:"hsl(var(--muted-foreground))",strokeWidth:"2"},`marker-${m}`);{const u=h-i+1;if(u>=1&&u<=5){const p=60+(u-.5)*40,x=o?.[m];return e.jsxs("g",{children:[e.jsx("circle",{cx:c,cy:p,r:"10",fill:"hsl(var(--primary))"}),x&&x>0&&e.jsx("text",{x:c,y:p+4,fontSize:"12",fill:"hsl(var(--primary-foreground))",textAnchor:"middle",children:x})]},`marker-${m}`)}return null}})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Finger positions: ",o?.filter(h=>h>0).join(", ")||"N/A"]}),s&&e.jsx(Xe,{variant:s.source==="database"?"default":"secondary",children:s.source==="database"?"Database":"Generated"})]})]})};function Yn({chord:t,isOpen:r,onClose:s,customDiagram:n}){return e.jsx(bt,{open:r,onOpenChange:s,children:e.jsxs(yt,{className:"max-w-2xl",children:[e.jsxs(jt,{children:[e.jsxs(wt,{className:"text-2xl",children:[t," Chord",n?.capo&&n.capo>0&&e.jsxs("span",{className:"ml-3 text-lg text-orange-600",children:["Capo ",n.capo]})]}),e.jsxs(Nt,{children:["View chord diagrams for guitar, piano, and ukulele",n&&e.jsx("span",{className:"ml-2 text-yellow-600",children:"(Custom)"})]})]}),e.jsxs(As,{defaultValue:"guitar",className:"w-full",children:[e.jsxs(Ds,{className:"grid w-full grid-cols-3",children:[e.jsx(nt,{value:"guitar",children:"Guitar"}),e.jsx(nt,{value:"piano",children:"Piano"}),e.jsx(nt,{value:"ukulele",children:"Ukulele"})]}),e.jsx(at,{value:"guitar",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(Un,{chord:t,customData:n?.guitar})}),e.jsx(at,{value:"piano",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(Xn,{chord:t,customData:n?.piano})}),e.jsx(at,{value:"ukulele",className:"mt-6 min-h-[320px] flex flex-col items-center justify-center",children:e.jsx(Zn,{chord:t,customData:n?.ukulele})})]})]})})}function qs({className:t,...r}){return e.jsx("textarea",{"data-slot":"textarea",className:Ee("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...r})}function Qn({open:t,onOpenChange:r,trackName:s,notes:n,onSave:o}){const[i,a]=g.useState(n);W.useEffect(()=>{a(n)},[n,t]);const l=()=>{o(i),r(!1)};return e.jsx(bt,{open:t,onOpenChange:r,children:e.jsxs(yt,{style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},children:[e.jsxs(jt,{children:[e.jsx(wt,{style:{color:"#F1F1F1"},children:"Track Notes"}),e.jsxs(Nt,{style:{color:"#9E9E9E"},children:["Add notes for ",s]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(qs,{placeholder:"Enter your notes here...",value:i,onChange:h=>a(h.target.value),rows:6,style:{backgroundColor:"var(--daw-control)",borderColor:"var(--daw-border)",color:"#F1F1F1"}}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(I,{variant:"ghost",onClick:()=>r(!1),style:{color:"#9E9E9E"},children:"Cancel"}),e.jsx(I,{onClick:l,style:{backgroundColor:"#3B82F6",color:"#FFFFFF"},children:"Save Notes"})]})]})]})})}const Jn=({start:t,end:r,onChange:s,minWidth:n=.01,className:o})=>{const i=g.useRef(null),[a,l]=g.useState(null),h=g.useCallback(x=>{if(!i.current)return 0;const f=i.current.getBoundingClientRect(),v=x-f.left;return Math.max(0,Math.min(1,v/f.width))},[]),m=(x,f)=>{x.preventDefault(),x.stopPropagation(),l({type:f,startX:x.clientX,initialStart:t,initialEnd:r})};g.useEffect(()=>{if(!a)return;const x=v=>{if(!i.current)return;const k=i.current.getBoundingClientRect().width;let b=a.initialStart,T=a.initialEnd;if(a.type==="pan"){const N=(v.clientX-a.startX)/k;if(b=a.initialStart+N,T=a.initialEnd+N,b<0){const C=0-b;b+=C,T+=C}if(T>1){const C=1-T;b+=C,T+=C}b=Math.max(0,Math.min(1-(a.initialEnd-a.initialStart),b)),T=Math.min(1,Math.max(a.initialEnd-a.initialStart,T))}else if(a.type==="left"){const w=h(v.clientX);b=Math.min(w,a.initialEnd-n),b=Math.max(0,b),T=a.initialEnd}else if(a.type==="right"){const w=h(v.clientX);T=Math.max(w,a.initialStart+n),T=Math.min(1,T),b=a.initialStart}(Math.abs(b-t)>1e-4||Math.abs(T-r)>1e-4)&&s({start:b,end:T})},f=()=>{l(null)};return window.addEventListener("mousemove",x),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",f)}},[a,t,r,n,s,h]);const c=x=>{if(x.target!==i.current)return;x.preventDefault(),x.stopPropagation();const f=h(x.clientX),v=r-t;let y=f-v/2,k=f+v/2;y<0&&(y=0,k=v),k>1&&(k=1,y=1-v),s({start:y,end:k})},u=t*100,p=(r-t)*100;return e.jsxs("div",{ref:i,onClick:c,className:Ee("relative w-full select-none touch-none flex items-center border border-white/10 rounded-full cursor-pointer",o),style:{backgroundColor:"#18181b",height:"14px"},children:[e.jsx("div",{className:"absolute top-0 bottom-0 rounded-full group transition-colors cursor-grab active:cursor-grabbing hover:brightness-110",style:{left:`${u}%`,width:`${p}%`,backgroundColor:"#52525b",border:"1px solid #71717a",boxSizing:"border-box"},onMouseDown:x=>m(x,"pan")}),e.jsx("div",{className:"absolute top-1/2 w-6 h-6 cursor-ew-resize z-20 group/handle",style:{left:`${u}%`,transform:"translate(-50%, -50%)"},onMouseDown:x=>m(x,"left"),children:e.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full shadow-sm transition-transform hover:scale-150",style:{transform:"translate(-50%, -50%)"}})}),e.jsx("div",{className:"absolute top-1/2 w-6 h-6 cursor-ew-resize z-20 group/handle",style:{left:`${r*100}%`,transform:"translate(-50%, -50%)"},onMouseDown:x=>m(x,"right"),children:e.jsx("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full shadow-sm transition-transform hover:scale-150",style:{transform:"translate(-50%, -50%)"}})})]})},ea=({start:t,end:r,onChange:s,minHeight:n=.01,className:o})=>{const i=g.useRef(null),[a,l]=g.useState(null),h=g.useCallback(x=>{if(!i.current)return 0;const f=i.current.getBoundingClientRect(),v=x-f.top;return Math.max(0,Math.min(1,v/f.height))},[]),m=x=>{x.preventDefault(),x.stopPropagation(),l({startY:x.clientY,initialStart:t,initialEnd:r})};g.useEffect(()=>{if(!a)return;const x=v=>{if(!i.current)return;const k=i.current.getBoundingClientRect().height,T=(v.clientY-a.startY)/k;let w=a.initialStart+T,N=a.initialEnd+T;if(w<0){const C=0-w;w+=C,N+=C}if(N>1){const C=1-N;w+=C,N+=C}w=Math.max(0,Math.min(1-(a.initialEnd-a.initialStart),w)),N=Math.min(1,Math.max(a.initialEnd-a.initialStart,N)),(Math.abs(w-t)>1e-4||Math.abs(N-r)>1e-4)&&s({start:w,end:N})},f=()=>{l(null)};return window.addEventListener("mousemove",x),window.addEventListener("mouseup",f),()=>{window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",f)}},[a,t,r,s]);const c=x=>{if(x.target!==i.current)return;x.preventDefault(),x.stopPropagation();const f=h(x.clientY),v=r-t;let y=f-v/2,k=f+v/2;y<0&&(y=0,k=v),k>1&&(k=1,y=1-v),s({start:y,end:k})},u=t*100,p=(r-t)*100;return e.jsx("div",{ref:i,onClick:c,className:Ee("relative h-full select-none touch-none flex justify-center border border-white/10 rounded-full cursor-pointer",o),style:{backgroundColor:"#18181b",width:"14px"},children:e.jsx("div",{className:"absolute left-0 right-0 rounded-full transition-colors cursor-grab active:cursor-grabbing hover:brightness-110",style:{top:`${u}%`,height:`${p}%`,backgroundColor:"#52525b",border:"1px solid #71717a",boxSizing:"border-box"},onMouseDown:m})})},ta=g.createContext(void 0),sa=({children:t,value:r})=>e.jsx(ta.Provider,{value:r,children:t}),Gt=new WeakMap;function ra(t,r){if(Gt.has(t))return Gt.get(t);const s=[...t].sort((l,h)=>l.time-h.time),n=[];let o=0,i=0;for(let l=0;l<s.length;l++)s[l].time>i;const a=[...s];(a.length===0||a[0].time>0)&&a.unshift({time:0,tempo:r}),o=0;for(let l=0;l<a.length;l++){const h=a[l],m=l<a.length-1?a[l+1].time:Number.MAX_VALUE;if(n.push({startTime:h.time,endTime:m,audioStartTime:o,tempo:h.tempo}),m!==Number.MAX_VALUE){const c=m-h.time,u=r/h.tempo;o+=c*u}}return Gt.set(t,n),n}function na(t,r,s,n){if(!n||r.length===0)return t;const o=ra(r,s);let i=0,a=o.length-1,l=null;for(;i<=a;){const h=Math.floor((i+a)/2),m=o[h];if(t>=m.startTime&&t<m.endTime){l=m;break}else t<m.startTime?a=h-1:i=h+1}if(!l&&o.length>0&&(l=o[o.length-1]),l){const h=t-l.startTime,m=s/l.tempo;return l.audioStartTime+h*m}return t}function ys(t,r,s){let n=0,o=0;const a=[{time:0,tempo:s},...r].sort((u,p)=>u.time-p.time).filter((u,p,x)=>p===0||u.time>x[p-1].time);for(let u=1;u<a.length;u++){const p=a[u],x=p.time-o,f=a[u-1].tempo,v=s/f,y=x*v;if(t<n+y){const b=(t-n)/v;return o+b}n+=y,o=p.time}const l=a[a.length-1]?.tempo||s,h=s/l,c=(t-n)/h;return o+c}function aa(){return $e.getMetronomeFrequencies()}function Co(t){$e.setMetronomeFrequencies(t)}function ko(){try{$e.setMetronomeFrequencies({strongBeat:1e3,normalBeat:800,subdivision:600})}catch{console.warn("Failed to reset metronome frequencies")}}function oa(t,r,s=.5,n=!1,o,i){const a=t,l=i!==void 0?i:a.currentTime,h=a.createOscillator(),m=a.createGain(),c=aa();let u;n?u=c.subdivision:r?u=c.strongBeat:u=c.normalBeat,h.frequency.setValueAtTime(u,l),m.gain.setValueAtTime(s,l),m.gain.exponentialRampToValueAtTime(.001,l+.05),h.connect(m),m.connect(a.destination),h.start(l),h.stop(l+.05)}function ls(t){return!t||!t.trim()?[]:t.split("+").map(r=>parseInt(r.trim())).filter(r=>!isNaN(r)&&r>0)}function ia(t,r){if(r)return ls(r).length;const[s,n]=t.split("/").map(Number);return n===8&&[6,9,12].includes(s)?s/3:s}function la(t,r){const s=ls(r);if(s.length===0)return{groupIndex:0,beatInGroup:1,isGroupStart:!0};let n=0,o=(t-1)%s.reduce((i,a)=>i+a,0)+1;for(let i=0;i<s.length;i++){if(o<=n+s[i])return{groupIndex:i,beatInGroup:o-n,isGroupStart:o===n+1};n+=s[i]}return{groupIndex:0,beatInGroup:1,isGroupStart:!0}}const ca=({song:t,initialTempo:r=100,initialMetronomeVolume:s=.5,warpModeEnabled:n=!0})=>{const{resumeAudioContext:o,getAudioContext:i}=vn(),[a,l]=g.useState(!1),[h,m]=g.useState(0),[c,u]=g.useState(0),[p,x]=g.useState(r),[f,v]=g.useState(!1),[y,k]=g.useState(null),[b,T]=g.useState(null),[w,N]=g.useState(!1),[C,M]=g.useState(s),E=g.useRef(0),P=g.useRef(0),z=g.useRef(new Set),G=t?.tempoChanges||[{time:0,tempo:t?.tempo||120,timeSignature:"4/4"}],$=g.useRef(new Map),J=g.useRef(new Map),fe=g.useRef(null),ue=g.useRef(p),te=g.useRef(w),se=g.useRef(C),re=g.useRef(f),L=g.useRef(y),ne=g.useRef(b),ee=g.useRef(0),ae=g.useRef(0);g.useEffect(()=>{ue.current=p},[p]),g.useEffect(()=>{te.current=w},[w]),g.useEffect(()=>{se.current=C},[C]),g.useEffect(()=>{re.current=f},[f]),g.useEffect(()=>{L.current=y},[y]),g.useEffect(()=>{ne.current=b},[b]);const U=g.useCallback(H=>t?na(H,G,t.tempo,n):H,[t,G,n]),me=g.useCallback(H=>{if(!t)return;const Z=Math.max(0,Math.min(H,t.duration)),O=U(Z),V=i();ee.current=V.currentTime,ae.current=O,u(Z),m(O),E.current=0,$.current.forEach(S=>{S.currentTime=O})},[t,U,i]),Ce=g.useCallback(()=>{l(H=>!H)},[]),Me=g.useCallback(()=>{l(!1),me(0)},[me]);return g.useEffect(()=>{if(!t)return;const H=i(),Z=new Map,O=new Map;for(const V of t.tracks){if(!V.url)continue;const S=new Audio(V.url);S.preload="auto",S.crossOrigin="anonymous";const R=H.createGain(),F=H.createMediaElementSource(S);F.connect(R),R.connect(H.destination),R.gain.value=V.muted?0:V.volume,Z.set(V.id,S),O.set(V.id,{gainNode:R,source:F})}return $.current=Z,J.current=O,()=>{Z.forEach(V=>{V.pause(),V.src=""}),O.forEach(({gainNode:V,source:S})=>{S.disconnect(),V.disconnect()}),$.current.clear(),J.current.clear()}},[t?.id,i]),g.useEffect(()=>{if(!t)return;const H=t.tracks.some(Z=>Z.solo);t.tracks.forEach(Z=>{const O=J.current.get(Z.id);if(!O)return;const{gainNode:V}=O;let S=0;H?S=Z.solo&&!Z.muted?Z.volume:0:S=Z.muted?0:Z.volume,V.gain.value=S})},[t?.tracks]),g.useEffect(()=>{a&&o()},[a,o]),g.useEffect(()=>()=>{fe.current&&fe.current.terminate()},[]),g.useEffect(()=>{if(!a||!t)return;const H=i(),Z=.2;let O=null;ee.current=H.currentTime,ae.current=h;const V=F=>{let A=G[0];for(const K of G)if(K.time<=F)A=K;else break;if(A.curve&&F>=A.time&&F<=A.curve.targetTime){const K=A.tempo,q=A.curve.targetTempo,Y=A.curve.targetTime-A.time,Q=(F-A.time)/Y;let X=K;if(A.curve.type==="linear")X=K+(q-K)*Q;else if(A.curve.type==="exponential"){const xe=1-Math.pow(1-Q,2);X=K+(q-K)*xe}return{...A,tempo:X}}return A};$.current.forEach(F=>{F.currentTime=h,F.playbackRate=p/100,F.play().catch(A=>console.warn("Audio play failed:",A))});const S=()=>{const F=H.currentTime,A=ue.current,K=re.current,q=L.current,Y=ne.current;te.current,se.current;const Q=(F-ee.current)*(A/100),X=ae.current+Q,xe=ys(X,G,t.tempo);$.current.forEach(ie=>{Math.abs(ie.currentTime-X)>.02&&(ie.currentTime=X),Math.abs(ie.playbackRate-A/100)>.01&&(ie.playbackRate=A/100)});const pe=K&&q!==null?U(q):0,he=K&&Y!==null?U(Y):t.duration;X>=he?K?(ee.current=H.currentTime,ae.current=pe,E.current=0,P.current=0,z.current.clear(),u(q!==null?q:0),m(pe),$.current.forEach(ie=>{ie.currentTime=pe})):(l(!1),E.current=0,P.current=0,z.current.clear(),u(0),m(0),$.current.forEach(ie=>{ie.pause(),ie.currentTime=0})):(m(X),u(xe)),O=requestAnimationFrame(S)},R=fe.current;return R&&(R.onmessage=()=>{if(te.current){const F=i(),A=F.currentTime,K=A+Z,q=ue.current;(P.current===0||P.current<A)&&(P.current=A+.05,z.current.clear());const Y=(A-ee.current)*(q/100),Q=ae.current+Y,X=ys(Q,G,t.tempo);for(;P.current<K;){const xe=P.current,pe=V(X),ie=60/(pe.tempo*(q/100)),Re=Math.floor(X/ie);if(!z.current.has(Re)){const ge=pe.timeSignature||"4/4",le=pe.subdivision,ut=ia(ge,le);let Ge=!1;if(le){const He=ls(le).reduce((mt,j)=>mt+j,0),qe=Re%He+1;Ge=la(qe,le).isGroupStart}else Ge=Re%ut+1===1;if(oa(F,Ge,se.current,!1,void 0,xe),z.current.add(Re),z.current.size>100){const We=Array.from(z.current).sort((He,qe)=>He-qe);z.current=new Set(We.slice(-50))}}P.current+=ie}}},R.postMessage({action:"start",interval:25})),O=requestAnimationFrame(S),()=>{O!==null&&cancelAnimationFrame(O),R&&R.postMessage({action:"stop"}),$.current.forEach(F=>{F.pause()})}},[a,t,G,U,i]),{isPlaying:a,currentTime:h,gridTime:c,tempo:p,loopEnabled:f,loopStart:y,loopEnd:b,metronomeEnabled:w,metronomeVolume:C,actions:{togglePlayPause:Ce,stop:Me,seek:me,setTempo:x,setLoopEnabled:v,setLoopStart:k,setLoopEnd:T,setMetronomeEnabled:N,setMetronomeVolume:M}}},da=({isPlaying:t,onPlayPause:r,onStop:s,onZoomIn:n,onZoomOut:o,onToggleLoop:i,onToggleMetronome:a,onGoToStart:l,onGoToEnd:h,onFitToView:m,onToggleEditMode:c,onToggleHelp:u,disabled:p=!1})=>{const x=g.useCallback(f=>{if(p)return;const v=f.target;if(!(v.tagName==="INPUT"||v.tagName==="TEXTAREA"||v.isContentEditable))switch(f.code){case"Space":f.preventDefault(),r();break;case"KeyS":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),s());break;case"Home":f.preventDefault(),l();break;case"End":f.preventDefault(),h();break;case"Equal":case"NumpadAdd":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),n());break;case"Minus":case"NumpadSubtract":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),o());break;case"KeyL":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),i());break;case"KeyM":(f.ctrlKey||f.metaKey)&&(f.preventDefault(),a());break;case"Slash":f.shiftKey&&(f.preventDefault(),u?.());break;case"KeyF":!f.ctrlKey&&!f.metaKey&&!f.altKey&&!f.shiftKey&&(f.preventDefault(),m?.());break;case"KeyE":!f.ctrlKey&&!f.metaKey&&!f.altKey&&!f.shiftKey&&(f.preventDefault(),c?.());break}},[p,t,r,s,n,o,i,a,l,h,m,c,u]);return g.useEffect(()=>(window.addEventListener("keydown",x),()=>{window.removeEventListener("keydown",x)}),[x]),null},ua=["time","measures","sections","chords","tempo"],ma=()=>{const[t,r]=g.useState(()=>$e.getTrackHeight()),[s,n]=g.useState(1),[o,i]=g.useState(()=>$e.getRulerOrder()),[a,l]=g.useState(()=>{const N={};return ua.forEach(C=>{N[C]=$e.getRulerVisibility(C)}),N}),[h,m]=g.useState(!0),[c,u]=g.useState(!0),[p,x]=g.useState(!1),[f,v]=g.useState(!1);g.useEffect(()=>{$e.setTrackHeight(t)},[t]),g.useEffect(()=>{$e.setRulerOrder(o)},[o]);const y=g.useCallback((N,C)=>{l(M=>{const E={...M,[N]:C};return $e.setRulerVisibility(N,C),E})},[]),k=g.useCallback(()=>{n(N=>Math.min(N+.5,8))},[]),b=g.useCallback(()=>{n(N=>Math.max(N-.5,.5))},[]),T=g.useCallback(N=>{n(Math.max(.5,Math.min(8,N)))},[]),w=g.useCallback(()=>{switch(t){case"small":return 80;case"large":return 180;default:return 120}},[t]);return{trackHeight:t,zoom:s,rulerVisibility:a,rulerOrder:o,sidebarVisible:h,mixerVisible:c,mixerDockVisible:p,notesPanelVisible:f,setTrackHeight:r,setZoom:n,setRulerVisibility:l,setRulerOrder:i,setSidebarVisible:m,setMixerVisible:u,setMixerDockVisible:x,setNotesPanelVisible:v,handleRulerVisibilityChange:y,handleZoomIn:k,handleZoomOut:b,handleZoomChange:T,getTrackHeightPx:w}};function ha(t,r){let s=null;return(...n)=>{s&&clearTimeout(s),s=setTimeout(()=>t(...n),r)}}const fa=(t,r)=>{const[s,n]=g.useState(t?.tracks||[]),[o,i]=g.useState(new Set),a=g.useRef(null),l=g.useRef(null);g.useEffect(()=>{const w=t?.id||null;w!==a.current&&t?.tracks&&(n(t.tracks),a.current=w)},[t?.id]);const h=g.useCallback(w=>{t&&r&&r({...t,...w})},[t,r]);g.useEffect(()=>{l.current=ha(w=>{t&&r&&r({...t,...w})},100)},[t,r]);const m=g.useCallback((w,N)=>{const C=isNaN(N)||!isFinite(N)?1:Math.max(0,Math.min(10,N));if(n(M=>M.map(E=>E.id===w?{...E,volume:C}:E)),l.current){const M=s.map(E=>E.id===w?{...E,volume:C}:E);l.current({tracks:M})}},[s]),c=g.useCallback(w=>{n(N=>{const C=N.map(M=>M.id===w?{...M,muted:!M.muted}:M);return h({tracks:C}),C})},[h]),u=g.useCallback(w=>{n(N=>{const C=N.map(M=>M.id===w?{...M,solo:!M.solo}:M);return h({tracks:C}),C})},[h]),p=g.useCallback((w,N)=>{n(C=>{const M=C.map(E=>E.id===w?{...E,name:N}:E);return h({tracks:M}),M})},[h]),x=g.useCallback((w,N)=>{n(C=>{const M=C.map(E=>E.id===w?{...E,color:N}:E);return h({tracks:M}),M})},[h]),f=g.useCallback((w,N)=>{n(C=>{const M=C.map(E=>E.id===w?{...E,tag:N}:E);return h({tracks:M}),M})},[h]),v=g.useCallback((w,N)=>{n(C=>{const M=C.map(E=>E.id===w?{...E,notes:N}:E);return h({tracks:M}),M})},[h]),y=g.useCallback(w=>{i(N=>{const C=new Set(N);return C.has(w)?C.delete(w):C.add(w),C})},[]),k=g.useCallback(w=>{if(!t)return;const N={id:`preset-${Date.now()}`,name:w,tracks:s.filter(C=>!o.has(C.id)).map(C=>({trackId:C.id,volume:C.volume,muted:C.muted}))};if(r){const C=[...t.mixPresets||[],N];r({...t,mixPresets:C})}},[t,s,o,r]),b=g.useCallback(w=>{if(!t||!t.mixPresets)return;const N=t.mixPresets.find(E=>E.id===w);if(!N)return;const C=s.map(E=>{if(o.has(E.id))return E;const P=N.tracks.find(z=>z.trackId===E.id);return P?{...E,volume:P.volume,muted:P.muted}:E}),M=$e.getMainInstrument();if(M){const E=C.findIndex(P=>P.tag===M);if(E>0){const[P]=C.splice(E,1);C.unshift(P)}}n(C),h({tracks:C})},[t,o,s,h]),T=g.useCallback(w=>{if(!t||!r)return;const N=(t.mixPresets||[]).filter(C=>C.id!==w);r({...t,mixPresets:N})},[t,r]);return{tracks:s,setTracks:n,pinnedTracks:o,isAnySolo:s.some(w=>w.solo),handlers:{handleTrackVolumeChange:m,handleTrackMuteToggle:c,handleTrackSoloToggle:u,handleTrackNameChange:p,handleTrackColorChange:x,handleTrackTagChange:f,handleSaveTrackNotes:v,handleToggleTrackPin:y},presetHandlers:{handleSavePreset:k,handleLoadPreset:b,handleDeletePreset:T}}};function xa({song:t,onSongUpdate:r}){const s=fa(t,r),n=s.handlers.handleTrackVolumeChange,o=s.handlers.handleTrackMuteToggle,i=s.handlers.handleTrackSoloToggle,a=s.handlers.handleTrackNameChange,l=s.handlers.handleTrackColorChange,h=s.handlers.handleTrackTagChange;return{handleTrackVolumeChange:n,handleTrackMuteToggle:o,handleTrackSoloToggle:i,handleTrackNameChange:a,handleTrackColorChange:l,handleTrackTagChange:h}}function pa({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:i="",scrollContainerRef:a,scrollPosRef:l,zoom:h=1}){const m=g.useRef(null),c=g.useRef(null),u=g.useRef({scrollLeft:-1,width:0,totalWidth:0,dataLen:-1,zoom:0}),p=g.useRef(0);g.useEffect(()=>{if(!a.current)return;const f=new ResizeObserver(v=>{for(const y of v)p.current=y.contentRect.width});return f.observe(a.current),p.current=a.current.clientWidth,()=>f.disconnect()},[a]);const x=g.useCallback(()=>{const f=performance.now(),v=m.current,y=a.current;if(!v||!y){c.current=requestAnimationFrame(x);return}const k=l?l.current:y.scrollLeft,b=p.current,T=window.devicePixelRatio||1,w=t?t.length:0;if(k===u.current.scrollLeft&&b===u.current.width&&r===u.current.totalWidth&&w===u.current.dataLen){c.current=requestAnimationFrame(x);return}u.current={scrollLeft:k,width:b,totalWidth:r,dataLen:w,zoom:0};const N=b*T,C=s*T;(v.width!==N||v.height!==C)&&(v.width=N,v.height=C,v.style.width=`${b}px`,v.style.height=`${s}px`),v.style.transform=`translateX(${k}px)`;const M=v.getContext("2d",{alpha:!0});if(!M)return;if(M.setTransform(1,0,0,1,0,0),M.scale(T,T),M.clearRect(0,0,b,s),!t||t.length===0){M.strokeStyle=n,M.globalAlpha=.5,M.lineWidth=2,M.beginPath(),M.moveTo(0,s/2),M.lineTo(b,s/2),M.stroke(),c.current=requestAnimationFrame(x);return}const E=t.length,P=r/E;if(r===0)return;const z=Math.floor(k/P),G=Math.ceil((k+b)/P),$=Math.max(0,z),J=Math.min(E,G);if($>=J){c.current=requestAnimationFrame(x);return}const fe=1/P,ue=fe>1?Math.floor(fe):1,te=s/2;M.fillStyle=n,M.globalAlpha=o,M.beginPath();const se=$*P-k;M.moveTo(se,te);const re=(ne,ee)=>{let ae=0;for(let U=ne;U<Math.min(ee,E);U++)t[U]>ae&&(ae=t[U]);return ae};for(let ne=$;ne<J;ne+=ue){const ee=ue>1?re(ne,ne+ue):t[ne],ae=ne*P-k,U=Math.max(.5,ee*te*.95);M.lineTo(ae,te-U)}for(let ne=J-1;ne>=$;ne-=ue){const ee=ue>1?re(ne,ne+ue):t[ne],ae=ne*P-k,U=Math.max(.5,ee*te*.95);M.lineTo(ae,te+U)}M.closePath(),M.fill();const L=performance.now()-f;L>16&&console.warn(`[LOD Performance Main] Slow render: ${L.toFixed(2)}ms | Step: ${ue} | Points: ${J-$} | Zoom: ${h.toFixed(2)}`),c.current=requestAnimationFrame(x)},[t,r,s,n,o,h,a]);return g.useEffect(()=>(c.current=requestAnimationFrame(x),()=>{c.current&&cancelAnimationFrame(c.current)}),[x]),e.jsx("div",{className:"h-full w-full relative",children:e.jsx("canvas",{ref:m,className:i,style:{display:"block",position:"absolute",left:0,top:0,pointerEvents:"none",willChange:"transform"}})})}function ga({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:i="",scrollLeft:a=0,viewportWidth:l=1e3,zoom:h=1}){const m=g.useRef(null),c=g.useRef(null);g.useRef(null);const u=g.useRef(!1),p=!t||t.length===0;return g.useEffect(()=>{p||m.current},[p]),g.useEffect(()=>{!u.current||!c.current||p||c.current.postMessage({type:"updateData",data:t})},[t,p]),g.useEffect(()=>{!u.current||!c.current||p||c.current.postMessage({type:"updateMetrics",width:r,height:s})},[r,s,p]),g.useEffect(()=>{!u.current||!c.current||p||c.current.postMessage({type:"render",viewportWidth:l,scrollLeft:a,zoom:h})},[a,l,h,p]),e.jsxs("div",{className:"relative w-full h-full",children:[p&&e.jsx("div",{className:"absolute inset-0 animate-pulse",style:{backgroundColor:`${n}15`,pointerEvents:"none"}}),e.jsx("canvas",{ref:m,className:i,style:{display:"block",width:"100%",height:"100%",backgroundColor:"transparent",pointerEvents:"none",opacity:p?0:1}})]})}const va=W.memo(ga,(t,r)=>t.data===r.data&&t.width===r.width&&t.height===r.height&&t.fill===r.fill&&t.opacity===r.opacity&&t.scrollLeft===r.scrollLeft&&t.viewportWidth===r.viewportWidth&&t.zoom===r.zoom);va.displayName="WaveformCanvasOffscreenMemoized";function ba({data:t,width:r,height:s,fill:n="#60a5fa",opacity:o=.8,className:i="",useCanvas:a=!0,scrollContainerRef:l,scrollPosRef:h,zoom:m=1}){return e.jsx(pa,{data:t,width:r,height:s,fill:n,opacity:o,className:i,scrollContainerRef:l||{current:null},scrollPosRef:h,zoom:m})}const de={BASE_PPS:50,MIN:.001,MAX:20,FACTOR:1.2},Ue={RULER_HEIGHT:32},js={LOW_ZOOM_THRESHOLD:.3,MEDIUM_ZOOM_THRESHOLD:1.5},Wt={SIDEBAR_WIDTH:280};function ya(t,r=1){const s=g.useCallback(()=>{if(r<js.LOW_ZOOM_THRESHOLD){const i=Et.getOverview(t);if(i&&i.length>0)return i}if(r<js.MEDIUM_ZOOM_THRESHOLD){const i=Et.getMedium(t);if(i&&i.length>0)return i}return Et.getWaveform(t)||[]},[t,r]),[n,o]=g.useState(()=>s());return g.useEffect(()=>{const i=Et.subscribe(()=>{o(s())}),a=s();return a.length>0&&o(a),i},[s]),n}const Ks=W.memo(({trackId:t,color:r,duration:s,pps:n,height:o,zoom:i,scrollContainerRef:a,scrollPosRef:l})=>{const h=ya(t,i);return e.jsx("div",{className:"waveform-container",style:{height:"calc(100% - 20px)"},children:e.jsx(ba,{data:h,width:s*n,height:o,fill:r||"#3b82f6",opacity:.8,useCanvas:!0,scrollContainerRef:a,scrollPosRef:l,zoom:i})})});Ks.displayName="TrackWaveformRenderer";const Us=W.memo(W.forwardRef(({song:t,currentTime:r,zoom:s,pixelsPerSecond:n,filteredTracks:o,loopStart:i,loopEnd:a,trackHeightPx:l,onTimelineMouseDown:h,onTimelineMouseMove:m,onTimelineMouseUp:c,onScroll:u},p)=>{const x=g.useRef(null),f=g.useRef(0),v=g.useCallback(b=>{f.current=b.currentTarget.scrollLeft,u(b.currentTarget.scrollLeft)},[u]),y=n||s*100,k=i!==null&&a!==null?{left:`${i*y}px`,width:`${(a-i)*y}px`}:void 0;return e.jsx("div",{className:"timeline-tracks-container flex-1 overflow-auto relative scrollbar-hide",style:{backgroundColor:"var(--daw-bg-main)",overflowY:"auto",scrollbarWidth:"none",msOverflowStyle:"none"},ref:b=>{typeof p=="function"?p(b):p&&(p.current=b),x.current=b},onScroll:v,children:e.jsxs("div",{className:"relative",style:{width:`${t.duration*y}px`,height:`${Math.max(o.length*l,0)}px`,minHeight:"100%",paddingTop:0,paddingBottom:0},onClick:h,onMouseDown:h,onMouseMove:m,onMouseUp:c,onMouseLeave:c,children:[e.jsx("div",{className:"absolute top-0 z-50 pointer-events-none",style:{left:`${r*y}px`,height:"100%"},children:e.jsx("div",{className:"h-full",style:{width:"2px",backgroundColor:"#ef4444",boxShadow:"0 0 4px rgba(239, 68, 68, 0.4)"}})}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"linear-gradient(to right, var(--daw-grid) 1px, transparent 1px)",backgroundSize:"100px 100%",opacity:.3}}),k&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-yellow-500/10 border-l-2 border-r-2 border-yellow-500/50 z-10 pointer-events-none",style:k}),o.map((b,T)=>e.jsx("div",{className:"track-lane absolute left-0 right-0 border-b box-border",style:{top:0,height:`${l}px`,minHeight:`${l}px`,maxHeight:`${l}px`,transform:`translateY(${T*l}px)`,borderColor:"var(--daw-border)",borderBottomWidth:"1px"},children:e.jsxs("div",{className:"clip-box absolute rounded-md overflow-hidden border",style:{left:0,top:"2px",width:`${t.duration*y}px`,height:"calc(100% - 4px)",backgroundColor:`${b.color}20`,borderColor:`${b.color}40`,borderWidth:"1px"},children:[e.jsx("div",{className:"h-5 w-full flex items-center px-2",style:{backgroundColor:`${b.color}60`},children:e.jsx("span",{className:"text-[10px] text-white truncate font-medium drop-shadow",children:b.name})}),e.jsx(Ks,{trackId:b.id,color:b.color||"#3b82f6",duration:t.duration,pps:y,height:l-28,zoom:s,scrollContainerRef:x,scrollPosRef:f})]})},b.id))]})})}));Us.displayName="TimelineContainer";const ja=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M6 20h12l-2-12H8l-2 12z"}),e.jsx("line",{x1:"12",y1:"8",x2:"14",y2:"13"}),e.jsx("circle",{cx:"14.5",cy:"14",r:"1.5"}),e.jsx("path",{d:"M5 20h14"})]}),ws=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10"}),e.jsx("path",{d:"M12 2a10 10 0 0 0-10 10"}),e.jsx("path",{d:"M2 12a10 10 0 0 0 10 10"}),e.jsx("path",{d:"M22 12a10 10 0 0 1-10 10"}),e.jsx("path",{d:"M12 12l4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"5"}),e.jsx("line",{x1:"19",y1:"12",x2:"18",y2:"12"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"6",y2:"12"})]}),wa=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"6",y1:"4",x2:"6",y2:"20",strokeWidth:"1.5"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20",strokeWidth:"2"}),e.jsx("line",{x1:"18",y1:"4",x2:"18",y2:"20",strokeWidth:"1.5"}),e.jsx("circle",{cx:"9",cy:"12",r:"1.5",fill:"currentColor"}),e.jsx("path",{d:"M10.5 12h4.5"}),e.jsx("path",{d:"M13 10l2 2-2 2"})]}),Na=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M17 2l4 4-4 4"}),e.jsx("path",{d:"M3 11v-1a9 9 0 0 1 9-9h9"}),e.jsx("path",{d:"M7 22l-4-4 4-4"}),e.jsx("path",{d:"M21 13v1a9 9 0 0 1-9 9H3"})]}),Ns=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M10 8l6 4-6 4V8z",fill:"currentColor"})]}),Cs=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M4 4v16",strokeWidth:"2.5"}),e.jsx("path",{d:"M4 4h12l-2 4 2 4H4"}),e.jsx("path",{d:"M17 15l2-2 2 2-3 3-2-2z"}),e.jsx("path",{d:"M16 18l-2 2"})]}),ks=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"4",y1:"7",x2:"20",y2:"7",strokeWidth:"1.5"}),e.jsx("path",{d:"M4 12 Q 12 9, 20 12",strokeWidth:"2"}),e.jsx("line",{x1:"4",y1:"17",x2:"20",y2:"17",strokeWidth:"1.5"}),e.jsx("line",{x1:"8",y1:"5",x2:"8",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("line",{x1:"16",y1:"5",x2:"16",y2:"19",strokeWidth:"1",opacity:"0.5"}),e.jsx("circle",{cx:"12",cy:"9",r:"2",fill:"currentColor"})]}),Ca=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"3",rx:"1"}),e.jsx("rect",{x:"3",y:"10",width:"18",height:"3",rx:"1"}),e.jsx("rect",{x:"3",y:"16",width:"18",height:"3",rx:"1"}),e.jsx("circle",{cx:"8",cy:"5.5",r:"0.8",fill:"currentColor"}),e.jsx("circle",{cx:"8",cy:"11.5",r:"0.8",fill:"currentColor"}),e.jsx("circle",{cx:"8",cy:"17.5",r:"0.8",fill:"currentColor"})]});function lt({className:t,defaultValue:r,value:s,min:n=0,max:o=100,...i}){const a=g.useMemo(()=>Array.isArray(s)?s:Array.isArray(r)?r:[n,o],[s,r,n,o]);return e.jsxs(Xr,{"data-slot":"slider",defaultValue:r,value:s,min:n,max:o,className:Ee("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...i,children:[e.jsx(Zr,{"data-slot":"slider-track",className:Ee("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(Yr,{"data-slot":"slider-range",className:Ee("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:a.length},(l,h)=>e.jsx(Qr,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},h))]})}function Bt({delayDuration:t=0,...r}){return e.jsx(Jr,{"data-slot":"tooltip-provider",delayDuration:t,...r})}function ve({...t}){return e.jsx(Bt,{children:e.jsx(en,{"data-slot":"tooltip",...t})})}function be({...t}){return e.jsx(tn,{"data-slot":"tooltip-trigger",...t})}function ye({className:t,sideOffset:r=0,children:s,...n}){return e.jsx(sn,{children:e.jsxs(rn,{"data-slot":"tooltip-content",sideOffset:r,className:Ee("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...n,children:[s,e.jsx(nn,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function Ft({...t}){return e.jsx(an,{"data-slot":"dropdown-menu",...t})}function Rt({...t}){return e.jsx(on,{"data-slot":"dropdown-menu-trigger",...t})}function It({className:t,sideOffset:r=4,...s}){return e.jsx(ln,{children:e.jsx(cn,{"data-slot":"dropdown-menu-content",sideOffset:r,className:Ee("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...s})})}function Ht({className:t,inset:r,variant:s="default",...n}){return e.jsx(dn,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":s,className:Ee("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function ka({tempo:t,onTempoChange:r,keyShift:s,onKeyShiftChange:n,disabled:o,originalKey:i="C"}){const[a,l]=g.useState(0),h=s+a,m=Dt(i,s),c=Dt(i,h);return e.jsxs(Ft,{children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(Rt,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:u=>{u.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="var(--daw-control)"},disabled:o,children:e.jsx(ws,{className:"w-5 h-5"})})})}),e.jsx(ye,{children:"Playback Settings"})]}),e.jsx(It,{className:"w-96 p-4",style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},align:"end",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(ws,{className:"w-4 h-4"}),"Speed"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:[t,"%"]}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>r(100),className:"h-6 px-2 text-xs",style:{backgroundColor:t===100?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(lt,{value:[t],onValueChange:([u])=>r(u),min:50,max:150,step:1,className:"w-full",onDoubleClick:()=>r(100)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"}),e.jsx("span",{children:"150%"})]})]}),e.jsx(es,{style:{backgroundColor:"#3A3A3A"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-sm",style:{color:"#F1F1F1"},children:"Key Information"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center p-3 rounded-md",style:{backgroundColor:"#1E1E1E",border:"1px solid #3A3A3A"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Original"}),e.jsx("div",{className:"text-lg",style:{color:"#F1F1F1"},children:i})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Playing"}),e.jsx("div",{className:"text-lg",style:{color:"#3B82F6"},children:m})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#9E9E9E"},children:"Display"}),e.jsx("div",{className:"text-lg",style:{color:a>0?"#22c55e":"#F1F1F1"},children:c})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(Sr,{className:"w-4 h-4"}),"Transpose"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:[s>0?"+":"",s," ",Math.abs(s)===1?"semitone":"semitones"]}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>n(0),className:"h-6 px-2 text-xs",style:{backgroundColor:s===0?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(lt,{value:[s],onValueChange:([u])=>n(u),min:-12,max:12,step:1,className:"w-full",onDoubleClick:()=>n(0)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"-12"}),e.jsx("span",{children:"0"}),e.jsx("span",{children:"+12"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{className:"text-sm flex items-center gap-2",style:{color:"#F1F1F1"},children:[e.jsx(Tr,{className:"w-4 h-4"}),"Capo Position"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm tabular-nums",style:{color:"#9E9E9E"},children:["Fret ",a]}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>l(0),className:"h-6 px-2 text-xs",style:{backgroundColor:a===0?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},children:"Reset"})]})]}),e.jsx(lt,{value:[a],onValueChange:([u])=>l(u),min:0,max:12,step:1,className:"w-full",onDoubleClick:()=>l(0)}),e.jsxs("div",{className:"flex justify-between text-xs",style:{color:"#6B6B6B"},children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"6"}),e.jsx("span",{children:"12"})]}),e.jsx("div",{className:"text-xs",style:{color:"#9E9E9E"},children:a>0?`Chords shown are ${a} semitone${a>1?"s":""} higher (play as if no capo)`:"No capo - play chords as shown"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-sm",style:{color:"#F1F1F1"},children:"Quick Presets"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(I,{size:"sm",variant:"outline",onClick:()=>{r(75),n(0)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"Practice (75%)"}),e.jsx(I,{size:"sm",variant:"outline",onClick:()=>{r(100),n(0),l(0)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"Reset All"}),e.jsx(I,{size:"sm",variant:"outline",onClick:()=>{r(100),n(-2)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"-2 semitones"}),e.jsx(I,{size:"sm",variant:"outline",onClick:()=>{r(100),n(2)},className:"text-xs",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-secondary)",borderColor:"var(--daw-border)"},children:"+2 semitones"})]})]})]})})]})}function Ma({trackHeight:t,onTrackHeightChange:r,rulerVisibility:s,onRulerVisibilityChange:n,rulerOrder:o=["time","measures","sections","chords","tempo"],onRulerOrderChange:i}){const{t:a}=dt(),[l,h]=g.useState(null),[m,c]=g.useState(null),u={time:{id:"time",label:a.time,visible:s.time},measures:{id:"measures",label:a.measures,visible:s.measures},sections:{id:"sections",label:a.sections,visible:s.sections},chords:{id:"chords",label:a.chords,visible:s.chords},tempo:{id:"tempo",label:a.tempo,visible:s.tempo}},p=o.map(b=>u[b]).filter(Boolean),x=(b,T)=>{const w={...s,[b]:T};n(w)},f=(b,T)=>{h(T),b.dataTransfer.setData("text/plain",T),b.dataTransfer.effectAllowed="move"},v=(b,T)=>{b.preventDefault(),b.dataTransfer.dropEffect="move",T!==m&&c(T)},y=(b,T)=>{b.preventDefault();const w=b.dataTransfer.getData("text/plain");if(!w||w===T)return;const N=[...o],C=N.indexOf(w),M=N.indexOf(T);if(C===-1||M===-1)return;const[E]=N.splice(C,1);N.splice(M,0,E),i&&i(N)},k=()=>{h(null),c(null)};return e.jsxs(Ft,{children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(Rt,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:b=>{b.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:b=>{b.currentTarget.style.backgroundColor="var(--daw-control)"},children:e.jsx(Ca,{className:"w-5 h-5"})})})}),e.jsx(ye,{children:"View Settings"})]}),e.jsx(It,{className:"w-72 p-4",style:{backgroundColor:"#2B2B2B",borderColor:"#3A3A3A"},align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-sm",style:{color:"#F1F1F1"},children:"Track Height"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{size:"sm",variant:t==="small"?"default":"outline",onClick:()=>r("small"),className:"flex-1",style:t==="small"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Small"}),e.jsx(I,{size:"sm",variant:t==="medium"?"default":"outline",onClick:()=>r("medium"),className:"flex-1",style:t==="medium"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Medium"}),e.jsx(I,{size:"sm",variant:t==="large"?"default":"outline",onClick:()=>r("large"),className:"flex-1",style:t==="large"?{backgroundColor:"#3B82F6",color:"#F1F1F1"}:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-muted)",borderColor:"var(--daw-border)"},children:"Large"})]})]}),e.jsx(es,{style:{backgroundColor:"#3A3A3A"}}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{className:"text-sm",style:{color:"#F1F1F1"},children:"Rulers"}),e.jsx("span",{className:"text-xs",style:{color:"#9E9E9E"},children:"Drag to reorder"})]}),e.jsx("div",{className:"space-y-1",children:p.map((b,T)=>e.jsxs("div",{draggable:!!i,onDragStart:w=>i&&f(w,b.id),onDragOver:w=>i&&v(w,b.id),onDrop:w=>i&&y(w,b.id),onDragEnd:k,onDragLeave:()=>c(null),className:Ee("flex items-center justify-between p-2 rounded transition-all",i&&"cursor-move",l===b.id?"opacity-50 scale-95":"opacity-100",m===b.id&&l!==b.id&&"bg-yellow-500/30"),style:{backgroundColor:"var(--daw-control)"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Rs,{className:"w-4 h-4 cursor-grab active:cursor-grabbing",style:{color:"#6B6B6B"}}),b.visible?e.jsx(Er,{className:"w-4 h-4",style:{color:"#9E9E9E"}}):e.jsx(Pr,{className:"w-4 h-4",style:{color:"#9E9E9E"}}),e.jsx("span",{className:"text-sm",style:{color:"#F1F1F1"},children:b.label})]}),e.jsx(pt,{checked:b.visible,onCheckedChange:w=>x(b.id,w),onClick:w=>w.stopPropagation()})]},b.id))})]})]})})]})}const Xs=t=>Number.isInteger(t)?t.toString():parseFloat(t.toFixed(2)).toString(),Qt=t=>{if(t==null)return"--:--";const r=Math.floor(t/60),s=Math.floor(t%60);return`${r}:${s.toString().padStart(2,"0")}`};function Sa({mode:t,onModeChange:r,timeSignature:s}){const n=s&&/^(6|9|12)\/8$/.test(s);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-sm",style:{color:"var(--daw-text-primary)"},children:"Metronome Mode"}),e.jsxs(Pe,{value:t,onValueChange:o=>r(o),children:[e.jsx(Ae,{className:"w-full",children:e.jsx(De,{})}),e.jsxs(Fe,{children:[e.jsx(je,{value:"macro",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Macro Beats"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n?"2 beats in 6/8, 3 in 9/8":"Main beats only"})]})}),e.jsx(je,{value:"all",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"All Pulses"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n?"6 pulses in 6/8, 9 in 9/8":"All subdivisions"})]})}),e.jsx(je,{value:"accented",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Accented Pulses"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"All pulses with hierarchical accents"})]})})]})]}),e.jsxs("div",{className:"text-xs space-y-1",style:{color:"var(--daw-text-secondary)"},children:[t==="macro"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500",title:"Downbeat"}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 self-center",title:"Beat"}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 self-center",title:"Beat"})]}),e.jsx("span",{children:"Only main beats"})]}),t==="all"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500",title:"Downbeat"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 self-center",title:"Subdivision"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 self-center",title:"Subdivision"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 self-center",title:"Subdivision"})]}),e.jsx("span",{children:"All equal volume"})]}),t==="accented"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500",title:"Downbeat (forte)"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 self-center",title:"Subdivision (piano)"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 self-center",title:"Subdivision (piano)"}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 self-center",title:"Beat (mezzo)"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 self-center",title:"Subdivision (piano)"}),e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 self-center",title:"Subdivision (piano)"})]}),e.jsx("span",{children:"Dynamic accents"})]})]}),e.jsx("div",{className:"text-xs p-2 rounded",style:{backgroundColor:"rgba(59, 130, 246, 0.1)",borderLeft:"2px solid rgb(59, 130, 246)"},children:e.jsxs("p",{className:"text-blue-400",children:[t==="macro"&&"💡 Perfect for feeling the groove in compound meters",t==="all"&&"💡 Useful for learning complex rhythms",t==="accented"&&"💡 Best for irregular meters like 5/8 or 7/8"]})})]})}const Ta=({songTitle:t,songKey:r,isPlaying:s,currentTime:n,tempo:o,loopEnabled:i,metronomeEnabled:a,metronomeVolume:l,metronomeMode:h="macro",keyShift:m,trackHeight:c,rulerVisibility:u,rulerOrder:p,currentMeasure:x,currentTimeSignature:f,displayTempo:v,snapEnabled:y=!1,snapMode:k="measures",onBack:b,onPlayPause:T,onStop:w,onLoopToggle:N,onMetronomeToggle:C,onMetronomeVolumeChange:M,onMetronomeModeChange:E,onTempoChange:P,onKeyShiftChange:z,onTrackHeightChange:G,onRulerVisibilityChange:$,onRulerOrderChange:J,onSnapToggle:fe,onSnapModeChange:ue,onExportProject:te,activeTool:se=null,onToolChange:re})=>e.jsxs("div",{className:"border-b p-3 flex items-center justify-between gap-4",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:b,children:e.jsx(ss,{className:"w-4 h-4"})})}),e.jsx(ye,{children:"Back to Library"})]}),e.jsx("span",{className:"text-lg font-medium",style:{color:"var(--daw-text-primary)"},children:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:w,children:e.jsx(Ar,{className:"w-5 h-5"})})}),e.jsx(ye,{children:"Stop"})]}),e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-12 w-12",style:{backgroundColor:s?"#10B981":"#065F46",color:"#FFFFFF",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=s?"#059669":"#047857"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=s?"#10B981":"#065F46"},onClick:T,children:s?e.jsx(Dr,{className:"w-6 h-6"}):e.jsx(Qe,{className:"w-6 h-6"})})}),e.jsx(ye,{children:s?"Pause":"Play"})]}),e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:i?"#1E3A8A":"var(--daw-control)",color:i?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=i?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=i?"#1E3A8A":"var(--daw-control)"},onClick:N,children:e.jsx(Na,{className:"w-5 h-5"})})}),e.jsx(ye,{children:"Loop"})]})]}),e.jsxs("div",{className:"rounded-lg px-4 py-2 flex items-center gap-4",style:{backgroundColor:"var(--daw-bg-main)",border:"1px solid var(--daw-border)",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{className:"flex flex-col items-center",style:{minWidth:"80px"},children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Time"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:Qt(n)})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Measure"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:x})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Tempo"}),e.jsx("span",{className:"text-lg font-mono font-bold tabular-nums",style:{color:"#10B981"},children:Xs(v)})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Time Sig"}),e.jsx("span",{className:"text-lg font-mono font-bold",style:{color:"#10B981"},children:f})]}),e.jsx("div",{className:"w-px h-10",style:{backgroundColor:"var(--daw-border)"}}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:"var(--daw-text-muted)"},children:"Key"}),e.jsx("span",{className:"text-lg font-mono font-bold",style:{color:"#10B981"},children:r})]})]}),e.jsxs(Ft,{children:[e.jsxs("div",{className:"flex items-center gap-0",children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-r-none",style:{backgroundColor:a?"#1E3A8A":"var(--daw-control)",color:a?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px 0 0 8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=a?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=a?"#1E3A8A":"var(--daw-control)"},onClick:C,children:e.jsx(ja,{className:"w-5 h-5"})})}),e.jsx(ye,{children:"Metronome"})]}),e.jsx(Rt,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-6 rounded-l-none px-1",style:{backgroundColor:a?"#1E3A8A":"var(--daw-control)",color:a?"#60A5FA":"var(--daw-text-primary)",borderRadius:"0 8px 8px 0",borderLeft:"1px solid rgba(0,0,0,0.2)"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=a?"#1E40AF":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=a?"#1E3A8A":"var(--daw-control)"},children:e.jsx(cs,{className:"w-3 h-3"})})})]}),e.jsx(It,{className:"w-64 p-4",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{className:"text-sm",style:{color:"var(--daw-text-primary)"},children:"Metronome Volume"}),e.jsxs("span",{className:"text-sm",style:{color:"var(--daw-text-secondary)"},children:[gt(xn(l))," dB"]})]}),e.jsx(lt,{value:[ot(l)],onValueChange:L=>M(rs(L[0])),max:100,step:.1,className:"w-full",onDoubleClick:()=>{M(.5)}})]}),E&&e.jsx("div",{className:"pt-3 border-t",style:{borderColor:"var(--daw-border)"},children:e.jsx(Sa,{mode:h,onModeChange:E,timeSignature:f})})]})})]}),e.jsxs(Ft,{children:[e.jsx(Rt,{asChild:!0,children:e.jsxs(I,{variant:"ghost",className:"h-10 px-3 gap-2",style:{backgroundColor:se?"#1E3A8A":"var(--daw-control)",color:se?"#60A5FA":"var(--daw-text-primary)",borderRadius:"8px"},children:[se==="marker"?e.jsxs(e.Fragment,{children:[e.jsx(Cs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Marker Editor"})]}):se==="warp"?e.jsxs(e.Fragment,{children:[e.jsx(ks,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Warp Grid"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Player Mode"})]}),e.jsx(cs,{className:"w-3 h-3 opacity-50"})]})}),e.jsxs(It,{align:"end",className:"w-48",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs(Ht,{onClick:()=>re&&re(null),className:"gap-2 cursor-pointer",children:[e.jsx(Ns,{className:"w-4 h-4"}),e.jsx("span",{children:"Player Mode"})]}),e.jsxs(Ht,{onClick:()=>re&&re("marker"),className:"gap-2 cursor-pointer",children:[e.jsx(Cs,{className:"w-4 h-4"}),e.jsx("span",{children:"Marker Editor"})]}),e.jsxs(Ht,{onClick:()=>re&&re("warp"),className:"gap-2 cursor-pointer",children:[e.jsx(ks,{className:"w-4 h-4"}),e.jsx("span",{children:"Warp Grid Editor"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 px-3",style:{backgroundColor:y?"#2563EB":"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=y?"#1D4ED8":"var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor=y?"#2563EB":"var(--daw-control)"},onClick:fe,children:e.jsx(wa,{className:"w-4 h-4"})})}),e.jsx(ye,{children:y?"Snap enabled (measures)":"Snap disabled"})]}),e.jsx(ka,{tempo:o,onTempoChange:P,keyShift:m,onKeyShiftChange:z,originalKey:r}),e.jsx(Ma,{trackHeight:c,onTrackHeightChange:G,rulerVisibility:u,onRulerVisibilityChange:$,rulerOrder:p,onRulerOrderChange:J}),e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-10 w-10",style:{backgroundColor:"var(--daw-control)",color:"var(--daw-text-primary)",borderRadius:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="var(--daw-control-hover)"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="var(--daw-control)"},onClick:te,children:e.jsx(Fr,{className:"w-4 h-4"})})}),e.jsx(ye,{children:"Export Project"})]})]})]});function tt(t,r,s){let n=s.initialDeps??[],o,i=!0;function a(){var l,h,m;let c;s.key&&((l=s.debug)!=null&&l.call(s))&&(c=Date.now());const u=t();if(!(u.length!==n.length||u.some((f,v)=>n[v]!==f)))return o;n=u;let x;if(s.key&&((h=s.debug)!=null&&h.call(s))&&(x=Date.now()),o=r(...u),s.key&&((m=s.debug)!=null&&m.call(s))){const f=Math.round((Date.now()-c)*100)/100,v=Math.round((Date.now()-x)*100)/100,y=v/16,k=(b,T)=>{for(b=String(b);b.length<T;)b=" "+b;return b};console.info(`%c⏱ ${k(v,5)} /${k(f,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,s?.key)}return s?.onChange&&!(i&&s.skipInitialOnChange)&&s.onChange(o),i=!1,o}return a.updateDeps=l=>{n=l},a}function Ms(t,r){if(t===void 0)throw new Error("Unexpected undefined");return t}const Ea=(t,r)=>Math.abs(t-r)<1.01,Pa=(t,r,s)=>{let n;return function(...o){t.clearTimeout(n),n=t.setTimeout(()=>r.apply(this,o),s)}},Ss=t=>{const{offsetWidth:r,offsetHeight:s}=t;return{width:r,height:s}},Aa=t=>t,Da=t=>{const r=Math.max(t.startIndex-t.overscan,0),s=Math.min(t.endIndex+t.overscan,t.count-1),n=[];for(let o=r;o<=s;o++)n.push(o);return n},Fa=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;const o=a=>{const{width:l,height:h}=a;r({width:Math.round(l),height:Math.round(h)})};if(o(Ss(s)),!n.ResizeObserver)return()=>{};const i=new n.ResizeObserver(a=>{const l=()=>{const h=a[0];if(h?.borderBoxSize){const m=h.borderBoxSize[0];if(m){o({width:m.inlineSize,height:m.blockSize});return}}o(Ss(s))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return i.observe(s,{box:"border-box"}),()=>{i.unobserve(s)}},Ts={passive:!0},Es=typeof window>"u"?!0:"onscrollend"in window,Ra=(t,r)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;let o=0;const i=t.options.useScrollendEvent&&Es?()=>{}:Pa(n,()=>{r(o,!1)},t.options.isScrollingResetDelay),a=c=>()=>{const{horizontal:u,isRtl:p}=t.options;o=u?s.scrollLeft*(p&&-1||1):s.scrollTop,i(),r(o,c)},l=a(!0),h=a(!1);h(),s.addEventListener("scroll",l,Ts);const m=t.options.useScrollendEvent&&Es;return m&&s.addEventListener("scrollend",h,Ts),()=>{s.removeEventListener("scroll",l),m&&s.removeEventListener("scrollend",h)}},Ia=(t,r,s)=>{if(r?.borderBoxSize){const n=r.borderBoxSize[0];if(n)return Math.round(n[s.options.horizontal?"inlineSize":"blockSize"])}return t[s.options.horizontal?"offsetWidth":"offsetHeight"]},$a=(t,{adjustments:r=0,behavior:s},n)=>{var o,i;const a=t+r;(i=(o=n.scrollElement)==null?void 0:o.scrollTo)==null||i.call(o,{[n.options.horizontal?"left":"top"]:a,behavior:s})};class Ba{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const n=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(o=>{o.forEach(i=>{const a=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()})}));return{disconnect:()=>{var o;(o=n())==null||o.disconnect(),s=null},observe:o=>{var i;return(i=n())==null?void 0:i.observe(o,{box:"border-box"})},unobserve:o=>{var i;return(i=n())==null?void 0:i.unobserve(o)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([n,o])=>{typeof o>"u"&&delete s[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Aa,rangeExtractor:Da,onChange:()=>{},measureElement:Ia,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var n,o;(o=(n=this.options).onChange)==null||o.call(n,this,s)},this.maybeNotify=tt(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(o=>{this.observer.observe(o)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,o=>{this.scrollRect=o,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(o,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<o?"forward":"backward":null,this.scrollOffset=o,this.isScrolling=i,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,n)=>{const o=new Map,i=new Map;for(let a=n-1;a>=0;a--){const l=s[a];if(o.has(l.lane))continue;const h=i.get(l.lane);if(h==null||l.end>h.end?i.set(l.lane,l):l.end<h.end&&o.set(l.lane,!0),o.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((a,l)=>a.end===l.end?a.index-l.index:a.end-l.end)[0]:void 0},this.getMeasurementOptions=tt(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(s,n,o,i,a,l)=>(this.prevLanes!==void 0&&this.prevLanes!==l&&(this.lanesChangedFlag=!0),this.prevLanes=l,this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:n,scrollMargin:o,getItemKey:i,enabled:a,lanes:l}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=tt(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:n,scrollMargin:o,getItemKey:i,enabled:a,lanes:l},h)=>{if(!a)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>s)for(const p of this.laneAssignments.keys())p>=s&&this.laneAssignments.delete(p);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(p=>{this.itemSizeCache.set(p.key,p.size)}));const m=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===s&&(this.lanesSettling=!1);const c=this.measurementsCache.slice(0,m),u=new Array(l).fill(void 0);for(let p=0;p<m;p++){const x=c[p];x&&(u[x.lane]=p)}for(let p=m;p<s;p++){const x=i(p),f=this.laneAssignments.get(p);let v,y;if(f!==void 0&&this.options.lanes>1){v=f;const w=u[v],N=w!==void 0?c[w]:void 0;y=N?N.end+this.options.gap:n+o}else{const w=this.options.lanes===1?c[p-1]:this.getFurthestMeasurement(c,p);y=w?w.end+this.options.gap:n+o,v=w?w.lane:p%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(p,v)}const k=h.get(x),b=typeof k=="number"?k:this.options.estimateSize(p),T=y+b;c[p]={index:p,start:y,size:b,end:T,key:x,lane:v},u[v]=p}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=tt(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,n,o,i)=>this.range=s.length>0&&n>0?La({measurements:s,outerSize:n,scrollOffset:o,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=tt(()=>{let s=null,n=null;const o=this.calculateRange();return o&&(s=o.startIndex,n=o.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,n]},(s,n,o,i,a)=>i===null||a===null?[]:s({startIndex:i,endIndex:a,overscan:n,count:o}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const n=this.options.indexAttribute,o=s.getAttribute(n);return o?parseInt(o,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(s,n)=>{const o=this.indexFromElement(s),i=this.measurementsCache[o];if(!i)return;const a=i.key,l=this.elementsCache.get(a);l!==s&&(l&&this.observer.unobserve(l),this.observer.observe(s),this.elementsCache.set(a,s)),s.isConnected&&this.resizeItem(o,this.options.measureElement(s,n,this))},this.resizeItem=(s,n)=>{const o=this.measurementsCache[s];if(!o)return;const i=this.itemSizeCache.get(o.key)??o.size,a=n-i;a!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(o,a,this):o.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=a,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(o.index),this.itemSizeCache=new Map(this.itemSizeCache.set(o.key,n)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((n,o)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(o))});return}this._measureElement(s,void 0)},this.getVirtualItems=tt(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,n)=>{const o=[];for(let i=0,a=s.length;i<a;i++){const l=s[i],h=n[l];o.push(h)}return o},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const n=this.getMeasurements();if(n.length!==0)return Ms(n[Zs(0,n.length-1,o=>Ms(n[o]).start,s)])},this.getOffsetForAlignment=(s,n,o=0)=>{const i=this.getSize(),a=this.getScrollOffset();n==="auto"&&(n=s>=a+i?"end":"start"),n==="center"?s+=(o-i)/2:n==="end"&&(s-=i);const l=this.getTotalSize()+this.options.scrollMargin-i;return Math.max(Math.min(l,s),0)},this.getOffsetForIndex=(s,n="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const o=this.measurementsCache[s];if(!o)return;const i=this.getSize(),a=this.getScrollOffset();if(n==="auto")if(o.end>=a+i-this.options.scrollPaddingEnd)n="end";else if(o.start<=a+this.options.scrollPaddingStart)n="start";else return[a,n];const l=n==="end"?o.end+this.options.scrollPaddingEnd:o.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(l,n,o.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:n="start",behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,n),{adjustments:void 0,behavior:o})},this.scrollToIndex=(s,{align:n="auto",behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1));let i=0;const a=10,l=m=>{if(!this.targetWindow)return;const c=this.getOffsetForIndex(s,m);if(!c){console.warn("Failed to get offset for index:",s);return}const[u,p]=c;this._scrollToOffset(u,{adjustments:void 0,behavior:o}),this.targetWindow.requestAnimationFrame(()=>{const x=this.getScrollOffset(),f=this.getOffsetForIndex(s,p);if(!f){console.warn("Failed to get offset for index:",s);return}Ea(f[0],x)||h(p)})},h=m=>{this.targetWindow&&(i++,i<a?this.targetWindow.requestAnimationFrame(()=>l(m)):console.warn(`Failed to scroll to index ${s} after ${a} attempts.`))};l(n)},this.scrollBy=(s,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var s;const n=this.getMeasurements();let o;if(n.length===0)o=this.options.paddingStart;else if(this.options.lanes===1)o=((s=n[n.length-1])==null?void 0:s.end)??0;else{const i=Array(this.options.lanes).fill(null);let a=n.length-1;for(;a>=0&&i.some(l=>l===null);){const l=n[a];i[l.lane]===null&&(i[l.lane]=l.end),a--}o=Math.max(...i.filter(l=>l!==null))}return Math.max(o-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:n,behavior:o})=>{this.options.scrollToFn(s,{behavior:o,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(r)}}const Zs=(t,r,s,n)=>{for(;t<=r;){const o=(t+r)/2|0,i=s(o);if(i<n)t=o+1;else if(i>n)r=o-1;else return o}return t>0?t-1:0};function La({measurements:t,outerSize:r,scrollOffset:s,lanes:n}){const o=t.length-1,i=h=>t[h].start;if(t.length<=n)return{startIndex:0,endIndex:o};let a=Zs(0,o,i,s),l=a;if(n===1)for(;l<o&&t[l].end<s+r;)l++;else if(n>1){const h=Array(n).fill(0);for(;l<o&&h.some(c=>c<s+r);){const c=t[l];h[c.lane]=c.end,l++}const m=Array(n).fill(s+r);for(;a>=0&&m.some(c=>c>=s);){const c=t[a];m[c.lane]=c.start,a--}a=Math.max(0,a-a%n),l=Math.min(o,l+(n-1-l%n))}return{startIndex:a,endIndex:l}}const Ps=typeof document<"u"?g.useLayoutEffect:g.useEffect;function Oa(t){const r=g.useReducer(()=>({}),{})[1],s={...t,onChange:(o,i)=>{var a;i?kr.flushSync(r):r(),(a=t.onChange)==null||a.call(t,o,i)}},[n]=g.useState(()=>new Ba(s));return n.setOptions(s),Ps(()=>n._didMount(),[]),Ps(()=>n._willUpdate()),n}function za(t){return Oa({observeElementRect:Fa,observeElementOffset:Ra,scrollToFn:$a,...t})}const Ys=W.memo(({trackId:t,trackName:r,trackColor:s,trackVolume:n,trackMuted:o,trackSolo:i,trackHeightPx:a,isAnySolo:l,onVolumeChange:h,onMuteToggle:m,onSoloToggle:c})=>{const[u,p]=W.useState(ot(n)),[x,f]=W.useState(!1);W.useEffect(()=>{x||p(ot(n))},[n,x]);const v=b=>{p(b[0])},y=()=>{f(!0)},k=()=>{f(!1),h(t,rs(u))};return e.jsxs("div",{className:"border-b relative group box-border",style:{height:`${a}px`,minHeight:`${a}px`,maxHeight:`${a}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",borderBottomWidth:"1px"},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1",style:{backgroundColor:s||"#3b82f6"}}),e.jsxs("div",{className:"p-2 pl-6 h-full flex flex-col justify-center gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:e.jsx("span",{className:"font-semibold text-sm truncate text-gray-200",title:r,children:r})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"icon",className:`h-6 w-8 rounded-sm border-2 focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${o?"bg-red-600 text-white border-red-500 focus:ring-red-500":"bg-gray-800 text-gray-400 border-gray-600 hover:border-gray-500 focus:ring-gray-500"}`,onClick:()=>m(t),"aria-label":o?`Unmute ${r}`:`Mute ${r}`,"aria-pressed":o,title:o?"Unmute track":"Mute track",children:e.jsx("span",{className:"text-[10px] font-bold",children:"M"})}),e.jsx(I,{variant:"ghost",size:"icon",className:`h-6 w-8 rounded-sm border-2 focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${i?"bg-yellow-500 text-black border-yellow-400 focus:ring-yellow-500":"bg-gray-800 text-gray-400 border-gray-600 hover:border-gray-500 focus:ring-gray-500"}`,onClick:()=>c(t),"aria-label":i?`Unsolo ${r}`:`Solo ${r}`,"aria-pressed":i,title:i?"Unsolo track":"Solo track",children:e.jsx("span",{className:"text-[10px] font-bold",children:"S"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{value:[u],min:0,max:100,step:1,onValueChange:v,onPointerDown:y,onPointerUp:k,className:"flex-1","aria-label":`Volume for ${r}`,"aria-valuenow":u,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":`${gt(Pt(u))} decibels`}),e.jsx("span",{className:"text-[10px] tabular-nums text-gray-400 w-8 text-right font-mono","aria-hidden":"true",children:gt(Pt(u))})]})]})]})},(t,r)=>t.trackId===r.trackId&&t.trackName===r.trackName&&t.trackColor===r.trackColor&&t.trackVolume===r.trackVolume&&t.trackMuted===r.trackMuted&&t.trackSolo===r.trackSolo&&t.trackHeightPx===r.trackHeightPx&&t.isAnySolo===r.isAnySolo);Ys.displayName="TrackListItem";const Qs=W.memo(W.forwardRef(({tracks:t,trackHeight:r,editingTrackId:s,trackNameInput:n,pinnedTracks:o,onTrackNameChange:i,onTrackColorChange:a,onTrackVolumeChange:l,onTrackMuteToggle:h,onTrackSoloToggle:m,onTrackTagsChange:c,onTrackNotesOpen:u,onEditingTrackIdChange:p,onTrackNameInputChange:x,onPinnedTracksChange:f,onScroll:v},y)=>{const k=()=>{switch(r){case"small":return 64;case"large":return 128;default:return 96}},b=g.useCallback((E,P)=>{l(E,P)},[l]),T=t.some(E=>E.solo),w=k(),N=g.useRef(null),C=za({count:t.length,getScrollElement:()=>N.current,estimateSize:()=>w,overscan:3}),M=E=>{v(E.currentTarget.scrollTop)};return e.jsxs("div",{ref:E=>{N.current=E,typeof y=="function"?y(E):y&&(y.current=E)},className:"track-list-sidebar-container flex-shrink-0 border-r flex flex-col overflow-y-auto",style:{width:`${Wt.SIDEBAR_WIDTH}px`,minWidth:`${Wt.SIDEBAR_WIDTH}px`,maxWidth:`${Wt.SIDEBAR_WIDTH}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",scrollbarWidth:"none",msOverflowStyle:"none",paddingTop:0,paddingBottom:0},onScroll:M,children:[e.jsx("div",{className:"flex-1 relative",style:{height:`${C.getTotalSize()}px`,margin:0,padding:0},children:C.getVirtualItems().map(E=>{const P=t[E.index];return e.jsx("div",{"data-index":E.index,ref:C.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${E.start}px)`},children:e.jsx(Ys,{trackId:P.id,trackName:P.name,trackColor:P.color||"#3b82f6",trackVolume:P.volume,trackMuted:P.muted,trackSolo:P.solo,trackHeightPx:w,isAnySolo:T,onVolumeChange:b,onMuteToggle:h,onSoloToggle:m})},P.id)})}),e.jsx("style",{children:`
        .track-list-sidebar-container::-webkit-scrollbar {
          display: none;
        }
      `})]})}));Qs.displayName="TrackListSidebar";const Va={time:"Time",measures:"Measures",sections:"Sections",chords:"Chords",tempo:"Tempo"},_a=({visibleRulers:t,rulerOrder:r,onRulerOrderChange:s})=>{const[n,o]=g.useState(null),i=r.filter(c=>t.includes(c)),a=(c,u)=>{o(u),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("text/plain",u)},l=c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},h=(c,u)=>{if(c.preventDefault(),!n||n===u){o(null);return}const p=[...r],x=p.indexOf(n),f=p.indexOf(u);p.splice(x,1),p.splice(f,0,n),s(p),o(null)},m=()=>{o(null)};return e.jsx("div",{className:"flex flex-col",children:i.map(c=>e.jsxs("div",{draggable:!0,onDragStart:u=>a(u,c),onDragOver:l,onDrop:u=>h(u,c),onDragEnd:m,className:`flex items-center justify-start px-3 border-b text-xs font-medium uppercase tracking-wider cursor-grab active:cursor-grabbing transition-opacity ${n===c?"opacity-50":"opacity-100"}`,style:{height:`${Ue.RULER_HEIGHT}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",color:"var(--daw-text-secondary)"},children:[e.jsx(Rs,{className:"w-3 h-3 mr-2 text-gray-500"}),Va[c]||c]},c))})},Ga=({zoom:t,onZoomIn:r,onZoomOut:s,onFitToView:n})=>e.jsxs("div",{className:"flex items-center justify-center gap-2 px-2",children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",opacity:t<=1?.5:1},onClick:s,disabled:t<=1,children:e.jsx(Rr,{className:"w-4 h-4"})})}),e.jsx(ye,{children:"Zoom Out"})]}),e.jsxs("span",{className:"text-xs tabular-nums w-14 text-center",style:{color:"#9E9E9E"},children:[Math.round(t*100),"%"]}),e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",opacity:t>=8?.5:1},onClick:r,disabled:t>=8,children:e.jsx(Ir,{className:"w-4 h-4"})})}),e.jsx(ye,{children:"Zoom In"})]}),e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-7 w-7 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:n,children:e.jsx(Is,{className:"w-4 h-4"})})}),e.jsx(ye,{children:"Fit to View"})]})]});function Wa({...t}){return e.jsx(un,{"data-slot":"popover",...t})}function Ha({...t}){return e.jsx(mn,{"data-slot":"popover-trigger",...t})}function qa({className:t,align:r="center",sideOffset:s=4,...n}){return e.jsx(hn,{children:e.jsx(fn,{"data-slot":"popover-content",align:r,sideOffset:s,className:Ee("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...n})})}function Ka({tracks:t,presets:r,onSavePreset:s,onLoadPreset:n,onDeletePreset:o}){const[i,a]=g.useState(!1),[l,h]=g.useState(""),[m,c]=g.useState(""),u=()=>{if(!l.trim()){Te.error("Please enter a preset name");return}s(l),h(""),a(!1),Te.success(`Mix preset "${l}" saved successfully`)},p=()=>{if(!m){Te.error("Please select a preset to load");return}const f=r.find(v=>v.id===m);if(!f){Te.error("Preset not found");return}n(f),Te.success(`Mix preset "${f.name}" loaded successfully`)},x=f=>{const v=r.find(y=>y.id===f);window.confirm(`Are you sure you want to delete preset "${v?.name}"?`)&&(o(f),m===f&&c(""),Te.success("Mix preset deleted"))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(bt,{open:i,onOpenChange:a,children:[e.jsx($r,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"sm",className:"w-full",title:"Save current mix as preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(Br,{className:"w-4 h-4 mr-2"}),"Save Current Mix"]})}),e.jsxs(yt,{children:[e.jsxs(jt,{children:[e.jsx(wt,{children:"Save Mix Preset"}),e.jsx(Nt,{children:"Save the current volume and mute settings as a mix preset."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"preset-name",children:"Preset Name"}),e.jsx(Ie,{id:"preset-name",placeholder:"e.g., Rehearsal Mix, Live Mix, etc.",value:l,onChange:f=>h(f.target.value),onKeyDown:f=>{f.key==="Enter"&&u()}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Current Settings:"}),e.jsx("div",{className:"max-h-48 overflow-y-auto border rounded p-2 space-y-1",children:t.map(f=>e.jsxs("div",{className:"text-sm flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:f.name}),e.jsx("span",{className:"text-gray-500",children:f.muted?"Muted":`${Math.round(f.volume*100)}%`})]},f.id))})]})]}),e.jsxs(Lr,{children:[e.jsx(Or,{asChild:!0,children:e.jsx(I,{variant:"outline",children:"Cancel"})}),e.jsx(I,{onClick:u,children:"Save Preset"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Pe,{value:m,onValueChange:c,children:[e.jsx(Ae,{className:"w-full",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:e.jsx(De,{placeholder:"Select preset..."})}),e.jsx(Fe,{children:r.length===0?e.jsx("div",{className:"px-2 py-1.5 text-sm text-gray-500",children:"No presets saved"}):r.map(f=>e.jsx(je,{value:f.id,children:f.name},f.id))})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(I,{variant:"outline",size:"sm",className:"flex-1",onClick:p,disabled:!m,title:"Load selected preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(zr,{className:"w-4 h-4 mr-1"}),"Load"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>m&&x(m),disabled:!m,title:"Delete selected preset",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1",borderColor:"var(--daw-border)"},children:[e.jsx(ts,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]})}const Ua=({sidebarVisible:t,mixerDockVisible:r,notesPanelVisible:s,mixPresetsPopoverOpen:n,tracks:o,mixPresets:i,onToggleSidebar:a,onToggleMixer:l,onToggleNotes:h,onPerformanceMode:m,onMixPresetsOpenChange:c,onSaveMixPreset:u,onLoadMixPreset:p,onDeleteMixPreset:x})=>e.jsxs("div",{className:"border-t flex items-center justify-between h-10 px-3",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:a,children:t?e.jsx(Vr,{className:"w-4 h-4"}):e.jsx(_r,{className:"w-4 h-4"})})}),e.jsx(ye,{children:t?"Hide Sidebar":"Show Sidebar"})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Wa,{open:n,onOpenChange:c,children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(Ha,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"6",y1:"4",x2:"6",y2:"20"}),e.jsx("rect",{x:"4",y:"7",width:"4",height:"3",rx:"1",fill:"currentColor"}),e.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20"}),e.jsx("rect",{x:"10",y:"11",width:"4",height:"3",rx:"1",fill:"currentColor"}),e.jsx("line",{x1:"18",y1:"4",x2:"18",y2:"20"}),e.jsx("rect",{x:"16",y:"9",width:"4",height:"3",rx:"1",fill:"currentColor"})]})})})}),e.jsx(ye,{children:"Mix Presets"})]}),e.jsx(qa,{align:"center",className:"w-72",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:e.jsx(Ka,{tracks:o,presets:i,onSavePreset:u,onLoadPreset:p,onDeletePreset:x})})]}),e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:r?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},onClick:l,children:e.jsx(Gr,{className:"w-4 h-4"})})}),e.jsx(ye,{children:r?"Hide Mixer":"Show Mixer"})]}),e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded",style:{backgroundColor:s?"#3B82F6":"var(--daw-control)",color:"#F1F1F1"},onClick:h,children:e.jsx(Wr,{className:"w-4 h-4"})})}),e.jsx(ye,{children:s?"Hide Notes":"Show Notes"})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded",style:{backgroundColor:"var(--daw-control)",color:"#F1F1F1"},onClick:m,children:e.jsx(Is,{className:"w-4 h-4"})})}),e.jsx(ye,{children:"Performance Mode"})]})})]}),Xa=({zoom:t,setZoom:r,timelineRef:s,rulerRef:n,currentTime:o})=>{const i=g.useRef(0),a=g.useRef(null),l=g.useCallback(c=>{n.current&&(n.current.scrollLeft=c)},[n]),h=g.useCallback(c=>{i.current=c,l(c)},[l]),m=g.useCallback((c,u)=>{r(c),s.current&&(s.current.scrollLeft=u),n.current&&(n.current.scrollLeft=u),i.current=u},[r,s,n]);return g.useEffect(()=>{const c=s.current,u=n.current,p=x=>{if(!x.ctrlKey&&!x.metaKey)return;x.preventDefault(),x.stopPropagation();const f=x.deltaY>0?1/de.FACTOR:de.FACTOR,v=Math.max(de.MIN,Math.min(de.MAX,t*f));if(v===t)return;const y=s.current?.getBoundingClientRect(),k=y?x.clientX-y.left:0,T=(s.current?.scrollLeft||0)+k,w=de.BASE_PPS*t,N=T/w;r(v);const C=de.BASE_PPS*v,M=N*C,E=Math.max(0,M-k);a.current=E};return c&&c.addEventListener("wheel",p,{passive:!1}),u&&u.addEventListener("wheel",p,{passive:!1}),()=>{c&&c.removeEventListener("wheel",p),u&&u.removeEventListener("wheel",p)}},[t,r,s,n]),g.useEffect(()=>{if(a.current!==null){const c=a.current;s.current&&(s.current.scrollLeft=c),n.current&&(n.current.scrollLeft=c),i.current=c,a.current=null}},[t,s,n]),{scrollLeftRef:i,handleTimelineScroll:h,handleNavigatorChange:m}},Za=({song:t,onSongUpdate:r})=>{const[s,n]=g.useState([]),o=g.useCallback(l=>{const h={id:`preset-${Date.now()}`,name:l,tracks:t.tracks.map(m=>({trackId:m.id,volume:m.volume??1,muted:m.muted??!1}))};n(m=>[...m,h])},[t.tracks]),i=g.useCallback(l=>{if(!r)return;const h=t.tracks.map(m=>{const c=l.tracks.find(u=>u.trackId===m.id);return c?{...m,volume:c.volume,muted:c.muted}:m});r({...t,tracks:h})},[t,r]),a=g.useCallback(l=>{n(h=>h.filter(m=>m.id!==l))},[]);return{mixPresets:s,handleSaveMixPreset:o,handleLoadMixPreset:i,handleDeleteMixPreset:a}},Ya=({song:t,onSongUpdate:r,editMode:s})=>{const[n,o]=g.useState(!1),[i,a]=g.useState("section"),[l,h]=g.useState(null),[m,c]=g.useState(0),u=g.useCallback(f=>{if(!s)return;const v=f.currentTarget.getBoundingClientRect(),k=(f.clientX-v.left)/50;c(k)},[s]),p=g.useCallback((f,v)=>{if(!r)return;let y={...t};switch(i){case"section":f==="delete"&&l?y.markers=t.markers?.filter(b=>b.time!==l.time)||[]:f==="update"&&l?y.markers=t.markers?.map(b=>b.time===l.time?{...b,...v}:b)||[]:y.markers=[...t.markers||[],v];break;case"chord":f==="delete"&&l?y.chordMarkers=t.chordMarkers?.filter(b=>b.time!==l.time)||[]:f==="update"&&l?y.chordMarkers=t.chordMarkers?.map(b=>b.time===l.time?{...b,...v}:b)||[]:y.chordMarkers=[...t.chordMarkers||[],v];break;case"tempo":f==="delete"&&l?y.tempoChanges=t.tempoChanges?.filter(b=>b.time!==l.time)||[]:f==="update"&&l?y.tempoChanges=t.tempoChanges?.map(b=>b.time===l.time?{...b,...v}:b)||[]:y.tempoChanges=[...t.tempoChanges||[],v];break}r(y),o(!1),h(null)},[t,r,l,i]),x=g.useCallback((f,v,y)=>{a(f),h(v||null),y!==void 0&&c(y),o(!0)},[]);return{editorOpen:n,setEditorOpen:o,editorType:i,editingMarker:l,clickedTime:m,handleTimelineClick:u,handleTimelineItemSubmit:p,openEditor:x}},Qa=({zoom:t,setZoom:r,song:s,containerWidth:n})=>{const o=g.useCallback(()=>!s||n===0?1:n/(s.duration*de.BASE_PPS),[s,n]),i=g.useCallback(()=>{r(h=>Math.max(de.MIN,h-.25))},[r]),a=g.useCallback(()=>{r(h=>Math.min(de.MAX,h+.25))},[r]),l=g.useCallback(()=>{const h=o(),m=Math.max(de.MIN,Math.min(de.MAX,h));r(m)},[o,r]);return{handleZoomOutOnPlayhead:i,handleZoomInOnPlayhead:a,handleFitToView:l}},Ja=({song:t})=>{const[r,s]=g.useState(0),[n,o]=g.useState(t?.source==="project"),[i,a]=g.useState(!1),[l,h]=g.useState(1e3),[m,c]=g.useState(!1),[u,p]=g.useState(!0),[x,f]=g.useState(!0),[v,y]=g.useState(!1),[k,b]=g.useState(!1),[T,w]=g.useState(null),[N,C]=g.useState(!1),[M,E]=g.useState([]),[P,z]=g.useState(!1),[G,$]=g.useState(null),[J,fe]=g.useState(0),[ue,te]=g.useState(new Set),[se,re]=g.useState(null),[L,ne]=g.useState(!1),[ee,ae]=g.useState(!1),[U,me]=g.useState("macro"),Ce=g.useRef(null),Me=g.useRef(null),H=g.useRef(null),Z=g.useRef(null);return g.useEffect(()=>{t&&E(t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}])},[t?.tempoChanges,t?.tempo]),{keyShift:r,setKeyShift:s,editMode:n,setEditMode:o,createProjectOpen:i,setCreateProjectOpen:a,containerWidth:l,setContainerWidth:h,snapEnabled:m,setSnapEnabled:c,sidebarVisible:u,setSidebarVisible:p,mixerVisible:x,setMixerVisible:f,mixerDockVisible:v,setMixerDockVisible:y,mixPresetsPopoverOpen:k,setMixPresetsPopoverOpen:b,selectedChord:T,setSelectedChord:w,showShortcutsHelp:N,setShowShortcutsHelp:C,dynamicTempos:M,setDynamicTempos:E,isDragging:P,setIsDragging:z,dragStartTime:G,setDragStartTime:$,scrollTop:J,setScrollTop:fe,pinnedTracks:ue,setPinnedTracks:te,selectedTrackForNotes:se,setSelectedTrackForNotes:re,notesPanelVisible:L,setNotesPanelVisible:ne,warpMode:ee,setWarpMode:ae,metronomeMode:U,setMetronomeMode:me,rulerRef:Ce,sidebarRef:Me,timelineRef:H,hoveredContainerRef:Z}};function Ze(t,r,s,n="4/4"){const[o]=n.split("/").map(Number),i=[...r].sort((c,u)=>c.time-u.time);let a=0,l=1,h=s;for(const c of i){if(c.time<=a){h=c.tempo;continue}const u=o*60/h,p=(c.time-a)/u,x=l+p;if(x>=t){const f=t-l;return a+f*u}a=c.time,l=x,h=c.tempo}const m=t-l;if(m>0){const c=o*60/h;a+=m*c}return a}function Jt(t,r,s,n="4/4"){const[o]=n.split("/").map(Number),i=[...r].sort((p,x)=>p.time-x.time);let a=0,l=1,h=s;for(const p of i){if(p.time<=a){h=p.tempo;continue}if(p.time>t){const y=t-a,k=o*60/h,b=y/k;return l+b}const x=p.time-a,f=o*60/h,v=x/f;a=p.time,l+=v,h=p.tempo}const m=t-a,c=o*60/h,u=m/c;return l+u}function Js(t,r,s){if(r<=0)return 120;const n=t*s*60/r;return Math.max(10,Math.min(999,n))}const eo=({song:t,zoom:r,currentTime:s,trackHeight:n})=>{const o=()=>de.BASE_PPS*r,i=()=>{switch(n){case"small":return 64;case"large":return 128;default:return 96}},a=()=>{const m=t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}];return Math.floor(Jt(s,m,t.tempo))},l=m=>{const c=t.tempoChanges||[{time:0,tempo:t.tempo,timeSignature:"4/4"}],u=Jt(m,c,t.tempo);return[...c].sort((f,v)=>f.time-v.time).slice().reverse().find(f=>f.time<=u)||c[0]};return{getPixelsPerSecond:o,getTrackHeightPx:i,getCurrentMeasure:a,getCurrentTempoInfo:l,getCurrentTimeSignature:()=>l(s).timeSignature}},to=({song:t,onSongUpdate:r})=>({handleWarpCommit:g.useCallback((n,o,i)=>{if(!t||!r)return;const a={...t},l=a.tempoChanges?[...a.tempoChanges]:[];l.sort((f,v)=>f.time-v.time);const h=l.find(f=>f.time>o);let m=0,c=0;h&&(c=h.time,m=Ze(c,l,t.tempo));const u=l.findIndex(f=>f.time===n);u>=0?l[u]={...l[u],tempo:i}:n===1&&l.push({time:1,tempo:i,timeSignature:"4/4"});let p=l.findIndex(f=>f.time===o),x=l[p];if(!x){const f=l.find(v=>v.time===n);x={time:o,tempo:f?f.tempo:i,timeSignature:f?f.timeSignature:"4/4"},l.push(x)}if(l.sort((f,v)=>f.time-v.time),h){const f=Ze(o,l,t.tempo),v=m-f,y=c-o;if(v>0&&y>0){const[k]=x.timeSignature.split("/").map(Number),b=Js(y,v,k);x.tempo=b;const T=l.findIndex(w=>w.time===o);T>=0&&(l[T]=x)}}a.tempoChanges=l,r(a)},[t,r])}),so=({song:t,onSongUpdate:r})=>{const s=g.useCallback((i,a,l)=>{if(!t||!r)return;const h={id:crypto.randomUUID(),userId:"current-user",content:i,time:l,isPrivate:a};r({...t,notes:[...t.notes||[],h]})},[t,r]),n=g.useCallback(i=>{!t||!r||r({...t,notes:(t.notes||[]).filter(a=>a.id!==i)})},[t,r]),o=g.useCallback((i,a)=>{if(!t||!r)return;const l=t.tracks.map(h=>h.id===a?{...h,notes:i}:h);r({...t,tracks:l})},[t,r]);return{handleAddSongNote:s,handleDeleteSongNote:n,handleSaveTrackNotes:o}},ro=({timelineRef:t,setContainerWidth:r,song:s,containerWidth:n,setZoom:o})=>{g.useEffect(()=>{const i=()=>{t.current&&r(t.current.clientWidth)},a=setTimeout(i,0);return window.addEventListener("resize",i),()=>{clearTimeout(a),window.removeEventListener("resize",i)}},[t,r]),g.useEffect(()=>{if(!s||n===0)return;const i=n/(s.duration*de.BASE_PPS),a=Math.max(de.MIN,Math.min(de.MAX,i));o(a),t.current&&(t.current.scrollLeft=0)},[s?.id,n,o,t])};function no({notes:t,currentUser:r,onAddNote:s,onDeleteNote:n}){const[o,i]=g.useState(""),[a,l]=g.useState(!1),h=()=>{o.trim()&&(s(o,a),i(""),l(!1))},m=[...t].sort((u,p)=>u.time!==void 0&&p.time!==void 0?u.time-p.time:u.time!==void 0?-1:p.time!==void 0?1:0),c=u=>{if(u===void 0)return null;const p=Math.floor(u/60),x=Math.floor(u%60);return`${p}:${x.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add personal notes or share with your team"})]}),e.jsx(ds,{children:e.jsxs(us,{className:"pt-6 space-y-3",children:[e.jsx(qs,{placeholder:"Add a note...",value:o,onChange:u=>i(u.target.value),rows:3}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{id:"private-note",checked:a,onCheckedChange:l}),e.jsxs(_,{htmlFor:"private-note",className:"text-sm flex items-center gap-1",children:[e.jsx(ms,{className:"w-3 h-3"}),"Private Note"]})]}),e.jsxs(I,{onClick:h,disabled:!o.trim(),children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"}),"Add Note"]})]})]})}),e.jsx("div",{className:"space-y-3",children:m.map(u=>e.jsxs(ds,{children:[e.jsx(Hr,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm",children:u.userId===r.id?"You":"Team Member"}),u.isPrivate?e.jsxs(Xe,{variant:"secondary",className:"text-xs",children:[e.jsx(ms,{className:"w-3 h-3 mr-1"}),"Private"]}):e.jsxs(Xe,{variant:"outline",className:"text-xs",children:[e.jsx(qr,{className:"w-3 h-3 mr-1"}),"Shared"]}),u.time!==void 0&&e.jsx(Xe,{variant:"outline",className:"text-xs",children:c(u.time)})]})}),u.userId===r.id&&e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n(u.id),children:e.jsx(ts,{className:"w-4 h-4"})})]})}),e.jsx(us,{children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:u.content})})]},u.id))}),t.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"No notes yet"})})]})}const er=W.memo(({track:t,isAnySolo:r,onVolumeChange:s,onMuteToggle:n,onSoloToggle:o})=>{const[i,a]=W.useState(ot(t.volume)),[l,h]=W.useState(!1);W.useEffect(()=>{l||a(ot(t.volume))},[t.volume,l]);const m=v=>{a(v[0])},c=()=>{h(!0)},u=()=>{h(!1),s(t.id,rs(i))},p=()=>{a(ot(1)),s(t.id,1)},x=r&&!t.solo,f=t.muted||x;return e.jsxs("div",{className:"flex flex-col items-center gap-3 min-w-[70px]",children:[e.jsx("div",{className:"text-xs text-center truncate w-full px-1 text-neutral-50",title:t.name,children:t.name}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center min-h-0",children:e.jsx(Bt,{children:e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx("div",{className:"h-full flex items-center",onDoubleClick:p,children:e.jsx(lt,{orientation:"vertical",value:[i],min:0,max:100,step:.1,onValueChange:m,onPointerDown:c,onPointerUp:u,className:"h-32",disabled:f})})}),e.jsxs(ye,{side:"top",children:[gt(Pt(i))," • Double-click to reset"]})]})})}),e.jsx("div",{className:`text-xs tabular-nums text-center min-w-[45px] ${f?"text-neutral-600":"text-neutral-400"}`,children:gt(Pt(i))}),e.jsx(I,{variant:"ghost",size:"sm",className:`h-7 w-8 text-xs p-0 ${t.muted?"bg-red-500 text-white hover:bg-red-600":"bg-neutral-700 text-neutral-50 hover:bg-neutral-600"}`,onClick:()=>n(t.id),children:"M"}),e.jsx(I,{variant:"ghost",size:"sm",className:`h-7 w-8 text-xs p-0 ${t.solo?"bg-amber-400 text-black hover:bg-amber-500":"bg-neutral-700 text-neutral-50 hover:bg-neutral-600"}`,onClick:()=>o(t.id),children:"S"}),e.jsx("div",{className:"w-full h-1 rounded",style:{backgroundColor:t.color}})]})});er.displayName="MixerFader";function ao({tracks:t,onTrackVolumeChange:r,onTrackMuteToggle:s,onTrackSoloToggle:n,onClose:o}){const i=t.some(a=>a.solo);return e.jsxs("div",{className:"w-full flex flex-col border-t h-[240px]",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:[e.jsxs("div",{className:"h-10 border-b flex items-center justify-between px-3 bg-neutral-800 border-neutral-700",children:[e.jsx("h3",{className:"text-sm text-neutral-50",children:"Mixer"}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-7 w-7 text-neutral-400 hover:text-neutral-50",onClick:o,children:e.jsx($s,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden p-4",children:e.jsx("div",{className:"flex gap-4 h-full",children:t.map(a=>e.jsx(er,{track:a,isAnySolo:i,onVolumeChange:r,onMuteToggle:s,onSoloToggle:n},a.id))})})]})}const oo=({mixerDockVisible:t,notesPanelVisible:r,song:s,orderedTracks:n,onCloseMixerDock:o,onCloseNotesPanel:i,onTrackVolumeChange:a,onTrackMuteToggle:l,onTrackSoloToggle:h,onAddNote:m,onDeleteNote:c})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(ao,{tracks:n,onTrackVolumeChange:a,onTrackMuteToggle:l,onTrackSoloToggle:h,onClose:o}),r&&s&&e.jsxs("div",{className:"w-full flex flex-col border-t",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)",height:"240px"},children:[e.jsxs("div",{className:"h-10 border-b flex items-center justify-between px-3",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:"var(--daw-text-primary)"},children:"Song Notes"}),e.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-700 rounded",children:e.jsx($s,{className:"w-4 h-4",style:{color:"var(--daw-text-primary)"}})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-3",style:{backgroundColor:"var(--daw-bg-contrast)"},children:e.jsx(no,{notes:s.notes||[],currentUser:{id:"current-user",name:"You"},onAddNote:m,onDeleteNote:c})})]})]});function io(t,r,s="4/4",n=!0,o=50,i,a,l){const h=[],m=l?[...l].sort((T,w)=>T.time-w.time):[];let c=1,u=0,p=r,x=s,f=vt(x,p),v=vs(f),y=0;const k=Math.max(0,0),b=Math.min(t,t);for(;u<t;){for(;y<m.length&&m[y].time<=u;){const C=m[y];p=C.tempo,C.timeSignature&&(x=C.timeSignature,f=vt(x,p),v=vs(f)),y++}const T=60/p,w=f.measureDurationInQuarters*T;if(u+w>=k&&u<=b&&(u>=k&&h.push({position:u,opacity:1,type:"measure",accentLevel:2,measureNumber:c}),n||o>25)){const C=w/f.pulsesPerMeasure;if(v.allPulses.forEach((M,E)=>{if(M===0)return;const P=u+M*C;if(P>=k&&P<=b&&P<t){const z=v.accentLevels[E];v.macroBeats.includes(M)?h.push({position:P,opacity:z===2?1:.6,type:"beat",accentLevel:z}):n&&o>50&&h.push({position:P,opacity:.3,type:"subdivision",accentLevel:z})}}),n&&o>80){const M=C/4,E=f.pulsesPerMeasure*4;for(let P=1;P<E;P++){if(P%4===0)continue;const z=u+P*M;z>=k&&z<=b&&z<t&&h.push({position:z,opacity:.2,type:"subdivision",accentLevel:0})}}}u+=w,c++}return h}const lo=({song:t,timelineWidth:r,onWarpCommit:s,warpMode:n})=>{const[o,i]=g.useState(!1),[a,l]=g.useState(null),[h,m]=g.useState(null),c=g.useCallback((u,p)=>{if(!n)return!1;u.preventDefault(),u.stopPropagation();const f=(u.clientX-p.left)/r*t.duration,v=t.tempoChanges||[],y=Jt(f,v,t.tempo),k=Math.round(y),T=[...v].sort((M,E)=>M.time-E.time).slice().reverse().find(M=>M.time<k),w=T?T.time:1;if(k<=w)return!0;const N=Ze(w,v,t.tempo),C=Ze(k,v,t.tempo);return l({dragMeasure:k,anchorMeasure:w,anchorTime:N,startPixel:u.clientX,originalTime:C}),i(!0),m(C),!0},[n,r,t]);return g.useEffect(()=>{if(!o||!a)return;const u=x=>{document.body.style.cursor="col-resize";const f=x.clientX-a.startPixel,v=r/t.duration,y=f/v,k=a.originalTime+y;k>a.anchorTime&&m(k)},p=x=>{document.body.style.cursor="default";const f=x.clientX-a.startPixel,v=r/t.duration,y=f/v,k=a.originalTime+y;if(k<=a.anchorTime){i(!1),l(null),m(null);return}const b=a.dragMeasure-a.anchorMeasure,T=k-a.anchorTime,w=(t.tempoChanges||[]).find(E=>E.time===a.anchorMeasure),N=w?w.timeSignature:"4/4",[C]=N.split("/").map(Number),M=Js(b,T,C);s&&s(a.anchorMeasure,a.dragMeasure,M),i(!1),l(null),m(null)};return window.addEventListener("mousemove",u),window.addEventListener("mouseup",p),()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",p),document.body.style.cursor="default"}},[o,a,r,t,s]),{isWarpDragging:o,warpState:a,warpGhostTime:h,handleWarpMouseDown:c}};function co({key:t,timeSignature:r="4/4",scale:s="major",tempo:n=120}){const o=g.useMemo(()=>Je(t,s),[t,s]),i=g.useMemo(()=>r?vt(r,n):null,[r,n]),a=g.useCallback(m=>{const c=Ve(m);return fs(c.root,t,s)},[t,s]),l=g.useCallback(m=>{const c=Ve(m);return _e(c.root,t,s)},[t,s]),h=g.useCallback(m=>{const c=Ve(m),u=_e(c.root,t,s),p=fs(c.root,t,s),x=Gn(c.root,t),f=Wn(c.root,t);return{parsed:c,romanNumeral:u,isDiatonic:p,functionAnalysis:x,isBorrowed:f.isBorrowed,borrowedFrom:f.sourceKey}},[t,s]);return{scaleNotes:o,timeSignatureInfo:i,analyzeChord:h,isChordDiatonic:a,getChordRomanNumeral:l}}function uo(t){const{key:r,scale:s="major"}=t,{analyzeChord:n,scaleNotes:o}=co({key:r,scale:s}),i=g.useMemo(()=>m=>{const c=n(m);if(!c||!c.romanNumeral)return null;const u=Tn(c.parsed.root,c.parsed.quality);return{romanNumeral:c.romanNumeral,isDiatonic:c.isDiatonic,isBorrowed:c.isBorrowed,function:c.functionAnalysis?.function||"unknown",quality:c.parsed.quality||"major",notes:u}},[n]),a=g.useMemo(()=>m=>m.map(c=>{const u=i(c.chord);return{...c,analysis:u||void 0}}),[i]),l=g.useMemo(()=>m=>a(m).filter(u=>u.analysis?.isBorrowed),[a]),h=g.useMemo(()=>m=>{const c=a(m),u={total:c.length,diatonic:0,borrowed:0,byFunction:{}};return c.forEach(p=>{if(p.analysis){p.analysis.isDiatonic&&u.diatonic++,p.analysis.isBorrowed&&u.borrowed++;const x=p.analysis.function;u.byFunction[x]=(u.byFunction[x]||0)+1}}),u},[a]);return{getChordAnalysis:i,analyzeChordMarkers:a,getBorrowedChords:l,getChordStatistics:h,scaleNotes:o}}const mo=({rulerId:t,song:r,timelineWidth:s,zoom:n,editMode:o,keyShift:i,showBeats:a,onRulerDrop:l,onRulerDragOver:h,onSectionClick:m,onTempoMarkerClick:c,onChordClick:u,onTimeClick:p,onTempoMarkerAdd:x,onChordAdd:f,hoverLineRef:v,onLoopRegionChange:y,loopStart:k=null,loopEnd:b=null,scrollLeft:T=0,containerWidth:w=1e3,warpMode:N=!1,onWarpCommit:C})=>{const{analyzeChordMarkers:M}=uo({key:r.key||"C",scale:r.scale==="minor"?"minor":"major"}),E=g.useMemo(()=>M(r.chordMarkers||[]),[M,r.chordMarkers]),{warpGhostTime:P,handleWarpMouseDown:z}=lo({song:r,timelineWidth:s,onWarpCommit:C,warpMode:N}),[G,$]=W.useState(!1),[J,fe]=W.useState(null),[ue,te]=W.useState(null),[se,re]=W.useState(null),[L,ne]=W.useState(!0),[ee,ae]=W.useState(!1),U=O=>{if(!L||H.length===0)return O;let V=0,S=H.length-1;for(;V<=S;){const A=Math.floor((V+S)/2);H[A].position<O?V=A+1:S=A-1}const R=H[V],F=H[V-1];return R&&F?O-F.position<R.position-O?F.position:R.position:R?R.position:F?F.position:O},me=O=>{const V=O.currentTarget.getBoundingClientRect();if(!(N&&t==="measures"&&z(O,V))){if(!N&&t==="measures"&&y&&O.shiftKey){O.stopPropagation();const R=(O.clientX-V.left)/s*r.duration,F=U(R);$(!0),fe(F),te(F);return}if(o&&!N){if(t==="tempo"&&x){const R=(O.clientX-V.left)/s*r.duration,F=U(R);x(F);return}if(t==="chords"&&f){const R=(O.clientX-V.left)/s*r.duration,F=U(R);f(F);return}}if(!N){const R=(O.clientX-V.left)/s*r.duration,F=U(R);p&&O.clientY-V.top<Ue.RULER_HEIGHT/2&&p(Math.max(0,Math.min(F,r.duration)))}}},Ce=()=>{const V=n>=8?1:n>=4?2:n>=2?5:n>=.5?10:30,S=[];for(let R=0;R<=r.duration;R+=V)S.push(R);return S},Me=g.useMemo(()=>Math.round(n*10)/10,[n]),H=g.useMemo(()=>io(r.duration,r.tempo||120,"4/4",a,Me*100,void 0,void 0,r.tempoChanges),[r.duration,r.tempo,r.tempoChanges,o,Me,a]),Z=g.useMemo(()=>{const O=[];let V=0,S=-1,R=-100;const F=50,A=s/r.duration,K=60/(r.tempo||120)*A,q=a&&K>=25,Y=a&&K>=80;return H.forEach((Q,X)=>{if(Q.type==="measure"){V++,S=Q.position;const xe=Q.position/r.duration*s,he=xe-R>=F;he&&(R=xe),O.push({time:Q.position,measure:he?V:null,beat:1,isBeat:!1,opacity:Q.opacity,height:"100%",width:2,color:"rgba(255,255,255,0.6)"})}else if(Q.type==="beat"&&q){const pe=H.slice(0,X).filter(ie=>ie.position>S&&ie.type==="beat").length+2,he=pe===4||pe===7||pe===10;O.push({time:Q.position,measure:null,beat:pe,isBeat:!0,opacity:Q.opacity,height:he?"70%":"55%",width:he?1.5:1,color:he?"rgba(255,255,255,0.35)":"rgba(255,255,255,0.25)"})}else Q.type==="subdivision"&&Y&&O.push({time:Q.position,measure:null,beat:0,isBeat:!0,opacity:Q.opacity*.5,height:"30%",width:1,color:"rgba(255,255,255,0.15)"})}),O},[H,n,a,r.duration,s,r.tempo,T,w]);switch(t){case"time":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${Ue.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:S=>l(S,"time"),onDragOver:h,onMouseDown:me,children:Ce().map(S=>e.jsx("div",{className:"absolute top-0 bottom-0 border-l",style:{left:S/r.duration*s,borderColor:"var(--daw-border)"},children:e.jsx("span",{className:"absolute top-0.5 left-1 text-[10px]",style:{color:"var(--daw-text-secondary)"},children:Qt(S)})},S))});case"measures":return e.jsxs("div",{className:"border-b relative cursor-pointer transition-colors duration-300",style:{height:`${Ue.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:N?"rgba(249, 115, 22, 0.15)":"var(--daw-bg-contrast)",borderColor:N?"#f97316":"var(--daw-border)"},onDrop:S=>l(S,"measures"),onDragOver:h,onMouseDown:me,onMouseMove:S=>{const R=S.currentTarget.getBoundingClientRect(),A=(S.clientX-R.left)/s*r.duration,K=U(A);if(re(K),G&&J!==null&&y){const q=Math.min(J,K),Y=Math.max(J,K);y(q,Y)}},onMouseUp:()=>{G&&($(!1),fe(null),te(null))},onMouseLeave:()=>{re(null),G&&($(!1),fe(null),te(null))},children:[Z.map((S,R)=>{const F=S.time/r.duration*s;if(!S.measure&&!S.isBeat)return null;const A=S.height,K=S.width,q=S.color,Y="var(--daw-text-secondary)",Q=A==="100%"?"0":A==="70%"?"15%":A==="55%"?"22.5%":"35%",X=r.tempoChanges?.find(xe=>Math.abs(xe.time-S.time)<.01);return X&&X.timeSignature&&X.timeSignature.includes("8")&&["6/8","9/8","12/8"].includes(X.timeSignature),X&&X.subdivision,e.jsxs("div",{className:`absolute transition-colors ${N?"hover:bg-orange-400/30":""}`,style:{left:F,top:Q,height:A,width:`${K}px`,backgroundColor:q},title:S.isCompound?"Compound Time":S.isIrregular?"Irregular Time":void 0,children:[S.measure&&e.jsx("span",{className:"absolute -top-4 left-1 text-[10px] font-semibold whitespace-nowrap",style:{color:Y},children:S.measure}),a&&S.isBeat&&S.beat>0&&e.jsx("span",{className:"absolute -top-4 left-1 text-[9px] whitespace-nowrap",style:{color:"var(--daw-text-muted)"},children:S.beat})]},R)}),N&&(r.tempoChanges||[]).map((S,R)=>{const A=Ze(S.time,r.tempoChanges||[],r.tempo)/r.duration*s;return e.jsx("div",{className:"absolute -top-0.5 -left-1.5 w-3 h-3 z-20 pointer-events-none",style:{left:A,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #f97316",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}},`warp-anchor-${R}`)}),se!==null&&!N&&e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-cyan-400/50 pointer-events-none transition-all duration-75",style:{left:se/r.duration*s},children:e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 px-1.5 py-0.5 bg-cyan-500 text-white text-[9px] rounded whitespace-nowrap",children:Qt(se)})}),P!==null&&e.jsxs("div",{className:"absolute top-0 bottom-0 w-0.5 bg-orange-500 z-50 pointer-events-none",style:{left:P/r.duration*s},children:[e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 px-1.5 py-0.5 bg-orange-500 text-white text-[9px] rounded whitespace-nowrap font-bold",children:"WARP"}),e.jsx("div",{className:"absolute -top-0.5 -left-1.5 w-3 h-3 z-50",style:{borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #f97316",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}})]}),G&&J!==null&&se!==null&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-yellow-500/20 border-l-2 border-r-2 border-yellow-500/60 pointer-events-none",style:{left:Math.min(J,se)/r.duration*s,width:Math.abs(se-J)/r.duration*s}})]});case"tempo":const V=[...o?r.tempoChanges||[]:(r.tempoChanges||[]).filter(S=>!S.hidden)].sort((S,R)=>S.time-R.time);return e.jsxs("div",{className:"tempo-ruler-interactive border-b relative cursor-pointer transition-all duration-300",style:{height:ee?"120px":`${Ue.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:S=>l(S,"tempo"),onDragOver:h,onMouseDown:me,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-4 z-50 flex items-center justify-center hover:bg-white/10 cursor-pointer text-[10px] text-muted-foreground",onClick:S=>{S.stopPropagation(),ae(!ee)},title:ee?"Collapse Tempo View":"Expand Tempo View",children:e.jsx("div",{className:`transform transition-transform ${ee?"rotate-90":"rotate-0"}`,children:"▶"})}),ee&&e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none opacity-30",children:e.jsx("polyline",{points:V.map(S=>{const R=Ze(S.time,r.tempoChanges||[],r.tempo)/r.duration*s,F=120-(Math.min(Math.max(S.tempo,60),200)-60)/140*120;return`${R},${F}`}).join(" "),fill:"none",stroke:"#f97316",strokeWidth:"2"})}),V.map((S,R)=>{const F=R>0?V[R-1]:null,A=!F||F.timeSignature!==S.timeSignature,K=Ze(S.time,r.tempoChanges||[],r.tempo);return e.jsxs("div",{className:"absolute top-0.5 flex items-start cursor-pointer group z-10",style:{left:K/r.duration*s},onClick:q=>{q.stopPropagation(),q.preventDefault(),o&&c(S)},children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-px",style:{backgroundColor:"#f97316",opacity:.4,height:ee?"120px":"100%"}}),e.jsxs("div",{className:"absolute top-0 -translate-x-1/2 flex gap-1 flex-col items-center",children:[e.jsx("div",{className:"hover:brightness-110 transition-all",style:{backgroundColor:"#f97316",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},children:Xs(S.tempo)}),A&&e.jsx("div",{className:"hover:brightness-110 transition-all mt-0.5",style:{backgroundColor:"#6b7280",color:"#fff",fontSize:"10px",fontWeight:"600",padding:"3px 6px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},children:S.timeSignature})]})]},`tempo-${R}`)})]});case"chords":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${Ue.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:S=>l(S,"chords"),onDragOver:h,onMouseDown:me,children:e.jsx(Bt,{children:E.map((S,R)=>e.jsxs("div",{className:"absolute top-0.5 flex flex-col gap-0.5",style:{left:S.time/r.duration*s},children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsx("div",{className:"cursor-pointer hover:brightness-110 transition-all",style:{backgroundColor:S.analysis?.isBorrowed?"#f59e0b":"#3b82f6",color:"#fff",fontSize:"11px",fontWeight:"600",padding:"3px 7px",borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",whiteSpace:"nowrap"},onClick:F=>{F.stopPropagation(),u(S)},children:Dt(S.chord,i)})}),e.jsx(ye,{side:"bottom",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{className:"font-bold",children:Dt(S.chord,i)}),S.analysis&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Roman:"})," ",e.jsx("span",{className:"font-semibold",children:S.analysis.romanNumeral})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Function:"})," ",S.analysis.function]}),S.analysis.isBorrowed&&e.jsx("div",{className:"text-orange-400",children:"⚠ Borrowed chord"})]})]})})]}),S.analysis&&e.jsx("div",{className:"text-center",style:{fontSize:"9px",fontWeight:"600",color:S.analysis.isBorrowed?"#f59e0b":"#64748b",backgroundColor:"rgba(0,0,0,0.05)",padding:"1px 4px",borderRadius:"2px",whiteSpace:"nowrap"},children:S.analysis.romanNumeral})]},R))})});case"sections":return e.jsx("div",{className:"border-b relative cursor-pointer",style:{height:`${Ue.RULER_HEIGHT}px`,width:`${s}px`,backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},onDrop:S=>l(S,"sections"),onDragOver:h,onMouseDown:me,children:r.markers.map((S,R)=>{const F=S.time/r.duration*s,A=r.markers[R+1],K=A?(A.time-S.time)/r.duration*s:s-F,q={intro:{bg:"#22c55e",text:"#fff"},verse:{bg:"#3b82f6",text:"#fff"},chorus:{bg:"#ef4444",text:"#fff"},bridge:{bg:"#f59e0b",text:"#fff"},outro:{bg:"#8b5cf6",text:"#fff"},"pre-chorus":{bg:"#ec4899",text:"#fff"},instrumental:{bg:"#14b8a6",text:"#fff"},tag:{bg:"#64748b",text:"#fff"},custom:{bg:"#6b7280",text:"#fff"}},Y=q[S.type]||q.custom;return e.jsx("div",{className:"absolute top-0.5 cursor-pointer hover:brightness-110 transition-all",style:{left:F,width:Math.max(40,K-4),height:"24px",backgroundColor:Y.bg,borderRadius:"3px",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 1px 2px rgba(0,0,0,0.2)"},onClick:Q=>{Q.stopPropagation(),m(R)},children:e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-semibold pointer-events-none truncate px-2",style:{color:Y.text},children:S.label})},S.id)})});default:return null}},tr=W.memo(({song:t,currentTime:r,gridTime:s,tempo:n,zoom:o,pixelsPerSecond:i,containerWidth:a,visibleRulers:l,rulerOrder:h,onTimeClick:m,onMarkerEdit:c,onMarkerDelete:u,editMode:p,keyShift:x,onChordClick:f,onLoopRegionChange:v,loopStart:y,loopEnd:k,scrollLeft:b,warpMode:T=!1,onWarpCommit:w,onTempoMarkerAdd:N,onChordAdd:C})=>{const M=i||o*100,E=h.filter($=>l.includes($)),P=$=>{f&&f($.chord,$.customDiagram)},z=$=>{p&&!T&&c&&t.markers[$]&&c(t.markers[$],"section")},G=$=>{p&&!T&&c&&c($,"tempo")};return e.jsxs("div",{className:"relative flex-shrink-0 z-10",style:{width:`${t.duration*M}px`},children:[e.jsx("div",{className:"absolute top-0 bottom-0 z-50 pointer-events-none",style:{left:`${r*M}px`},children:e.jsx("div",{className:"absolute top-0 bottom-0",style:{width:"2px",backgroundColor:"#ef4444"},children:e.jsx("div",{className:"absolute -top-0 left-1/2 -translate-x-1/2",style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"8px solid #ef4444"}})})}),E.map($=>e.jsx(mo,{rulerId:$,song:t,timelineWidth:t.duration*M,zoom:o,editMode:p,keyShift:x,showBeats:!0,onRulerDrop:()=>{},onRulerDragOver:J=>J.preventDefault(),onSectionClick:z,onTempoMarkerClick:G,onChordClick:P,onTimeClick:m,onLoopRegionChange:$==="measures"?v:void 0,loopStart:y,loopEnd:k,scrollLeft:b,containerWidth:a,warpMode:T,onWarpCommit:w,onTempoMarkerAdd:N,onChordAdd:C},$))]})});tr.displayName="RulersContainer";const ho=({songDuration:t,zoom:r,containerWidth:s,timelineRef:n,onNavigate:o})=>{const[i,a]=g.useState({start:0,end:1}),l=g.useRef(!1);g.useEffect(()=>{const m=n.current;if(!m)return;const c=()=>{if(l.current)return;const u=m.scrollLeft,p=t*de.BASE_PPS*r;if(p===0)return;const x=u/p,f=(u+s)/p;a({start:Math.max(0,x),end:Math.min(1,f)})};return c(),m.addEventListener("scroll",c),()=>m.removeEventListener("scroll",c)},[t,r,s,n]);const h=W.useCallback(({start:m,end:c})=>{l.current=!0,a({start:m,end:c});const u=c-m;if(u<=1e-4)return;const x=s/u/(t*de.BASE_PPS),f=Math.max(de.MIN,Math.min(de.MAX,x)),v=t*de.BASE_PPS*f,y=m*v;o(f,y),setTimeout(()=>{l.current=!1},100)},[s,t,o]);return e.jsx("div",{className:"flex-1 px-4 flex items-center h-full",children:e.jsx(Jn,{start:i.start,end:i.end,onChange:h,className:"h-5 w-full"})})};function fo({song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n,onExportProject:o}){const{t:i}=dt(),a=ma(),{zoom:l,setZoom:h,trackHeight:m,setTrackHeight:c,rulerVisibility:u,rulerOrder:p,setRulerOrder:x}=a,f=Ja({song:t}),{keyShift:v,setKeyShift:y,editMode:k,setEditMode:b,createProjectOpen:T,setCreateProjectOpen:w,containerWidth:N,setContainerWidth:C,snapEnabled:M,setSnapEnabled:E,sidebarVisible:P,setSidebarVisible:z,mixerVisible:G,mixerDockVisible:$,setMixerDockVisible:J,mixPresetsPopoverOpen:fe,setMixPresetsPopoverOpen:ue,selectedChord:te,setSelectedChord:se,showShortcutsHelp:re,setShowShortcutsHelp:L,setIsDragging:ne,scrollTop:ee,pinnedTracks:ae,setPinnedTracks:U,selectedTrackForNotes:me,setSelectedTrackForNotes:Ce,notesPanelVisible:Me,setNotesPanelVisible:H,warpMode:Z,setWarpMode:O,metronomeMode:V,setMetronomeMode:S,rulerRef:R,sidebarRef:F,timelineRef:A,hoveredContainerRef:K}=f,{isPlaying:q,currentTime:Y,gridTime:Q,tempo:X,loopEnabled:xe,loopStart:pe,loopEnd:he,metronomeEnabled:ie,metronomeVolume:Re,actions:ge}=ca({song:t,warpModeEnabled:!1}),le=xa({song:t,onSongUpdate:r}),{mixPresets:ut,handleSaveMixPreset:Ge,handleLoadMixPreset:We,handleDeleteMixPreset:He}=Za({song:t,onSongUpdate:r}),{editorOpen:qe,setEditorOpen:mt,editorType:j,editingMarker:D,clickedTime:oe,handleTimelineClick:ce,handleTimelineItemSubmit:ke,openEditor:Be}=Ya({song:t,onSongUpdate:r,editMode:k}),{handleZoomOutOnPlayhead:Ke,handleZoomInOnPlayhead:kt,handleFitToView:ht}=Qa({zoom:l,setZoom:h,song:t,containerWidth:N}),{handleTimelineScroll:et,handleNavigatorChange:Lt}=Xa({zoom:l,setZoom:h,timelineRef:A,rulerRef:R,currentTime:Y}),{getPixelsPerSecond:Mt,getTrackHeightPx:Ot,getCurrentMeasure:zt,getCurrentTimeSignature:sr}=eo({song:t,zoom:l,currentTime:Y,trackHeight:m}),{handleWarpCommit:rr}=to({song:t,onSongUpdate:r}),{handleAddSongNote:nr,handleDeleteSongNote:ar,handleSaveTrackNotes:or}=so({song:t,onSongUpdate:r});ro({timelineRef:A,setContainerWidth:C,song:t,containerWidth:N,setZoom:h});const ir=B=>{a.setRulerVisibility(B),Object.entries(B).forEach(([we,Se])=>{$e.setRulerVisibility(we,Se)})},lr=W.useCallback(()=>{ne(!1)},[]),cr=W.useCallback(B=>{K.current!=="timeline"&&A.current&&A.current.scrollTop!==B&&(A.current.scrollTop=B)},[]),dr=W.useCallback(B=>{if(!A.current)return;const we=A.current.scrollHeight,Se=B.start*we;A.current.scrollTop=Se,F.current&&(F.current.scrollTop=Se)},[]),ur=W.useCallback(()=>{if(!A.current)return{start:0,end:1};const B=A.current.scrollHeight,we=A.current.clientHeight;if(B<=we)return{start:0,end:1};const Se=A.current.scrollTop,Nr=Se/B,Cr=(Se+we)/B;return{start:Nr,end:Cr}},[ee]),mr=W.useCallback(B=>{},[]),hr=W.useCallback((B,we)=>{},[]),fr=W.useCallback(()=>{},[]),xr=W.useCallback(()=>{},[]),pr=W.useCallback(()=>{J(!1)},[]);da({isPlaying:q,onPlayPause:ge.togglePlayPause,onStop:()=>ge.seek(0),onToggleLoop:()=>ge.setLoopEnabled(!xe),onToggleMetronome:()=>ge.setMetronomeEnabled(!ie),onZoomIn:()=>h(B=>Math.min(8,B+.25)),onZoomOut:()=>h(B=>Math.max(.5,B-.25)),onGoToStart:()=>ge.seek(0),onGoToEnd:()=>ge.seek(t?.duration||0),onFitToView:()=>{if(t&&N>0){const B=N/(t.duration*de.BASE_PPS),we=Math.max(de.MIN,Math.min(de.MAX,B));h(we),et(0)}},onToggleEditMode:()=>b(B=>!B)});const[gr,po]=W.useState(null),vr=B=>{k&&!Z?Be("chord",B):se({chord:B.chord,customDiagram:B.customDiagram})};if(!t)return e.jsxs("div",{className:"flex flex-col h-full text-white",style:{backgroundColor:"var(--daw-bg-main)"},children:[e.jsxs("div",{className:"border-b p-3 flex items-center justify-between",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsxs(I,{variant:"ghost",size:"sm",onClick:n,className:"text-white hover:bg-gray-700",children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),"Back to Library"]}),e.jsx("h2",{children:"Player"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"No Project Loaded"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create a new project or load one from the library"})]})})}),e.jsx(qt,{open:!1,onOpenChange:()=>{},onCreateProject:async()=>{}})]});const St=g.useMemo(()=>{if(!t?.tracks)return[];const B=t.tracks.filter(Se=>ae.has(Se.id)),we=t.tracks.filter(Se=>!ae.has(Se.id));return[...B,...we]},[t?.tracks,ae]),br=B=>{Be("tempo",void 0,B)},yr=B=>{Be("chord",void 0,B)},jr={song:t,updateSong:B=>{r&&r(B)},tracks:t?.tracks||[],trackActions:{updateVolume:le.handleTrackVolumeChange,toggleMute:le.handleTrackMuteToggle,toggleSolo:le.handleTrackSoloToggle,updateName:le.handleTrackNameChange,updateColor:le.handleTrackColorChange,updateTag:le.handleTrackTagChange},currentTime:Y,gridTime:Q,tempo:X,isPlaying:q,zoom:l,setZoom:h,editMode:k,setEditMode:b,warpMode:Z,setWarpMode:O,keyShift:v,setKeyShift:y},Tt=Z?"warp":k?"marker":null,wr=B=>{B==="warp"?(O(!0),b(!0)):B==="marker"?(O(!1),b(!0)):(O(!1),b(!1))};return e.jsx(sa,{value:jr,children:e.jsx(Bt,{children:e.jsxs("div",{className:"flex flex-col h-full text-white",style:{backgroundColor:"var(--daw-bg-main)"},children:[e.jsx(Ta,{songTitle:t.title,songKey:t.key,isPlaying:q,currentTime:Y,tempo:X,loopEnabled:xe,metronomeEnabled:ie,metronomeVolume:Re,metronomeMode:V,currentMeasure:String(zt()),currentTimeSignature:sr(),displayTempo:X,keyShift:v,trackHeight:m,rulerVisibility:u,rulerOrder:p,snapEnabled:M,onBack:n,onPlayPause:ge.togglePlayPause,onStop:ge.stop,onLoopToggle:()=>ge.setLoopEnabled(!xe),onMetronomeToggle:()=>ge.setMetronomeEnabled(!ie),onMetronomeVolumeChange:ge.setMetronomeVolume,onMetronomeModeChange:S,onTempoChange:ge.setTempo,onKeyShiftChange:y,onTrackHeightChange:c,onRulerVisibilityChange:ir,onRulerOrderChange:x,onSnapToggle:()=>E(!M),onSnapModeChange:B=>console.log("Snap mode:",B),activeTool:Tt,onToolChange:wr}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-none h-auto border-b z-30",style:{backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:[P&&G&&e.jsx("div",{className:"flex-none border-r",style:{width:"280px",minWidth:"280px",maxWidth:"280px",backgroundColor:"var(--daw-bg-contrast)",borderColor:"var(--daw-border)"},children:e.jsx(_a,{visibleRulers:Object.keys(u).filter(B=>u[B]),rulerOrder:p,onRulerOrderChange:x})}),e.jsx("div",{className:"flex-1 overflow-x-hidden overflow-y-hidden",ref:R,children:e.jsx(tr,{song:t,currentTime:Y,gridTime:Q,tempo:X,zoom:l,pixelsPerSecond:Mt(),containerWidth:N,visibleRulers:Object.keys(u).filter(B=>u[B]),rulerOrder:p,onTimeClick:B=>ge.seek(B),onMarkerEdit:(B,we)=>Be(we,B),onMarkerDelete:(B,we)=>{},onTempoMarkerAdd:Tt==="marker"?br:void 0,onChordAdd:Tt==="marker"?yr:void 0,editMode:Tt==="marker",keyShift:v,warpMode:Z,onWarpCommit:rr,onChordClick:B=>{const we=t?.chordMarkers?.find(Se=>Se.chord===B);we&&vr(we)}})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[P&&G&&e.jsx(Qs,{ref:F,tracks:St,trackHeight:m,editingTrackId:null,trackNameInput:"",pinnedTracks:ae,onTrackVolumeChange:le.handleTrackVolumeChange,onTrackMuteToggle:le.handleTrackMuteToggle,onTrackSoloToggle:le.handleTrackSoloToggle,onTrackNameChange:le.handleTrackNameChange,onTrackColorChange:le.handleTrackColorChange,onTrackTagsChange:hr,onTrackNotesOpen:Ce,onEditingTrackIdChange:fr,onTrackNameInputChange:xr,onPinnedTracksChange:U,onScroll:cr}),e.jsx(Us,{ref:A,song:t,currentTime:Y,zoom:l,pixelsPerSecond:Mt(),filteredTracks:St,loopStart:pe,loopEnd:he,trackHeightPx:Ot(),onTimelineMouseDown:ce,onTimelineMouseMove:mr,onTimelineMouseUp:lr,onScroll:et}),e.jsx("div",{className:"w-4 flex-shrink-0",style:{backgroundColor:"var(--daw-bg-contrast)"},children:e.jsx(ea,{...ur(),onChange:dr,minHeight:.05})})]})]}),e.jsx(oo,{mixerDockVisible:$,notesPanelVisible:Me,orderedTracks:St,song:t,onTrackVolumeChange:le.handleTrackVolumeChange,onTrackMuteToggle:le.handleTrackMuteToggle,onTrackSoloToggle:le.handleTrackSoloToggle,onCloseMixerDock:pr,onCloseNotesPanel:()=>H(!1),onAddNote:nr,onDeleteNote:ar}),e.jsxs("div",{className:"border-t flex items-center h-8",style:{backgroundColor:"var(--daw-bg-bars)",borderColor:"var(--daw-border)"},children:[e.jsx("div",{className:"border-r flex items-center flex-shrink-0",style:{width:P&&G?"280px":"0",minWidth:P&&G?"280px":"0",borderColor:"var(--daw-border)"},children:e.jsx(Ga,{zoom:l,onZoomIn:kt,onZoomOut:Ke,onFitToView:ht})}),e.jsx(ho,{songDuration:t.duration,zoom:l,containerWidth:N,timelineRef:A,onNavigate:Lt})]}),e.jsx(Ua,{sidebarVisible:P,mixerDockVisible:$,notesPanelVisible:Me,mixPresetsPopoverOpen:fe,tracks:St,mixPresets:ut,onToggleSidebar:()=>z(!P),onToggleMixer:()=>J(!$),onToggleNotes:()=>H(!Me),onPerformanceMode:s||(()=>{}),onMixPresetsOpenChange:ue,onSaveMixPreset:Ge,onLoadMixPreset:We,onDeleteMixPreset:He}),e.jsx(qt,{open:T,onOpenChange:w,onCreateProject:async()=>{}}),e.jsx(Kn,{open:qe,onOpenChange:mt,type:j,currentTime:gr??oe,initialData:D,onSubmit:ke}),te&&e.jsx(Yn,{chord:te.chord,isOpen:!!te,onClose:()=>se(null),customDiagram:te.customDiagram}),me&&e.jsx(Qn,{open:!!me,onOpenChange:B=>{B||Ce(null)},trackName:me.name,notes:me.notes||"",onSave:B=>or(B,me.id)}),e.jsx(bn,{isOpen:re,onClose:()=>L(!1)})]})})})}function xo({song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n,onCreateProject:o,onExportProject:i}){return t?e.jsx(fo,{song:t,onSongUpdate:r,onPerformanceMode:s,onBack:n}):e.jsxs("div",{className:"flex flex-col h-full bg-gray-900 text-white",children:[e.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 p-3 flex items-center justify-between",children:[e.jsxs(I,{variant:"ghost",size:"sm",onClick:n,className:"text-white hover:bg-gray-700",children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),"Back to Library"]}),e.jsx("h2",{children:"Player"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2",children:"No Project Loaded"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create a new project or load one from the library"})]})})}),e.jsx(qt,{open:!1,onOpenChange:()=>{},onCreateProject:o||(async()=>{})})]})}const Mo=Object.freeze(Object.defineProperty({__proto__:null,DAWPlayer:xo},Symbol.toStringTag,{value:"Module"}));export{No as A,Mo as D,wo as L,Wa as P,lt as S,qs as T,Co as a,ca as b,Ha as c,qa as d,ia as e,Qt as f,aa as g,la as h,ls as p,ko as r,$e as s,dt as u,Et as w};
