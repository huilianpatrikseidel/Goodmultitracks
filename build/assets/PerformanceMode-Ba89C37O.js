import{r as c,j as e}from"./react-vendor-BoGJM_Cg.js";import{f as u,B as $,L as S}from"./library-feature-DCPrmRLD.js";import{b as Z,f as p,P as ee,c as te,d as se,S as re,e as ie,p as ae,h as ne}from"./player-feature-DuzHldha.js";import{X as oe,R as ce,n as le,g as de,V as me,W as xe,Y as ue}from"./icons-vendor-4kQF2o2m.js";import"./utils-vendor-BznqKjY6.js";import"./ui-vendor-1btjq6i-.js";import"./setlist-feature-BWtmnVv2.js";import"./toast-vendor-CHPPPCQ6.js";import"./audio-processing-DdlKDC9D.js";function ke({song:r,onClose:F}){const{isPlaying:j,currentTime:o,actions:l,metronomeEnabled:v,metronomeVolume:k,loopStart:C,loopEnd:M}=Z({song:r,initialTempo:r.tempo,warpModeEnabled:!1}),[R,N]=c.useState(""),[P,w]=c.useState(""),[E,b]=c.useState(""),[A,B]=c.useState(r.tempo),[V,I]=c.useState("4/4"),T=c.useRef(0),[D,O]=c.useState(1),[X,H]=c.useState(4),[f,K]=c.useState(!1),[L,J]=c.useState(void 0),z=s=>{if(!r.tempoChanges||r.tempoChanges.length===0)return{tempo:r.tempo,timeSignature:"4/4",subdivision:void 0};const i=[...r.tempoChanges].sort((n,x)=>n.time-x.time);let t=i[0];for(const n of i)if(n.time<=s)t=n;else break;let a=t.tempo;if(t.curve&&s>=t.time&&s<=t.curve.targetTime){const n=t.tempo,x=t.curve.targetTempo,h=t.curve.targetTime-t.time,d=(s-t.time)/h;if(t.curve.type==="linear")a=n+(x-n)*d;else if(t.curve.type==="exponential"){const m=1-Math.pow(1-d,2);a=n+(x-n)*m}}return{tempo:a,timeSignature:t.timeSignature,subdivision:t.subdivision}};c.useEffect(()=>{(i=>{const t=r.markers?.sort((d,m)=>d.time-m.time).slice().reverse().find(d=>d.time<=i);if(t){N(t.label);const d=r.markers?.findIndex(g=>g.id===t.id)||0,m=r.markers?.[d+1];w(m?m.label:"End")}else N("Intro"),w(r.markers?.[0]?.label||"End");const a=r.chordMarkers?.sort((d,m)=>d.time-m.time).slice().reverse().find(d=>d.time<=i);b(a?a.chord:"-");const n=z(i);B(n.tempo),I(n.timeSignature);const x=60/n.tempo,h=Math.floor(i/x);if(h>T.current){const d=n.timeSignature,m=n.subdivision;J(m);const g=ie(d,m);H(g);let y=1;if(m){const q=ae(m).reduce((Q,U)=>Q+U,0),G=h%q+1;y=ne(G,m).groupIndex+1}else y=h%g+1;O(y),T.current=h}})(o)},[o,r]),c.useEffect(()=>{const s=i=>{if(i.code==="Space"&&i.target instanceof HTMLElement){const t=i.target.tagName.toLowerCase();t!=="input"&&t!=="textarea"&&!i.target.isContentEditable&&(i.preventDefault(),l.togglePlayPause())}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]),c.useEffect(()=>{const s=[...r.markers].sort((a,n)=>a.time-n.time),i=s.reverse().find(a=>a.time<=o),t=s.find(a=>a.time>o);N(i?.label||"Start"),w(t?.label||"End")},[o,r.markers]),c.useEffect(()=>{if(!r.chordMarkers||r.chordMarkers.length===0){b("");return}const i=[...r.chordMarkers].sort((t,a)=>t.time-a.time).reverse().find(t=>t.time<=o);b(i?.chord||"")},[o,r.chordMarkers]),c.useEffect(()=>{const s=z(o);B(s.tempo),I(s.timeSignature)},[o,r.tempoChanges,r.tempo]);const W=s=>{const i=s.currentTarget.getBoundingClientRect(),n=(s.clientX-i.left)/i.width*r.duration;l.seek(Math.max(0,Math.min(r.duration,n)))},Y=s=>{const i=[...r.markers].sort((n,x)=>n.time-x.time),t=i.findIndex(n=>n.id===s.id),a=i[t+1];l.setLoopStart(s.time),l.setLoopEnd(a?a.time:r.duration),l.seek(s.time),l.setLoopEnabled(!0)},_=o/r.duration*100;return e.jsxs("div",{className:"fixed inset-0 bg-black text-white z-50 flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl mb-1",children:r.title}),e.jsx("p",{className:"text-xl text-gray-400",children:r.artist})]}),e.jsx(u,{variant:"ghost",size:"icon",onClick:F,className:"text-white hover:bg-gray-800",children:e.jsx(oe,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8",children:[E&&e.jsx("div",{className:"text-center mb-12",children:e.jsx("div",{className:"font-mono tracking-wider",style:{fontSize:"clamp(8rem, 20vw, 16rem)",lineHeight:"1",textShadow:"0 0 40px rgba(59, 130, 246, 0.5)"},children:E})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-5xl md:text-7xl mb-4 text-gray-300",children:R}),P&&e.jsxs("div",{className:"text-xl text-gray-500",children:["Next: ",P]})]}),e.jsxs("div",{className:"flex items-center gap-6 mb-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"BPM"}),e.jsx("div",{className:"text-3xl",children:Math.round(A)})]}),e.jsx("div",{className:"text-gray-600 text-4xl",children:"|"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"Time Signature"}),e.jsx("div",{className:"text-3xl",children:V})]})]}),v&&j&&e.jsxs("div",{className:"flex flex-col items-center gap-2 mb-8",children:[e.jsx("div",{className:"flex items-center gap-3",children:Array.from({length:X}).map((s,i)=>{const t=i+1,a=t===D,n=t===1;return e.jsx("div",{className:`w-4 h-4 rounded-full transition-all duration-100 ${a?n?"bg-blue-500 scale-150 shadow-lg shadow-blue-500/50":"bg-gray-400 scale-125 shadow-md shadow-gray-400/50":"bg-gray-700"}`},i)})}),f&&L&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Pattern: ",L]})]}),e.jsxs("div",{className:"text-4xl mb-8",children:[p(o)," / ",p(r.duration)]}),e.jsxs("div",{className:"w-full max-w-2xl mb-12",children:[e.jsx("div",{className:"relative mb-2 h-8",children:r.markers.map(s=>{const i=s.time/r.duration*100,t=s.time<=o&&(r.markers.find(a=>a.time>o)?.time||1/0)>s.time;return e.jsx("button",{onClick:()=>Y(s),className:`absolute -translate-x-1/2 px-2 py-1 text-xs rounded transition-all hover:scale-110 ${t?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,style:{left:`${i}%`,bottom:0},title:`Jump to ${s.label} at ${p(s.time)}`,children:s.label},s.id)})}),e.jsxs("div",{className:"h-4 bg-gray-800 rounded-full overflow-hidden cursor-pointer hover:bg-gray-700 transition-colors relative",onClick:W,children:[r.markers.map(s=>{const i=s.time/r.duration*100;return e.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-gray-600",style:{left:`${i}%`}},`div-${s.id}`)}),e.jsx("div",{className:"h-full bg-white transition-all pointer-events-none",style:{width:`${_}%`}})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"w-16 h-16 text-white hover:bg-gray-800",onClick:()=>{const i=[...r.markers].sort((t,a)=>t.time-a.time).reverse().find(t=>t.time<o-1);i&&l.seek(i.time)},children:e.jsx(ce,{className:"w-8 h-8"})}),e.jsx(u,{size:"icon",className:`w-24 h-24 rounded-full ${j?"bg-green-500 text-white hover:bg-green-600":"bg-green-800 text-white hover:bg-green-700"}`,onClick:()=>l.togglePlayPause(),children:j?e.jsx(le,{className:"w-12 h-12"}):e.jsx(de,{className:"w-12 h-12"})}),e.jsx(u,{variant:"ghost",size:"icon",className:"w-16 h-16 text-white hover:bg-gray-800",onClick:()=>{const i=[...r.markers].sort((t,a)=>t.time-a.time).find(t=>t.time>o);i&&l.seek(i.time)},children:e.jsx(me,{className:"w-8 h-8"})})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{variant:"outline",className:"text-lg py-2 px-4 border-white text-white",children:["Key: ",r.key]}),e.jsxs($,{variant:"outline",className:"text-lg py-2 px-4 border-white text-white",children:[r.tempo," BPM"]}),C!==null&&M!==null&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{l.setLoopEnabled(!1),l.setLoopStart(null),l.setLoopEnd(null)},className:"gap-2 border-green-600 text-green-500 hover:bg-green-900",children:[e.jsx(xe,{className:"w-4 h-4"}),"Loop: ",p(C)," - ",p(M)]}),e.jsxs(ee,{children:[e.jsx(te,{asChild:!0,children:e.jsx(u,{variant:"outline",size:"icon",className:`w-10 h-10 ${v?"bg-blue-600 border-blue-600 text-white hover:bg-blue-700":"border-white text-white hover:bg-gray-800"}`,children:e.jsx(ue,{className:"w-5 h-5"})})}),e.jsx(se,{className:"w-64 bg-gray-900 border-gray-700",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{className:"text-white",children:"Metronome"}),e.jsx(u,{variant:v?"default":"outline",size:"sm",onClick:()=>l.setMetronomeEnabled(!v),children:v?"ON":"OFF"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-white text-sm",children:"Volume"}),e.jsx(re,{value:[k*100],onValueChange:s=>l.setMetronomeVolume(s[0]/100),max:100,step:1,className:"w-full"}),e.jsxs("div",{className:"text-xs text-gray-400 text-right",children:[Math.round(k*100),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-700",children:[e.jsx(S,{className:"text-white text-sm",children:"Show Subdivisions"}),e.jsx(u,{variant:f?"default":"outline",size:"sm",onClick:()=>K(!f),children:f?"ON":"OFF"})]})]})})]})]}),e.jsx("div",{className:"text-sm text-gray-400",children:"MIDI Controls Active â€¢ Performance Mode"})]})})]})}export{ke as PerformanceMode};
